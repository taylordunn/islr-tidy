<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Classification | An Introduction to Statistical Learning with the tidyverse and tidymodels</title>
  <meta name="description" content="Working through ISLR with the tidyverse and tidymodels" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Classification | An Introduction to Statistical Learning with the tidyverse and tidymodels" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Working through ISLR with the tidyverse and tidymodels" />
  <meta name="github-repo" content="taylordunn/islr-tidy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Classification | An Introduction to Statistical Learning with the tidyverse and tidymodels" />
  
  <meta name="twitter:description" content="Working through ISLR with the tidyverse and tidymodels" />
  

<meta name="author" content="Taylor Dunn" />


<meta name="date" content="2022-09-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="linear-regression.html"/>
<link rel="next" href="resampling-methods.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Who, what, and why?</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#an-overview-of-statistical-learning"><i class="fa fa-check"></i>An Overview of Statistical Learning</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#wage-data"><i class="fa fa-check"></i>Wage Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#a-brief-history-of-statistical-learning"><i class="fa fa-check"></i>A Brief History of Statistical Learning</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#this-book"><i class="fa fa-check"></i>This Book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="statistical-learning.html"><a href="statistical-learning.html"><i class="fa fa-check"></i><b>2</b> Statistical Learning</a>
<ul>
<li class="chapter" data-level="2.1" data-path="statistical-learning.html"><a href="statistical-learning.html#what-is-statistical-learning"><i class="fa fa-check"></i><b>2.1</b> What Is Statistical Learning?</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="statistical-learning.html"><a href="statistical-learning.html#why-estimate-f"><i class="fa fa-check"></i><b>2.1.1</b> Why Estimate <span class="math inline">\(f\)</span>?</a></li>
<li class="chapter" data-level="2.1.2" data-path="statistical-learning.html"><a href="statistical-learning.html#how-do-we-estimate-f"><i class="fa fa-check"></i><b>2.1.2</b> How Do We Estimate f?</a></li>
<li class="chapter" data-level="2.1.3" data-path="statistical-learning.html"><a href="statistical-learning.html#the-trade-off-between-prediction-accuracy-and-model-interpretability"><i class="fa fa-check"></i><b>2.1.3</b> The Trade-Off Between Prediction Accuracy and Model Interpretability</a></li>
<li class="chapter" data-level="2.1.4" data-path="statistical-learning.html"><a href="statistical-learning.html#supervised-versus-unsupervised-learning"><i class="fa fa-check"></i><b>2.1.4</b> Supervised Versus Unsupervised Learning</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="statistical-learning.html"><a href="statistical-learning.html#assessing-model-accuracy"><i class="fa fa-check"></i><b>2.2</b> Assessing Model Accuracy</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="statistical-learning.html"><a href="statistical-learning.html#measuring-the-quality-of-fit"><i class="fa fa-check"></i><b>2.2.1</b> Measuring the Quality of Fit</a></li>
<li class="chapter" data-level="2.2.2" data-path="statistical-learning.html"><a href="statistical-learning.html#the-bias-variance-trade-off"><i class="fa fa-check"></i><b>2.2.2</b> The Bias-Variance Trade-Off</a></li>
<li class="chapter" data-level="2.2.3" data-path="statistical-learning.html"><a href="statistical-learning.html#the-classification-setting"><i class="fa fa-check"></i><b>2.2.3</b> The Classification Setting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="statistical-learning.html"><a href="statistical-learning.html#lab-introduction-to-r"><i class="fa fa-check"></i><b>2.3</b> Lab: Introduction to R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>3</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="linear-regression.html"><a href="linear-regression.html#simple-linear-regression"><i class="fa fa-check"></i><b>3.1</b> Simple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="linear-regression.html"><a href="linear-regression.html#estimating-the-coefficients"><i class="fa fa-check"></i><b>3.1.1</b> Estimating the Coefficients</a></li>
<li class="chapter" data-level="3.1.2" data-path="linear-regression.html"><a href="linear-regression.html#assessing-the-accuracy-of-the-coefficient-estimates"><i class="fa fa-check"></i><b>3.1.2</b> Assessing the Accuracy of the Coefficient Estimates</a></li>
<li class="chapter" data-level="3.1.3" data-path="linear-regression.html"><a href="linear-regression.html#assessing-the-accuracy-of-the-model"><i class="fa fa-check"></i><b>3.1.3</b> Assessing the Accuracy of the Model</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="linear-regression.html"><a href="linear-regression.html#multiple-linear-regression"><i class="fa fa-check"></i><b>3.2</b> Multiple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="linear-regression.html"><a href="linear-regression.html#estimating-the-regression-coefficients"><i class="fa fa-check"></i><b>3.2.1</b> Estimating the Regression Coefficients</a></li>
<li class="chapter" data-level="3.2.2" data-path="linear-regression.html"><a href="linear-regression.html#some-important-questions"><i class="fa fa-check"></i><b>3.2.2</b> Some Important Questions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="linear-regression.html"><a href="linear-regression.html#other-considerations-in-the-regression-model"><i class="fa fa-check"></i><b>3.3</b> Other Considerations in the Regression Model</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="linear-regression.html"><a href="linear-regression.html#qualitative-predictors"><i class="fa fa-check"></i><b>3.3.1</b> Qualitative Predictors</a></li>
<li class="chapter" data-level="3.3.2" data-path="linear-regression.html"><a href="linear-regression.html#extensions-of-the-linear-model"><i class="fa fa-check"></i><b>3.3.2</b> Extensions of the Linear Model</a></li>
<li class="chapter" data-level="3.3.3" data-path="linear-regression.html"><a href="linear-regression.html#potential-problems"><i class="fa fa-check"></i><b>3.3.3</b> Potential Problems</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="linear-regression.html"><a href="linear-regression.html#the-marketing-plan"><i class="fa fa-check"></i><b>3.4</b> The Marketing Plan</a></li>
<li class="chapter" data-level="3.5" data-path="linear-regression.html"><a href="linear-regression.html#comparison-of-linear-regression-with-k-nearest-neighbors"><i class="fa fa-check"></i><b>3.5</b> Comparison of Linear Regression with <span class="math inline">\(K\)</span>-Nearest Neighbors</a></li>
<li class="chapter" data-level="3.6" data-path="linear-regression.html"><a href="linear-regression.html#lab-linear-regression"><i class="fa fa-check"></i><b>3.6</b> Lab: Linear Regression</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="linear-regression.html"><a href="linear-regression.html#libraries"><i class="fa fa-check"></i><b>3.6.1</b> Libraries</a></li>
<li class="chapter" data-level="3.6.2" data-path="linear-regression.html"><a href="linear-regression.html#simple-linear-regression-1"><i class="fa fa-check"></i><b>3.6.2</b> Simple Linear Regression</a></li>
<li class="chapter" data-level="3.6.3" data-path="linear-regression.html"><a href="linear-regression.html#multiple-linear-regression-1"><i class="fa fa-check"></i><b>3.6.3</b> Multiple Linear Regression</a></li>
<li class="chapter" data-level="3.6.4" data-path="linear-regression.html"><a href="linear-regression.html#interaction-terms"><i class="fa fa-check"></i><b>3.6.4</b> Interaction Terms</a></li>
<li class="chapter" data-level="3.6.5" data-path="linear-regression.html"><a href="linear-regression.html#non-linear-transformations-of-the-predictors"><i class="fa fa-check"></i><b>3.6.5</b> Non-linear Transformations of the Predictors</a></li>
<li class="chapter" data-level="3.6.6" data-path="linear-regression.html"><a href="linear-regression.html#qualitative-predictors-1"><i class="fa fa-check"></i><b>3.6.6</b> Qualitative Predictors</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="linear-regression.html"><a href="linear-regression.html#exercises"><i class="fa fa-check"></i><b>3.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#applied"><i class="fa fa-check"></i>Applied</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#reproducibility"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>4</b> Classification</a>
<ul>
<li class="chapter" data-level="4.1" data-path="classification.html"><a href="classification.html#an-overview-of-classification"><i class="fa fa-check"></i><b>4.1</b> An Overview of Classification</a></li>
<li class="chapter" data-level="4.2" data-path="classification.html"><a href="classification.html#why-not-linear-regression"><i class="fa fa-check"></i><b>4.2</b> Why Not Linear Regression?</a></li>
<li class="chapter" data-level="4.3" data-path="classification.html"><a href="classification.html#logistic-regression"><i class="fa fa-check"></i><b>4.3</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="classification.html"><a href="classification.html#the-logistic-model"><i class="fa fa-check"></i><b>4.3.1</b> The Logistic Model</a></li>
<li class="chapter" data-level="4.3.2" data-path="classification.html"><a href="classification.html#estimating-the-regression-coefficients-1"><i class="fa fa-check"></i><b>4.3.2</b> Estimating the Regression Coefficients</a></li>
<li class="chapter" data-level="4.3.3" data-path="classification.html"><a href="classification.html#making-predictions"><i class="fa fa-check"></i><b>4.3.3</b> Making Predictions</a></li>
<li class="chapter" data-level="4.3.4" data-path="classification.html"><a href="classification.html#multiple-logistic-regression"><i class="fa fa-check"></i><b>4.3.4</b> Multiple Logistic Regression</a></li>
<li class="chapter" data-level="4.3.5" data-path="classification.html"><a href="classification.html#multinomial-logistic-regression"><i class="fa fa-check"></i><b>4.3.5</b> Multinomial Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="classification.html"><a href="classification.html#generative-models-for-classification"><i class="fa fa-check"></i><b>4.4</b> Generative Models for Classification</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="classification.html"><a href="classification.html#linear-discriminant-analysis-for-p-1"><i class="fa fa-check"></i><b>4.4.1</b> Linear Discriminant Analysis for <span class="math inline">\(p = 1\)</span></a></li>
<li class="chapter" data-level="4.4.2" data-path="classification.html"><a href="classification.html#linear-discriminant-analysis-for-p-1-1"><i class="fa fa-check"></i><b>4.4.2</b> Linear Discriminant Analysis for <span class="math inline">\(p &gt; 1\)</span></a></li>
<li class="chapter" data-level="4.4.3" data-path="classification.html"><a href="classification.html#quadratic-discriminant-analysis"><i class="fa fa-check"></i><b>4.4.3</b> Quadratic Discriminant Analysis</a></li>
<li class="chapter" data-level="4.4.4" data-path="classification.html"><a href="classification.html#naive-bayes"><i class="fa fa-check"></i><b>4.4.4</b> Naive Bayes</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="classification.html"><a href="classification.html#a-comparison-of-classification-methods"><i class="fa fa-check"></i><b>4.5</b> A Comparison of Classification Methods</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="classification.html"><a href="classification.html#an-analytical-comparison"><i class="fa fa-check"></i><b>4.5.1</b> An Analytical Comparison</a></li>
<li class="chapter" data-level="4.5.2" data-path="classification.html"><a href="classification.html#an-empirical-comparison"><i class="fa fa-check"></i><b>4.5.2</b> An Empirical Comparison</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="classification.html"><a href="classification.html#generalized-linear-models"><i class="fa fa-check"></i><b>4.6</b> Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="classification.html"><a href="classification.html#linear-regression-on-the-bikeshare-data"><i class="fa fa-check"></i><b>4.6.1</b> Linear Regression on the Bikeshare Data</a></li>
<li class="chapter" data-level="4.6.2" data-path="classification.html"><a href="classification.html#poisson-regression-on-bikeshare-data"><i class="fa fa-check"></i><b>4.6.2</b> Poisson Regression on Bikeshare Data</a></li>
<li class="chapter" data-level="4.6.3" data-path="classification.html"><a href="classification.html#generalized-linear-models-in-greater-generality"><i class="fa fa-check"></i><b>4.6.3</b> Generalized Linear Models in Greater Generality</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="classification.html"><a href="classification.html#lab-classification-methods"><i class="fa fa-check"></i><b>4.7</b> Lab: Classification Methods</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="classification.html"><a href="classification.html#the-stock-market-data"><i class="fa fa-check"></i><b>4.7.1</b> The Stock Market Data</a></li>
<li class="chapter" data-level="4.7.2" data-path="classification.html"><a href="classification.html#logistic-regression-1"><i class="fa fa-check"></i><b>4.7.2</b> Logistic Regression</a></li>
<li class="chapter" data-level="4.7.3" data-path="classification.html"><a href="classification.html#linear-discriminant-analysis"><i class="fa fa-check"></i><b>4.7.3</b> Linear Discriminant Analysis</a></li>
<li class="chapter" data-level="4.7.4" data-path="classification.html"><a href="classification.html#quadratic-discriminant-analysis-1"><i class="fa fa-check"></i><b>4.7.4</b> Quadratic Discriminant Analysis</a></li>
<li class="chapter" data-level="4.7.5" data-path="classification.html"><a href="classification.html#naive-bayes-1"><i class="fa fa-check"></i><b>4.7.5</b> Naive Bayes</a></li>
<li class="chapter" data-level="4.7.6" data-path="classification.html"><a href="classification.html#k-nearest-neighbors-1"><i class="fa fa-check"></i><b>4.7.6</b> <span class="math inline">\(K\)</span>-Nearest Neighbors</a></li>
<li class="chapter" data-level="4.7.7" data-path="classification.html"><a href="classification.html#poisson-regression"><i class="fa fa-check"></i><b>4.7.7</b> Poisson Regression</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="classification.html"><a href="classification.html#exercises-1"><i class="fa fa-check"></i><b>4.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="classification.html"><a href="classification.html#applied-1"><i class="fa fa-check"></i>Applied</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="classification.html"><a href="classification.html#reproducibility-1"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="resampling-methods.html"><a href="resampling-methods.html"><i class="fa fa-check"></i><b>5</b> Resampling Methods</a>
<ul>
<li class="chapter" data-level="5.1" data-path="resampling-methods.html"><a href="resampling-methods.html#cross-validation"><i class="fa fa-check"></i><b>5.1</b> Cross Validation</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="resampling-methods.html"><a href="resampling-methods.html#validation-set"><i class="fa fa-check"></i><b>5.1.1</b> The Validation Set Approach</a></li>
<li class="chapter" data-level="5.1.2" data-path="resampling-methods.html"><a href="resampling-methods.html#loocv"><i class="fa fa-check"></i><b>5.1.2</b> Leave-One-Out Cross Validation</a></li>
<li class="chapter" data-level="5.1.3" data-path="resampling-methods.html"><a href="resampling-methods.html#kfoldcv"><i class="fa fa-check"></i><b>5.1.3</b> <span class="math inline">\(k\)</span>-fold Cross-Validation</a></li>
<li class="chapter" data-level="5.1.4" data-path="resampling-methods.html"><a href="resampling-methods.html#bias-variance-trade-off-for-k-fold-cross-validation"><i class="fa fa-check"></i><b>5.1.4</b> Bias-Variance Trade-Off for <span class="math inline">\(k\)</span>-Fold Cross-Validation</a></li>
<li class="chapter" data-level="5.1.5" data-path="resampling-methods.html"><a href="resampling-methods.html#cross-validation-on-classification-problems"><i class="fa fa-check"></i><b>5.1.5</b> Cross-Validation on Classification Problems</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="resampling-methods.html"><a href="resampling-methods.html#bootstrap-lab"><i class="fa fa-check"></i><b>5.2</b> The Bootstrap</a></li>
<li class="chapter" data-level="5.3" data-path="resampling-methods.html"><a href="resampling-methods.html#lab-cross-validation-and-the-bootstrap"><i class="fa fa-check"></i><b>5.3</b> Lab: Cross-Validation and the Bootstrap</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="resampling-methods.html"><a href="resampling-methods.html#the-validation-set-approach"><i class="fa fa-check"></i><b>5.3.1</b> The Validation Set Approach</a></li>
<li class="chapter" data-level="5.3.2" data-path="resampling-methods.html"><a href="resampling-methods.html#leave-one-out-cross-validation"><i class="fa fa-check"></i><b>5.3.2</b> Leave-One-Out Cross-Validation</a></li>
<li class="chapter" data-level="5.3.3" data-path="resampling-methods.html"><a href="resampling-methods.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>5.3.3</b> <span class="math inline">\(k\)</span>-fold Cross-Validation</a></li>
<li class="chapter" data-level="5.3.4" data-path="resampling-methods.html"><a href="resampling-methods.html#bootstrap"><i class="fa fa-check"></i><b>5.3.4</b> The Bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="resampling-methods.html"><a href="resampling-methods.html#exercises-2"><i class="fa fa-check"></i><b>5.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="resampling-methods.html"><a href="resampling-methods.html#applied-2"><i class="fa fa-check"></i>Applied</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="resampling-methods.html"><a href="resampling-methods.html#reproducibility-2"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html"><i class="fa fa-check"></i><b>6</b> Linear Model Selection and Regularization</a>
<ul>
<li class="chapter" data-level="6.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#subset-selection"><i class="fa fa-check"></i><b>6.1</b> Subset Selection</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#best-subset-selection"><i class="fa fa-check"></i><b>6.1.1</b> Best Subset Selection</a></li>
<li class="chapter" data-level="6.1.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#stepwise-selection"><i class="fa fa-check"></i><b>6.1.2</b> Stepwise Selection</a></li>
<li class="chapter" data-level="6.1.3" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#choosing-the-optimal-model"><i class="fa fa-check"></i><b>6.1.3</b> Choosing the Optimal Model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#shrinkage-methods"><i class="fa fa-check"></i><b>6.2</b> Shrinkage Methods</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#ridge-regression"><i class="fa fa-check"></i><b>6.2.1</b> Ridge Regression</a></li>
<li class="chapter" data-level="6.2.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#the-lasso"><i class="fa fa-check"></i><b>6.2.2</b> The Lasso</a></li>
<li class="chapter" data-level="6.2.3" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#selecting-the-tuning-parameter"><i class="fa fa-check"></i><b>6.2.3</b> Selecting the Tuning Parameter</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#dimension-reduction-methods"><i class="fa fa-check"></i><b>6.3</b> Dimension Reduction Methods</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#principal-components-regression"><i class="fa fa-check"></i><b>6.3.1</b> Principal Components Regression</a></li>
<li class="chapter" data-level="6.3.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#partial-least-squares"><i class="fa fa-check"></i><b>6.3.2</b> Partial Least Squares</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#considerations-in-high-dimensions"><i class="fa fa-check"></i><b>6.4</b> Considerations in High Dimensions</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#high-dimensional-data"><i class="fa fa-check"></i><b>6.4.1</b> High-Dimensional Data</a></li>
<li class="chapter" data-level="6.4.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#what-goes-wrong-in-high-dimensions"><i class="fa fa-check"></i><b>6.4.2</b> What Goes Wrong in High Dimensions?</a></li>
<li class="chapter" data-level="6.4.3" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#regression-in-high-dimensions"><i class="fa fa-check"></i><b>6.4.3</b> Regression in High Dimensions</a></li>
<li class="chapter" data-level="6.4.4" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#interpreting-results-in-high-dimensions"><i class="fa fa-check"></i><b>6.4.4</b> Interpreting Results in High Dimensions</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#lab-linear-models-and-regularization-methods"><i class="fa fa-check"></i><b>6.5</b> Lab: Linear Models and Regularization Methods</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#subset-selection-methods"><i class="fa fa-check"></i><b>6.5.1</b> Subset Selection Methods</a></li>
<li class="chapter" data-level="6.5.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#ridge-regression-and-the-lasso"><i class="fa fa-check"></i><b>6.5.2</b> Ridge Regression and the Lasso</a></li>
<li class="chapter" data-level="6.5.3" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#pcr-and-pls-regression"><i class="fa fa-check"></i><b>6.5.3</b> PCR and PLS Regression</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#exercises-3"><i class="fa fa-check"></i><b>6.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#applied-3"><i class="fa fa-check"></i>Applied</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#reproducibility-3"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html"><i class="fa fa-check"></i><b>7</b> Moving Beyond Linearity</a>
<ul>
<li class="chapter" data-level="7.1" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#polynomial-regression"><i class="fa fa-check"></i><b>7.1</b> Polynomial Regression</a></li>
<li class="chapter" data-level="7.2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#step-functions"><i class="fa fa-check"></i><b>7.2</b> Step Functions</a></li>
<li class="chapter" data-level="7.3" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#basis-functions"><i class="fa fa-check"></i><b>7.3</b> Basis Functions</a></li>
<li class="chapter" data-level="7.4" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#regression-splines"><i class="fa fa-check"></i><b>7.4</b> Regression Splines</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#piecewise-polynomials"><i class="fa fa-check"></i><b>7.4.1</b> Piecewise Polynomials</a></li>
<li class="chapter" data-level="7.4.2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#constraints-and-splines"><i class="fa fa-check"></i><b>7.4.2</b> Constraints and Splines</a></li>
<li class="chapter" data-level="7.4.3" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#spline-basis"><i class="fa fa-check"></i><b>7.4.3</b> The Spline Basis Representation</a></li>
<li class="chapter" data-level="7.4.4" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#choosing-knots"><i class="fa fa-check"></i><b>7.4.4</b> Choosing the Number and Locations of the Knots</a></li>
<li class="chapter" data-level="7.4.5" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#comparison-polynomial"><i class="fa fa-check"></i><b>7.4.5</b> Comparison to Polynomial Regression</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#smoothing-splines"><i class="fa fa-check"></i><b>7.5</b> Smoothing Splines</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#an-overview-of-smoothing-splines"><i class="fa fa-check"></i><b>7.5.1</b> An Overview of Smoothing Splines</a></li>
<li class="chapter" data-level="7.5.2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#smoothing-parameter"><i class="fa fa-check"></i><b>7.5.2</b> Choosing the Smoothing Parameter <span class="math inline">\(\lambda\)</span></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#local-regression"><i class="fa fa-check"></i><b>7.6</b> Local Regression</a></li>
<li class="chapter" data-level="7.7" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#generalized-additive-models"><i class="fa fa-check"></i><b>7.7</b> Generalized Additive Models</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#gam-regression"><i class="fa fa-check"></i><b>7.7.1</b> GAMs for Regression Problems</a></li>
<li class="chapter" data-level="7.7.2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#gam-classification"><i class="fa fa-check"></i><b>7.7.2</b> GAMs for Classification Problems</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#lab-non-linear-modeling"><i class="fa fa-check"></i><b>7.8</b> Lab: Non-linear Modeling</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#polynomial-regression-and-step-functions"><i class="fa fa-check"></i><b>7.8.1</b> Polynomial Regression and Step Functions</a></li>
<li class="chapter" data-level="7.8.2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#splines"><i class="fa fa-check"></i><b>7.8.2</b> Splines</a></li>
<li class="chapter" data-level="7.8.3" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#gams-lab"><i class="fa fa-check"></i><b>7.8.3</b> GAMs</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#exercises-4"><i class="fa fa-check"></i><b>7.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#applied-4"><i class="fa fa-check"></i>Applied</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#reproducibility-4"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tree-based-methods.html"><a href="tree-based-methods.html"><i class="fa fa-check"></i><b>8</b> Tree-Based Methods</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tree-based-methods.html"><a href="tree-based-methods.html#the-basics-of-decision-trees"><i class="fa fa-check"></i><b>8.1</b> The Basics of Decision Trees</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="tree-based-methods.html"><a href="tree-based-methods.html#regression-trees"><i class="fa fa-check"></i><b>8.1.1</b> Regression Trees</a></li>
<li class="chapter" data-level="8.1.2" data-path="tree-based-methods.html"><a href="tree-based-methods.html#classification-trees"><i class="fa fa-check"></i><b>8.1.2</b> Classification Trees</a></li>
<li class="chapter" data-level="8.1.3" data-path="tree-based-methods.html"><a href="tree-based-methods.html#trees-versus-linear-models"><i class="fa fa-check"></i><b>8.1.3</b> Trees Versus Linear Models</a></li>
<li class="chapter" data-level="8.1.4" data-path="tree-based-methods.html"><a href="tree-based-methods.html#advantages-and-disadvantages-of-trees"><i class="fa fa-check"></i><b>8.1.4</b> Advantages and Disadvantages of Trees</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="tree-based-methods.html"><a href="tree-based-methods.html#bagging-random-forests-boosting-and-bayesian-additive-regression-trees"><i class="fa fa-check"></i><b>8.2</b> Bagging, Random Forests, Boosting, and Bayesian Additive Regression Trees</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="tree-based-methods.html"><a href="tree-based-methods.html#bagging"><i class="fa fa-check"></i><b>8.2.1</b> Bagging</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tree-based-methods.html"><a href="tree-based-methods.html#reproducibility-5"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An Introduction to Statistical Learning with the tidyverse and tidymodels</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="classification" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Classification<a href="classification.html#classification" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p>But in many situations, the response
variable is instead qualitative. For example, eye color is qualitative. Often qualitative variables are referred to as categorical; we will use these
terms interchangeably. In this chapter, we study approaches for predicting
qualitative responses, a process that is known as classification.</p>
</blockquote>
<p>The methods covered in this chapter include logistic regression (and Poisson regression), linear discriminant analysis, quadratic discriminant analysis, naive Bayes, and <span class="math inline">\(K\)</span>-nearest neighbors.</p>
<div id="an-overview-of-classification" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> An Overview of Classification<a href="classification.html#an-overview-of-classification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>In this chapter, we will illustrate the concept of classification using the
simulated <code>Default</code> data set. We are interested in predicting whether an
individual will default on his or her credit card payment, on the basis of
annual income and monthly credit card balance.</p>
</blockquote>
<p>Load the go-to packages and the <code>default</code> data set:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="classification.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb176-2"><a href="classification.html#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb176-3"><a href="classification.html#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb176-4"><a href="classification.html#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># for composing plots</span></span>
<span id="cb176-5"><a href="classification.html#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tictoc) <span class="co"># for timing code execution</span></span>
<span id="cb176-6"><a href="classification.html#cb176-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-7"><a href="classification.html#cb176-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load my R package and set the ggplot theme</span></span>
<span id="cb176-8"><a href="classification.html#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dunnr)</span>
<span id="cb176-9"><a href="classification.html#cb176-9" aria-hidden="true" tabindex="-1"></a>extrafont<span class="sc">::</span><span class="fu">loadfonts</span>(<span class="at">device =</span> <span class="st">&quot;win&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb176-10"><a href="classification.html#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_td</span>())</span>
<span id="cb176-11"><a href="classification.html#cb176-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set_geom_fonts</span>()</span>
<span id="cb176-12"><a href="classification.html#cb176-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set_palette</span>()</span>
<span id="cb176-13"><a href="classification.html#cb176-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-14"><a href="classification.html#cb176-14" aria-hidden="true" tabindex="-1"></a>default <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Default</span>
<span id="cb176-15"><a href="classification.html#cb176-15" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(default)</span></code></pre></div>
<pre><code>## Rows: 10,000
## Columns: 4
## $ default &lt;fct&gt; No, No, No, No, No, No, No, No, No, No, No, No, No, No, No, No…
## $ student &lt;fct&gt; No, Yes, No, No, No, Yes, No, Yes, No, No, Yes, Yes, No, No, N…
## $ balance &lt;dbl&gt; 729.5265, 817.1804, 1073.5492, 529.2506, 785.6559, 919.5885, 8…
## $ income  &lt;dbl&gt; 44361.625, 12106.135, 31767.139, 35704.494, 38463.496, 7491.55…</code></pre>
<p>Randomly choose a subset of the 10000 observations and re-create Figure 4.1:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="classification.html#cb178-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> default <span class="sc">%&gt;%</span></span>
<span id="cb178-2"><a href="classification.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(default, <span class="at">name =</span> <span class="st">&quot;n_group&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb178-3"><a href="classification.html#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(</span>
<span id="cb178-4"><a href="classification.html#cb178-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">1000</span>,</span>
<span id="cb178-5"><a href="classification.html#cb178-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inversely weight by group size to get more even distribution</span></span>
<span id="cb178-6"><a href="classification.html#cb178-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_by =</span> <span class="fu">n</span>() <span class="sc">-</span> n_group</span>
<span id="cb178-7"><a href="classification.html#cb178-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb178-8"><a href="classification.html#cb178-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb178-9"><a href="classification.html#cb178-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> balance, <span class="at">y =</span> income)) <span class="sc">+</span></span>
<span id="cb178-10"><a href="classification.html#cb178-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> default, <span class="at">shape =</span> default),</span>
<span id="cb178-11"><a href="classification.html#cb178-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb178-12"><a href="classification.html#cb178-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb178-13"><a href="classification.html#cb178-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> default, <span class="at">y =</span> balance)) <span class="sc">+</span></span>
<span id="cb178-14"><a href="classification.html#cb178-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> default), <span class="at">show.legend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb178-15"><a href="classification.html#cb178-15" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb178-16"><a href="classification.html#cb178-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> default, <span class="at">y =</span> income)) <span class="sc">+</span></span>
<span id="cb178-17"><a href="classification.html#cb178-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> default), <span class="at">show.legend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb178-18"><a href="classification.html#cb178-18" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> (p2 <span class="sc">|</span> p3)</span></code></pre></div>
<p><img src="_main_files/figure-html/figure4.1-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="why-not-linear-regression" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Why Not Linear Regression?<a href="classification.html#why-not-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Linear regression cannot predict un-ordered qualitative responses with more than two levels.</p>
<blockquote>
<p>Unfortunately, in general there is no natural way to
convert a qualitative response variable with more than two levels into a
quantitative response that is ready for linear regression.</p>
</blockquote>
<p>It is possible to use linear regression to predict a binary (two level) response.
For example, if we code stroke and drug overdose as dummy variables:</p>
<p><span class="math display">\[
Y =
\begin{cases}
0 &amp; \text{if stroke;} \\
1 &amp; \text{if drug overdose}.
\end{cases}
\]</span></p>
<p>Then we predict stroke if <span class="math inline">\(\hat{Y} &lt;= 0.5\)</span> and overdose if <span class="math inline">\(\hat{Y} &gt; 0.5\)</span>.
It turns out that these probability estimates are not unreasonble, but there can be issues:</p>
<blockquote>
<p>However, if we use linear regression, some of our estimates might be outside the [0, 1] interval (see Figure 4.2), making them
hard to interpret as probabilities! Nevertheless, the predictions provide an ordering and can be interpreted as crude probability estimates.</p>
</blockquote>
</div>
<div id="logistic-regression" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Logistic Regression<a href="classification.html#logistic-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In logistic regression, we model the probability of <span class="math inline">\(Y\)</span> belonging to a class, rather than the response <span class="math inline">\(Y\)</span> itself.
The probability of <code>default</code> given <code>balance</code> can be written:</p>
<p><span class="math display">\[
\text{Pr}(\text{default = Yes}|\text{balance}) = p(\text{balance}).
\]</span></p>
<p>One might predict a default for an individual with <span class="math inline">\(p(\text{balance}) &gt; 0.5\)</span>.
Or they may alter the threshold to be conservative, e.g. <span class="math inline">\(p(\text{balance}) &gt; 0.1\)</span></p>
<div id="the-logistic-model" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> The Logistic Model<a href="classification.html#the-logistic-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As previously discussed, we could model the probability as linear:</p>
<p><span class="math display">\[
p(X) = \beta_0 + \beta_1 X
\]</span></p>
<p>but this could give probabilities outside of the range 0-1.
We must instead model <span class="math inline">\(p(X)\)</span> using a function that gives outputs 0-1.
Many functions meet this description, but logistic regression uses the logistic function:</p>
<p><span class="math display">\[
p(X) = \frac{e^{\beta_0 + \beta_1X}}{1 + e^{\beta_0 + \beta_1 X}}.
\]</span></p>
<p>Fit the linear and logistic probability models and re-create Figure 4.2:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="classification.html#cb179-1" aria-hidden="true" tabindex="-1"></a>lm_default_balance <span class="ot">&lt;-</span></span>
<span id="cb179-2"><a href="classification.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb179-3"><a href="classification.html#cb179-3" aria-hidden="true" tabindex="-1"></a>    default <span class="sc">~</span> balance,</span>
<span id="cb179-4"><a href="classification.html#cb179-4" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Turn the factor levels into 0 and 1</span></span>
<span id="cb179-5"><a href="classification.html#cb179-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> default <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">default =</span> <span class="fu">as.numeric</span>(default) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb179-6"><a href="classification.html#cb179-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb179-7"><a href="classification.html#cb179-7" aria-hidden="true" tabindex="-1"></a>glm_default_balance <span class="ot">&lt;-</span></span>
<span id="cb179-8"><a href="classification.html#cb179-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(default <span class="sc">~</span> balance, <span class="at">data =</span> default,</span>
<span id="cb179-9"><a href="classification.html#cb179-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb179-10"><a href="classification.html#cb179-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb179-11"><a href="classification.html#cb179-11" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> default <span class="sc">%&gt;%</span></span>
<span id="cb179-12"><a href="classification.html#cb179-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> balance)) <span class="sc">+</span></span>
<span id="cb179-13"><a href="classification.html#cb179-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(default) <span class="sc">-</span> <span class="dv">1</span>), <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>soft_orange, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb179-14"><a href="classification.html#cb179-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the linear model</span></span>
<span id="cb179-15"><a href="classification.html#cb179-15" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb179-16"><a href="classification.html#cb179-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="fu">coef</span>(lm_default_balance)[<span class="st">&quot;balance&quot;</span>],</span>
<span id="cb179-17"><a href="classification.html#cb179-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">intercept =</span> <span class="fu">coef</span>(lm_default_balance)[<span class="st">&quot;(Intercept)&quot;</span>],</span>
<span id="cb179-18"><a href="classification.html#cb179-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>strong_blue) <span class="sc">+</span></span>
<span id="cb179-19"><a href="classification.html#cb179-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Probability of default&quot;</span>)</span>
<span id="cb179-20"><a href="classification.html#cb179-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the logistic model</span></span>
<span id="cb179-21"><a href="classification.html#cb179-21" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb179-22"><a href="classification.html#cb179-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb179-23"><a href="classification.html#cb179-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> pred_default),</span>
<span id="cb179-24"><a href="classification.html#cb179-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">balance =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2700</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb179-25"><a href="classification.html#cb179-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb179-26"><a href="classification.html#cb179-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">sum_beta =</span> <span class="fu">coef</span>(glm_default_balance)[<span class="st">&quot;(Intercept)&quot;</span>] <span class="sc">+</span></span>
<span id="cb179-27"><a href="classification.html#cb179-27" aria-hidden="true" tabindex="-1"></a>                       balance <span class="sc">*</span> <span class="fu">coef</span>(glm_default_balance)[<span class="st">&quot;balance&quot;</span>],</span>
<span id="cb179-28"><a href="classification.html#cb179-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">pred_default =</span> <span class="fu">plogis</span>(sum_beta)</span>
<span id="cb179-29"><a href="classification.html#cb179-29" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb179-30"><a href="classification.html#cb179-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>strong_blue</span>
<span id="cb179-31"><a href="classification.html#cb179-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb179-32"><a href="classification.html#cb179-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb179-33"><a href="classification.html#cb179-33" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/figure4.2-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>A very clear improvement.
The mean of the fitted probabilities in both models return the overall proportion of defaulters in the data set:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="classification.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(lm_default_balance, <span class="at">newdata =</span> default) <span class="sc">%&gt;%</span></span>
<span id="cb180-2"><a href="classification.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] 0.0333</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="classification.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(glm_default_balance, <span class="at">newdata =</span> default) <span class="sc">%&gt;%</span></span>
<span id="cb182-2"><a href="classification.html#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plogis</span>() <span class="sc">%&gt;%</span></span>
<span id="cb182-3"><a href="classification.html#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] 0.0333</code></pre>
<p>The odds is found by re-arranging the logistic function:</p>
<p><span class="math display">\[
\frac{p(X)}{1 - p(X)} = e^{\beta_0 + \beta_1 X}.
\]</span></p>
<p>This can take any value between 0 (<span class="math inline">\(p(X) = 0\)</span>) and <span class="math inline">\(\infty\)</span> (<span class="math inline">\(p(X) = 1\)</span>).
Basic interpretation:</p>
<ul>
<li>A probability of 0.2 gives 1:4 odds.</li>
<li>A probability of 0.9 gives 9:1 odds.</li>
</ul>
<p>Taking the logarithm of both sides gives us the log odds or logit which is linear in <span class="math inline">\(X\)</span>:</p>
<p><span class="math display">\[
\log \left(\frac{p(X)}{1 - p(X)}\right) = \beta_0 + \beta_1 X.
\]</span>
A one unit change in <span class="math inline">\(X\)</span> increases the log odds by <span class="math inline">\(\beta_1\)</span>.
Equivalently, it multiplies the odds by <span class="math inline">\(e^{\beta_1}\)</span>.</p>
</div>
<div id="estimating-the-regression-coefficients-1" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Estimating the Regression Coefficients<a href="classification.html#estimating-the-regression-coefficients-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We fit logistic regression models with maximum likelihood, which seeks estimates for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> such that the predicted probabilities <span class="math inline">\(\hat{p}(x_i)\)</span> corresponds as closely as possible to the values <span class="math inline">\(y_i\)</span>.
This idea is formalized using a likelihood function:</p>
<p><span class="math display">\[
\ell (\beta_0, \beta_1) = \prod_{i: y_i = 1} p(x_i) \prod_{i&#39;: y_{i&#39;} = 0} (1 - p(x_{i&#39;})).
\]</span></p>
<p>We find the estimates <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span> by maximizing this likelihood function.
Note that the least squares approach to linear regression is a special case of maximum likelihood.</p>
<p>Re-produce Table 4.1 using the fitted model:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="classification.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Since I will be reproducing this table often, write a function</span></span>
<span id="cb184-2"><a href="classification.html#cb184-2" aria-hidden="true" tabindex="-1"></a>tidy_custom <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">coef_round =</span> <span class="dv">4</span>, <span class="at">se_round =</span> <span class="dv">4</span>, <span class="at">z_round =</span> <span class="dv">2</span>) {</span>
<span id="cb184-3"><a href="classification.html#cb184-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb184-4"><a href="classification.html#cb184-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(</span>
<span id="cb184-5"><a href="classification.html#cb184-5" aria-hidden="true" tabindex="-1"></a>      term,</span>
<span id="cb184-6"><a href="classification.html#cb184-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">coefficient =</span> <span class="fu">round</span>(estimate, coef_round),</span>
<span id="cb184-7"><a href="classification.html#cb184-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">std.error =</span> <span class="fu">round</span>(std.error, se_round),</span>
<span id="cb184-8"><a href="classification.html#cb184-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">z-statistic</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(statistic, z_round),</span>
<span id="cb184-9"><a href="classification.html#cb184-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">p-value</span><span class="st">`</span> <span class="ot">=</span> scales<span class="sc">::</span><span class="fu">pvalue</span>(p.value)</span>
<span id="cb184-10"><a href="classification.html#cb184-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb184-11"><a href="classification.html#cb184-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-12"><a href="classification.html#cb184-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_custom</span>(glm_default_balance) <span class="sc">%&gt;%</span> <span class="fu">gt</span>() </span></code></pre></div>
<div id="iitolowwom" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#iitolowwom .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#iitolowwom .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iitolowwom .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#iitolowwom .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#iitolowwom .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iitolowwom .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iitolowwom .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#iitolowwom .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#iitolowwom .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#iitolowwom .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#iitolowwom .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#iitolowwom .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#iitolowwom .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#iitolowwom .gt_from_md > :first-child {
  margin-top: 0;
}

#iitolowwom .gt_from_md > :last-child {
  margin-bottom: 0;
}

#iitolowwom .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#iitolowwom .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#iitolowwom .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#iitolowwom .gt_row_group_first td {
  border-top-width: 2px;
}

#iitolowwom .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iitolowwom .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#iitolowwom .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#iitolowwom .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iitolowwom .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iitolowwom .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#iitolowwom .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#iitolowwom .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iitolowwom .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iitolowwom .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iitolowwom .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iitolowwom .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iitolowwom .gt_left {
  text-align: left;
}

#iitolowwom .gt_center {
  text-align: center;
}

#iitolowwom .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#iitolowwom .gt_font_normal {
  font-weight: normal;
}

#iitolowwom .gt_font_bold {
  font-weight: bold;
}

#iitolowwom .gt_font_italic {
  font-style: italic;
}

#iitolowwom .gt_super {
  font-size: 65%;
}

#iitolowwom .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#iitolowwom .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#iitolowwom .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#iitolowwom .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#iitolowwom .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#iitolowwom .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">coefficient</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">std.error</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">z-statistic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">p-value</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">(Intercept)</td>
<td class="gt_row gt_right">-10.6513</td>
<td class="gt_row gt_right">0.3612</td>
<td class="gt_row gt_right">-29.49</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">balance</td>
<td class="gt_row gt_right">0.0055</td>
<td class="gt_row gt_right">0.0002</td>
<td class="gt_row gt_right">24.95</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
  </tbody>
  
  
</table>
</div>
<p>The <span class="math inline">\(z\)</span>-statistic plays the same role at the <span class="math inline">\(t\)</span>-statistic from linear regression.
It equals <span class="math inline">\(\hat{\beta}_1 / \text{SE}(\hat{\beta}_1)\)</span> and large (absolute) values indiciate evidence against the null hypothesis <span class="math inline">\(H_0: \beta_1 = 0\)</span>.
The small <span class="math inline">\(p\)</span>-value associated with <code>balance</code> in the above table is small, so we reject the null hypothesis.</p>
</div>
<div id="making-predictions" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Making Predictions<a href="classification.html#making-predictions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>With the estimates, we can compute <code>default</code> probabilities for an individual with a <code>balance</code> of $1,000 and $2,000.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="classification.html#cb185-1" aria-hidden="true" tabindex="-1"></a>example_balance <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">2000</span>)</span>
<span id="cb185-2"><a href="classification.html#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For convenience, add together the linear terms to get the log-odds</span></span>
<span id="cb185-3"><a href="classification.html#cb185-3" aria-hidden="true" tabindex="-1"></a>sum_beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(glm_default_balance)[<span class="st">&quot;(Intercept)&quot;</span>] <span class="sc">+</span></span>
<span id="cb185-4"><a href="classification.html#cb185-4" aria-hidden="true" tabindex="-1"></a>  example_balance <span class="sc">*</span> <span class="fu">coef</span>(glm_default_balance)[<span class="st">&quot;balance&quot;</span>]</span>
<span id="cb185-5"><a href="classification.html#cb185-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-6"><a href="classification.html#cb185-6" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(sum_beta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(sum_beta))</span></code></pre></div>
<pre><code>## [1] 0.005752145 0.585769370</code></pre>
<p>Instead of manually writing out the full equation, here are some alternatives:</p>
<p>This logistic distribution function <code>stats::plogis</code> (sometimes called the inverse logit) returns probabilities from the given log-odds values:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="classification.html#cb187-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">plogis</span>(sum_beta)</span></code></pre></div>
<pre><code>## [1] 0.005752145 0.585769370</code></pre>
<p>Calling the generic <code>predict</code> on a <code>glm</code> uses <code>predict.glm()</code>:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="classification.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># By default, predict.glm() returns log-odds</span></span>
<span id="cb189-2"><a href="classification.html#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(glm_default_balance,</span>
<span id="cb189-3"><a href="classification.html#cb189-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">balance =</span> example_balance)) <span class="sc">%&gt;%</span></span>
<span id="cb189-4"><a href="classification.html#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># So use the inverse logit</span></span>
<span id="cb189-5"><a href="classification.html#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plogis</span>()</span></code></pre></div>
<pre><code>##           1           2 
## 0.005752145 0.585769370</code></pre>
<p>There is an argument to <code>predict.glm()</code> called <code>type</code> that specifies the scale of the returned predictions.
By default, <code>type</code> = “link” which refers to the link function which means log-odds are returned.
Setting <code>type</code> = “response” returns probabilities:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="classification.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(glm_default_balance, <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">balance =</span> example_balance),</span>
<span id="cb191-2"><a href="classification.html#cb191-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<pre><code>##           1           2 
## 0.005752145 0.585769370</code></pre>
<p>Fit the model with <code>student</code> as the predictor and re-create Table 4.2:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="classification.html#cb193-1" aria-hidden="true" tabindex="-1"></a>glm_default_student <span class="ot">&lt;-</span></span>
<span id="cb193-2"><a href="classification.html#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(default <span class="sc">~</span> student, <span class="at">data =</span> default,</span>
<span id="cb193-3"><a href="classification.html#cb193-3" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Note: don&#39;t need to specify binomial(link = &quot;logit&quot;) because it is the</span></span>
<span id="cb193-4"><a href="classification.html#cb193-4" aria-hidden="true" tabindex="-1"></a>      <span class="co">#  default link</span></span>
<span id="cb193-5"><a href="classification.html#cb193-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial)</span>
<span id="cb193-6"><a href="classification.html#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_custom</span>(glm_default_student) <span class="sc">%&gt;%</span> <span class="fu">gt</span>()</span></code></pre></div>
<div id="dzgapspvwl" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#dzgapspvwl .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dzgapspvwl .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dzgapspvwl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dzgapspvwl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dzgapspvwl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dzgapspvwl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dzgapspvwl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dzgapspvwl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dzgapspvwl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dzgapspvwl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dzgapspvwl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dzgapspvwl .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#dzgapspvwl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dzgapspvwl .gt_from_md > :first-child {
  margin-top: 0;
}

#dzgapspvwl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dzgapspvwl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dzgapspvwl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dzgapspvwl .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dzgapspvwl .gt_row_group_first td {
  border-top-width: 2px;
}

#dzgapspvwl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dzgapspvwl .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dzgapspvwl .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dzgapspvwl .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dzgapspvwl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dzgapspvwl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dzgapspvwl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dzgapspvwl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dzgapspvwl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dzgapspvwl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dzgapspvwl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dzgapspvwl .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dzgapspvwl .gt_left {
  text-align: left;
}

#dzgapspvwl .gt_center {
  text-align: center;
}

#dzgapspvwl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dzgapspvwl .gt_font_normal {
  font-weight: normal;
}

#dzgapspvwl .gt_font_bold {
  font-weight: bold;
}

#dzgapspvwl .gt_font_italic {
  font-style: italic;
}

#dzgapspvwl .gt_super {
  font-size: 65%;
}

#dzgapspvwl .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#dzgapspvwl .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#dzgapspvwl .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dzgapspvwl .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#dzgapspvwl .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#dzgapspvwl .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">coefficient</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">std.error</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">z-statistic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">p-value</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">(Intercept)</td>
<td class="gt_row gt_right">-3.5041</td>
<td class="gt_row gt_right">0.0707</td>
<td class="gt_row gt_right">-49.55</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">studentYes</td>
<td class="gt_row gt_right">0.4049</td>
<td class="gt_row gt_right">0.1150</td>
<td class="gt_row gt_right">3.52</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
  </tbody>
  
  
</table>
</div>
<p>The probabilities for student and non-students:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="classification.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(glm_default_student, <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">student =</span> <span class="fu">c</span>(<span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>)),</span>
<span id="cb194-2"><a href="classification.html#cb194-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<pre><code>##          1          2 
## 0.04313859 0.02919501</code></pre>
</div>
<div id="multiple-logistic-regression" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Multiple Logistic Regression<a href="classification.html#multiple-logistic-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The extension to multiple predictors <span class="math inline">\(p\)</span> is straightfoward:</p>
<p><span class="math display">\[
\log \left( \frac{p(X)}{1 - p(X)} \right) = \beta_0 + \beta_1 X_1 + \dots + \beta_p X_p.
\]</span></p>
<p>Fit the model with all three predictors (<code>income</code> in thousands of dollars):</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="classification.html#cb196-1" aria-hidden="true" tabindex="-1"></a>glm_default_all <span class="ot">&lt;-</span></span>
<span id="cb196-2"><a href="classification.html#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(default <span class="sc">~</span> .,</span>
<span id="cb196-3"><a href="classification.html#cb196-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> default <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">income =</span> income <span class="sc">/</span> <span class="dv">1000</span>),</span>
<span id="cb196-4"><a href="classification.html#cb196-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial)</span>
<span id="cb196-5"><a href="classification.html#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_custom</span>(glm_default_all) <span class="sc">%&gt;%</span> <span class="fu">gt</span>()</span></code></pre></div>
<div id="qbqjvrdpgf" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qbqjvrdpgf .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qbqjvrdpgf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qbqjvrdpgf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qbqjvrdpgf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qbqjvrdpgf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qbqjvrdpgf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qbqjvrdpgf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qbqjvrdpgf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qbqjvrdpgf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qbqjvrdpgf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qbqjvrdpgf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qbqjvrdpgf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qbqjvrdpgf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qbqjvrdpgf .gt_from_md > :first-child {
  margin-top: 0;
}

#qbqjvrdpgf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qbqjvrdpgf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qbqjvrdpgf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qbqjvrdpgf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qbqjvrdpgf .gt_row_group_first td {
  border-top-width: 2px;
}

#qbqjvrdpgf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbqjvrdpgf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qbqjvrdpgf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qbqjvrdpgf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qbqjvrdpgf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbqjvrdpgf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qbqjvrdpgf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qbqjvrdpgf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qbqjvrdpgf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qbqjvrdpgf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbqjvrdpgf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qbqjvrdpgf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbqjvrdpgf .gt_left {
  text-align: left;
}

#qbqjvrdpgf .gt_center {
  text-align: center;
}

#qbqjvrdpgf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qbqjvrdpgf .gt_font_normal {
  font-weight: normal;
}

#qbqjvrdpgf .gt_font_bold {
  font-weight: bold;
}

#qbqjvrdpgf .gt_font_italic {
  font-style: italic;
}

#qbqjvrdpgf .gt_super {
  font-size: 65%;
}

#qbqjvrdpgf .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#qbqjvrdpgf .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#qbqjvrdpgf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qbqjvrdpgf .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#qbqjvrdpgf .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#qbqjvrdpgf .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">coefficient</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">std.error</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">z-statistic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">p-value</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">(Intercept)</td>
<td class="gt_row gt_right">-10.8690</td>
<td class="gt_row gt_right">0.4923</td>
<td class="gt_row gt_right">-22.08</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">studentYes</td>
<td class="gt_row gt_right">-0.6468</td>
<td class="gt_row gt_right">0.2363</td>
<td class="gt_row gt_right">-2.74</td>
<td class="gt_row gt_left">0.006</td></tr>
    <tr><td class="gt_row gt_left">balance</td>
<td class="gt_row gt_right">0.0057</td>
<td class="gt_row gt_right">0.0002</td>
<td class="gt_row gt_right">24.74</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">income</td>
<td class="gt_row gt_right">0.0030</td>
<td class="gt_row gt_right">0.0082</td>
<td class="gt_row gt_right">0.37</td>
<td class="gt_row gt_left">0.712</td></tr>
  </tbody>
  
  
</table>
</div>
<p>The coefficient for <code>student</code> is statistically significant and negative, whereas it was positive in the univariable model.
To understand this apparent paradox, re-create Figure 4.3:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="classification.html#cb197-1" aria-hidden="true" tabindex="-1"></a>balance_breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2700</span>, <span class="at">by =</span> <span class="dv">270</span>)</span>
<span id="cb197-2"><a href="classification.html#cb197-2" aria-hidden="true" tabindex="-1"></a>balance_midpoints <span class="ot">&lt;-</span></span>
<span id="cb197-3"><a href="classification.html#cb197-3" aria-hidden="true" tabindex="-1"></a>  (balance_breaks[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(balance_breaks) <span class="sc">-</span> <span class="dv">1</span>)] <span class="sc">+</span></span>
<span id="cb197-4"><a href="classification.html#cb197-4" aria-hidden="true" tabindex="-1"></a>     balance_breaks[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(balance_breaks)]) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb197-5"><a href="classification.html#cb197-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> default <span class="sc">%&gt;%</span></span>
<span id="cb197-6"><a href="classification.html#cb197-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb197-7"><a href="classification.html#cb197-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">balance_binned =</span> <span class="fu">cut</span>(balance, <span class="at">breaks =</span> balance_breaks,</span>
<span id="cb197-8"><a href="classification.html#cb197-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">labels =</span> balance_midpoints),</span>
<span id="cb197-9"><a href="classification.html#cb197-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">balance_binned =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(balance_binned))</span>
<span id="cb197-10"><a href="classification.html#cb197-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb197-11"><a href="classification.html#cb197-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(student, balance_binned) <span class="sc">%&gt;%</span></span>
<span id="cb197-12"><a href="classification.html#cb197-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p_default =</span> <span class="fu">mean</span>(default <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span>), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb197-13"><a href="classification.html#cb197-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> balance_binned, <span class="at">y =</span> p_default, <span class="at">color =</span> student)) <span class="sc">+</span></span>
<span id="cb197-14"><a href="classification.html#cb197-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb197-15"><a href="classification.html#cb197-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb197-16"><a href="classification.html#cb197-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> default <span class="sc">%&gt;%</span></span>
<span id="cb197-17"><a href="classification.html#cb197-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(student) <span class="sc">%&gt;%</span></span>
<span id="cb197-18"><a href="classification.html#cb197-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">p_mean_default =</span> <span class="fu">mean</span>(default <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span>),</span>
<span id="cb197-19"><a href="classification.html#cb197-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>),</span>
<span id="cb197-20"><a href="classification.html#cb197-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">yintercept =</span> p_mean_default, <span class="at">color =</span> student), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb197-21"><a href="classification.html#cb197-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb197-22"><a href="classification.html#cb197-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(td_colors<span class="sc">$</span>nice<span class="sc">$</span>strong_blue,</span>
<span id="cb197-23"><a href="classification.html#cb197-23" aria-hidden="true" tabindex="-1"></a>                                td_colors<span class="sc">$</span>nice<span class="sc">$</span>strong_red)) <span class="sc">+</span></span>
<span id="cb197-24"><a href="classification.html#cb197-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.7</span>))</span>
<span id="cb197-25"><a href="classification.html#cb197-25" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> default <span class="sc">%&gt;%</span></span>
<span id="cb197-26"><a href="classification.html#cb197-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> student, <span class="at">y =</span> balance)) <span class="sc">+</span></span>
<span id="cb197-27"><a href="classification.html#cb197-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> student)) <span class="sc">+</span></span>
<span id="cb197-28"><a href="classification.html#cb197-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(td_colors<span class="sc">$</span>nice<span class="sc">$</span>strong_blue,</span>
<span id="cb197-29"><a href="classification.html#cb197-29" aria-hidden="true" tabindex="-1"></a>                                td_colors<span class="sc">$</span>nice<span class="sc">$</span>strong_red)) <span class="sc">+</span></span>
<span id="cb197-30"><a href="classification.html#cb197-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb197-31"><a href="classification.html#cb197-31" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/figure4.3-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>In the left panel, we see that students have a higher overall default rate
(4.3%) than non-students
(2.9%) as shown by the dashed lines.
This is why, in the univariable regression, <code>student</code> was associated with an increase in probability of default.
But by the solid lines, we see that for most values of <code>balance</code>, students have lower default rates.
And that is what the multiple logistic regression model tells us: for fixed values of <code>balance</code> and <code>income</code>, a <code>student</code> is less likely to <code>default</code>.</p>
<p>This is explained by the right panel above: <code>student</code> and <code>balance</code> are correlated in that students tend to hold higher levels of debt, which is then associated with higher probability of default.</p>
<p>Taken altogether, we can conclude that a student is <em>less likely to default</em> than a non-student with the same credit card balance.
Without any information about their balance, however, a student is more likely to default because they are also more likely to carry a higher balance.</p>
<blockquote>
<p>This simple example illustrates the dangers and subtleties associated
with performing regressions involving only a single predictor when other
predictors may also be relevant. As in the linear regression setting, the
results obtained using one predictor may be quite different from those obtained using multiple predictors, especially when there is correlation among
the predictors. In general, the phenomenon seen in Figure 4.3 is known as
confounding.</p>
</blockquote>
<p>Make predictions for a student and non-student:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="classification.html#cb198-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb198-2"><a href="classification.html#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">student =</span> <span class="fu">c</span>(<span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>), <span class="at">balance =</span> <span class="dv">1500</span>,</span>
<span id="cb198-3"><a href="classification.html#cb198-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Income in thousands</span></span>
<span id="cb198-4"><a href="classification.html#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> <span class="dv">40000</span> <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb198-5"><a href="classification.html#cb198-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb198-6"><a href="classification.html#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(glm_default_all, <span class="at">newdata =</span> d, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<pre><code>##          1          2 
## 0.05788194 0.10499192</code></pre>
</div>
<div id="multinomial-logistic-regression" class="section level3 hasAnchor" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> Multinomial Logistic Regression<a href="classification.html#multinomial-logistic-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For predicting <span class="math inline">\(K &gt; 2\)</span> classes, we can extend logistic regression in a method called multinomial logistic regression.
To do this, we choose a single class <span class="math inline">\(K\)</span> to serve as the baseline.
Then the probability of another class <span class="math inline">\(k\)</span> is:</p>
<p><span class="math display">\[
\text{Pr}(Y = k|X = x) = \frac{e^{\beta_{k0} + \beta_{k1} x_1 + \beta_{kp} x_p}}{1 + \sum_{l=1}^{K-1} e^{\beta_{l0} + \beta_{l1} x_1 + \beta_{lp} x_p}}
\]</span></p>
<p>for <span class="math inline">\(k = 1, \dots, K - 1\)</span>.
Then for the baseline class <span class="math inline">\(K\)</span>:</p>
<p><span class="math display">\[
\text{Pr}(Y = K|X = x) = \frac{1}{1 + \sum_{l=1}^{K-1} e^{\beta_{l0} + \beta_{l1} x_1 + \beta_{lp} x_p}}.
\]</span></p>
<p>The log-odds of a class <span class="math inline">\(k\)</span> is then linear in the predictors:</p>
<p><span class="math display">\[
\log \left( \frac{\text{Pr} (Y = k| X = x)}{\text{Pr} (Y = K| X = x)}\right) = \beta_{k0} + \beta_{k1} x_1 + \dots + \beta_{kp} x_p.
\]</span></p>
<p>Note that in the case of <span class="math inline">\(K = 2\)</span>, the numerator becomes <span class="math inline">\(p(X)\)</span> and the denominator <span class="math inline">\(1 - p(X)\)</span>, which is exactly the same the two-class logistic regression formula (Equation 4.6).</p>
<p>The choice of class <span class="math inline">\(K\)</span> as baseline was arbitrary.
The only thing that will change by choosing a different baseline will be the coefficient estimates, but the predictions (fitted values), and model metrics will be the same.</p>
<p>When performing multinomial logistic regression, we will sometimes use an alternative to dummy coding called softmax coding.</p>
<blockquote>
<p>The softmax coding is equivalent to the coding just described in the sense that the fitted values, log odds between any pair of classes, and other key model outputs will remain the
same, regardless of coding. But the softmax coding is used extensively in
some areas of the machine learning literature (and will appear again in
Chapter 10), so it is worth being aware of it. In the softmax coding, rather
than selecting a baseline class, we treat all <span class="math inline">\(K\)</span> classes symmetrically, and
assume that for <span class="math inline">\(k = 1,...,K\)</span>,</p>
</blockquote>
<p><span class="math display">\[
\text{Pr}(Y = k|X = x) = \frac{e^{\beta_{k0} + \beta_{k1} x_1 + \beta_{kp} x_p}}{ \sum_{l=1}^{K} e^{\beta_{l0} + \beta_{l1} x_1 + \beta_{lp} x_p}}.
\]</span></p>
<blockquote>
<p>Thus, rather than estimating coefficients for <span class="math inline">\(K − 1\)</span> classes, we actually
estimate coefficients for all <span class="math inline">\(K\)</span> classes. It is not hard to see that as a result
of (4.13), the log odds ratio between the <span class="math inline">\(k\)</span>th and <span class="math inline">\(k′\)</span>th classes equals</p>
</blockquote>
<p><span class="math display">\[
\frac{\log \text{Pr} (Y = k| X = x)}{\log \text{Pr} (Y = k&#39;| X = x)} = (\beta_{k0} - \beta_{k&#39;0}) + (\beta_{k1} - \beta_{k&#39;1}) x_1 + \dots + (\beta_{kp} - \beta_{k&#39;p}) x_p.
\]</span></p>
</div>
</div>
<div id="generative-models-for-classification" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Generative Models for Classification<a href="classification.html#generative-models-for-classification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>Logistic regression involves directly modeling <span class="math inline">\(\text{Pr} (Y = k|X = x)\)</span> using the
logistic function, given by (4.7) for the case of two response classes. In
statistical jargon, we model the conditional distribution of the response <span class="math inline">\(Y\)</span>,
given the predictor(s) <span class="math inline">\(X\)</span>. We now consider an alternative and less direct
approach to estimating these probabilities. In this new approach, we model
the distribution of the predictors <span class="math inline">\(X\)</span> separately in each of the response
classes (i.e. for each value of <span class="math inline">\(Y\)</span>). We then use Bayes’ theorem to flip these
around into estimates for <span class="math inline">\(\text{Pr} (Y = k|X = x)\)</span>. When the distribution of <span class="math inline">\(X\)</span>
within each class is assumed to be normal, it turns out that the model is
very similar in form to logistic regression.</p>
</blockquote>
<p>There are several reasons to choose this method over logistic regression:</p>
<blockquote>
<ul>
<li>When there is substantial separation between the two classes, the
parameter estimates for the logistic regression model are surprisingly
unstable. The methods that we consider in this section do not suffer
from this problem.</li>
<li>If the distribution of the predictors <span class="math inline">\(X\)</span> is approximately normal in
each of the classes and the sample size is small, then the approaches
in this section may be more accurate than logistic regression.</li>
<li>The methods in this section can be naturally extended to the case
of more than two response classes. (In the case of more than two
response classes, we can also use multinomial logistic regression from
Section 4.3.5.)</li>
</ul>
</blockquote>
<p>Consider a classification problem with <span class="math inline">\(K \geq 2\)</span> unordered classes.
Let <span class="math inline">\(\pi_k\)</span> represent the prior probability that a random observation is class <span class="math inline">\(k\)</span>.
Let <span class="math inline">\(f_k(X) \equiv \text{Pr}(X | Y = k)\)</span> denote the density function of <span class="math inline">\(X\)</span> for an observation in the <span class="math inline">\(k\)</span>th class.
Then Bayes’ theorem states that the posterior probability than observation <span class="math inline">\(X = x\)</span> belongs to the <span class="math inline">\(k\)</span>th class is</p>
<p><span class="math display">\[
\text{Pr} (Y = k|X = x) = \frac{\pi_k f_k(x)}{\sum_{l=1}^K \pi_l f_l (x)} = p_k(x).
\]</span></p>
<p>Aside: Bayes’ theorem in the most simplistic form is</p>
<p><span class="math display">\[
P(Y | X) = \frac{P(X | Y) P (Y)}{P(X)}.
\]</span></p>
<p>So the probability of <span class="math inline">\(X\)</span> given class <span class="math inline">\(Y\)</span> (= <span class="math inline">\(k\)</span>) is <span class="math inline">\(P(X|Y) = f_k (x)\)</span>, the independent probability of a class <span class="math inline">\(Y\)</span> is <span class="math inline">\(P(Y) = \pi_k\)</span>, and the denominator is a normalizing factor which sums over all possible values <span class="math inline">\(Y\)</span> to give the independent probability <span class="math inline">\(P(X) = \sum \pi_l f_l (x)\)</span>.</p>
<p>Estimating <span class="math inline">\(\pi_k\)</span> is easy if we have a random sample from the population – just take the fraction of the training observations belonging to class <span class="math inline">\(k\)</span>.
Estimating the density function <span class="math inline">\(f_k (x)\)</span> is much more challenging.</p>
<blockquote>
<p>We know from Chapter 2 that the Bayes classifier, which classifies an
observation <span class="math inline">\(x\)</span> to the class for which <span class="math inline">\(p_k(x)\)</span> is largest, has the lowest possible
error rate out of all classifiers. (Of course, this is only true if all of the
terms in (4.15) are correctly specified.) Therefore, if we can find a way to
estimate <span class="math inline">\(f_k(x)\)</span>, then we can plug it into (4.15) in order to approximate the
Bayes classifier.</p>
</blockquote>
<p>We now discuss three classifiers that use different estimates of <span class="math inline">\(f_k (x)\)</span>.</p>
<div id="linear-discriminant-analysis-for-p-1" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Linear Discriminant Analysis for <span class="math inline">\(p = 1\)</span><a href="classification.html#linear-discriminant-analysis-for-p-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the case of one predictor, we start by assuming that <span class="math inline">\(f_k (x)\)</span> is normal or Gaussian, which has the following density in one dimension:</p>
<p><span class="math display">\[
f_k (x) = \frac{1}{\sqrt{2 \pi} \sigma_k} \exp \left( - \frac{1}{2\sigma_k^2} (x - \mu_k)^2\right)
\]</span></p>
<p>where <span class="math inline">\(\mu_k\)</span> and <span class="math inline">\(\sigma_k^2\)</span> are the mean and variance of the <span class="math inline">\(k\)</span>th class.
For now, assume all classes have the same variance <span class="math inline">\(\sigma^2\)</span>.
Plugging the above into Bayes’ theorem, we have:</p>
<p><span class="math display">\[
p_k (x) =
\frac{\pi_k \frac{1}{\sqrt{2 \pi} \sigma} \exp \left( - \frac{1}{2\sigma^2} (x - \mu_k)^2\right)}
{\sum_{l=1}^K \pi_l \frac{1}{\sqrt{2 \pi} \sigma} \exp \left( - \frac{1}{2\sigma^2} (x - \mu_l)^2\right)}.
\]</span>
The Bayes classifier assigns an observation <span class="math inline">\(X = x\)</span> to the class for which the above is largest.
Taking the log and rearranging, this is equivalent to choosing the class for which:</p>
<p><span class="math display">\[
\delta_k (x) = x \frac{\mu_k}{\sigma^2} - \frac{\mu_k^2}{2 \sigma^2} + \log(\pi_k)
\]</span></p>
<p>is largest.</p>
<blockquote>
<p>For instance, if <span class="math inline">\(K = 2\)</span> and <span class="math inline">\(\pi_1 = \pi_2\)</span>, then the Bayes classifier
assigns an observation to class 1 if <span class="math inline">\(2x (\mu_1 − \mu_2) &gt; \mu_1^2 - \mu_2^2\)</span>, and to class 2 otherwise.
The Bayes decision boundary is the point for which <span class="math inline">\(\delta_1 (x) = \delta_2 (x)\)</span>; one can show that this amounts to</p>
</blockquote>
<p><span class="math display">\[
x = \frac{\mu_1^2 - \mu_2^2}{2 (\mu_1 - \mu_2)} = \frac{\mu_1 + \mu_2}{2}.
\]</span></p>
<p>Note that in the real world, we do not know that <span class="math inline">\(X\)</span> is drawn from a Gaussian distribution within each class, or all the parameters involved, so we are not able to calculate the decision boundary for the Bayes classifier.
This is where the linear discriminant analysis (LDA) method comes in.</p>
<p>If we are quite certain that <span class="math inline">\(X\)</span> is Gaussian within each class, then we can use LDA to approximate the Bayes classifier with these estimates:</p>
<p><span class="math display">\[
\begin{align}
\hat{\mu}_k &amp;= \frac{1}{n_k} \sum_{i: y_i = k} x_i\\
\hat{\sigma}^2 &amp;= \frac{1}{n - K} \sum^K_{k=1} \sum_{i: y_i = k} (x_i - \hat{u}_k)^2
\end{align}
\]</span></p>
<p>where <span class="math inline">\(n\)</span> is the total number of training observations, and <span class="math inline">\(n_k\)</span> is the number in the <span class="math inline">\(k\)</span>th class.
The estimate for <span class="math inline">\(\hat{\mu}_k\)</span> is simply the average of the <span class="math inline">\(k\)</span>th class, and <span class="math inline">\(\hat{\sigma}^2\)</span> is the weighted average of the sample variances for each of the <span class="math inline">\(K\)</span> classes.
Sometimes we know the true fractions of class membership <span class="math inline">\(\pi_k\)</span> which can be used directly.
Otherwise, LDA simply uses the proportion from the training observations:</p>
<p><span class="math display">\[
\hat{\pi}_k = n_k / n.
\]</span></p>
<p>Observation <span class="math inline">\(X = x\)</span> is then assigned to the class for which</p>
<p><span class="math display">\[
\hat{\delta}_k (x) = x \frac{\hat{\mu}_k}{\hat{\sigma}^2} - \frac{\hat{\mu}_k^2}{2 \hat{\sigma}^2} + \log(\hat{\pi}_k)
\]</span></p>
<blockquote>
<p>The word linear in the classifier’s name stems from the fact
that the discriminant functions <span class="math inline">\(\hat{\delta}_k (x)\)</span> in (4.22) are linear functions of x (as opposed to a more complex function of <span class="math inline">\(x\)</span>)</p>
</blockquote>
<p>Re-create the example in Figure 4.4:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="classification.html#cb200-1" aria-hidden="true" tabindex="-1"></a>mu1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">1.25</span></span>
<span id="cb200-2"><a href="classification.html#cb200-2" aria-hidden="true" tabindex="-1"></a>mu2 <span class="ot">&lt;-</span> <span class="fl">1.25</span></span>
<span id="cb200-3"><a href="classification.html#cb200-3" aria-hidden="true" tabindex="-1"></a>sigma1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb200-4"><a href="classification.html#cb200-4" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb200-5"><a href="classification.html#cb200-5" aria-hidden="true" tabindex="-1"></a>bayes_boundary <span class="ot">&lt;-</span> (mu1 <span class="sc">+</span> mu2) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb200-6"><a href="classification.html#cb200-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.1</span>)), <span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb200-7"><a href="classification.html#cb200-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> mu1, <span class="at">sd =</span> sigma1),</span>
<span id="cb200-8"><a href="classification.html#cb200-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>emerald) <span class="sc">+</span></span>
<span id="cb200-9"><a href="classification.html#cb200-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> mu2, <span class="at">sd =</span> sigma2),</span>
<span id="cb200-10"><a href="classification.html#cb200-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>opera_mauve) <span class="sc">+</span></span>
<span id="cb200-11"><a href="classification.html#cb200-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> bayes_boundary, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb200-12"><a href="classification.html#cb200-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_axis</span>(<span class="st">&quot;y&quot;</span>)</span>
<span id="cb200-13"><a href="classification.html#cb200-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-14"><a href="classification.html#cb200-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb200-15"><a href="classification.html#cb200-15" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb200-16"><a href="classification.html#cb200-16" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>class, <span class="sc">~</span>x,</span>
<span id="cb200-17"><a href="classification.html#cb200-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">mean =</span> mu1, <span class="at">sd =</span> sigma1),</span>
<span id="cb200-18"><a href="classification.html#cb200-18" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">mean =</span> mu2, <span class="at">sd =</span> sigma2)</span>
<span id="cb200-19"><a href="classification.html#cb200-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb200-20"><a href="classification.html#cb200-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(x)</span>
<span id="cb200-21"><a href="classification.html#cb200-21" aria-hidden="true" tabindex="-1"></a>lda_boundary <span class="ot">&lt;-</span></span>
<span id="cb200-22"><a href="classification.html#cb200-22" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">mean</span>(<span class="fu">filter</span>(d, class <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">$</span>x) <span class="sc">+</span> <span class="fu">mean</span>(<span class="fu">filter</span>(d, class <span class="sc">==</span> <span class="dv">2</span>)<span class="sc">$</span>x)) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb200-23"><a href="classification.html#cb200-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-24"><a href="classification.html#cb200-24" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb200-25"><a href="classification.html#cb200-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, <span class="at">fill =</span> <span class="fu">factor</span>(class), <span class="at">color =</span> <span class="fu">factor</span>(class))) <span class="sc">+</span></span>
<span id="cb200-26"><a href="classification.html#cb200-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">13</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb200-27"><a href="classification.html#cb200-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> bayes_boundary, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb200-28"><a href="classification.html#cb200-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> lda_boundary, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb200-29"><a href="classification.html#cb200-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(td_colors<span class="sc">$</span>nice<span class="sc">$</span>emerald,</span>
<span id="cb200-30"><a href="classification.html#cb200-30" aria-hidden="true" tabindex="-1"></a>                               td_colors<span class="sc">$</span>nice<span class="sc">$</span>opera_mauve)) <span class="sc">+</span></span>
<span id="cb200-31"><a href="classification.html#cb200-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(td_colors<span class="sc">$</span>nice<span class="sc">$</span>emerald,</span>
<span id="cb200-32"><a href="classification.html#cb200-32" aria-hidden="true" tabindex="-1"></a>                               td_colors<span class="sc">$</span>nice<span class="sc">$</span>opera_mauve)) <span class="sc">+</span></span>
<span id="cb200-33"><a href="classification.html#cb200-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb200-34"><a href="classification.html#cb200-34" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/figure4.4-1.png" width="576" style="display: block; margin: auto;" />
Simulate a large number of test observations and compute the Bayes and LDA test error rates:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="classification.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2021</span>)</span>
<span id="cb201-2"><a href="classification.html#cb201-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb201-3"><a href="classification.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>class, <span class="sc">~</span>x,</span>
<span id="cb201-4"><a href="classification.html#cb201-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="fu">rnorm</span>(<span class="fl">1e3</span>, <span class="at">mean =</span> mu1, <span class="at">sd =</span> sigma1),</span>
<span id="cb201-5"><a href="classification.html#cb201-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="fu">rnorm</span>(<span class="fl">1e3</span>, <span class="at">mean =</span> mu2, <span class="at">sd =</span> sigma2)</span>
<span id="cb201-6"><a href="classification.html#cb201-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb201-7"><a href="classification.html#cb201-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(x)</span>
<span id="cb201-8"><a href="classification.html#cb201-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The LDA boundary must be recomputed with the new data</span></span>
<span id="cb201-9"><a href="classification.html#cb201-9" aria-hidden="true" tabindex="-1"></a>lda_boundary <span class="ot">&lt;-</span></span>
<span id="cb201-10"><a href="classification.html#cb201-10" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">mean</span>(<span class="fu">filter</span>(d, class <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">$</span>x) <span class="sc">+</span> <span class="fu">mean</span>(<span class="fu">filter</span>(d, class <span class="sc">==</span> <span class="dv">2</span>)<span class="sc">$</span>x)) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb201-11"><a href="classification.html#cb201-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-12"><a href="classification.html#cb201-12" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb201-13"><a href="classification.html#cb201-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb201-14"><a href="classification.html#cb201-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">bayes_class =</span> <span class="fu">ifelse</span>(x <span class="sc">&gt;</span> bayes_boundary, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb201-15"><a href="classification.html#cb201-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lda_class =</span> <span class="fu">ifelse</span>(x <span class="sc">&gt;</span> lda_boundary, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb201-16"><a href="classification.html#cb201-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb201-17"><a href="classification.html#cb201-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb201-18"><a href="classification.html#cb201-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Bayes error rate</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(class <span class="sc">==</span> bayes_class),</span>
<span id="cb201-19"><a href="classification.html#cb201-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">LDA error rate</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(class <span class="sc">==</span> lda_class)</span>
<span id="cb201-20"><a href="classification.html#cb201-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   `Bayes error rate` `LDA error rate`
##                &lt;dbl&gt;            &lt;dbl&gt;
## 1              0.104            0.107</code></pre>
<p>Pretty close but, as expected, the Bayes classifier has the lower error rate.</p>
<blockquote>
<p>To reiterate, the LDA classifier results from assuming that the observations within each class come from a normal distribution with a class-specific mean and a common variance <span class="math inline">\(\sigma^2\)</span>, and plugging estimates for these
parameters into the Bayes classifier. In Section 4.4.3, we will consider a less
stringent set of assumptions, by allowing the observations in the <span class="math inline">\(k\)</span>th class
to have a class-specific variance, <span class="math inline">\(\sigma_k^2\)</span>.</p>
</blockquote>
</div>
<div id="linear-discriminant-analysis-for-p-1-1" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Linear Discriminant Analysis for <span class="math inline">\(p &gt; 1\)</span><a href="classification.html#linear-discriminant-analysis-for-p-1-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Extending the LDA classifier for multiple predictors involves a multi-variate Gaussian distribution with class-specific mean vector and a common covariance matrix.</p>
<blockquote>
<p>The multivariate Gaussian distribution assumes that each individual predictor follows a one-dimensional normal distribution, as in (4.16), with some correlation between each pair of predictors.</p>
</blockquote>
<p>I’ll simulate some data with the <code>mvtnorm</code> package and plot probabilities with a 2D density plot (instead of the 3D in Figure 4.5):</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="classification.html#cb203-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="fl">0.1</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="fl">0.1</span>))</span>
<span id="cb203-2"><a href="classification.html#cb203-2" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb203-3"><a href="classification.html#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb203-4"><a href="classification.html#cb203-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(</span>
<span id="cb203-5"><a href="classification.html#cb203-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">as.matrix</span>(d),</span>
<span id="cb203-6"><a href="classification.html#cb203-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">sigma =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb203-7"><a href="classification.html#cb203-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb203-8"><a href="classification.html#cb203-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb203-9"><a href="classification.html#cb203-9" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb203-10"><a href="classification.html#cb203-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb203-11"><a href="classification.html#cb203-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(</span>
<span id="cb203-12"><a href="classification.html#cb203-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">as.matrix</span>(d),</span>
<span id="cb203-13"><a href="classification.html#cb203-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">sigma =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb203-14"><a href="classification.html#cb203-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb203-15"><a href="classification.html#cb203-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb203-16"><a href="classification.html#cb203-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d1 <span class="sc">%&gt;%</span></span>
<span id="cb203-17"><a href="classification.html#cb203-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2)) <span class="sc">+</span></span>
<span id="cb203-18"><a href="classification.html#cb203-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> prob)) <span class="sc">+</span></span>
<span id="cb203-19"><a href="classification.html#cb203-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb203-20"><a href="classification.html#cb203-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb203-21"><a href="classification.html#cb203-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb203-22"><a href="classification.html#cb203-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span></span>
<span id="cb203-23"><a href="classification.html#cb203-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2)) <span class="sc">+</span></span>
<span id="cb203-24"><a href="classification.html#cb203-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> prob)) <span class="sc">+</span></span>
<span id="cb203-25"><a href="classification.html#cb203-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb203-26"><a href="classification.html#cb203-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb203-27"><a href="classification.html#cb203-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb203-28"><a href="classification.html#cb203-28" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/figure4.5-1.png" width="576" style="display: block; margin: auto;" /></p>
<blockquote>
<p>To indicate that a <span class="math inline">\(p\)</span>-dimensional random variable <span class="math inline">\(X\)</span> has a multivariate Gaussian distribution, we write <span class="math inline">\(X \sim N(\mu, \Sigma)\)</span>. Here <span class="math inline">\(E(X) = \mu\)</span> is
the mean of <span class="math inline">\(X\)</span> (a vector with <span class="math inline">\(p\)</span> components), and <span class="math inline">\(\text{Cov}(X) = \Sigma\)</span> is the
<span class="math inline">\(p \times p\)</span> covariance matrix of <span class="math inline">\(X\)</span>.</p>
</blockquote>
<p>The LDA classifier assumes that the observations in the <span class="math inline">\(k\)</span>th class are drawn from a multivariate Gaussian distribution <span class="math inline">\(N(\mu_k, \Sigma)\)</span>.
The Bayes classifier assigns an observation <span class="math inline">\(X = x\)</span> to the class for which</p>
<p><span class="math display">\[
\delta_k (x) = x^T \Sigma^{-1} \mu_k - \frac{1}{2} \mu_k^T \Sigma^{-1} \mu_k + \log \pi_k
\]</span></p>
<p>is largest.</p>
<p>As with the univariable case, the LDA method involves estimating the unknown parameters <span class="math inline">\(\mu_k\)</span>, <span class="math inline">\(\pi_k\)</span> and <span class="math inline">\(\Sigma\)</span>.
Then the quantities <span class="math inline">\(\hat{\delta}_k (x)\)</span> are calculated and the observations <span class="math inline">\(X\)</span> are classified into the largest <span class="math inline">\(\hat{\delta}_k (k)\)</span>.</p>
<p>We can perform LDA using the <code>MASS</code> package to predict <code>default</code> from <code>student</code> and <code>balance</code>:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="classification.html#cb204-1" aria-hidden="true" tabindex="-1"></a>lda_default_balance_student <span class="ot">&lt;-</span></span>
<span id="cb204-2"><a href="classification.html#cb204-2" aria-hidden="true" tabindex="-1"></a>  MASS<span class="sc">::</span><span class="fu">lda</span>(default <span class="sc">~</span> balance <span class="sc">+</span> student, <span class="at">data =</span> default)</span>
<span id="cb204-3"><a href="classification.html#cb204-3" aria-hidden="true" tabindex="-1"></a>lda_default_balance_student</span></code></pre></div>
<pre><code>## Call:
## lda(default ~ balance + student, data = default)
## 
## Prior probabilities of groups:
##     No    Yes 
## 0.9667 0.0333 
## 
## Group means:
##       balance studentYes
## No   803.9438  0.2914037
## Yes 1747.8217  0.3813814
## 
## Coefficients of linear discriminants:
##                     LD1
## balance     0.002244397
## studentYes -0.249059498</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="classification.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The MASS package has a `select` function that overwrite `dplyr`,</span></span>
<span id="cb206-2"><a href="classification.html#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  fix that before it becomes a problem</span></span>
<span id="cb206-3"><a href="classification.html#cb206-3" aria-hidden="true" tabindex="-1"></a>select <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>select</span></code></pre></div>
<p>The resulting training error rate:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="classification.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(</span>
<span id="cb207-2"><a href="classification.html#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lda_default_balance_student,</span>
<span id="cb207-3"><a href="classification.html#cb207-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> default)<span class="sc">$</span>class <span class="sc">!=</span> default<span class="sc">$</span>default</span>
<span id="cb207-4"><a href="classification.html#cb207-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] 0.0275</code></pre>
<blockquote>
<p>This sounds like a low error rate, but two caveats must be noted.</p>
</blockquote>
<blockquote>
<ul>
<li>First of all, training error rates will usually be lower than test error
rates, which are the real quantity of interest. In other words, we
might expect this classifier to perform worse if we use it to predict
whether or not a new set of individuals will default. The reason is
that we specifically adjust the parameters of our model to do well on
the training data. The higher the ratio of parameters <span class="math inline">\(p\)</span> to number
of samples <span class="math inline">\(n\)</span>, the more we expect this overfitting to play a role.
For these data we don’t expect this to be a problem, since <span class="math inline">\(p = 2\)</span> and
<span class="math inline">\(n = 10,000\)</span>.</li>
<li>Second, since only 3.33% of the individuals in the training sample
defaulted, a simple but useless classifier that always predicts that
an individual will not default, regardless of his or her credit card
balance and student status, will result in an error rate of 3.33%. In
other words, the trivial null classifier will achieve an error rate that is only a bit higher than the LDA training set error rate.</li>
</ul>
</blockquote>
<p>Make predictions and produce the confusion matrix in Table 4.4:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="classification.html#cb209-1" aria-hidden="true" tabindex="-1"></a>lda_pred <span class="ot">&lt;-</span> </span>
<span id="cb209-2"><a href="classification.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb209-3"><a href="classification.html#cb209-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_default =</span> <span class="fu">predict</span>(lda_default_balance_student,</span>
<span id="cb209-4"><a href="classification.html#cb209-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> default)<span class="sc">$</span>class,</span>
<span id="cb209-5"><a href="classification.html#cb209-5" aria-hidden="true" tabindex="-1"></a>    default </span>
<span id="cb209-6"><a href="classification.html#cb209-6" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb209-7"><a href="classification.html#cb209-7" aria-hidden="true" tabindex="-1"></a>lda_pred <span class="sc">%&gt;%</span></span>
<span id="cb209-8"><a href="classification.html#cb209-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pred_default, default) <span class="sc">%&gt;%</span></span>
<span id="cb209-9"><a href="classification.html#cb209-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> default, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb209-10"><a href="classification.html#cb209-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> No <span class="sc">+</span> Yes) <span class="sc">%&gt;%</span></span>
<span id="cb209-11"><a href="classification.html#cb209-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">&quot;pred_default&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb209-12"><a href="classification.html#cb209-12" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_spanner</span>(<span class="at">label =</span> <span class="st">&quot;True default status&quot;</span>, <span class="at">columns =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb209-13"><a href="classification.html#cb209-13" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_stubhead</span>(<span class="st">&quot;Predicted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb209-14"><a href="classification.html#cb209-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Can&#39;t get the Total row to round to 0 decimals</span></span>
<span id="cb209-15"><a href="classification.html#cb209-15" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">summary_rows</span>(<span class="at">fns =</span> <span class="fu">list</span>(<span class="at">Total =</span> <span class="sc">~</span><span class="fu">round</span>(<span class="fu">sum</span>(.), <span class="dv">0</span>)))</span></code></pre></div>
<div id="skvtyzcjea" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#skvtyzcjea .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#skvtyzcjea .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#skvtyzcjea .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#skvtyzcjea .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#skvtyzcjea .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#skvtyzcjea .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#skvtyzcjea .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#skvtyzcjea .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#skvtyzcjea .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#skvtyzcjea .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#skvtyzcjea .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#skvtyzcjea .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#skvtyzcjea .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#skvtyzcjea .gt_from_md > :first-child {
  margin-top: 0;
}

#skvtyzcjea .gt_from_md > :last-child {
  margin-bottom: 0;
}

#skvtyzcjea .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#skvtyzcjea .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#skvtyzcjea .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#skvtyzcjea .gt_row_group_first td {
  border-top-width: 2px;
}

#skvtyzcjea .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#skvtyzcjea .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#skvtyzcjea .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#skvtyzcjea .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#skvtyzcjea .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#skvtyzcjea .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#skvtyzcjea .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#skvtyzcjea .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#skvtyzcjea .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#skvtyzcjea .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#skvtyzcjea .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#skvtyzcjea .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#skvtyzcjea .gt_left {
  text-align: left;
}

#skvtyzcjea .gt_center {
  text-align: center;
}

#skvtyzcjea .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#skvtyzcjea .gt_font_normal {
  font-weight: normal;
}

#skvtyzcjea .gt_font_bold {
  font-weight: bold;
}

#skvtyzcjea .gt_font_italic {
  font-style: italic;
}

#skvtyzcjea .gt_super {
  font-size: 65%;
}

#skvtyzcjea .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#skvtyzcjea .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#skvtyzcjea .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#skvtyzcjea .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#skvtyzcjea .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#skvtyzcjea .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1">Predicted</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">True default status</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">No</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Yes</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Total</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right gt_stub">No</td>
<td class="gt_row gt_right">9644</td>
<td class="gt_row gt_right">252</td>
<td class="gt_row gt_right">9896</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Yes</td>
<td class="gt_row gt_right">23</td>
<td class="gt_row gt_right">81</td>
<td class="gt_row gt_right">104</td></tr>
    <tr><td class="gt_row gt_right gt_stub gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">Total</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">9,667.00</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">333.00</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">10,000.00</td></tr>
  </tbody>
  
  
</table>
</div>
<p>We only missed 23 individuals who did not default, out of 9667.
This is great, but we did quite poorly in predicting defaulters.</p>
<blockquote>
<p>However, of the 333 individuals who
defaulted, 252 (or 75.7%) were missed by LDA. So while the overall error
rate is low, the error rate among individuals who defaulted is very high.
From the perspective of a credit card company that is trying to identify
high-risk individuals, an error rate of 252/333 = 75.7% among individuals
who default may well be unacceptable.</p>
</blockquote>
<blockquote>
<p>Class-specific performance is also important in medicine and biology,
where the terms sensitivity and specificity characterize the performance of
a classifier or screening test. In this case the sensitivity is the percentage
of true defaulters that are identified; it equals 24.3%. The specificity is
the percentage of non-defaulters that are correctly identified; it equals (1 −
23/9667) = 99.8%.</p>
</blockquote>
<p>LDA has poor sensitivity here because it attempts to reduce the total error rate, regardless of class.
In the case of a credit card company, it is probably more valuable to correctly identify individuals who will default.</p>
<p>The LDA classifier, like the Bayes classifier to which it approximates, assigns an observation to the <code>default</code> = “Yes” class if</p>
<p><span class="math display">\[
\text{Pr}(\text{default = Yes}| X = x) &gt; 0.5.
\]</span></p>
<p>That is to say, these classifiers have a default threshold of 50% posterior probability.
We may lower these probability as needed.
To adjust this with the <code>MASS::lda</code> package, we can get the posterior probabilities directly via <code>predict.lda()</code>:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="classification.html#cb210-1" aria-hidden="true" tabindex="-1"></a>lda_posterior <span class="ot">&lt;-</span> <span class="fu">predict</span>(lda_default_balance_student, <span class="at">newdata =</span> default)<span class="sc">$</span>posterior</span>
<span id="cb210-2"><a href="classification.html#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lda_posterior)</span></code></pre></div>
<pre><code>##          No         Yes
## 1 0.9968680 0.003131975
## 2 0.9971925 0.002807531
## 3 0.9843970 0.015603046
## 4 0.9987769 0.001223133
## 5 0.9959254 0.004074582
## 6 0.9954627 0.004537289</code></pre>
<p>Then use the threshold of 20% to re-create Table 4.5:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="classification.html#cb212-1" aria-hidden="true" tabindex="-1"></a>lda_pred_20 <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb212-2"><a href="classification.html#cb212-2" aria-hidden="true" tabindex="-1"></a>  default,</span>
<span id="cb212-3"><a href="classification.html#cb212-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">posterior_prob_default =</span> lda_posterior[,<span class="dv">2</span>]</span>
<span id="cb212-4"><a href="classification.html#cb212-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb212-5"><a href="classification.html#cb212-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb212-6"><a href="classification.html#cb212-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_default =</span> <span class="fu">ifelse</span>(posterior_prob_default <span class="sc">&gt;</span> <span class="fl">0.2</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>)</span>
<span id="cb212-7"><a href="classification.html#cb212-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb212-8"><a href="classification.html#cb212-8" aria-hidden="true" tabindex="-1"></a>lda_pred_20 <span class="sc">%&gt;%</span></span>
<span id="cb212-9"><a href="classification.html#cb212-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pred_default, default) <span class="sc">%&gt;%</span></span>
<span id="cb212-10"><a href="classification.html#cb212-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> default, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb212-11"><a href="classification.html#cb212-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> No <span class="sc">+</span> Yes) <span class="sc">%&gt;%</span></span>
<span id="cb212-12"><a href="classification.html#cb212-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">&quot;pred_default&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-13"><a href="classification.html#cb212-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(<span class="at">label =</span> <span class="st">&quot;True default status&quot;</span>, <span class="at">columns =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb212-14"><a href="classification.html#cb212-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_stubhead</span>(<span class="st">&quot;Predicted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-15"><a href="classification.html#cb212-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary_rows</span>(<span class="at">fns =</span> <span class="fu">list</span>(<span class="at">Total =</span> <span class="sc">~</span><span class="fu">round</span>(<span class="fu">sum</span>(.), <span class="dv">0</span>)))</span></code></pre></div>
<div id="ggcbylpnri" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ggcbylpnri .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ggcbylpnri .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ggcbylpnri .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ggcbylpnri .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ggcbylpnri .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ggcbylpnri .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ggcbylpnri .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ggcbylpnri .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ggcbylpnri .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ggcbylpnri .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ggcbylpnri .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ggcbylpnri .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ggcbylpnri .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ggcbylpnri .gt_from_md > :first-child {
  margin-top: 0;
}

#ggcbylpnri .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ggcbylpnri .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ggcbylpnri .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ggcbylpnri .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ggcbylpnri .gt_row_group_first td {
  border-top-width: 2px;
}

#ggcbylpnri .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggcbylpnri .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ggcbylpnri .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ggcbylpnri .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ggcbylpnri .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggcbylpnri .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ggcbylpnri .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ggcbylpnri .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ggcbylpnri .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ggcbylpnri .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggcbylpnri .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ggcbylpnri .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggcbylpnri .gt_left {
  text-align: left;
}

#ggcbylpnri .gt_center {
  text-align: center;
}

#ggcbylpnri .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ggcbylpnri .gt_font_normal {
  font-weight: normal;
}

#ggcbylpnri .gt_font_bold {
  font-weight: bold;
}

#ggcbylpnri .gt_font_italic {
  font-style: italic;
}

#ggcbylpnri .gt_super {
  font-size: 65%;
}

#ggcbylpnri .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#ggcbylpnri .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ggcbylpnri .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ggcbylpnri .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#ggcbylpnri .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#ggcbylpnri .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1">Predicted</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">True default status</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">No</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Yes</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Total</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right gt_stub">No</td>
<td class="gt_row gt_right">9432</td>
<td class="gt_row gt_right">138</td>
<td class="gt_row gt_right">9570</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Yes</td>
<td class="gt_row gt_right">235</td>
<td class="gt_row gt_right">195</td>
<td class="gt_row gt_right">430</td></tr>
    <tr><td class="gt_row gt_right gt_stub gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">Total</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">9,667.00</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">333.00</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">10,000.00</td></tr>
  </tbody>
  
  
</table>
</div>
<p>The sensitivity to detect defaulters has improved to 58.8%, but the specificity has dropped 97.5%.
The overall error rate has also increased to 3.7%.</p>
<blockquote>
<p>But a credit card company
may consider this slight increase in the total error rate to be a small price to
pay for more accurate identification of individuals who do indeed default.</p>
</blockquote>
<blockquote>
<p>How can we decide which threshold value is
best? Such a decision must be based on domain knowledge, such as detailed
information about the costs associated with default.</p>
</blockquote>
<p>The receiver operating character (ROC) curve is one way to visualize the trade-off between two types of error for different threshold values.
I like the <code>yardstick::roc_curve()</code> function for this purpose:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="classification.html#cb213-1" aria-hidden="true" tabindex="-1"></a>lda_roc <span class="ot">&lt;-</span></span>
<span id="cb213-2"><a href="classification.html#cb213-2" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">roc_curve</span>(</span>
<span id="cb213-3"><a href="classification.html#cb213-3" aria-hidden="true" tabindex="-1"></a>    lda_pred_20,</span>
<span id="cb213-4"><a href="classification.html#cb213-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Specify the class probability and the truth variables</span></span>
<span id="cb213-5"><a href="classification.html#cb213-5" aria-hidden="true" tabindex="-1"></a>    posterior_prob_default, <span class="at">truth =</span> default,</span>
<span id="cb213-6"><a href="classification.html#cb213-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This argument specifies which level of truth (default) is considered</span></span>
<span id="cb213-7"><a href="classification.html#cb213-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  &quot;positive&quot;, so it will flip the ROC curve vertically</span></span>
<span id="cb213-8"><a href="classification.html#cb213-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span></span>
<span id="cb213-9"><a href="classification.html#cb213-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb213-10"><a href="classification.html#cb213-10" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(lda_roc)</span></code></pre></div>
<p><img src="_main_files/figure-html/figure4.8-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The area under the curve (AUC) summarizes the overall performance of the classifier:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="classification.html#cb214-1" aria-hidden="true" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">roc_auc</span>(</span>
<span id="cb214-2"><a href="classification.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  lda_pred_20,</span>
<span id="cb214-3"><a href="classification.html#cb214-3" aria-hidden="true" tabindex="-1"></a>  posterior_prob_default, <span class="at">truth =</span> default,</span>
<span id="cb214-4"><a href="classification.html#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span></span>
<span id="cb214-5"><a href="classification.html#cb214-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 roc_auc binary         0.950</code></pre>
<p>We get the exact same ROC AUC with logistic regression:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="classification.html#cb216-1" aria-hidden="true" tabindex="-1"></a>glm_default_balance_student <span class="ot">&lt;-</span></span>
<span id="cb216-2"><a href="classification.html#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(default <span class="sc">~</span> balance <span class="sc">+</span> student,</span>
<span id="cb216-3"><a href="classification.html#cb216-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> default, <span class="at">family =</span> binomial)</span>
<span id="cb216-4"><a href="classification.html#cb216-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-5"><a href="classification.html#cb216-5" aria-hidden="true" tabindex="-1"></a>glm_pred <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb216-6"><a href="classification.html#cb216-6" aria-hidden="true" tabindex="-1"></a>  default,</span>
<span id="cb216-7"><a href="classification.html#cb216-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">glm_prob_default =</span> <span class="fu">predict</span>(</span>
<span id="cb216-8"><a href="classification.html#cb216-8" aria-hidden="true" tabindex="-1"></a>    glm_default_balance_student,</span>
<span id="cb216-9"><a href="classification.html#cb216-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> default, <span class="at">type =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb216-10"><a href="classification.html#cb216-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb216-11"><a href="classification.html#cb216-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb216-12"><a href="classification.html#cb216-12" aria-hidden="true" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">roc_auc</span>(</span>
<span id="cb216-13"><a href="classification.html#cb216-13" aria-hidden="true" tabindex="-1"></a>  glm_pred,</span>
<span id="cb216-14"><a href="classification.html#cb216-14" aria-hidden="true" tabindex="-1"></a>  glm_prob_default, <span class="at">truth =</span> default,</span>
<span id="cb216-15"><a href="classification.html#cb216-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span></span>
<span id="cb216-16"><a href="classification.html#cb216-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 roc_auc binary         0.950</code></pre>
</div>
<div id="quadratic-discriminant-analysis" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Quadratic Discriminant Analysis<a href="classification.html#quadratic-discriminant-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>As we have discussed, LDA assumes that the observations within each
class are drawn from a multivariate Gaussian distribution with a class-specific mean vector and a covariance matrix that is common to all <span class="math inline">\(K\)</span>
classes. Quadratic discriminant analysis (QDA) provides an alternative
approach. Like LDA, the QDA classifier results from assuming that the
observations from each class are drawn from a Gaussian distribution, and
plugging estimates for the parameters into Bayes’ theorem in order to perform prediction. However, unlike LDA, QDA assumes that each class has
its own covariance matrix. That is, it assumes that an observation from the
<span class="math inline">\(k\)</span>th class is of the form <span class="math inline">\(X \sim N(\mu_k, \Sigma_k)\)</span>, where <span class="math inline">\(\Sigma_k\)</span> is a covariance matrix
for the <span class="math inline">\(k\)</span>th class.</p>
</blockquote>
<p>An observation <span class="math inline">\(X = x\)</span> is assigned to the class for which</p>
<p><span class="math display">\[
\begin{align}
\delta_k (x) = - \frac{1}{2} (x - \mu_k)^T \Sigma^{-1}_k (x - \mu_k) - \frac{1}{2} \log |\Sigma_k|+ \log \pi_k.
\end{align}
\]</span></p>
<p>is largest. QDA gets its name from how the quantity <span class="math inline">\(x\)</span> appears as quadratic function in the first term of the above equation.</p>
<blockquote>
<p>Why does it matter whether or not we assume that the <span class="math inline">\(K\)</span> classes share a
common covariance matrix? In other words, why would one prefer LDA to
QDA, or vice-versa? The answer lies in the bias-variance trade-off. When
there are <span class="math inline">\(p\)</span> predictors, then estimating a covariance matrix requires estimating <span class="math inline">\(p(p+1)/2\)</span> parameters. QDA estimates a separate covariance matrix
for each class, for a total of <span class="math inline">\(Kp(p+1)/2\)</span> parameters.</p>
</blockquote>
<blockquote>
<p>Consequently, LDA is a much less flexible classifier than QDA, and
so has substantially lower variance. This can potentially lead to improved
prediction performance. But there is a trade-off: if LDA’s assumption that
the <span class="math inline">\(K\)</span> classes share a common covariance matrix is badly off, then LDA
can suffer from high bias.</p>
</blockquote>
<p>In general, use LDA if there are relatively few training observations, and use QDA for many.
Also consider QDA if you have some intuition about the decision boundary being non-linear.</p>
</div>
<div id="naive-bayes" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Naive Bayes<a href="classification.html#naive-bayes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The naive Bayes classifier also estimates the conditional probability <span class="math inline">\(f_k (x) = \text{Pr}(X|Y = k)\)</span>.
In LDA, we made the very strong assumption that <span class="math inline">\(f_k\)</span> is the density function of a multivariate normal distribution with mean <span class="math inline">\(\mu_k\)</span> and shared covariance <span class="math inline">\(\Sigma\)</span>.
In QDA, the covariance <span class="math inline">\(\Sigma_k\)</span> is class-specific.
The naive Bayes classifier instead makes a single assumption:</p>
<blockquote>
<p>Within the <span class="math inline">\(k\)</span>th class, the <span class="math inline">\(p\)</span> predictors are independent.</p>
</blockquote>
<p>Mathematically:</p>
<p><span class="math display">\[
f_k (x) = f_{k1}(x_1) \times f_{k2}(x_2) \times \dots \times f_{kp}(x_p).
\]</span></p>
<p>where <span class="math inline">\(f_{kj}\)</span> is the density function of the <span class="math inline">\(j\)</span>th predictor among observations in the <span class="math inline">\(k\)</span>th class.</p>
<blockquote>
<p>Why is this assumption so powerful? Essentially, estimating a <span class="math inline">\(p\)</span>-dimensional density function is challenging because we must consider not only
the marginal distribution of each predictor — that is, the distribution of each predictor on its own — but also the joint distribution of the predictors
— that is, the association between the different predictors. In the case of
a multivariate normal distribution, the association between the different
predictors is summarized by the off-diagonal elements of the covariance
matrix. However, in general, this association can be very hard to characterize, and exceedingly challenging to estimate. But by assuming that the
<span class="math inline">\(p\)</span> covariates are independent within each class, we completely eliminate the
need to worry about the association between the <span class="math inline">\(p\)</span> predictors, because we
have simply assumed that there is no association between the predictors!</p>
</blockquote>
<p>This is a very stringent assumption – most of the time, we believe there to be some degree of association between predictors.
But naive Bayes can still perform well, especially when <span class="math inline">\(n\)</span> is not large enough relative to <span class="math inline">\(p\)</span> to effectively estimate the joint distribution of the predictors within each class.</p>
<blockquote>
<p>Essentially, the naive Bayes assumption introduces some bias, but
reduces variance, leading to a classifier that works quite well in practice as
a result of the bias-variance trade-off.</p>
</blockquote>
<p>Under the naive Bayes, assumption, the posterior probability becomes:</p>
<p><span class="math display">\[
\text{Pr}(Y = k|X = x) = \frac{\pi_k \times f_{k1}(x_1) \times \dots \times f_{kp} (x_p)}{\sum_{l=1}^K \pi_l \times f_{l1}(x_1) \times \dots \times f_{lp} (x_p)}
\]</span></p>
<p>for <span class="math inline">\(k = 1, \dots, K\)</span>.</p>
<p>To estimate the one-dimensional <span class="math inline">\(f_{kj}\)</span> from <span class="math inline">\(x_j\)</span>, we have a few options:</p>
<ul>
<li>Assume that the <span class="math inline">\(j\)</span>th predictor is drawn from a univariate normal distribution.
<ul>
<li><span class="math inline">\(X_j | Y = k \sim N(\mu_{jk}, \sigma_{jk}^2)\)</span>.</li>
<li>This is like QDA except the covariance matrix is diagonal because the predictors are independent.</li>
</ul></li>
<li>Use a non-parametric estimate for <span class="math inline">\(f_{kj}\)</span>.
<ul>
<li>A simple way: Estimate <span class="math inline">\(f_{kj}(x_j)\)</span> as the fraction of the training observations in the <span class="math inline">\(k\)</span>th class belonging to a histogram bin.</li>
<li>Alternatively, use a kernel density estimator, which is essentially a smoothed version of a histogram.</li>
</ul></li>
<li>For qualitative <span class="math inline">\(X_j\)</span>, simply count the proportion of training observations for the <span class="math inline">\(j\)</span>th predictor corresponding to each class.</li>
</ul>
<p>Apply the naive Bayes classifier with the <code>klaR</code> package:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="classification.html#cb218-1" aria-hidden="true" tabindex="-1"></a>nb_default <span class="ot">&lt;-</span></span>
<span id="cb218-2"><a href="classification.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  klaR<span class="sc">::</span><span class="fu">NaiveBayes</span>(default <span class="sc">~</span> balance <span class="sc">+</span> student, <span class="at">data =</span> default)</span>
<span id="cb218-3"><a href="classification.html#cb218-3" aria-hidden="true" tabindex="-1"></a>nb_pred <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb218-4"><a href="classification.html#cb218-4" aria-hidden="true" tabindex="-1"></a>  default,</span>
<span id="cb218-5"><a href="classification.html#cb218-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nb_prob_default =</span> <span class="fu">predict</span>(nb_default, <span class="at">newdata =</span> default)<span class="sc">$</span>posterior[,<span class="dv">2</span>]</span>
<span id="cb218-6"><a href="classification.html#cb218-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>If we take a posterior probability of 50% or 20% as the thresholds for predicting a default, we get Tables 4.8 and 4.9:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="classification.html#cb219-1" aria-hidden="true" tabindex="-1"></a>nb_pred <span class="ot">&lt;-</span> nb_pred <span class="sc">%&gt;%</span></span>
<span id="cb219-2"><a href="classification.html#cb219-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb219-3"><a href="classification.html#cb219-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_default_0.5 =</span> <span class="fu">ifelse</span>(nb_prob_default <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>),</span>
<span id="cb219-4"><a href="classification.html#cb219-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_default_0.2 =</span> <span class="fu">ifelse</span>(nb_prob_default <span class="sc">&gt;</span> <span class="fl">0.2</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>)</span>
<span id="cb219-5"><a href="classification.html#cb219-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb219-6"><a href="classification.html#cb219-6" aria-hidden="true" tabindex="-1"></a>nb_pred <span class="sc">%&gt;%</span></span>
<span id="cb219-7"><a href="classification.html#cb219-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pred_default_0<span class="fl">.5</span>, default) <span class="sc">%&gt;%</span></span>
<span id="cb219-8"><a href="classification.html#cb219-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> default, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb219-9"><a href="classification.html#cb219-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> No <span class="sc">+</span> Yes) <span class="sc">%&gt;%</span></span>
<span id="cb219-10"><a href="classification.html#cb219-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">&quot;pred_default_0.5&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-11"><a href="classification.html#cb219-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(<span class="at">label =</span> <span class="st">&quot;True default status&quot;</span>, <span class="at">columns =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb219-12"><a href="classification.html#cb219-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_stubhead</span>(<span class="st">&quot;Predicted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-13"><a href="classification.html#cb219-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary_rows</span>(<span class="at">fns =</span> <span class="fu">list</span>(<span class="at">Total =</span> <span class="sc">~</span><span class="fu">round</span>(<span class="fu">sum</span>(.), <span class="dv">0</span>)))</span></code></pre></div>
<div id="ujgogwpkcm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ujgogwpkcm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ujgogwpkcm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ujgogwpkcm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ujgogwpkcm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ujgogwpkcm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ujgogwpkcm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ujgogwpkcm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ujgogwpkcm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ujgogwpkcm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ujgogwpkcm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ujgogwpkcm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ujgogwpkcm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ujgogwpkcm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ujgogwpkcm .gt_from_md > :first-child {
  margin-top: 0;
}

#ujgogwpkcm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ujgogwpkcm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ujgogwpkcm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ujgogwpkcm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ujgogwpkcm .gt_row_group_first td {
  border-top-width: 2px;
}

#ujgogwpkcm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ujgogwpkcm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ujgogwpkcm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ujgogwpkcm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ujgogwpkcm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ujgogwpkcm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ujgogwpkcm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ujgogwpkcm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ujgogwpkcm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ujgogwpkcm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ujgogwpkcm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ujgogwpkcm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ujgogwpkcm .gt_left {
  text-align: left;
}

#ujgogwpkcm .gt_center {
  text-align: center;
}

#ujgogwpkcm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ujgogwpkcm .gt_font_normal {
  font-weight: normal;
}

#ujgogwpkcm .gt_font_bold {
  font-weight: bold;
}

#ujgogwpkcm .gt_font_italic {
  font-style: italic;
}

#ujgogwpkcm .gt_super {
  font-size: 65%;
}

#ujgogwpkcm .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#ujgogwpkcm .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ujgogwpkcm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ujgogwpkcm .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#ujgogwpkcm .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#ujgogwpkcm .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1">Predicted</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">True default status</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">No</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Yes</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Total</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right gt_stub">No</td>
<td class="gt_row gt_right">9621</td>
<td class="gt_row gt_right">244</td>
<td class="gt_row gt_right">9865</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Yes</td>
<td class="gt_row gt_right">46</td>
<td class="gt_row gt_right">89</td>
<td class="gt_row gt_right">135</td></tr>
    <tr><td class="gt_row gt_right gt_stub gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">Total</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">9,667.00</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">333.00</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">10,000.00</td></tr>
  </tbody>
  
  
</table>
</div>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="classification.html#cb220-1" aria-hidden="true" tabindex="-1"></a>nb_pred <span class="sc">%&gt;%</span></span>
<span id="cb220-2"><a href="classification.html#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pred_default_0<span class="fl">.2</span>, default) <span class="sc">%&gt;%</span></span>
<span id="cb220-3"><a href="classification.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> default, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb220-4"><a href="classification.html#cb220-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> No <span class="sc">+</span> Yes) <span class="sc">%&gt;%</span></span>
<span id="cb220-5"><a href="classification.html#cb220-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">&quot;pred_default_0.2&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb220-6"><a href="classification.html#cb220-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(<span class="at">label =</span> <span class="st">&quot;True default status&quot;</span>, <span class="at">columns =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb220-7"><a href="classification.html#cb220-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_stubhead</span>(<span class="st">&quot;Predicted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb220-8"><a href="classification.html#cb220-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary_rows</span>(<span class="at">fns =</span> <span class="fu">list</span>(<span class="at">Total =</span> <span class="sc">~</span><span class="fu">round</span>(<span class="fu">sum</span>(.), <span class="dv">0</span>)))</span></code></pre></div>
<div id="vfygpcxfsz" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vfygpcxfsz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vfygpcxfsz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vfygpcxfsz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vfygpcxfsz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vfygpcxfsz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vfygpcxfsz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vfygpcxfsz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vfygpcxfsz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vfygpcxfsz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vfygpcxfsz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vfygpcxfsz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vfygpcxfsz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vfygpcxfsz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vfygpcxfsz .gt_from_md > :first-child {
  margin-top: 0;
}

#vfygpcxfsz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vfygpcxfsz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vfygpcxfsz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vfygpcxfsz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vfygpcxfsz .gt_row_group_first td {
  border-top-width: 2px;
}

#vfygpcxfsz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vfygpcxfsz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vfygpcxfsz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vfygpcxfsz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vfygpcxfsz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vfygpcxfsz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vfygpcxfsz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vfygpcxfsz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vfygpcxfsz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vfygpcxfsz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vfygpcxfsz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vfygpcxfsz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vfygpcxfsz .gt_left {
  text-align: left;
}

#vfygpcxfsz .gt_center {
  text-align: center;
}

#vfygpcxfsz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vfygpcxfsz .gt_font_normal {
  font-weight: normal;
}

#vfygpcxfsz .gt_font_bold {
  font-weight: bold;
}

#vfygpcxfsz .gt_font_italic {
  font-style: italic;
}

#vfygpcxfsz .gt_super {
  font-size: 65%;
}

#vfygpcxfsz .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#vfygpcxfsz .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#vfygpcxfsz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vfygpcxfsz .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#vfygpcxfsz .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#vfygpcxfsz .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1">Predicted</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">True default status</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">No</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Yes</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Total</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right gt_stub">No</td>
<td class="gt_row gt_right">9339</td>
<td class="gt_row gt_right">130</td>
<td class="gt_row gt_right">9469</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Yes</td>
<td class="gt_row gt_right">328</td>
<td class="gt_row gt_right">203</td>
<td class="gt_row gt_right">531</td></tr>
    <tr><td class="gt_row gt_right gt_stub gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">Total</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">9,667.00</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">333.00</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row">10,000.00</td></tr>
  </tbody>
  
  
</table>
</div>
<p>The numbers are slightly different from the text, which may have to do with how <span class="math inline">\(f_{kj}\)</span> for the quantitative <code>balance</code> was estimated.
The overall error rate, sensitivity, and specificity of the naive Bayes approach:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="classification.html#cb221-1" aria-hidden="true" tabindex="-1"></a>nb_pred <span class="sc">%&gt;%</span></span>
<span id="cb221-2"><a href="classification.html#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(default, pred_default_0<span class="fl">.2</span>, pred_default_0<span class="fl">.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb221-3"><a href="classification.html#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(pred_default_0<span class="fl">.5</span>, pred_default_0<span class="fl">.2</span>),</span>
<span id="cb221-4"><a href="classification.html#cb221-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;threshold&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;pred_default&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb221-5"><a href="classification.html#cb221-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">threshold =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(threshold, <span class="st">&quot;pred_default_&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb221-6"><a href="classification.html#cb221-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(threshold) <span class="sc">%&gt;%</span></span>
<span id="cb221-7"><a href="classification.html#cb221-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb221-8"><a href="classification.html#cb221-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">overall_error =</span> <span class="fu">mean</span>(default <span class="sc">!=</span> pred_default),</span>
<span id="cb221-9"><a href="classification.html#cb221-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sensitivity =</span> <span class="fu">sum</span>(default <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span> <span class="sc">&amp;</span> pred_default <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span>) <span class="sc">/</span></span>
<span id="cb221-10"><a href="classification.html#cb221-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(default <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span>),</span>
<span id="cb221-11"><a href="classification.html#cb221-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">specificity =</span> <span class="fu">sum</span>(default <span class="sc">==</span> <span class="st">&quot;No&quot;</span> <span class="sc">&amp;</span> pred_default <span class="sc">==</span> <span class="st">&quot;No&quot;</span>) <span class="sc">/</span></span>
<span id="cb221-12"><a href="classification.html#cb221-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(default <span class="sc">==</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb221-13"><a href="classification.html#cb221-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb221-14"><a href="classification.html#cb221-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb221-15"><a href="classification.html#cb221-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), scales<span class="sc">::</span>percent)) <span class="sc">%&gt;%</span></span>
<span id="cb221-16"><a href="classification.html#cb221-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code></pre></div>
<div id="dolyxdntek" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#dolyxdntek .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dolyxdntek .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dolyxdntek .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dolyxdntek .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dolyxdntek .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dolyxdntek .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dolyxdntek .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dolyxdntek .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dolyxdntek .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dolyxdntek .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dolyxdntek .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dolyxdntek .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#dolyxdntek .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dolyxdntek .gt_from_md > :first-child {
  margin-top: 0;
}

#dolyxdntek .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dolyxdntek .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dolyxdntek .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dolyxdntek .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dolyxdntek .gt_row_group_first td {
  border-top-width: 2px;
}

#dolyxdntek .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dolyxdntek .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dolyxdntek .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dolyxdntek .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dolyxdntek .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dolyxdntek .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dolyxdntek .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dolyxdntek .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dolyxdntek .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dolyxdntek .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dolyxdntek .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dolyxdntek .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dolyxdntek .gt_left {
  text-align: left;
}

#dolyxdntek .gt_center {
  text-align: center;
}

#dolyxdntek .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dolyxdntek .gt_font_normal {
  font-weight: normal;
}

#dolyxdntek .gt_font_bold {
  font-weight: bold;
}

#dolyxdntek .gt_font_italic {
  font-style: italic;
}

#dolyxdntek .gt_super {
  font-size: 65%;
}

#dolyxdntek .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#dolyxdntek .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#dolyxdntek .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dolyxdntek .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#dolyxdntek .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#dolyxdntek .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">threshold</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">overall_error</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">sensitivity</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">specificity</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">20%</td>
<td class="gt_row gt_left">4.6%</td>
<td class="gt_row gt_left">61%</td>
<td class="gt_row gt_left">96.6%</td></tr>
    <tr><td class="gt_row gt_left">50%</td>
<td class="gt_row gt_left">2.9%</td>
<td class="gt_row gt_left">27%</td>
<td class="gt_row gt_left">99.5%</td></tr>
  </tbody>
  
  
</table>
</div>
<p>The overall error rate is slightly higher, but a higher sensitivity was achieved.</p>
<blockquote>
<p>In this example, it should not be too surprising that naive Bayes does
not convincingly outperform LDA: this data set has <span class="math inline">\(n = 10,000\)</span> and <span class="math inline">\(p = 4\)</span>,
and so the reduction in variance resulting from the naive Bayes assumption
is not necessarily worthwhile. We expect to see a greater pay-off to using
naive Bayes relative to LDA or QDA in instances where <span class="math inline">\(p\)</span> is larger or <span class="math inline">\(n\)</span> is
smaller, so that reducing the variance is very important.</p>
</blockquote>
</div>
</div>
<div id="a-comparison-of-classification-methods" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> A Comparison of Classification Methods<a href="classification.html#a-comparison-of-classification-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="an-analytical-comparison" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> An Analytical Comparison<a href="classification.html#an-analytical-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>We now perform an analytical (or mathematical) comparison of LDA,
QDA, naive Bayes, and logistic regression. We consider these approaches in
a setting with <span class="math inline">\(K\)</span> classes, so that we assign an observation to the class that
maximizes <span class="math inline">\(\text{Pr}(Y = k|X = x)\)</span>. Equivalently, we can set <span class="math inline">\(K\)</span> as the baseline
class and assign an observation to the class that maximizes</p>
</blockquote>
<p><span class="math display">\[
\log \left(\frac{\text{Pr}(Y = k|X = x)}{\text{Pr}(Y = K |X = x)}\right)
\]</span></p>
<blockquote>
<p>for <span class="math inline">\(k = 1, \dots, K\)</span>.</p>
</blockquote>
<p>This is the familiar log-odds of class <span class="math inline">\(k\)</span> compared to baseline class <span class="math inline">\(K\)</span>.</p>
<p>For LDA, we assumed the predictors within each class are drawn from a multivariate normal distribution with shared co-variance matrix.
The log-odds can be represented as:</p>
<p><span class="math display">\[
\begin{align}
\log \left(\frac{\text{Pr}(Y = k|X = x)}{\text{Pr}(Y = K |X = x)}\right) &amp;= \log \left(\frac{\pi_k f_k(x)}{\pi_K f_K(x)}\right)\\
&amp;= a_k + \sum_{j=1}^p b_{kj} x_j.
\end{align}
\]</span></p>
<p>where <span class="math inline">\(a_k\)</span> and <span class="math inline">\(b_{kj}\)</span> are functions of <span class="math inline">\(\pi_k\)</span>, <span class="math inline">\(\mu_k\)</span>, and <span class="math inline">\(\Sigma_k\)</span>.
Like logistic regression, LDA assumes that the log-odds of the probabilities are linear in <span class="math inline">\(x\)</span>.</p>
<p>Similarly, an additional function <span class="math inline">\(c_{kjl}\)</span> gives the log-odds in the QDA setting:</p>
<p><span class="math display">\[
\log \left(\frac{\text{Pr}(Y = k|X = x)}{\text{Pr}(Y = K |X = x)}\right)
= a_k + \sum_{j=1}^p b_{kj} x_j + \sum_{j=1}^p \sum_{l=1}^p c_{kjl} x_j x_l
\]</span></p>
<p>which is quadratic in <span class="math inline">\(x\)</span>.</p>
<p>Finally, the naive Bayes setting, with one-dimensional <span class="math inline">\(f_{kj}(x_j)\)</span>:</p>
<p><span class="math display">\[
\begin{align}
\log \left(\frac{\text{Pr}(Y = k|X = x)}{\text{Pr}(Y = K |X = x)}\right) &amp;= \log \left(\frac{\pi_k f_k(x   )}{\pi_K f_K(x)}\right)\\
&amp;= a_k + \sum_{j=1}^p g_{kj} (x_j).
\end{align}
\]</span></p>
<p>where <span class="math inline">\(g_{kj} (x_j) = \log \frac{f_{kj}(x_j)}{f_{Kj} (x_j)}\)</span>.
This is the form of a generalized additive model, a topic that is discussed further in Chapter 7.</p>
<p>Looking at these forms, we have the following observations:</p>
<ul>
<li>LDA is a special case of QDA with <span class="math inline">\(c_{kjl} = 0\)</span>.</li>
<li>Any classifier with a linear decision boundary is a special case of naive Bayes with <span class="math inline">\(b_{kj} (x_j) = b_{kj} x_j\)</span>. In particular, this means that LDA is a special case of naive Bayes.</li>
<li>Naive Bayes is also a special case of LDA if <span class="math inline">\(f_{kj} (x_j)\)</span> is a modeled as a one-dimensional Gaussian distribution.</li>
<li>QDA and naive Bayes are not special cases of the other.</li>
</ul>
<blockquote>
<p>None of these methods uniformly dominates the others: in any setting, the
choice of method will depend on the true distribution of the predictors in
each of the <span class="math inline">\(K\)</span> classes, as well as other considerations, such as the values of
<span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span>. The latter ties into the bias-variance trade-off.</p>
</blockquote>
<p>Then to tie this all to logistic regression, recall the multinomial form:</p>
<p><span class="math display">\[
\log \left( \frac{\text{Pr} (Y = k| X = x)}{\text{Pr} (Y = K| X = x)}\right) = \beta_{k0} + \sum_{j=1}^p \beta_{kj} x_j.
\]</span></p>
<p>This is identical to the linear form of the LDA as both are linear functions of the predictors.
The estimation approach differs of course:</p>
<blockquote>
<p>In LDA, the coefficients in this linear function are functions of estimates for <span class="math inline">\(\pi_k\)</span>, <span class="math inline">\(\pi_K\)</span>, <span class="math inline">\(\mu_k\)</span>, <span class="math inline">\(\mu_K\)</span>, and <span class="math inline">\(\Sigma\)</span>
obtained by assuming that <span class="math inline">\(X_1,\dots, X_p\)</span> follow a normal distribution within each class. By contrast, in logistic regression, the coefficients
are chosen to maximize the likelihood function (4.5). Thus, we expect LDA
to outperform logistic regression when the normality assumption (approximately) holds, and we expect logistic regression to perform better when it
does not.</p>
</blockquote>
<p>Lastly, some observations about <span class="math inline">\(K\)</span>-nearest neighbors, which is a non-parametric alternative to classification:</p>
<blockquote>
<ul>
<li>Because KNN is completely non-parametric, we can expect this approach to dominate LDA and logistic regression when the decision
boundary is highly non-linear, provided that <span class="math inline">\(n\)</span> is very large and <span class="math inline">\(p\)</span> is
small.</li>
<li>In order to provide accurate classification, KNN requires a lot of observations relative to the number of predictors – that is, <span class="math inline">\(n\)</span> much larger
than <span class="math inline">\(p\)</span>. This has to do with the fact that KNN is non-parametric, and
thus tends to reduce the bias while incurring a lot of variance.</li>
<li>In settings where the decision boundary is non-linear but <span class="math inline">\(n\)</span> is only
modest, or <span class="math inline">\(p\)</span> is not very small, then QDA may be preferred to KNN.
This is because QDA can provide a non-linear decision boundary
while taking advantage of a parametric form, which means that it
requires a smaller sample size for accurate classification, relative to
KNN.</li>
<li>Unlike logistic regression, KNN does not tell us which predictors are
important: we don’t get a table of coefficients as in Table 4.3.</li>
</ul>
</blockquote>
</div>
<div id="an-empirical-comparison" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> An Empirical Comparison<a href="classification.html#an-empirical-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Without additional simulation details, I can’t exactly re-produce the results of this section, but I’ll attempt it for scenarios 1, 2 and 3 (the linear examples).</p>
<p>There is a function called <code>make_blobs()</code> in the scikit-learn package (<a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.make_blobs.html">documentation here</a> that I’ve used before to simulate clustered data.
From a quick Google search, I found <a href="https://github.com/elbamos/clusteringdatasets/">this R package <code>clusteringdatasets</code></a> which translates the function in R.
I adapted the <a href="https://github.com/elbamos/clusteringdatasets/blob/master/R/sklearn.R">source code</a> to simulate the two-class linear scenarios:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="classification.html#cb222-1" aria-hidden="true" tabindex="-1"></a>make_blobs <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb222-2"><a href="classification.html#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_samples =</span> <span class="dv">40</span>, <span class="at">n_features =</span> <span class="dv">2</span>,</span>
<span id="cb222-3"><a href="classification.html#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># By default, class 1 is centered at (0, 0) and class 2 at (1, 1)</span></span>
<span id="cb222-4"><a href="classification.html#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_centers =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>),</span>
<span id="cb222-5"><a href="classification.html#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># By default, the two features are uncorrelated with variance = 1</span></span>
<span id="cb222-6"><a href="classification.html#cb222-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_covar =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>),</span>
<span id="cb222-7"><a href="classification.html#cb222-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist =</span> <span class="fu">c</span>(<span class="st">&quot;norm&quot;</span>, <span class="st">&quot;t&quot;</span>), <span class="at">t_df =</span> <span class="dv">5</span></span>
<span id="cb222-8"><a href="classification.html#cb222-8" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb222-9"><a href="classification.html#cb222-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">ncol</span>(cluster_centers) <span class="sc">!=</span> n_features) {</span>
<span id="cb222-10"><a href="classification.html#cb222-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Dimensionality of centers must equal number of features&quot;</span>)</span>
<span id="cb222-11"><a href="classification.html#cb222-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb222-12"><a href="classification.html#cb222-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((<span class="fu">nrow</span>(cluster_covar) <span class="sc">!=</span> n_features) <span class="sc">|</span></span>
<span id="cb222-13"><a href="classification.html#cb222-13" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">ncol</span>(cluster_covar) <span class="sc">!=</span> n_features)) {</span>
<span id="cb222-14"><a href="classification.html#cb222-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Dimensionality of covariance matrix must match number of features&quot;</span>)</span>
<span id="cb222-15"><a href="classification.html#cb222-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb222-16"><a href="classification.html#cb222-16" aria-hidden="true" tabindex="-1"></a>  dist <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(dist)</span>
<span id="cb222-17"><a href="classification.html#cb222-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb222-18"><a href="classification.html#cb222-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Equally divides each of `n_samples` into the different categories according</span></span>
<span id="cb222-19"><a href="classification.html#cb222-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  to the number of provided classes</span></span>
<span id="cb222-20"><a href="classification.html#cb222-20" aria-hidden="true" tabindex="-1"></a>  categories <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cluster_centers), <span class="at">length.out =</span> n_samples)</span>
<span id="cb222-21"><a href="classification.html#cb222-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb222-22"><a href="classification.html#cb222-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (dist <span class="sc">==</span> <span class="st">&quot;norm&quot;</span>) {</span>
<span id="cb222-23"><a href="classification.html#cb222-23" aria-hidden="true" tabindex="-1"></a>    points <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_samples, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Sigma =</span> cluster_covar)</span>
<span id="cb222-24"><a href="classification.html#cb222-24" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (dist <span class="sc">==</span> <span class="st">&quot;t&quot;</span>) {</span>
<span id="cb222-25"><a href="classification.html#cb222-25" aria-hidden="true" tabindex="-1"></a>    points <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">rmvt</span>(<span class="at">n =</span> n_samples, <span class="at">delta =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">df =</span> t_df,</span>
<span id="cb222-26"><a href="classification.html#cb222-26" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sigma =</span> cluster_covar)</span>
<span id="cb222-27"><a href="classification.html#cb222-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb222-28"><a href="classification.html#cb222-28" aria-hidden="true" tabindex="-1"></a>  points <span class="ot">&lt;-</span> points <span class="sc">+</span> cluster_centers[categories, ]</span>
<span id="cb222-29"><a href="classification.html#cb222-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb222-30"><a href="classification.html#cb222-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(points) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)</span>
<span id="cb222-31"><a href="classification.html#cb222-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(points) <span class="sc">%&gt;%</span></span>
<span id="cb222-32"><a href="classification.html#cb222-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="at">category =</span> <span class="fu">factor</span>(categories))</span>
<span id="cb222-33"><a href="classification.html#cb222-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here is some sample data simulated for the first three scenarios:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="classification.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">22</span>)</span>
<span id="cb223-2"><a href="classification.html#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="classification.html#cb223-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(</span>
<span id="cb223-4"><a href="classification.html#cb223-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> scenario, <span class="sc">~</span> data,</span>
<span id="cb223-5"><a href="classification.html#cb223-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Scenario 1&quot;</span>, <span class="fu">make_blobs</span>(<span class="at">n_samples =</span> <span class="dv">40</span>),</span>
<span id="cb223-6"><a href="classification.html#cb223-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Scenario 2&quot;</span>, <span class="fu">make_blobs</span>(<span class="at">n_samples =</span> <span class="dv">40</span>,</span>
<span id="cb223-7"><a href="classification.html#cb223-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cluster_covar =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb223-8"><a href="classification.html#cb223-8" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">nrow =</span> <span class="dv">2</span>)),</span>
<span id="cb223-9"><a href="classification.html#cb223-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Scenario 3&quot;</span>, <span class="fu">make_blobs</span>(<span class="at">n_samples =</span> <span class="dv">100</span>,</span>
<span id="cb223-10"><a href="classification.html#cb223-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cluster_covar =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb223-11"><a href="classification.html#cb223-11" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">nrow =</span> <span class="dv">2</span>),</span>
<span id="cb223-12"><a href="classification.html#cb223-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">dist =</span> <span class="st">&quot;t&quot;</span>)</span>
<span id="cb223-13"><a href="classification.html#cb223-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb223-14"><a href="classification.html#cb223-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb223-15"><a href="classification.html#cb223-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y, <span class="at">color =</span> category, <span class="at">shape =</span> category)) <span class="sc">+</span></span>
<span id="cb223-16"><a href="classification.html#cb223-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb223-17"><a href="classification.html#cb223-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> scenario) <span class="sc">+</span></span>
<span id="cb223-18"><a href="classification.html#cb223-18" aria-hidden="true" tabindex="-1"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-119-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Simulate 100 testing data sets for each of these scenarios:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="classification.html#cb224-1" aria-hidden="true" tabindex="-1"></a>sim_linear_train <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb224-2"><a href="classification.html#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> scenario, <span class="sc">~</span> n_samples, <span class="sc">~</span> corr, <span class="sc">~</span> dist,</span>
<span id="cb224-3"><a href="classification.html#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Scenario 1&quot;</span>, <span class="dv">40</span>, <span class="fl">0.0</span>, <span class="st">&quot;norm&quot;</span>,</span>
<span id="cb224-4"><a href="classification.html#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Scenario 2&quot;</span>, <span class="dv">40</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="st">&quot;norm&quot;</span>,</span>
<span id="cb224-5"><a href="classification.html#cb224-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Scenario 3&quot;</span>, <span class="dv">40</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="st">&quot;t&quot;</span></span>
<span id="cb224-6"><a href="classification.html#cb224-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb224-7"><a href="classification.html#cb224-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">sim =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb224-8"><a href="classification.html#cb224-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb224-9"><a href="classification.html#cb224-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb224-10"><a href="classification.html#cb224-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_data =</span> <span class="fu">list</span>(<span class="fu">make_blobs</span>(</span>
<span id="cb224-11"><a href="classification.html#cb224-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_samples =</span> n_samples,</span>
<span id="cb224-12"><a href="classification.html#cb224-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">cluster_covar =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, corr, corr, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>),</span>
<span id="cb224-13"><a href="classification.html#cb224-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">dist =</span> dist</span>
<span id="cb224-14"><a href="classification.html#cb224-14" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb224-15"><a href="classification.html#cb224-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb224-16"><a href="classification.html#cb224-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>The text doesn’t specify how many training samples are tested, just that it is a “large test set.”
I’ll use 1000:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="classification.html#cb225-1" aria-hidden="true" tabindex="-1"></a>sim_linear_test <span class="ot">&lt;-</span> sim_linear_train <span class="sc">%&gt;%</span></span>
<span id="cb225-2"><a href="classification.html#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(scenario, corr, dist) <span class="sc">%&gt;%</span></span>
<span id="cb225-3"><a href="classification.html#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb225-4"><a href="classification.html#cb225-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb225-5"><a href="classification.html#cb225-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_data =</span> <span class="fu">list</span>(<span class="fu">make_blobs</span>(</span>
<span id="cb225-6"><a href="classification.html#cb225-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_samples =</span> <span class="dv">1000</span>,</span>
<span id="cb225-7"><a href="classification.html#cb225-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">cluster_covar =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, corr, corr, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>),</span>
<span id="cb225-8"><a href="classification.html#cb225-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">dist =</span> dist</span>
<span id="cb225-9"><a href="classification.html#cb225-9" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb225-10"><a href="classification.html#cb225-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb225-11"><a href="classification.html#cb225-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Now load <code>tidymodels</code> and define the different models to be evaluated:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="classification.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb226-2"><a href="classification.html#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(discrim) <span class="co"># this needs to be loaded separately for `discrim_*()`</span></span>
<span id="cb226-3"><a href="classification.html#cb226-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-4"><a href="classification.html#cb226-4" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb226-5"><a href="classification.html#cb226-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> model_label, <span class="sc">~</span> model,</span>
<span id="cb226-6"><a href="classification.html#cb226-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;KNN-1&quot;</span>, <span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">neighbors =</span> <span class="dv">1</span>),</span>
<span id="cb226-7"><a href="classification.html#cb226-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;KNN-CV&quot;</span>, <span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">neighbors =</span> <span class="fu">tune</span>()),</span>
<span id="cb226-8"><a href="classification.html#cb226-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;LDA&quot;</span>, <span class="fu">discrim_linear</span>(),</span>
<span id="cb226-9"><a href="classification.html#cb226-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Logistic&quot;</span>, <span class="fu">logistic_reg</span>(),</span>
<span id="cb226-10"><a href="classification.html#cb226-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;NBayes&quot;</span>, <span class="fu">naive_Bayes</span>(),</span>
<span id="cb226-11"><a href="classification.html#cb226-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;QDA&quot;</span>, <span class="fu">discrim_quad</span>()</span>
<span id="cb226-12"><a href="classification.html#cb226-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>For each model and each of the 100 training sets, fit the model and evaluate on the testing set:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="classification.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A helper function for fitting on a training set and getting accuracy from</span></span>
<span id="cb227-2"><a href="classification.html#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  a testing set</span></span>
<span id="cb227-3"><a href="classification.html#cb227-3" aria-hidden="true" tabindex="-1"></a>calc_test_accuracy <span class="ot">&lt;-</span> <span class="cf">function</span>(model_label, train_data, test_data, model) {</span>
<span id="cb227-4"><a href="classification.html#cb227-4" aria-hidden="true" tabindex="-1"></a>  wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb227-5"><a href="classification.html#cb227-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(<span class="fu">recipe</span>(category <span class="sc">~</span> x <span class="sc">+</span> y, <span class="at">data =</span> train_data)) <span class="sc">%&gt;%</span></span>
<span id="cb227-6"><a href="classification.html#cb227-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(model)</span>
<span id="cb227-7"><a href="classification.html#cb227-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb227-8"><a href="classification.html#cb227-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (model_label <span class="sc">==</span> <span class="st">&quot;KNN-CV&quot;</span>) {</span>
<span id="cb227-9"><a href="classification.html#cb227-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5 fold cross-validation</span></span>
<span id="cb227-10"><a href="classification.html#cb227-10" aria-hidden="true" tabindex="-1"></a>    train_data_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_data, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb227-11"><a href="classification.html#cb227-11" aria-hidden="true" tabindex="-1"></a>    tune_res <span class="ot">&lt;-</span> wf <span class="sc">%&gt;%</span></span>
<span id="cb227-12"><a href="classification.html#cb227-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tune_grid</span>(</span>
<span id="cb227-13"><a href="classification.html#cb227-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">resamples =</span> train_data_folds,</span>
<span id="cb227-14"><a href="classification.html#cb227-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try 1 to 10 neighbors</span></span>
<span id="cb227-15"><a href="classification.html#cb227-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">grid =</span> <span class="fu">tibble</span>(<span class="at">neighbors =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb227-16"><a href="classification.html#cb227-16" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb227-17"><a href="classification.html#cb227-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overwrite the workflow with the best `neighbors` value by CV accuracy</span></span>
<span id="cb227-18"><a href="classification.html#cb227-18" aria-hidden="true" tabindex="-1"></a>    wf <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(wf, <span class="fu">select_best</span>(tune_res, <span class="st">&quot;accuracy&quot;</span>)) </span>
<span id="cb227-19"><a href="classification.html#cb227-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb227-20"><a href="classification.html#cb227-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb227-21"><a href="classification.html#cb227-21" aria-hidden="true" tabindex="-1"></a>  wf <span class="sc">%&gt;%</span></span>
<span id="cb227-22"><a href="classification.html#cb227-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(<span class="at">data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb227-23"><a href="classification.html#cb227-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(test_data) <span class="sc">%&gt;%</span></span>
<span id="cb227-24"><a href="classification.html#cb227-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">accuracy</span>(<span class="at">truth =</span> category, <span class="at">estimate =</span> .pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb227-25"><a href="classification.html#cb227-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(.estimate)</span>
<span id="cb227-26"><a href="classification.html#cb227-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="classification.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb228-2"><a href="classification.html#cb228-2" aria-hidden="true" tabindex="-1"></a>sim_linear_res <span class="ot">&lt;-</span>  sim_linear_train <span class="sc">%&gt;%</span></span>
<span id="cb228-3"><a href="classification.html#cb228-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sim_linear_test <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(scenario, test_data),</span>
<span id="cb228-4"><a href="classification.html#cb228-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;scenario&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb228-5"><a href="classification.html#cb228-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(models) <span class="sc">%&gt;%</span></span>
<span id="cb228-6"><a href="classification.html#cb228-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb228-7"><a href="classification.html#cb228-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_accuracy =</span> <span class="fu">pmap_dbl</span>(</span>
<span id="cb228-8"><a href="classification.html#cb228-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(model_label, train_data, test_data, model),</span>
<span id="cb228-9"><a href="classification.html#cb228-9" aria-hidden="true" tabindex="-1"></a>      calc_test_accuracy</span>
<span id="cb228-10"><a href="classification.html#cb228-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb228-11"><a href="classification.html#cb228-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_error =</span> <span class="dv">1</span> <span class="sc">-</span> test_accuracy</span>
<span id="cb228-12"><a href="classification.html#cb228-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb228-13"><a href="classification.html#cb228-13" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code></pre></div>
<pre><code>## 1955.31 sec elapsed</code></pre>
<p>Plot error rate for each model and scenario as in Figure 4.11:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="classification.html#cb230-1" aria-hidden="true" tabindex="-1"></a>sim_linear_res <span class="sc">%&gt;%</span></span>
<span id="cb230-2"><a href="classification.html#cb230-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_label =</span> <span class="fu">fct_inorder</span>(model_label),</span>
<span id="cb230-3"><a href="classification.html#cb230-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">model_fill =</span> <span class="fu">fct_collapse</span>(model_label,</span>
<span id="cb230-4"><a href="classification.html#cb230-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">KNN =</span> <span class="fu">c</span>(<span class="st">&quot;KNN-1&quot;</span>, <span class="st">&quot;KNN-CV&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb230-5"><a href="classification.html#cb230-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model_label, <span class="at">y =</span> test_error)) <span class="sc">+</span></span>
<span id="cb230-6"><a href="classification.html#cb230-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> model_fill), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb230-7"><a href="classification.html#cb230-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> scenario, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb230-8"><a href="classification.html#cb230-8" aria-hidden="true" tabindex="-1"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>() <span class="sc">+</span></span>
<span id="cb230-9"><a href="classification.html#cb230-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb230-10"><a href="classification.html#cb230-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;test error&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/fig4.11-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Pretty close.</p>
<ul>
<li>Scenario 1: uncorrelated normal variables.
<ul>
<li>LDA, logistic regression performed well due to linear decision boundary.</li>
<li>KNN performed poorly.</li>
<li>QDA worse than LDA because it was more flexible than necessary.</li>
<li>Naive Bayes should be better than QDA because of independent predictors (as in the text) but that is not the case in my simulations.</li>
</ul></li>
<li>Scenario 2: correlated normal variables.
<ul>
<li>Similar to scenario 1, except naive Bayes performed much worse due to correlated predictors.</li>
</ul></li>
<li>Scenario 3: correlated <span class="math inline">\(t\)</span>-distributed predictors (more extreme points than normal).
<ul>
<li>In the text, logistic regression performs slightly better than LDA, but here they are essentially identical.</li>
</ul></li>
</ul>
<p>I’m not sure of an easy way to adapt this approach to the non-linear scenarios 4, 5 and 6.
If anyone has ideas, please share them <a href="https://github.com/taylordunn/islr-tidy/issues/1">on this issue</a>.
Here is a summary of the results presented in Figure 4.12:</p>
<ul>
<li>Scenario 4: normal variables with different correlations per class.
<ul>
<li>The QDA assumption was correct, and therefore greatly outperformed others.</li>
</ul></li>
<li>Scenario 5: uncorrelated normal variables, but responses samples from the logistic function applied to a complicated non-linear function of the predictors.
<ul>
<li>The KNN-CV method gave the best results, followed by the more flexible QDA and naive Bayes.</li>
<li>KNN with <span class="math inline">\(K = 1\)</span> was the worst.</li>
</ul></li>
<li>Scenario 6: normal distribution with a different diagonal covariance matrix (uncorrelated) for each class, and with very small sample size.
<ul>
<li>Naive Bayes performed very well.</li>
<li>LDA and logistic regression performed worse due to unequal covariance matrices (non-linear decision boundary).</li>
<li>QDA performed a bit worse than naive Bayes due to small sample size, and difficulty estimating correlations between predictors.</li>
<li>KNN’s performance also suffered due to very small sample size.</li>
</ul></li>
</ul>
<p>The main takeaway from these empirical examples:</p>
<blockquote>
<p>These six examples illustrate that no one method will dominate the others in every situation. When the true decision boundaries are linear, then
the LDA and logistic regression approaches will tend to perform well. When
the boundaries are moderately non-linear, QDA or naive Bayes may give
better results. Finally, for much more complicated decision boundaries, a
non-parametric approach such as KNN can be superior. But the level of
smoothness for a non-parametric approach must be chosen carefully. In the
next chapter we examine a number of approaches for choosing the correct
level of smoothness and, in general, for selecting the best overall method.</p>
</blockquote>
<blockquote>
<p>Finally, recall from Chapter 3 that in the regression setting we can accommodate a non-linear relationship between the predictors and
by performing regression using transformations of the predictors. A similar
approach could be taken in the classification setting. For instance, we could
create a more flexible version of logistic regression by including <span class="math inline">\(X^2\)</span>, <span class="math inline">\(X^3\)</span>,
and even <span class="math inline">\(X^4\)</span> as predictors. This may or may not improve logistic regression’s performance, depending on whether the increase in variance due to
the added flexibility is offset by a sufficiently large reduction in bias. We
could do the same for LDA. If we added all possible quadratic terms and
cross-products to LDA, the form of the model would be the same as the
QDA model, although the parameter estimates would be different. This
device allows us to move somewhere between an LDA and a QDA model.</p>
</blockquote>
</div>
</div>
<div id="generalized-linear-models" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Generalized Linear Models<a href="classification.html#generalized-linear-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Thus far, we have considered both quantitative and qualitative response <span class="math inline">\(Y\)</span>.
However, sometimes <span class="math inline">\(Y\)</span> is neither, and so linear regression and classification are not applicable.</p>
<p>The example data set to introduce generalized linear models in <code>bikeshare</code>:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="classification.html#cb231-1" aria-hidden="true" tabindex="-1"></a>bikeshare <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Bikeshare</span>
<span id="cb231-2"><a href="classification.html#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(bikeshare)</span></code></pre></div>
<pre><code>## Rows: 8,645
## Columns: 15
## $ season     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ mnth       &lt;fct&gt; Jan, Jan, Jan, Jan, Jan, Jan, Jan, Jan, Jan, Jan, Jan, Jan,…
## $ day        &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ hr         &lt;fct&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1…
## $ holiday    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ weekday    &lt;dbl&gt; 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,…
## $ workingday &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ weathersit &lt;fct&gt; clear, clear, clear, clear, clear, cloudy/misty, clear, cle…
## $ temp       &lt;dbl&gt; 0.24, 0.22, 0.22, 0.24, 0.24, 0.24, 0.22, 0.20, 0.24, 0.32,…
## $ atemp      &lt;dbl&gt; 0.2879, 0.2727, 0.2727, 0.2879, 0.2879, 0.2576, 0.2727, 0.2…
## $ hum        &lt;dbl&gt; 0.81, 0.80, 0.80, 0.75, 0.75, 0.75, 0.80, 0.86, 0.75, 0.76,…
## $ windspeed  &lt;dbl&gt; 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0896, 0.0000, 0.0…
## $ casual     &lt;dbl&gt; 3, 8, 5, 3, 0, 0, 2, 1, 1, 8, 12, 26, 29, 47, 35, 40, 41, 1…
## $ registered &lt;dbl&gt; 13, 32, 27, 10, 1, 1, 0, 2, 7, 6, 24, 30, 55, 47, 71, 70, 5…
## $ bikers     &lt;dbl&gt; 16, 40, 32, 13, 1, 1, 2, 3, 8, 14, 36, 56, 84, 94, 106, 110…</code></pre>
<blockquote>
<p>The response
is <code>bikers</code>, the number of hourly users of a bike sharing program in Washington, DC. This response value is neither qualitative nor quantitative:
instead, it takes on non-negative integer values, or counts. We will consider counts
predicting bikers using the covariates <code>mnth</code> (month of the year), <code>hr</code> (hour
of the day, from 0 to 23), <code>workingday</code> (an indicator variable that equals 1 if
it is neither a weekend nor a holiday), <code>temp</code> (the normalized temperature,
in Celsius), and <code>weathersit</code> (a qualitative variable that takes on one of four
possible values: clear; misty or cloudy; light rain or light snow; or heavy
rain or heavy snow.)
In the analyses that follow, we will treat <code>mnth</code>, <code>hr</code>, and <code>weathersit</code> as
qualitative variables.</p>
</blockquote>
<div id="linear-regression-on-the-bikeshare-data" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Linear Regression on the Bikeshare Data<a href="classification.html#linear-regression-on-the-bikeshare-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Results of linear regression predicting <code>bikers</code>:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="classification.html#cb233-1" aria-hidden="true" tabindex="-1"></a>lm_bikers <span class="ot">&lt;-</span> <span class="fu">lm</span>(bikers <span class="sc">~</span> mnth <span class="sc">+</span> hr <span class="sc">+</span> workingday <span class="sc">+</span> temp <span class="sc">+</span> weathersit,</span>
<span id="cb233-2"><a href="classification.html#cb233-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> bikeshare)</span>
<span id="cb233-3"><a href="classification.html#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_custom</span>(lm_bikers, <span class="at">coef_round =</span> <span class="dv">2</span>, <span class="at">se_round =</span> <span class="dv">2</span>, <span class="at">z_round =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb233-4"><a href="classification.html#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclude mnth and hr due to space constraints</span></span>
<span id="cb233-5"><a href="classification.html#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(term, <span class="st">&quot;mnth|hr&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb233-6"><a href="classification.html#cb233-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code></pre></div>
<div id="nxdfzjqrsa" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#nxdfzjqrsa .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nxdfzjqrsa .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nxdfzjqrsa .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nxdfzjqrsa .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nxdfzjqrsa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nxdfzjqrsa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nxdfzjqrsa .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nxdfzjqrsa .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nxdfzjqrsa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nxdfzjqrsa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nxdfzjqrsa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nxdfzjqrsa .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#nxdfzjqrsa .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nxdfzjqrsa .gt_from_md > :first-child {
  margin-top: 0;
}

#nxdfzjqrsa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nxdfzjqrsa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nxdfzjqrsa .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nxdfzjqrsa .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nxdfzjqrsa .gt_row_group_first td {
  border-top-width: 2px;
}

#nxdfzjqrsa .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nxdfzjqrsa .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nxdfzjqrsa .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nxdfzjqrsa .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nxdfzjqrsa .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nxdfzjqrsa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nxdfzjqrsa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nxdfzjqrsa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nxdfzjqrsa .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nxdfzjqrsa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nxdfzjqrsa .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nxdfzjqrsa .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nxdfzjqrsa .gt_left {
  text-align: left;
}

#nxdfzjqrsa .gt_center {
  text-align: center;
}

#nxdfzjqrsa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nxdfzjqrsa .gt_font_normal {
  font-weight: normal;
}

#nxdfzjqrsa .gt_font_bold {
  font-weight: bold;
}

#nxdfzjqrsa .gt_font_italic {
  font-style: italic;
}

#nxdfzjqrsa .gt_super {
  font-size: 65%;
}

#nxdfzjqrsa .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#nxdfzjqrsa .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#nxdfzjqrsa .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nxdfzjqrsa .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#nxdfzjqrsa .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#nxdfzjqrsa .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">coefficient</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">std.error</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">z-statistic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">p-value</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">(Intercept)</td>
<td class="gt_row gt_right">-68.63</td>
<td class="gt_row gt_right">5.31</td>
<td class="gt_row gt_right">-12.93</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">workingday</td>
<td class="gt_row gt_right">1.27</td>
<td class="gt_row gt_right">1.78</td>
<td class="gt_row gt_right">0.71</td>
<td class="gt_row gt_left">0.477</td></tr>
    <tr><td class="gt_row gt_left">temp</td>
<td class="gt_row gt_right">157.21</td>
<td class="gt_row gt_right">10.26</td>
<td class="gt_row gt_right">15.32</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">weathersitcloudy/misty</td>
<td class="gt_row gt_right">-12.89</td>
<td class="gt_row gt_right">1.96</td>
<td class="gt_row gt_right">-6.56</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">weathersitlight rain/snow</td>
<td class="gt_row gt_right">-66.49</td>
<td class="gt_row gt_right">2.97</td>
<td class="gt_row gt_right">-22.42</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">weathersitheavy rain/snow</td>
<td class="gt_row gt_right">-109.74</td>
<td class="gt_row gt_right">76.67</td>
<td class="gt_row gt_right">-1.43</td>
<td class="gt_row gt_left">0.152</td></tr>
  </tbody>
  
  
</table>
</div>
<p>Re-creating Figure 4.13 takes some wrangling to get the appropriate coefficients:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="classification.html#cb234-1" aria-hidden="true" tabindex="-1"></a>month_coefs <span class="ot">&lt;-</span> <span class="fu">tidy</span>(lm_bikers) <span class="sc">%&gt;%</span></span>
<span id="cb234-2"><a href="classification.html#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">&quot;Intercept|mnth&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb234-3"><a href="classification.html#cb234-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb234-4"><a href="classification.html#cb234-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">ifelse</span>(</span>
<span id="cb234-5"><a href="classification.html#cb234-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># The reference level is January</span></span>
<span id="cb234-6"><a href="classification.html#cb234-6" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>, <span class="st">&quot;Jan&quot;</span>,</span>
<span id="cb234-7"><a href="classification.html#cb234-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove</span>(term, <span class="st">&quot;mnth&quot;</span>)</span>
<span id="cb234-8"><a href="classification.html#cb234-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb234-9"><a href="classification.html#cb234-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fct_inorder</span>(),</span>
<span id="cb234-10"><a href="classification.html#cb234-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Coefficient =</span> <span class="fu">ifelse</span>(</span>
<span id="cb234-11"><a href="classification.html#cb234-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># The coefficient for the reference level of just the intercept</span></span>
<span id="cb234-12"><a href="classification.html#cb234-12" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>, estimate,</span>
<span id="cb234-13"><a href="classification.html#cb234-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Otherwise the coefficient is relative to the intercept</span></span>
<span id="cb234-14"><a href="classification.html#cb234-14" aria-hidden="true" tabindex="-1"></a>      estimate <span class="sc">+</span> estimate[term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb234-15"><a href="classification.html#cb234-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb234-16"><a href="classification.html#cb234-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb234-17"><a href="classification.html#cb234-17" aria-hidden="true" tabindex="-1"></a>hour_coefs <span class="ot">&lt;-</span> <span class="fu">tidy</span>(lm_bikers) <span class="sc">%&gt;%</span></span>
<span id="cb234-18"><a href="classification.html#cb234-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">&quot;Intercept|hr&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb234-19"><a href="classification.html#cb234-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb234-20"><a href="classification.html#cb234-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hour =</span> <span class="fu">ifelse</span>(</span>
<span id="cb234-21"><a href="classification.html#cb234-21" aria-hidden="true" tabindex="-1"></a>      <span class="co"># The reference level is 00 hours (midnight)</span></span>
<span id="cb234-22"><a href="classification.html#cb234-22" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>, <span class="st">&quot;0&quot;</span>,</span>
<span id="cb234-23"><a href="classification.html#cb234-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove</span>(term, <span class="st">&quot;hr&quot;</span>)</span>
<span id="cb234-24"><a href="classification.html#cb234-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb234-25"><a href="classification.html#cb234-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.integer</span>(),</span>
<span id="cb234-26"><a href="classification.html#cb234-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">Coefficient =</span> <span class="fu">ifelse</span>(</span>
<span id="cb234-27"><a href="classification.html#cb234-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># The coefficient for the reference level of just the intercept</span></span>
<span id="cb234-28"><a href="classification.html#cb234-28" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>, estimate,</span>
<span id="cb234-29"><a href="classification.html#cb234-29" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Otherwise the coefficient is relative to the intercept</span></span>
<span id="cb234-30"><a href="classification.html#cb234-30" aria-hidden="true" tabindex="-1"></a>      estimate <span class="sc">+</span> estimate[term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb234-31"><a href="classification.html#cb234-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb234-32"><a href="classification.html#cb234-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb234-33"><a href="classification.html#cb234-33" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> month_coefs <span class="sc">%&gt;%</span></span>
<span id="cb234-34"><a href="classification.html#cb234-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Month, <span class="at">y =</span> Coefficient)) <span class="sc">+</span></span>
<span id="cb234-35"><a href="classification.html#cb234-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb234-36"><a href="classification.html#cb234-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb234-37"><a href="classification.html#cb234-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span>
<span id="cb234-38"><a href="classification.html#cb234-38" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> hour_coefs <span class="sc">%&gt;%</span></span>
<span id="cb234-39"><a href="classification.html#cb234-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Hour, <span class="at">y =</span> Coefficient)) <span class="sc">+</span></span>
<span id="cb234-40"><a href="classification.html#cb234-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb234-41"><a href="classification.html#cb234-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb234-42"><a href="classification.html#cb234-42" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/figure4.13-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The coefficients make intuitive sense, but the issues with the linear regression become apparent when we look at the predictions:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="classification.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist) <span class="co"># for the stat_halfeye() plotting function</span></span>
<span id="cb235-2"><a href="classification.html#cb235-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-3"><a href="classification.html#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb235-4"><a href="classification.html#cb235-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred_bikers =</span> <span class="fu">predict</span>(lm_bikers, <span class="at">newdata =</span> bikeshare,</span>
<span id="cb235-5"><a href="classification.html#cb235-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb235-6"><a href="classification.html#cb235-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb235-7"><a href="classification.html#cb235-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pred_bikers, <span class="at">fill =</span> <span class="fu">stat</span>(x <span class="sc">&lt;</span> <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb235-8"><a href="classification.html#cb235-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>() <span class="sc">+</span></span>
<span id="cb235-9"><a href="classification.html#cb235-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey75&quot;</span>, td_colors<span class="sc">$</span>nice<span class="sc">$</span>ruby_red)) <span class="sc">+</span></span>
<span id="cb235-10"><a href="classification.html#cb235-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_axis</span>(<span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-11"><a href="classification.html#cb235-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-123-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>9.6% of predictions are negative.</p>
<p>Another problem is heteroskedasticity, as shown in the left of Figure 4.14:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="classification.html#cb236-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> bikeshare <span class="sc">%&gt;%</span></span>
<span id="cb236-2"><a href="classification.html#cb236-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">as.integer</span>(hr)) <span class="sc">%&gt;%</span></span>
<span id="cb236-3"><a href="classification.html#cb236-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hr, <span class="at">y =</span> bikers)) <span class="sc">+</span></span>
<span id="cb236-4"><a href="classification.html#cb236-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb236-5"><a href="classification.html#cb236-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue) <span class="sc">+</span></span>
<span id="cb236-6"><a href="classification.html#cb236-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Draw a smoothling spline</span></span>
<span id="cb236-7"><a href="classification.html#cb236-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">formula =</span> y <span class="sc">~</span> splines<span class="sc">::</span><span class="fu">bs</span>(x, <span class="dv">3</span>), <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb236-8"><a href="classification.html#cb236-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>emerald)</span>
<span id="cb236-9"><a href="classification.html#cb236-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> bikeshare <span class="sc">%&gt;%</span></span>
<span id="cb236-10"><a href="classification.html#cb236-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">as.integer</span>(hr)) <span class="sc">%&gt;%</span></span>
<span id="cb236-11"><a href="classification.html#cb236-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hr, <span class="at">y =</span> <span class="fu">log</span>(bikers))) <span class="sc">+</span></span>
<span id="cb236-12"><a href="classification.html#cb236-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb236-13"><a href="classification.html#cb236-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue) <span class="sc">+</span></span>
<span id="cb236-14"><a href="classification.html#cb236-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">formula =</span> y <span class="sc">~</span> splines<span class="sc">::</span><span class="fu">bs</span>(x, <span class="dv">3</span>), <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb236-15"><a href="classification.html#cb236-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>emerald)</span>
<span id="cb236-16"><a href="classification.html#cb236-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/figure4.14-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Lastly, the response <code>bikers</code> is integer-valued, whereas the response in a linear model is continuous.</p>
<p>One solution is to transform the response <span class="math inline">\(Y\)</span>.
In the above figure, we see that <code>log(bikers)</code> can fix some of the heteroskedasticity, and also avoids negative predictions.
This won’t work if there are any values of <code>bikers = 0</code>, however, and leads to challenging interpretation of the coefficients on the log scale.</p>
</div>
<div id="poisson-regression-on-bikeshare-data" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Poisson Regression on Bikeshare Data<a href="classification.html#poisson-regression-on-bikeshare-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A much more natural approach to count data is Poisson regression.
First, the Poisson distribution:</p>
<blockquote>
<p>Suppose that a random variable <span class="math inline">\(Y\)</span> takes on nonnegative integer values,
i.e. <span class="math inline">\(Y \in \{0, 1, 2, \dots\}\)</span>. If <span class="math inline">\(Y\)</span> follows the Poisson distribution, then</p>
</blockquote>
<p><span class="math display">\[
\text{Pr}(Y = k) = \frac{e^{−λ}λ^k}{k!}
\text{ for } k = 0, 1, 2, \dots
\]</span></p>
<blockquote>
<p>Here, <span class="math inline">\(λ &gt; 0\)</span> is the expected value of <span class="math inline">\(Y\)</span>, i.e. <span class="math inline">\(E(Y )\)</span>. It turns out that <span class="math inline">\(λ\)</span> also
equals the variance of <span class="math inline">\(Y\)</span>, i.e. <span class="math inline">\(λ = E(Y ) = \text{Var}(Y )\)</span>. This means that if <span class="math inline">\(Y\)</span>
follows the Poisson distribution, then the larger the mean of <span class="math inline">\(Y\)</span>, the larger
its variance. (In (4.35), the notation <span class="math inline">\(k!\)</span>, pronounced “k factorial”, is defined
as <span class="math inline">\(k! = k × (k − 1) × (k − 2) × ... × 3 × 2 × 1.\)</span>)</p>
</blockquote>
<p>As an example, consider biker counts drawn from a Poisson distribution with mean <span class="math inline">\(E(Y) = \lambda = 5\)</span>.
Then the probability of 0, 1, 2, etc. bikers during a particular hour is:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="classification.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb237-2"><a href="classification.html#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_bikers =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb237-3"><a href="classification.html#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span><span class="sc">^</span>n_bikers <span class="sc">/</span> <span class="fu">factorial</span>(n_bikers)</span>
<span id="cb237-4"><a href="classification.html#cb237-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb237-5"><a href="classification.html#cb237-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-6"><a href="classification.html#cb237-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> scales<span class="sc">::</span><span class="fu">percent</span>(prob)</span>
<span id="cb237-7"><a href="classification.html#cb237-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 7 × 2
##   n_bikers prob  
##      &lt;int&gt; &lt;chr&gt; 
## 1        0 0.67% 
## 2        1 3.37% 
## 3        2 8.42% 
## 4        3 14.04%
## 5        4 17.55%
## 6        5 17.55%
## 7        6 14.62%</code></pre>
<p>Of course, we expect <span class="math inline">\(\lambda = E(Y)\)</span> to vary under certain conditions, so we write it as a function of the covariates:</p>
<p><span class="math display">\[
\log (\lambda (X_1, \dots, X_p)) = \beta_0 + \beta_1 X_1 + \dots + \beta_p X_p.
\]</span></p>
<p>Taking the log of <span class="math inline">\(\lambda\)</span> ensures that <span class="math inline">\(\lambda(X_1, \dots, X_p)\)</span> takes on non-negative values for all values of the covariates.</p>
<p>The coefficients <span class="math inline">\(\beta_j\)</span> are estimated using the same maximum likelihood approach as logistic regression:</p>
<p><span class="math display">\[
\ell (\beta_0, \dots, \beta_p) = \prod_{i = 1}^n p(y_i) =
\prod_{i = 1}^n \frac{e^{-\lambda (x_i)} \lambda(x_i)^{y_i}}{y_i!}
\]</span></p>
<p>where <span class="math inline">\(\lambda(x_i) = e^{\beta_0 + \dots + \beta_p x_{i}}\)</span>.</p>
<p>Fit the Poisson model:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="classification.html#cb239-1" aria-hidden="true" tabindex="-1"></a>glm_bikers <span class="ot">&lt;-</span> <span class="fu">glm</span>(bikers <span class="sc">~</span> mnth <span class="sc">+</span> hr <span class="sc">+</span> workingday <span class="sc">+</span> temp <span class="sc">+</span> weathersit,</span>
<span id="cb239-2"><a href="classification.html#cb239-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> bikeshare, <span class="at">family =</span> poisson)</span>
<span id="cb239-3"><a href="classification.html#cb239-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_custom</span>(glm_bikers, <span class="at">coef_round =</span> <span class="dv">2</span>, <span class="at">se_round =</span> <span class="dv">2</span>, <span class="at">z_round =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb239-4"><a href="classification.html#cb239-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclude mnth and hr due to space constraints</span></span>
<span id="cb239-5"><a href="classification.html#cb239-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(term, <span class="st">&quot;mnth|hr&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb239-6"><a href="classification.html#cb239-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code></pre></div>
<div id="xscihdrfqb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xscihdrfqb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xscihdrfqb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xscihdrfqb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xscihdrfqb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xscihdrfqb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xscihdrfqb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xscihdrfqb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xscihdrfqb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xscihdrfqb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xscihdrfqb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xscihdrfqb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xscihdrfqb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xscihdrfqb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xscihdrfqb .gt_from_md > :first-child {
  margin-top: 0;
}

#xscihdrfqb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xscihdrfqb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xscihdrfqb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xscihdrfqb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xscihdrfqb .gt_row_group_first td {
  border-top-width: 2px;
}

#xscihdrfqb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xscihdrfqb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xscihdrfqb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xscihdrfqb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xscihdrfqb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xscihdrfqb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xscihdrfqb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xscihdrfqb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xscihdrfqb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xscihdrfqb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xscihdrfqb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xscihdrfqb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xscihdrfqb .gt_left {
  text-align: left;
}

#xscihdrfqb .gt_center {
  text-align: center;
}

#xscihdrfqb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xscihdrfqb .gt_font_normal {
  font-weight: normal;
}

#xscihdrfqb .gt_font_bold {
  font-weight: bold;
}

#xscihdrfqb .gt_font_italic {
  font-style: italic;
}

#xscihdrfqb .gt_super {
  font-size: 65%;
}

#xscihdrfqb .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#xscihdrfqb .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#xscihdrfqb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xscihdrfqb .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#xscihdrfqb .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#xscihdrfqb .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">coefficient</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">std.error</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">z-statistic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">p-value</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">(Intercept)</td>
<td class="gt_row gt_right">2.69</td>
<td class="gt_row gt_right">0.01</td>
<td class="gt_row gt_right">277.12</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">workingday</td>
<td class="gt_row gt_right">0.01</td>
<td class="gt_row gt_right">0.00</td>
<td class="gt_row gt_right">7.50</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">temp</td>
<td class="gt_row gt_right">0.79</td>
<td class="gt_row gt_right">0.01</td>
<td class="gt_row gt_right">68.43</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">weathersitcloudy/misty</td>
<td class="gt_row gt_right">-0.08</td>
<td class="gt_row gt_right">0.00</td>
<td class="gt_row gt_right">-34.53</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">weathersitlight rain/snow</td>
<td class="gt_row gt_right">-0.58</td>
<td class="gt_row gt_right">0.00</td>
<td class="gt_row gt_right">-141.90</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">weathersitheavy rain/snow</td>
<td class="gt_row gt_right">-0.93</td>
<td class="gt_row gt_right">0.17</td>
<td class="gt_row gt_right">-5.55</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
  </tbody>
  
  
</table>
</div>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="classification.html#cb240-1" aria-hidden="true" tabindex="-1"></a>month_coefs <span class="ot">&lt;-</span> <span class="fu">tidy</span>(glm_bikers) <span class="sc">%&gt;%</span></span>
<span id="cb240-2"><a href="classification.html#cb240-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">&quot;Intercept|mnth&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb240-3"><a href="classification.html#cb240-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb240-4"><a href="classification.html#cb240-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">ifelse</span>(</span>
<span id="cb240-5"><a href="classification.html#cb240-5" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>, <span class="st">&quot;Jan&quot;</span>,</span>
<span id="cb240-6"><a href="classification.html#cb240-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove</span>(term, <span class="st">&quot;mnth&quot;</span>)</span>
<span id="cb240-7"><a href="classification.html#cb240-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb240-8"><a href="classification.html#cb240-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fct_inorder</span>(),</span>
<span id="cb240-9"><a href="classification.html#cb240-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Coefficient =</span> <span class="fu">ifelse</span>(</span>
<span id="cb240-10"><a href="classification.html#cb240-10" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>, estimate,</span>
<span id="cb240-11"><a href="classification.html#cb240-11" aria-hidden="true" tabindex="-1"></a>      estimate <span class="sc">+</span> estimate[term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb240-12"><a href="classification.html#cb240-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb240-13"><a href="classification.html#cb240-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb240-14"><a href="classification.html#cb240-14" aria-hidden="true" tabindex="-1"></a>hour_coefs <span class="ot">&lt;-</span> <span class="fu">tidy</span>(glm_bikers) <span class="sc">%&gt;%</span></span>
<span id="cb240-15"><a href="classification.html#cb240-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">&quot;Intercept|hr&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb240-16"><a href="classification.html#cb240-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb240-17"><a href="classification.html#cb240-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hour =</span> <span class="fu">ifelse</span>(</span>
<span id="cb240-18"><a href="classification.html#cb240-18" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>, <span class="st">&quot;0&quot;</span>,</span>
<span id="cb240-19"><a href="classification.html#cb240-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove</span>(term, <span class="st">&quot;hr&quot;</span>)</span>
<span id="cb240-20"><a href="classification.html#cb240-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb240-21"><a href="classification.html#cb240-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.integer</span>(),</span>
<span id="cb240-22"><a href="classification.html#cb240-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Coefficient =</span> <span class="fu">ifelse</span>(</span>
<span id="cb240-23"><a href="classification.html#cb240-23" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>, estimate,</span>
<span id="cb240-24"><a href="classification.html#cb240-24" aria-hidden="true" tabindex="-1"></a>      estimate <span class="sc">+</span> estimate[term <span class="sc">==</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb240-25"><a href="classification.html#cb240-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb240-26"><a href="classification.html#cb240-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb240-27"><a href="classification.html#cb240-27" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> month_coefs <span class="sc">%&gt;%</span></span>
<span id="cb240-28"><a href="classification.html#cb240-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Month, <span class="at">y =</span> Coefficient)) <span class="sc">+</span></span>
<span id="cb240-29"><a href="classification.html#cb240-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb240-30"><a href="classification.html#cb240-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb240-31"><a href="classification.html#cb240-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span>
<span id="cb240-32"><a href="classification.html#cb240-32" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> hour_coefs <span class="sc">%&gt;%</span></span>
<span id="cb240-33"><a href="classification.html#cb240-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Hour, <span class="at">y =</span> Coefficient)) <span class="sc">+</span></span>
<span id="cb240-34"><a href="classification.html#cb240-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb240-35"><a href="classification.html#cb240-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb240-36"><a href="classification.html#cb240-36" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/figure4.15-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Considerations of this model:</p>
<ul>
<li>Qualitatively quite similar to the linear regression model. One difference is that <code>workingday</code> was statistically significant with Poisson regression.</li>
<li>A coefficient <span class="math inline">\(\beta_j\)</span> is interpreted as the associated change in <span class="math inline">\(E(Y) = \lambda\)</span> by a factor of <span class="math inline">\(\exp({\beta_j})\)</span> for a one unit increase in <span class="math inline">\(X_j\)</span>.
<ul>
<li>Example: a change in weather from clear to cloudy skies is associated with a change of exp(-0.075) = 0.928 = 93% as many people will use bikes.</li>
</ul></li>
<li>The key assumption of the Poisson model is that the variance increases with the mean, <span class="math inline">\(\lambda = E(Y) = \text{Var}(Y)\)</span>, which means it can deal with the heteroskedasticity we saw in the linear model.</li>
<li>The predictions from the Poisson model, by construction, are non-negative:</li>
</ul>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="classification.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb241-2"><a href="classification.html#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred_bikers =</span> <span class="fu">predict</span>(glm_bikers, <span class="at">newdata =</span> bikeshare,</span>
<span id="cb241-3"><a href="classification.html#cb241-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb241-4"><a href="classification.html#cb241-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb241-5"><a href="classification.html#cb241-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pred_bikers, <span class="at">fill =</span> <span class="fu">stat</span>(x <span class="sc">&lt;</span> <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb241-6"><a href="classification.html#cb241-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>() <span class="sc">+</span></span>
<span id="cb241-7"><a href="classification.html#cb241-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey75&quot;</span>, td_colors<span class="sc">$</span>nice<span class="sc">$</span>ruby_red)) <span class="sc">+</span></span>
<span id="cb241-8"><a href="classification.html#cb241-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_axis</span>(<span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb241-9"><a href="classification.html#cb241-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-125-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="generalized-linear-models-in-greater-generality" class="section level3 hasAnchor" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Generalized Linear Models in Greater Generality<a href="classification.html#generalized-linear-models-in-greater-generality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The three regression models we have seen so far (linear, logistic and Poisson) share these similarities.</p>
<ul>
<li>Predictors <span class="math inline">\(X_1, \dots, X_p\)</span> used to predict a response <span class="math inline">\(Y\)</span>, which we assume belongs to a certain family of distributions conditional on <span class="math inline">\(X\)</span>.
<ul>
<li>For linear regression, we typically assume Gaussian/normal.</li>
<li>For logistic regression, we assume a Bernoulli distribution.</li>
<li>For Poisson regression, we assume a Poisson distribution.</li>
</ul></li>
<li>The mean of <span class="math inline">\(Y\)</span> is modeled as a function of the predictors:</li>
</ul>
<p><span class="math display">\[
\begin{align}
E(Y|X) &amp;= \beta_0 + \beta_1 X_1 + \dots + \beta_p X_p \\
E(Y|X) &amp;= \frac{e^{\beta_0 + \dots + \beta_pX_p}}{1 + e^{\beta_0 + \dots + \beta_pX_p}} \\
E(Y|X) = \lambda (X_1, \dots, X_p) &amp;= e^{\beta_0 + \beta_1 X_1 + \dots + \beta_p X_p}.
\end{align}
\]</span></p>
<p>These three equations can be expressed using a link function <span class="math inline">\(\eta\)</span>, which applies a transformation to <span class="math inline">\(E(Y|X)\)</span> so that the transformed mean is a lienar function of the predictors:</p>
<p><span class="math display">\[
\eta(E(Y|X)) = \beta_0 + \beta_1 X_1 + \dots + \beta_p X_p.
\]</span></p>
<p>The link functions for linear, logistic, and Poisson regression are, respectively:</p>
<p><span class="math display">\[
\begin{align}
\eta(\mu) &amp;= \mu \\
\eta(\mu) &amp;= \log \left(\frac{\mu}{1 - \mu} \right) \\
\eta(\mu) &amp;= \log (\mu).
\end{align}
\]</span></p>
<blockquote>
<p>The Gaussian, Bernoulli, and Poisson distributions are all members of a wider class of distributions, known as the exponential family.
Other well-known members of this family are the exponential distribution, the Gamma distribution, and the negative binomial distribution.
In general, we can perform a regression by modeling the response <span class="math inline">\(Y\)</span> as coming from a particular member of the exponential family, and then transforming the mean of the response so that the transformed mean is a linear function of the predictors via (4.42).
Any regression approach that follows this very general recipe is known as a generalized linear model (GLM).
Thus, linear regression, logistic regression, and Poisson regression and three examples of GLMs. Other examples not covered here include Gamma regression and negative binomial regerssion.</p>
</blockquote>
</div>
</div>
<div id="lab-classification-methods" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Lab: Classification Methods<a href="classification.html#lab-classification-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="the-stock-market-data" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> The Stock Market Data<a href="classification.html#the-stock-market-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>We will begin by examining some numerical and graphical summaries of
the <code>Smarket</code> data, which is part of the <code>ISLR2</code> library. This data set consists of
percentage returns for the S&amp;P 500 stock index over 1,250 days, from the
beginning of 2001 until the end of 2005. For each date, we have recorded
the percentage returns for each of the five previous trading days, <code>Lag1</code>
through <code>Lag5</code>. We have also recorded <code>Volume</code> (the number of shares traded
on the previous day, in billions), <code>Today</code> (the percentage return on the date
in question) and <code>Direction</code> (whether the market was <code>Up</code> or <code>Down</code> on this
date). Our goal is to predict <code>Direction</code> (a qualitative response) using the
other features.</p>
</blockquote>
<p>I like the <code>skimr</code> package for summarizing a data set:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="classification.html#cb242-1" aria-hidden="true" tabindex="-1"></a>smarket <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Smarket</span>
<span id="cb242-2"><a href="classification.html#cb242-2" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(smarket)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-126">Table 4.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">smarket</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">1250</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">9</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">8</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table style="width:100%;">
<colgroup>
<col width="19%" />
<col width="13%" />
<col width="19%" />
<col width="10%" />
<col width="12%" />
<col width="24%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Direction</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">Up: 648, Dow: 602</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<colgroup>
<col width="14%" />
<col width="10%" />
<col width="14%" />
<col width="8%" />
<col width="5%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2003.02</td>
<td align="right">1.41</td>
<td align="right">2001.00</td>
<td align="right">2002.00</td>
<td align="right">2003.00</td>
<td align="right">2004.00</td>
<td align="right">2005.00</td>
<td align="left">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td align="left">Lag1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.00</td>
<td align="right">1.14</td>
<td align="right">-4.92</td>
<td align="right">-0.64</td>
<td align="right">0.04</td>
<td align="right">0.60</td>
<td align="right">5.73</td>
<td align="left">▁▃▇▁▁</td>
</tr>
<tr class="odd">
<td align="left">Lag2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.00</td>
<td align="right">1.14</td>
<td align="right">-4.92</td>
<td align="right">-0.64</td>
<td align="right">0.04</td>
<td align="right">0.60</td>
<td align="right">5.73</td>
<td align="left">▁▃▇▁▁</td>
</tr>
<tr class="even">
<td align="left">Lag3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.00</td>
<td align="right">1.14</td>
<td align="right">-4.92</td>
<td align="right">-0.64</td>
<td align="right">0.04</td>
<td align="right">0.60</td>
<td align="right">5.73</td>
<td align="left">▁▃▇▁▁</td>
</tr>
<tr class="odd">
<td align="left">Lag4</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.00</td>
<td align="right">1.14</td>
<td align="right">-4.92</td>
<td align="right">-0.64</td>
<td align="right">0.04</td>
<td align="right">0.60</td>
<td align="right">5.73</td>
<td align="left">▁▃▇▁▁</td>
</tr>
<tr class="even">
<td align="left">Lag5</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.01</td>
<td align="right">1.15</td>
<td align="right">-4.92</td>
<td align="right">-0.64</td>
<td align="right">0.04</td>
<td align="right">0.60</td>
<td align="right">5.73</td>
<td align="left">▁▃▇▁▁</td>
</tr>
<tr class="odd">
<td align="left">Volume</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.48</td>
<td align="right">0.36</td>
<td align="right">0.36</td>
<td align="right">1.26</td>
<td align="right">1.42</td>
<td align="right">1.64</td>
<td align="right">3.15</td>
<td align="left">▁▇▅▁▁</td>
</tr>
<tr class="even">
<td align="left">Today</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.00</td>
<td align="right">1.14</td>
<td align="right">-4.92</td>
<td align="right">-0.64</td>
<td align="right">0.04</td>
<td align="right">0.60</td>
<td align="right">5.73</td>
<td align="left">▁▃▇▁▁</td>
</tr>
</tbody>
</table>
<p>To produce the pairwise correlations between predictors, I’ll use another new package <code>corrr</code>, which returns a tidy <code>tibble</code> that we can turn into a nice <code>gt</code> table:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="classification.html#cb243-1" aria-hidden="true" tabindex="-1"></a>smarket <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Direction) <span class="sc">%&gt;%</span></span>
<span id="cb243-2"><a href="classification.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  corrr<span class="sc">::</span><span class="fu">correlate</span>(<span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="classification.html#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">&quot;term&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb243-4"><a href="classification.html#cb243-4" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">fmt_missing</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">missing_text =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb243-5"><a href="classification.html#cb243-5" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">data_color</span>(</span>
<span id="cb243-6"><a href="classification.html#cb243-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">everything</span>(),</span>
<span id="cb243-7"><a href="classification.html#cb243-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> scales<span class="sc">::</span><span class="fu">col_numeric</span>(</span>
<span id="cb243-8"><a href="classification.html#cb243-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">palette =</span> <span class="fu">td_pal</span>(<span class="st">&quot;div5&quot;</span>)(<span class="dv">5</span>),</span>
<span id="cb243-9"><a href="classification.html#cb243-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">domain =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.6</span>)</span>
<span id="cb243-10"><a href="classification.html#cb243-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb243-11"><a href="classification.html#cb243-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb243-12"><a href="classification.html#cb243-12" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">decimals =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Warning: The `fmt_missing()` function is deprecated and will soon be removed
## * Use the `sub_missing()` function instead</code></pre>
<div id="lbaoumnbsu" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#lbaoumnbsu .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lbaoumnbsu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lbaoumnbsu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lbaoumnbsu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lbaoumnbsu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lbaoumnbsu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lbaoumnbsu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lbaoumnbsu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lbaoumnbsu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lbaoumnbsu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lbaoumnbsu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lbaoumnbsu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#lbaoumnbsu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lbaoumnbsu .gt_from_md > :first-child {
  margin-top: 0;
}

#lbaoumnbsu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lbaoumnbsu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lbaoumnbsu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lbaoumnbsu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lbaoumnbsu .gt_row_group_first td {
  border-top-width: 2px;
}

#lbaoumnbsu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lbaoumnbsu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lbaoumnbsu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lbaoumnbsu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lbaoumnbsu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lbaoumnbsu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lbaoumnbsu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lbaoumnbsu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lbaoumnbsu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lbaoumnbsu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lbaoumnbsu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lbaoumnbsu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lbaoumnbsu .gt_left {
  text-align: left;
}

#lbaoumnbsu .gt_center {
  text-align: center;
}

#lbaoumnbsu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lbaoumnbsu .gt_font_normal {
  font-weight: normal;
}

#lbaoumnbsu .gt_font_bold {
  font-weight: bold;
}

#lbaoumnbsu .gt_font_italic {
  font-style: italic;
}

#lbaoumnbsu .gt_super {
  font-size: 65%;
}

#lbaoumnbsu .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#lbaoumnbsu .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#lbaoumnbsu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lbaoumnbsu .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#lbaoumnbsu .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#lbaoumnbsu .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Lag1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Lag2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Lag3</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Lag4</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Lag5</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Volume</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Today</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right gt_stub">Year</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #0C7494; color: #FFFFFF;">0.030</td>
<td class="gt_row gt_right" style="background-color: #0C7494; color: #FFFFFF;">0.031</td>
<td class="gt_row gt_right" style="background-color: #0C7595; color: #FFFFFF;">0.033</td>
<td class="gt_row gt_right" style="background-color: #0C7696; color: #FFFFFF;">0.036</td>
<td class="gt_row gt_right" style="background-color: #0C7494; color: #FFFFFF;">0.030</td>
<td class="gt_row gt_right" style="background-color: #E35E1F; color: #FFFFFF;">0.539</td>
<td class="gt_row gt_right" style="background-color: #0C7494; color: #FFFFFF;">0.030</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Lag1</td>
<td class="gt_row gt_right" style="background-color: #0C7494; color: #FFFFFF;">0.030</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #076184; color: #FFFFFF;">&minus;0.026</td>
<td class="gt_row gt_right" style="background-color: #086688; color: #FFFFFF;">&minus;0.011</td>
<td class="gt_row gt_right" style="background-color: #09698A; color: #FFFFFF;">&minus;0.003</td>
<td class="gt_row gt_right" style="background-color: #09688A; color: #FFFFFF;">&minus;0.006</td>
<td class="gt_row gt_right" style="background-color: #0D7897; color: #FFFFFF;">0.041</td>
<td class="gt_row gt_right" style="background-color: #076184; color: #FFFFFF;">&minus;0.026</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Lag2</td>
<td class="gt_row gt_right" style="background-color: #0C7494; color: #FFFFFF;">0.031</td>
<td class="gt_row gt_right" style="background-color: #076184; color: #FFFFFF;">&minus;0.026</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #076184; color: #FFFFFF;">&minus;0.026</td>
<td class="gt_row gt_right" style="background-color: #086688; color: #FFFFFF;">&minus;0.011</td>
<td class="gt_row gt_right" style="background-color: #09688A; color: #FFFFFF;">&minus;0.004</td>
<td class="gt_row gt_right" style="background-color: #055B7F; color: #FFFFFF;">&minus;0.043</td>
<td class="gt_row gt_right" style="background-color: #086688; color: #FFFFFF;">&minus;0.010</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Lag3</td>
<td class="gt_row gt_right" style="background-color: #0C7595; color: #FFFFFF;">0.033</td>
<td class="gt_row gt_right" style="background-color: #086688; color: #FFFFFF;">&minus;0.011</td>
<td class="gt_row gt_right" style="background-color: #076184; color: #FFFFFF;">&minus;0.026</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #076184; color: #FFFFFF;">&minus;0.024</td>
<td class="gt_row gt_right" style="background-color: #086386; color: #FFFFFF;">&minus;0.019</td>
<td class="gt_row gt_right" style="background-color: #055B7F; color: #FFFFFF;">&minus;0.042</td>
<td class="gt_row gt_right" style="background-color: #09698B; color: #FFFFFF;">&minus;0.002</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Lag4</td>
<td class="gt_row gt_right" style="background-color: #0C7696; color: #FFFFFF;">0.036</td>
<td class="gt_row gt_right" style="background-color: #09698A; color: #FFFFFF;">&minus;0.003</td>
<td class="gt_row gt_right" style="background-color: #086688; color: #FFFFFF;">&minus;0.011</td>
<td class="gt_row gt_right" style="background-color: #076184; color: #FFFFFF;">&minus;0.024</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #076083; color: #FFFFFF;">&minus;0.027</td>
<td class="gt_row gt_right" style="background-color: #05597D; color: #FFFFFF;">&minus;0.048</td>
<td class="gt_row gt_right" style="background-color: #096789; color: #FFFFFF;">&minus;0.007</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Lag5</td>
<td class="gt_row gt_right" style="background-color: #0C7494; color: #FFFFFF;">0.030</td>
<td class="gt_row gt_right" style="background-color: #09688A; color: #FFFFFF;">&minus;0.006</td>
<td class="gt_row gt_right" style="background-color: #09688A; color: #FFFFFF;">&minus;0.004</td>
<td class="gt_row gt_right" style="background-color: #086386; color: #FFFFFF;">&minus;0.019</td>
<td class="gt_row gt_right" style="background-color: #076083; color: #FFFFFF;">&minus;0.027</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #076285; color: #FFFFFF;">&minus;0.022</td>
<td class="gt_row gt_right" style="background-color: #065E81; color: #FFFFFF;">&minus;0.035</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Volume</td>
<td class="gt_row gt_right" style="background-color: #E35E1F; color: #FFFFFF;">0.539</td>
<td class="gt_row gt_right" style="background-color: #0D7897; color: #FFFFFF;">0.041</td>
<td class="gt_row gt_right" style="background-color: #055B7F; color: #FFFFFF;">&minus;0.043</td>
<td class="gt_row gt_right" style="background-color: #055B7F; color: #FFFFFF;">&minus;0.042</td>
<td class="gt_row gt_right" style="background-color: #05597D; color: #FFFFFF;">&minus;0.048</td>
<td class="gt_row gt_right" style="background-color: #076285; color: #FFFFFF;">&minus;0.022</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #0B6F8F; color: #FFFFFF;">0.015</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Today</td>
<td class="gt_row gt_right" style="background-color: #0C7494; color: #FFFFFF;">0.030</td>
<td class="gt_row gt_right" style="background-color: #076184; color: #FFFFFF;">&minus;0.026</td>
<td class="gt_row gt_right" style="background-color: #086688; color: #FFFFFF;">&minus;0.010</td>
<td class="gt_row gt_right" style="background-color: #09698B; color: #FFFFFF;">&minus;0.002</td>
<td class="gt_row gt_right" style="background-color: #096789; color: #FFFFFF;">&minus;0.007</td>
<td class="gt_row gt_right" style="background-color: #065E81; color: #FFFFFF;">&minus;0.035</td>
<td class="gt_row gt_right" style="background-color: #0B6F8F; color: #FFFFFF;">0.015</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td></tr>
  </tbody>
  
  
</table>
</div>
<p>The only substantial correlation is between <code>Volume</code> and <code>Year</code>:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="classification.html#cb245-1" aria-hidden="true" tabindex="-1"></a>smarket <span class="sc">%&gt;%</span></span>
<span id="cb245-2"><a href="classification.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Year), <span class="at">y =</span> Volume)) <span class="sc">+</span></span>
<span id="cb245-3"><a href="classification.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>day9_yellow) <span class="sc">+</span></span>
<span id="cb245-4"><a href="classification.html#cb245-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">width =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-128-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="logistic-regression-1" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> Logistic Regression<a href="classification.html#logistic-regression-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use <code>tidymodels</code> to fit the model and produce the confusion matrix:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="classification.html#cb246-1" aria-hidden="true" tabindex="-1"></a>glm_direction_fit <span class="ot">&lt;-</span></span>
<span id="cb246-2"><a href="classification.html#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Note that these options are the defaults</span></span>
<span id="cb246-3"><a href="classification.html#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  (and mode can only be &quot;classification&quot; for logistic)</span></span>
<span id="cb246-4"><a href="classification.html#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">engine =</span> <span class="st">&quot;glm&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb246-5"><a href="classification.html#cb246-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2 <span class="sc">+</span> Lag3 <span class="sc">+</span> Lag4 <span class="sc">+</span> Lag5 <span class="sc">+</span> Volume,</span>
<span id="cb246-6"><a href="classification.html#cb246-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> smarket)</span>
<span id="cb246-7"><a href="classification.html#cb246-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-8"><a href="classification.html#cb246-8" aria-hidden="true" tabindex="-1"></a>glm_direction_conf_mat <span class="ot">&lt;-</span></span>
<span id="cb246-9"><a href="classification.html#cb246-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(glm_direction_fit, smarket) <span class="sc">%&gt;%</span></span>
<span id="cb246-10"><a href="classification.html#cb246-10" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">conf_mat</span>(.pred_class, Direction)</span>
<span id="cb246-11"><a href="classification.html#cb246-11" aria-hidden="true" tabindex="-1"></a>glm_direction_conf_mat</span></code></pre></div>
<pre><code>##           Truth
## Prediction Down  Up
##       Down  145 457
##       Up    141 507</code></pre>
<p>This returns an object with some helpful built-in functions.
Summary metrics:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="classification.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm_direction_conf_mat)</span></code></pre></div>
<pre><code>## # A tibble: 13 × 3
##    .metric              .estimator .estimate
##    &lt;chr&gt;                &lt;chr&gt;          &lt;dbl&gt;
##  1 accuracy             binary        0.522 
##  2 kap                  binary        0.0237
##  3 sens                 binary        0.507 
##  4 spec                 binary        0.526 
##  5 ppv                  binary        0.241 
##  6 npv                  binary        0.782 
##  7 mcc                  binary        0.0277
##  8 j_index              binary        0.0329
##  9 bal_accuracy         binary        0.516 
## 10 detection_prevalence binary        0.482 
## 11 precision            binary        0.241 
## 12 recall               binary        0.507 
## 13 f_meas               binary        0.327</code></pre>
<p>We get the same accuracy (52.2%) as that in the text.
There is also a couple <code>autoplot()</code> options</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="classification.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(glm_direction_conf_mat, <span class="at">type =</span> <span class="st">&quot;mosaic&quot;</span>) <span class="sc">|</span></span>
<span id="cb250-2"><a href="classification.html#cb250-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(glm_direction_conf_mat, <span class="at">type =</span> <span class="st">&quot;heatmap&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-131-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The next part of this lab is (I think) the first time we are splitting the data into training and testing data.
Typically in <code>tidymodels</code>, we randomly split the data with <code>rsample::initial_split</code>, which takes a specified proportion (<code>prop</code>) and optional stratification variable (<code>strata</code>).
In this lab, all the data for <code>Year</code> = 2005 is the hold out set.
We can re-create this split manually with <code>rsample::make_splits</code>:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="classification.html#cb251-1" aria-hidden="true" tabindex="-1"></a>smarket_split <span class="ot">&lt;-</span></span>
<span id="cb251-2"><a href="classification.html#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_splits</span>(</span>
<span id="cb251-3"><a href="classification.html#cb251-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">list</span>(</span>
<span id="cb251-4"><a href="classification.html#cb251-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get row numbers for &lt;2005</span></span>
<span id="cb251-5"><a href="classification.html#cb251-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;analysis&quot;</span> <span class="ot">=</span> <span class="fu">which</span>(smarket<span class="sc">$</span>Year <span class="sc">&lt;</span> <span class="dv">2005</span>),</span>
<span id="cb251-6"><a href="classification.html#cb251-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get row numbers for 2005</span></span>
<span id="cb251-7"><a href="classification.html#cb251-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;assessment&quot;</span> <span class="ot">=</span> <span class="fu">which</span>(smarket<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2005</span>)</span>
<span id="cb251-8"><a href="classification.html#cb251-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb251-9"><a href="classification.html#cb251-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> smarket</span>
<span id="cb251-10"><a href="classification.html#cb251-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb251-11"><a href="classification.html#cb251-11" aria-hidden="true" tabindex="-1"></a>smarket_split</span></code></pre></div>
<pre><code>## &lt;Analysis/Assess/Total&gt;
## &lt;998/252/1250&gt;</code></pre>
<p>We then get the training and testing data with their matching functions:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="classification.html#cb253-1" aria-hidden="true" tabindex="-1"></a>smarket_train <span class="ot">&lt;-</span> <span class="fu">training</span>(smarket_split)</span>
<span id="cb253-2"><a href="classification.html#cb253-2" aria-hidden="true" tabindex="-1"></a>smarket_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(smarket_split)</span></code></pre></div>
<p>Re-fit the model using the training data only:</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="classification.html#cb254-1" aria-hidden="true" tabindex="-1"></a>glm_direction_fit <span class="ot">&lt;-</span></span>
<span id="cb254-2"><a href="classification.html#cb254-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">engine =</span> <span class="st">&quot;glm&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb254-3"><a href="classification.html#cb254-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2 <span class="sc">+</span> Lag3 <span class="sc">+</span> Lag4 <span class="sc">+</span> Lag5 <span class="sc">+</span> Volume,</span>
<span id="cb254-4"><a href="classification.html#cb254-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> smarket_train)</span></code></pre></div>
<p>Just as a demonstration, I will evaluate the model on the training data first:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="classification.html#cb255-1" aria-hidden="true" tabindex="-1"></a>glm_direction_train_pred <span class="ot">&lt;-</span></span>
<span id="cb255-2"><a href="classification.html#cb255-2" aria-hidden="true" tabindex="-1"></a>  glm_direction_fit <span class="sc">%&gt;%</span></span>
<span id="cb255-3"><a href="classification.html#cb255-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(smarket_train)</span>
<span id="cb255-4"><a href="classification.html#cb255-4" aria-hidden="true" tabindex="-1"></a>glm_direction_train_pred <span class="sc">%&gt;%</span></span>
<span id="cb255-5"><a href="classification.html#cb255-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> Direction, .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.527</code></pre>
<p>Quite poor.
This was calculated using the 50% probability threshold, but we can also look at the ROC curve:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="classification.html#cb257-1" aria-hidden="true" tabindex="-1"></a>glm_direction_train_pred <span class="sc">%&gt;%</span></span>
<span id="cb257-2"><a href="classification.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> Direction, .pred_Up,</span>
<span id="cb257-3"><a href="classification.html#cb257-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb257-4"><a href="classification.html#cb257-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-136-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>This doesn’t give a lot of confidence in the performance on the testing set:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="classification.html#cb258-1" aria-hidden="true" tabindex="-1"></a>glm_direction_test_pred <span class="ot">&lt;-</span></span>
<span id="cb258-2"><a href="classification.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  glm_direction_fit <span class="sc">%&gt;%</span></span>
<span id="cb258-3"><a href="classification.html#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(smarket_test)</span>
<span id="cb258-4"><a href="classification.html#cb258-4" aria-hidden="true" tabindex="-1"></a>glm_direction_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb258-5"><a href="classification.html#cb258-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> Direction, .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.480</code></pre>
<p>We get an accuracy that is worse than random guessing.
Disappointing, but not a surprise as the authors say:</p>
<blockquote>
<p>Of course this result
is not all that surprising, given that one would not generally expect to be
able to use previous days’ returns to predict future market performance.
(After all, if it were possible to do so, then the authors of this book would
be out striking it rich rather than writing a statistics textbook.)</p>
</blockquote>
<p>Perhaps a simpler model would be more effective.</p>
<blockquote>
<p>After all, using predictors that have no
relationship with the response tends to cause a deterioration in the test
error rate (since such predictors cause an increase in variance without a
corresponding decrease in bias), and so removing such predictors may in
turn yield an improvement.</p>
</blockquote>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="classification.html#cb260-1" aria-hidden="true" tabindex="-1"></a>glm_direction_fit_simple <span class="ot">&lt;-</span></span>
<span id="cb260-2"><a href="classification.html#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">engine =</span> <span class="st">&quot;glm&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb260-3"><a href="classification.html#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2,</span>
<span id="cb260-4"><a href="classification.html#cb260-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> smarket_train)</span>
<span id="cb260-5"><a href="classification.html#cb260-5" aria-hidden="true" tabindex="-1"></a>glm_direction_fit_simple <span class="sc">%&gt;%</span></span>
<span id="cb260-6"><a href="classification.html#cb260-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(smarket_test) <span class="sc">%&gt;%</span></span>
<span id="cb260-7"><a href="classification.html#cb260-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> Direction, .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.560</code></pre>
<p>Indeed it does.</p>
</div>
<div id="linear-discriminant-analysis" class="section level3 hasAnchor" number="4.7.3">
<h3><span class="header-section-number">4.7.3</span> Linear Discriminant Analysis<a href="classification.html#linear-discriminant-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Perform LDA to predict <code>Direction</code> from <code>Lag1</code> and <code>Lag2</code>:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="classification.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(discrim)</span>
<span id="cb262-2"><a href="classification.html#cb262-2" aria-hidden="true" tabindex="-1"></a>lda_direction_fit <span class="ot">&lt;-</span></span>
<span id="cb262-3"><a href="classification.html#cb262-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Note that this model definition does not come with parsnip, but the</span></span>
<span id="cb262-4"><a href="classification.html#cb262-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  extension package discrim</span></span>
<span id="cb262-5"><a href="classification.html#cb262-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_linear</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">engine =</span> <span class="st">&quot;MASS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb262-6"><a href="classification.html#cb262-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2, <span class="at">data =</span> smarket_train)</span>
<span id="cb262-7"><a href="classification.html#cb262-7" aria-hidden="true" tabindex="-1"></a>lda_direction_fit</span></code></pre></div>
<pre><code>## parsnip model object
## 
## Call:
## lda(Direction ~ Lag1 + Lag2, data = data)
## 
## Prior probabilities of groups:
##     Down       Up 
## 0.491984 0.508016 
## 
## Group means:
##             Lag1        Lag2
## Down  0.04279022  0.03389409
## Up   -0.03954635 -0.03132544
## 
## Coefficients of linear discriminants:
##             LD1
## Lag1 -0.6420190
## Lag2 -0.5135293</code></pre>
<p>Performance on the testing data set:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="classification.html#cb264-1" aria-hidden="true" tabindex="-1"></a>lda_direction_test_pred <span class="ot">&lt;-</span></span>
<span id="cb264-2"><a href="classification.html#cb264-2" aria-hidden="true" tabindex="-1"></a>  lda_direction_fit <span class="sc">%&gt;%</span></span>
<span id="cb264-3"><a href="classification.html#cb264-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> smarket_test)</span>
<span id="cb264-4"><a href="classification.html#cb264-4" aria-hidden="true" tabindex="-1"></a>lda_direction_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb264-5"><a href="classification.html#cb264-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class)</span></code></pre></div>
<pre><code>##           Truth
## Prediction Down  Up
##       Down   35  35
##       Up     76 106</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="classification.html#cb266-1" aria-hidden="true" tabindex="-1"></a>lda_direction_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb266-2"><a href="classification.html#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.560</code></pre>
<p>Though there is a <a href="https://probably.tidymodels.org/">package called <code>probably</code></a> for adjusting probability thresholds for classification metrics, I will just manually do so here:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="classification.html#cb268-1" aria-hidden="true" tabindex="-1"></a>lda_direction_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb268-2"><a href="classification.html#cb268-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.pred_Down <span class="sc">&gt;</span> <span class="fl">0.9</span>)</span></code></pre></div>
<pre><code>## # A tibble: 0 × 12
## # … with 12 variables: Year &lt;dbl&gt;, Lag1 &lt;dbl&gt;, Lag2 &lt;dbl&gt;, Lag3 &lt;dbl&gt;,
## #   Lag4 &lt;dbl&gt;, Lag5 &lt;dbl&gt;, Volume &lt;dbl&gt;, Today &lt;dbl&gt;, Direction &lt;fct&gt;,
## #   .pred_class &lt;fct&gt;, .pred_Down &lt;dbl&gt;, .pred_Up &lt;dbl&gt;
## # ℹ Use `colnames()` to see all variable names</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="classification.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(lda_direction_test_pred<span class="sc">$</span>.pred_Down)</span></code></pre></div>
<pre><code>## [1] 0.520235</code></pre>
</div>
<div id="quadratic-discriminant-analysis-1" class="section level3 hasAnchor" number="4.7.4">
<h3><span class="header-section-number">4.7.4</span> Quadratic Discriminant Analysis<a href="classification.html#quadratic-discriminant-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Performing QDA will look very similar:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="classification.html#cb272-1" aria-hidden="true" tabindex="-1"></a>qda_direction_fit <span class="ot">&lt;-</span></span>
<span id="cb272-2"><a href="classification.html#cb272-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_quad</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">engine =</span> <span class="st">&quot;MASS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb272-3"><a href="classification.html#cb272-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2, <span class="at">data =</span> smarket_train)</span>
<span id="cb272-4"><a href="classification.html#cb272-4" aria-hidden="true" tabindex="-1"></a>qda_direction_fit</span></code></pre></div>
<pre><code>## parsnip model object
## 
## Call:
## qda(Direction ~ Lag1 + Lag2, data = data)
## 
## Prior probabilities of groups:
##     Down       Up 
## 0.491984 0.508016 
## 
## Group means:
##             Lag1        Lag2
## Down  0.04279022  0.03389409
## Up   -0.03954635 -0.03132544</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="classification.html#cb274-1" aria-hidden="true" tabindex="-1"></a>qda_direction_test_pred <span class="ot">&lt;-</span></span>
<span id="cb274-2"><a href="classification.html#cb274-2" aria-hidden="true" tabindex="-1"></a>  qda_direction_fit <span class="sc">%&gt;%</span></span>
<span id="cb274-3"><a href="classification.html#cb274-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> smarket_test)</span>
<span id="cb274-4"><a href="classification.html#cb274-4" aria-hidden="true" tabindex="-1"></a>qda_direction_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb274-5"><a href="classification.html#cb274-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class)</span></code></pre></div>
<pre><code>##           Truth
## Prediction Down  Up
##       Down   30  20
##       Up     81 121</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="classification.html#cb276-1" aria-hidden="true" tabindex="-1"></a>qda_direction_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb276-2"><a href="classification.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.599</code></pre>
<p>This level of accuracy is quite impressive for stock market data, suggesting that the quadratic form may capture the true relationship more accurately.</p>
</div>
<div id="naive-bayes-1" class="section level3 hasAnchor" number="4.7.5">
<h3><span class="header-section-number">4.7.5</span> Naive Bayes<a href="classification.html#naive-bayes-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>By default, the <code>discrim::naive_Bayes()</code> function uses the <code>klaR</code> package as the engine (<code>e1071</code> is not an option).</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="classification.html#cb278-1" aria-hidden="true" tabindex="-1"></a>nb_direction_fit <span class="ot">&lt;-</span></span>
<span id="cb278-2"><a href="classification.html#cb278-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">naive_Bayes</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">engine =</span> <span class="st">&quot;klaR&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb278-3"><a href="classification.html#cb278-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The klaR engine has an argument usekernel that is always TRUE</span></span>
<span id="cb278-4"><a href="classification.html#cb278-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We have to set it to FALSE to not use KDE, and instead use Gaussian</span></span>
<span id="cb278-5"><a href="classification.html#cb278-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  distributions, as in the text</span></span>
<span id="cb278-6"><a href="classification.html#cb278-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_args</span>(<span class="at">usekernel =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb278-7"><a href="classification.html#cb278-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2, <span class="at">data =</span> smarket_train)</span>
<span id="cb278-8"><a href="classification.html#cb278-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The model output is quite long, so I won&#39;t print it here</span></span>
<span id="cb278-9"><a href="classification.html#cb278-9" aria-hidden="true" tabindex="-1"></a><span class="co"># nb_direction_fit</span></span></code></pre></div>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="classification.html#cb279-1" aria-hidden="true" tabindex="-1"></a>nb_direction_test_pred <span class="ot">&lt;-</span></span>
<span id="cb279-2"><a href="classification.html#cb279-2" aria-hidden="true" tabindex="-1"></a>  nb_direction_fit <span class="sc">%&gt;%</span></span>
<span id="cb279-3"><a href="classification.html#cb279-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> smarket_test)</span>
<span id="cb279-4"><a href="classification.html#cb279-4" aria-hidden="true" tabindex="-1"></a>nb_direction_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb279-5"><a href="classification.html#cb279-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class)</span></code></pre></div>
<pre><code>##           Truth
## Prediction Down  Up
##       Down   28  20
##       Up     83 121</code></pre>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="classification.html#cb281-1" aria-hidden="true" tabindex="-1"></a>nb_direction_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb281-2"><a href="classification.html#cb281-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.591</code></pre>
<p>The naive Bayes approach was quite close (a bit worse) than QDA.
This makes sense.
As we saw in the correlation matrix, the <code>Lag1</code> and <code>Lag2</code> are uncorrelated, so the assumption of naive Bayes is not violated.</p>
</div>
<div id="k-nearest-neighbors-1" class="section level3 hasAnchor" number="4.7.6">
<h3><span class="header-section-number">4.7.6</span> <span class="math inline">\(K\)</span>-Nearest Neighbors<a href="classification.html#k-nearest-neighbors-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I’ll skip right to the <span class="math inline">\(K = 3\)</span> neighbors fit:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="classification.html#cb283-1" aria-hidden="true" tabindex="-1"></a>knn_direction_fit <span class="ot">&lt;-</span></span>
<span id="cb283-2"><a href="classification.html#cb283-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">engine =</span> <span class="st">&quot;kknn&quot;</span>,</span>
<span id="cb283-3"><a href="classification.html#cb283-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">neighbors =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb283-4"><a href="classification.html#cb283-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2, <span class="at">data =</span> smarket_train)</span></code></pre></div>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="classification.html#cb284-1" aria-hidden="true" tabindex="-1"></a>knn_direction_test_pred <span class="ot">&lt;-</span></span>
<span id="cb284-2"><a href="classification.html#cb284-2" aria-hidden="true" tabindex="-1"></a>  knn_direction_fit <span class="sc">%&gt;%</span></span>
<span id="cb284-3"><a href="classification.html#cb284-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> smarket_test)</span>
<span id="cb284-4"><a href="classification.html#cb284-4" aria-hidden="true" tabindex="-1"></a>knn_direction_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb284-5"><a href="classification.html#cb284-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class)</span></code></pre></div>
<pre><code>##           Truth
## Prediction Down Up
##       Down   43 58
##       Up     68 83</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="classification.html#cb286-1" aria-hidden="true" tabindex="-1"></a>knn_direction_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb286-2"><a href="classification.html#cb286-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary           0.5</code></pre>
<p>Essentially a coin flip.</p>
<p>To show a case where KNN does perform well, load the <code>Caravan</code> data set:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="classification.html#cb288-1" aria-hidden="true" tabindex="-1"></a>caravan <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Caravan</span></code></pre></div>
<p>This data set includes a massive 85 predictors that measure demographics for 5822 individuals who did or did not <code>Purchase</code> a caravan insurance policy.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="classification.html#cb289-1" aria-hidden="true" tabindex="-1"></a>caravan <span class="sc">%&gt;%</span> <span class="fu">count</span>(Purchase) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">p =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code></pre></div>
<pre><code>##   Purchase    n          p
## 1       No 5474 0.94022673
## 2      Yes  348 0.05977327</code></pre>
<p>Split the data into training and testing based on row number:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="classification.html#cb291-1" aria-hidden="true" tabindex="-1"></a>caravan_split <span class="ot">&lt;-</span></span>
<span id="cb291-2"><a href="classification.html#cb291-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_splits</span>(</span>
<span id="cb291-3"><a href="classification.html#cb291-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">list</span>(<span class="st">&quot;assessment&quot;</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb291-4"><a href="classification.html#cb291-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;analysis&quot;</span> <span class="ot">=</span> <span class="dv">1001</span><span class="sc">:</span><span class="fu">nrow</span>(caravan)),</span>
<span id="cb291-5"><a href="classification.html#cb291-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> caravan</span>
<span id="cb291-6"><a href="classification.html#cb291-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb291-7"><a href="classification.html#cb291-7" aria-hidden="true" tabindex="-1"></a>caravan_split</span></code></pre></div>
<pre><code>## &lt;Analysis/Assess/Total&gt;
## &lt;4822/1000/5822&gt;</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="classification.html#cb293-1" aria-hidden="true" tabindex="-1"></a>caravan_train <span class="ot">&lt;-</span> <span class="fu">training</span>(caravan_split)</span>
<span id="cb293-2"><a href="classification.html#cb293-2" aria-hidden="true" tabindex="-1"></a>caravan_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(caravan_split)</span></code></pre></div>
<p>KNN predicts a class based on nearby observations, and so the scale of the variables matters.</p>
<blockquote>
<p>For instance, imagine a data set
that contains two variables, <code>salary</code> and <code>age</code> (measured in dollars and years,
respectively). As far as KNN is concerned, a difference of $1,000 in salary
is enormous compared to a difference of 50 years in age. Consequently,
salary will drive the KNN classification results, and age will have almost
no effect. This is contrary to our intuition that a salary difference of $1,000
is quite small compared to an age difference of 50 years.</p>
</blockquote>
<p>To deal with this, we standardize/normalize the data to have mean zero and standard deviation one.
In <code>tidymodels</code>, this means we define a <code>recipe</code> with the <code>step_normalize()</code> step:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="classification.html#cb294-1" aria-hidden="true" tabindex="-1"></a>caravan_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Purchase <span class="sc">~</span> ., <span class="at">data =</span> caravan_train) <span class="sc">%&gt;%</span></span>
<span id="cb294-2"><a href="classification.html#cb294-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span></code></pre></div>
<p>Then we define the models with 1, 3, and 5 neighbors:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="classification.html#cb295-1" aria-hidden="true" tabindex="-1"></a>knn_spec1 <span class="ot">&lt;-</span></span>
<span id="cb295-2"><a href="classification.html#cb295-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">engine =</span> <span class="st">&quot;kknn&quot;</span>, <span class="at">neighbors =</span> <span class="dv">1</span>)</span>
<span id="cb295-3"><a href="classification.html#cb295-3" aria-hidden="true" tabindex="-1"></a>knn_spec3 <span class="ot">&lt;-</span></span>
<span id="cb295-4"><a href="classification.html#cb295-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">engine =</span> <span class="st">&quot;kknn&quot;</span>, <span class="at">neighbors =</span> <span class="dv">3</span>)</span>
<span id="cb295-5"><a href="classification.html#cb295-5" aria-hidden="true" tabindex="-1"></a>knn_spec5 <span class="ot">&lt;-</span></span>
<span id="cb295-6"><a href="classification.html#cb295-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">engine =</span> <span class="st">&quot;kknn&quot;</span>, <span class="at">neighbors =</span> <span class="dv">5</span>)</span></code></pre></div>
<p>We put the model and recipe together into three separate <code>workflow</code>s:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="classification.html#cb296-1" aria-hidden="true" tabindex="-1"></a>knn_purchase_wf1 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb296-2"><a href="classification.html#cb296-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(caravan_rec) <span class="sc">%&gt;%</span></span>
<span id="cb296-3"><a href="classification.html#cb296-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(knn_spec1)</span>
<span id="cb296-4"><a href="classification.html#cb296-4" aria-hidden="true" tabindex="-1"></a>knn_purchase_wf3 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb296-5"><a href="classification.html#cb296-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(caravan_rec) <span class="sc">%&gt;%</span></span>
<span id="cb296-6"><a href="classification.html#cb296-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(knn_spec3)</span>
<span id="cb296-7"><a href="classification.html#cb296-7" aria-hidden="true" tabindex="-1"></a>knn_purchase_wf5 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb296-8"><a href="classification.html#cb296-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(caravan_rec) <span class="sc">%&gt;%</span></span>
<span id="cb296-9"><a href="classification.html#cb296-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(knn_spec5)</span></code></pre></div>
<p>Fit all the models:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="classification.html#cb297-1" aria-hidden="true" tabindex="-1"></a>knn_purchase_fit1 <span class="ot">&lt;-</span> knn_purchase_wf1 <span class="sc">%&gt;%</span></span>
<span id="cb297-2"><a href="classification.html#cb297-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(caravan_train)</span>
<span id="cb297-3"><a href="classification.html#cb297-3" aria-hidden="true" tabindex="-1"></a>knn_purchase_fit3 <span class="ot">&lt;-</span> knn_purchase_wf3 <span class="sc">%&gt;%</span></span>
<span id="cb297-4"><a href="classification.html#cb297-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(caravan_train)</span>
<span id="cb297-5"><a href="classification.html#cb297-5" aria-hidden="true" tabindex="-1"></a>knn_purchase_fit5 <span class="ot">&lt;-</span> knn_purchase_wf5 <span class="sc">%&gt;%</span></span>
<span id="cb297-6"><a href="classification.html#cb297-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(caravan_train)</span></code></pre></div>
<p>Compile the metrics:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="classification.html#cb298-1" aria-hidden="true" tabindex="-1"></a>knn_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(accuracy, sensitivity, specificity, ppv,)</span>
<span id="cb298-2"><a href="classification.html#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb298-3"><a href="classification.html#cb298-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(knn_purchase_fit1, <span class="at">new_data =</span> caravan_test) <span class="sc">%&gt;%</span></span>
<span id="cb298-4"><a href="classification.html#cb298-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">knn_metrics</span>(<span class="at">truth =</span> Purchase, <span class="at">estimate =</span> .pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb298-5"><a href="classification.html#cb298-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">neighbors =</span> <span class="dv">1</span>),</span>
<span id="cb298-6"><a href="classification.html#cb298-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(knn_purchase_fit3, <span class="at">new_data =</span> caravan_test) <span class="sc">%&gt;%</span></span>
<span id="cb298-7"><a href="classification.html#cb298-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">knn_metrics</span>(<span class="at">truth =</span> Purchase, <span class="at">estimate =</span> .pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb298-8"><a href="classification.html#cb298-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">neighbors =</span> <span class="dv">3</span>),</span>
<span id="cb298-9"><a href="classification.html#cb298-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(knn_purchase_fit5, <span class="at">new_data =</span> caravan_test) <span class="sc">%&gt;%</span></span>
<span id="cb298-10"><a href="classification.html#cb298-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">knn_metrics</span>(<span class="at">truth =</span> Purchase, <span class="at">estimate =</span> .pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb298-11"><a href="classification.html#cb298-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">neighbors =</span> <span class="dv">5</span>)</span>
<span id="cb298-12"><a href="classification.html#cb298-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb298-13"><a href="classification.html#cb298-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(neighbors, .metric, <span class="at">.estimate =</span> <span class="fu">round</span>(.estimate, <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb298-14"><a href="classification.html#cb298-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .metric, <span class="at">values_from =</span> .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb298-15"><a href="classification.html#cb298-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code></pre></div>
<div id="cezhwzjndx" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#cezhwzjndx .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cezhwzjndx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cezhwzjndx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cezhwzjndx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cezhwzjndx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cezhwzjndx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cezhwzjndx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cezhwzjndx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cezhwzjndx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cezhwzjndx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cezhwzjndx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cezhwzjndx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#cezhwzjndx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cezhwzjndx .gt_from_md > :first-child {
  margin-top: 0;
}

#cezhwzjndx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cezhwzjndx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cezhwzjndx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cezhwzjndx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cezhwzjndx .gt_row_group_first td {
  border-top-width: 2px;
}

#cezhwzjndx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cezhwzjndx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cezhwzjndx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cezhwzjndx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cezhwzjndx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cezhwzjndx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cezhwzjndx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cezhwzjndx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cezhwzjndx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cezhwzjndx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cezhwzjndx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cezhwzjndx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cezhwzjndx .gt_left {
  text-align: left;
}

#cezhwzjndx .gt_center {
  text-align: center;
}

#cezhwzjndx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cezhwzjndx .gt_font_normal {
  font-weight: normal;
}

#cezhwzjndx .gt_font_bold {
  font-weight: bold;
}

#cezhwzjndx .gt_font_italic {
  font-style: italic;
}

#cezhwzjndx .gt_super {
  font-size: 65%;
}

#cezhwzjndx .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#cezhwzjndx .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#cezhwzjndx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cezhwzjndx .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#cezhwzjndx .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#cezhwzjndx .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">neighbors</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">accuracy</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">sensitivity</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">specificity</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">ppv</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0.883</td>
<td class="gt_row gt_right">0.929</td>
<td class="gt_row gt_right">0.153</td>
<td class="gt_row gt_right">0.946</td></tr>
    <tr><td class="gt_row gt_right">3</td>
<td class="gt_row gt_right">0.884</td>
<td class="gt_row gt_right">0.930</td>
<td class="gt_row gt_right">0.153</td>
<td class="gt_row gt_right">0.946</td></tr>
    <tr><td class="gt_row gt_right">5</td>
<td class="gt_row gt_right">0.883</td>
<td class="gt_row gt_right">0.929</td>
<td class="gt_row gt_right">0.153</td>
<td class="gt_row gt_right">0.946</td></tr>
  </tbody>
  
  
</table>
</div>
<p>The percentages reported in the text are the positive predictive value (TP / (TP + FP)).
This is the <code>ppv</code> variable in the above table, which is way off.
This is due to the <code>event_level</code> argument to the <code>ppv()</code> metric function (and <code>sensitivity</code> and <code>specificity</code> for that matter).
It is calculated the PPV for the first level of the response, which is <code>Purchase</code> = “No’.
Re-calculate PPV with the correct”positive” event identified:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="classification.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb299-2"><a href="classification.html#cb299-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(knn_purchase_fit1, <span class="at">new_data =</span> caravan_test) <span class="sc">%&gt;%</span></span>
<span id="cb299-3"><a href="classification.html#cb299-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ppv</span>(<span class="at">truth =</span> Purchase, <span class="at">estimate =</span> .pred_class, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb299-4"><a href="classification.html#cb299-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">neighbors =</span> <span class="dv">1</span>),</span>
<span id="cb299-5"><a href="classification.html#cb299-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(knn_purchase_fit3, <span class="at">new_data =</span> caravan_test) <span class="sc">%&gt;%</span></span>
<span id="cb299-6"><a href="classification.html#cb299-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ppv</span>(<span class="at">truth =</span> Purchase, <span class="at">estimate =</span> .pred_class, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb299-7"><a href="classification.html#cb299-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">neighbors =</span> <span class="dv">3</span>),</span>
<span id="cb299-8"><a href="classification.html#cb299-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(knn_purchase_fit5, <span class="at">new_data =</span> caravan_test) <span class="sc">%&gt;%</span></span>
<span id="cb299-9"><a href="classification.html#cb299-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ppv</span>(<span class="at">truth =</span> Purchase, <span class="at">estimate =</span> .pred_class, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb299-10"><a href="classification.html#cb299-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">neighbors =</span> <span class="dv">5</span>)</span>
<span id="cb299-11"><a href="classification.html#cb299-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb299-12"><a href="classification.html#cb299-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(neighbors, .metric, <span class="at">.estimate =</span> <span class="fu">round</span>(.estimate, <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb299-13"><a href="classification.html#cb299-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .metric, <span class="at">values_from =</span> .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb299-14"><a href="classification.html#cb299-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code></pre></div>
<div id="arybkhsner" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#arybkhsner .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#arybkhsner .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#arybkhsner .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#arybkhsner .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#arybkhsner .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#arybkhsner .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#arybkhsner .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#arybkhsner .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#arybkhsner .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#arybkhsner .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#arybkhsner .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#arybkhsner .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#arybkhsner .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#arybkhsner .gt_from_md > :first-child {
  margin-top: 0;
}

#arybkhsner .gt_from_md > :last-child {
  margin-bottom: 0;
}

#arybkhsner .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#arybkhsner .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#arybkhsner .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#arybkhsner .gt_row_group_first td {
  border-top-width: 2px;
}

#arybkhsner .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#arybkhsner .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#arybkhsner .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#arybkhsner .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#arybkhsner .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#arybkhsner .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#arybkhsner .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#arybkhsner .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#arybkhsner .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#arybkhsner .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#arybkhsner .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#arybkhsner .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#arybkhsner .gt_left {
  text-align: left;
}

#arybkhsner .gt_center {
  text-align: center;
}

#arybkhsner .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#arybkhsner .gt_font_normal {
  font-weight: normal;
}

#arybkhsner .gt_font_bold {
  font-weight: bold;
}

#arybkhsner .gt_font_italic {
  font-style: italic;
}

#arybkhsner .gt_super {
  font-size: 65%;
}

#arybkhsner .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#arybkhsner .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#arybkhsner .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#arybkhsner .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#arybkhsner .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#arybkhsner .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">neighbors</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">ppv</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0.118</td></tr>
    <tr><td class="gt_row gt_right">3</td>
<td class="gt_row gt_right">0.120</td></tr>
    <tr><td class="gt_row gt_right">5</td>
<td class="gt_row gt_right">0.118</td></tr>
  </tbody>
  
  
</table>
</div>
<p>I’m not getting the improved PPV with increasing neighbors as in the text.
Not sure why.</p>
<p>Lastly, get the PPV from a logistic regression:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="classification.html#cb300-1" aria-hidden="true" tabindex="-1"></a>glm_purchase_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb300-2"><a href="classification.html#cb300-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(caravan_rec) <span class="sc">%&gt;%</span></span>
<span id="cb300-3"><a href="classification.html#cb300-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(<span class="fu">logistic_reg</span>())</span>
<span id="cb300-4"><a href="classification.html#cb300-4" aria-hidden="true" tabindex="-1"></a>glm_purchase_fit <span class="ot">&lt;-</span> glm_purchase_wf <span class="sc">%&gt;%</span></span>
<span id="cb300-5"><a href="classification.html#cb300-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(caravan_train)</span></code></pre></div>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<p>PPV with a default 50% threshold:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="classification.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(glm_purchase_fit, <span class="at">new_data =</span> caravan_test) <span class="sc">%&gt;%</span></span>
<span id="cb302-2"><a href="classification.html#cb302-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ppv</span>(<span class="at">truth =</span> Purchase, <span class="at">estimate =</span> .pred_class, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 ppv     binary             0</code></pre>
<p>PPV with a 25% threshold:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="classification.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(glm_purchase_fit, <span class="at">new_data =</span> caravan_test) <span class="sc">%&gt;%</span></span>
<span id="cb304-2"><a href="classification.html#cb304-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb304-3"><a href="classification.html#cb304-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.pred_class =</span> <span class="fu">ifelse</span>(.pred_Yes <span class="sc">&gt;</span> <span class="fl">0.25</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb304-4"><a href="classification.html#cb304-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb304-5"><a href="classification.html#cb304-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ppv</span>(<span class="at">truth =</span> Purchase, <span class="at">estimate =</span> .pred_class, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 ppv     binary         0.333</code></pre>
</div>
<div id="poisson-regression" class="section level3 hasAnchor" number="4.7.7">
<h3><span class="header-section-number">4.7.7</span> Poisson Regression<a href="classification.html#poisson-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will again fit the <code>bikeshare</code> data with Poisson regression, but this time with <code>tidymodels</code>:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="classification.html#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(poissonreg)</span>
<span id="cb306-2"><a href="classification.html#cb306-2" aria-hidden="true" tabindex="-1"></a>glm_bikers_model <span class="ot">&lt;-</span></span>
<span id="cb306-3"><a href="classification.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">poisson_reg</span>(<span class="at">mode =</span> <span class="st">&quot;regression&quot;</span>, <span class="at">engine =</span> <span class="st">&quot;glm&quot;</span>)</span></code></pre></div>
<p>The model specification for <code>poisson_reg()</code> is a model wrapper that comes from the <code>poissonreg</code> package.</p>
<p>It is good practice to explicitly state that we are making dummy variables of the categorical predictors via <code>step_dummy()</code>:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="classification.html#cb307-1" aria-hidden="true" tabindex="-1"></a>glm_bikers_rec <span class="ot">&lt;-</span></span>
<span id="cb307-2"><a href="classification.html#cb307-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(bikers <span class="sc">~</span> mnth <span class="sc">+</span> hr <span class="sc">+</span> workingday <span class="sc">+</span> temp <span class="sc">+</span> weathersit,</span>
<span id="cb307-3"><a href="classification.html#cb307-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> bikeshare) <span class="sc">%&gt;%</span></span>
<span id="cb307-4"><a href="classification.html#cb307-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span></code></pre></div>
<p>Define the <code>workflow</code> and fit the model:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="classification.html#cb308-1" aria-hidden="true" tabindex="-1"></a>glm_bikers_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb308-2"><a href="classification.html#cb308-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(glm_bikers_model) <span class="sc">%&gt;%</span></span>
<span id="cb308-3"><a href="classification.html#cb308-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(glm_bikers_rec)</span>
<span id="cb308-4"><a href="classification.html#cb308-4" aria-hidden="true" tabindex="-1"></a>glm_bikers_fit <span class="ot">&lt;-</span> glm_bikers_wf <span class="sc">%&gt;%</span></span>
<span id="cb308-5"><a href="classification.html#cb308-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(bikeshare)</span></code></pre></div>
<p>We’ve already re-created Figure 4.15 with this model, so won’t repeat it here.
Instead, here is a plot of predictions and, just for fun, it is stratified by the weather:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="classification.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(glm_bikers_fit, <span class="at">new_data =</span> bikeshare) <span class="sc">%&gt;%</span></span>
<span id="cb309-2"><a href="classification.html#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bikers, <span class="at">y =</span> .pred)) <span class="sc">+</span></span>
<span id="cb309-3"><a href="classification.html#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>opera_mauve, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb309-4"><a href="classification.html#cb309-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb309-5"><a href="classification.html#cb309-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>weathersit) <span class="sc">+</span></span>
<span id="cb309-6"><a href="classification.html#cb309-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb309-7"><a href="classification.html#cb309-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_facet_borders</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-164-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercises-1" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Exercises<a href="classification.html#exercises-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="applied-1" class="section level3 unnumbered hasAnchor">
<h3>Applied<a href="classification.html#applied-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="predict-returns-with-weekly" class="section level4 unnumbered hasAnchor">
<h4>13. Predict returns with <code>Weekly</code><a href="classification.html#predict-returns-with-weekly" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="classification.html#cb310-1" aria-hidden="true" tabindex="-1"></a>weekly <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Weekly</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li>Data summaries.</li>
</ol>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="classification.html#cb311-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(weekly)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-166">Table 4.2: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">weekly</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">1089</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">9</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">8</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table style="width:100%;">
<colgroup>
<col width="19%" />
<col width="13%" />
<col width="19%" />
<col width="10%" />
<col width="12%" />
<col width="24%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Direction</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">Up: 605, Dow: 484</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<colgroup>
<col width="14%" />
<col width="10%" />
<col width="14%" />
<col width="8%" />
<col width="5%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2000.05</td>
<td align="right">6.03</td>
<td align="right">1990.00</td>
<td align="right">1995.00</td>
<td align="right">2000.00</td>
<td align="right">2005.00</td>
<td align="right">2010.00</td>
<td align="left">▇▆▆▆▆</td>
</tr>
<tr class="even">
<td align="left">Lag1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.15</td>
<td align="right">2.36</td>
<td align="right">-18.20</td>
<td align="right">-1.15</td>
<td align="right">0.24</td>
<td align="right">1.41</td>
<td align="right">12.03</td>
<td align="left">▁▁▆▇▁</td>
</tr>
<tr class="odd">
<td align="left">Lag2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.15</td>
<td align="right">2.36</td>
<td align="right">-18.20</td>
<td align="right">-1.15</td>
<td align="right">0.24</td>
<td align="right">1.41</td>
<td align="right">12.03</td>
<td align="left">▁▁▆▇▁</td>
</tr>
<tr class="even">
<td align="left">Lag3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.15</td>
<td align="right">2.36</td>
<td align="right">-18.20</td>
<td align="right">-1.16</td>
<td align="right">0.24</td>
<td align="right">1.41</td>
<td align="right">12.03</td>
<td align="left">▁▁▆▇▁</td>
</tr>
<tr class="odd">
<td align="left">Lag4</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.15</td>
<td align="right">2.36</td>
<td align="right">-18.20</td>
<td align="right">-1.16</td>
<td align="right">0.24</td>
<td align="right">1.41</td>
<td align="right">12.03</td>
<td align="left">▁▁▆▇▁</td>
</tr>
<tr class="even">
<td align="left">Lag5</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.14</td>
<td align="right">2.36</td>
<td align="right">-18.20</td>
<td align="right">-1.17</td>
<td align="right">0.23</td>
<td align="right">1.41</td>
<td align="right">12.03</td>
<td align="left">▁▁▆▇▁</td>
</tr>
<tr class="odd">
<td align="left">Volume</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.57</td>
<td align="right">1.69</td>
<td align="right">0.09</td>
<td align="right">0.33</td>
<td align="right">1.00</td>
<td align="right">2.05</td>
<td align="right">9.33</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="even">
<td align="left">Today</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.15</td>
<td align="right">2.36</td>
<td align="right">-18.20</td>
<td align="right">-1.15</td>
<td align="right">0.24</td>
<td align="right">1.41</td>
<td align="right">12.03</td>
<td align="left">▁▁▆▇▁</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="classification.html#cb312-1" aria-hidden="true" tabindex="-1"></a>weekly <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Direction) <span class="sc">%&gt;%</span></span>
<span id="cb312-2"><a href="classification.html#cb312-2" aria-hidden="true" tabindex="-1"></a>  corrr<span class="sc">::</span><span class="fu">correlate</span>(<span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb312-3"><a href="classification.html#cb312-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">&quot;term&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb312-4"><a href="classification.html#cb312-4" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">fmt_missing</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">missing_text =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb312-5"><a href="classification.html#cb312-5" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">data_color</span>(</span>
<span id="cb312-6"><a href="classification.html#cb312-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">everything</span>(),</span>
<span id="cb312-7"><a href="classification.html#cb312-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> scales<span class="sc">::</span><span class="fu">col_numeric</span>(</span>
<span id="cb312-8"><a href="classification.html#cb312-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">palette =</span> <span class="fu">td_pal</span>(<span class="st">&quot;div5&quot;</span>)(<span class="dv">5</span>),</span>
<span id="cb312-9"><a href="classification.html#cb312-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">domain =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.9</span>)</span>
<span id="cb312-10"><a href="classification.html#cb312-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb312-11"><a href="classification.html#cb312-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb312-12"><a href="classification.html#cb312-12" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">decimals =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Warning: The `fmt_missing()` function is deprecated and will soon be removed
## * Use the `sub_missing()` function instead</code></pre>
<div id="awbplxpdhh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#awbplxpdhh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#awbplxpdhh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#awbplxpdhh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#awbplxpdhh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#awbplxpdhh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#awbplxpdhh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#awbplxpdhh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#awbplxpdhh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#awbplxpdhh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#awbplxpdhh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#awbplxpdhh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#awbplxpdhh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#awbplxpdhh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#awbplxpdhh .gt_from_md > :first-child {
  margin-top: 0;
}

#awbplxpdhh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#awbplxpdhh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#awbplxpdhh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#awbplxpdhh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#awbplxpdhh .gt_row_group_first td {
  border-top-width: 2px;
}

#awbplxpdhh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#awbplxpdhh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#awbplxpdhh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#awbplxpdhh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#awbplxpdhh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#awbplxpdhh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#awbplxpdhh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#awbplxpdhh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#awbplxpdhh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#awbplxpdhh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#awbplxpdhh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#awbplxpdhh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#awbplxpdhh .gt_left {
  text-align: left;
}

#awbplxpdhh .gt_center {
  text-align: center;
}

#awbplxpdhh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#awbplxpdhh .gt_font_normal {
  font-weight: normal;
}

#awbplxpdhh .gt_font_bold {
  font-weight: bold;
}

#awbplxpdhh .gt_font_italic {
  font-style: italic;
}

#awbplxpdhh .gt_super {
  font-size: 65%;
}

#awbplxpdhh .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#awbplxpdhh .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#awbplxpdhh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#awbplxpdhh .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#awbplxpdhh .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#awbplxpdhh .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Lag1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Lag2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Lag3</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Lag4</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Lag5</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Volume</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Today</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right gt_stub">Year</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #04587C; color: #FFFFFF;">&minus;0.032</td>
<td class="gt_row gt_right" style="background-color: #04577C; color: #FFFFFF;">&minus;0.033</td>
<td class="gt_row gt_right" style="background-color: #05587D; color: #FFFFFF;">&minus;0.030</td>
<td class="gt_row gt_right" style="background-color: #05587C; color: #FFFFFF;">&minus;0.031</td>
<td class="gt_row gt_right" style="background-color: #05587D; color: #FFFFFF;">&minus;0.031</td>
<td class="gt_row gt_right" style="background-color: #E15521; color: #FFFFFF;">0.842</td>
<td class="gt_row gt_right" style="background-color: #04587C; color: #FFFFFF;">&minus;0.032</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Lag1</td>
<td class="gt_row gt_right" style="background-color: #04587C; color: #FFFFFF;">&minus;0.032</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.075</td>
<td class="gt_row gt_right" style="background-color: #0A6D8E; color: #FFFFFF;">0.059</td>
<td class="gt_row gt_right" style="background-color: #024F75; color: #FFFFFF;">&minus;0.071</td>
<td class="gt_row gt_right" style="background-color: #065D81; color: #FFFFFF;">&minus;0.008</td>
<td class="gt_row gt_right" style="background-color: #025076; color: #FFFFFF;">&minus;0.065</td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.075</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Lag2</td>
<td class="gt_row gt_right" style="background-color: #04577C; color: #FFFFFF;">&minus;0.033</td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.075</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.076</td>
<td class="gt_row gt_right" style="background-color: #0A6D8E; color: #FFFFFF;">0.058</td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.072</td>
<td class="gt_row gt_right" style="background-color: #014B72; color: #FFFFFF;">&minus;0.086</td>
<td class="gt_row gt_right" style="background-color: #0A6E8F; color: #FFFFFF;">0.059</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Lag3</td>
<td class="gt_row gt_right" style="background-color: #05587D; color: #FFFFFF;">&minus;0.030</td>
<td class="gt_row gt_right" style="background-color: #0A6D8E; color: #FFFFFF;">0.059</td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.076</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.075</td>
<td class="gt_row gt_right" style="background-color: #0B6E8F; color: #FFFFFF;">0.061</td>
<td class="gt_row gt_right" style="background-color: #024F75; color: #FFFFFF;">&minus;0.069</td>
<td class="gt_row gt_right" style="background-color: #024F75; color: #FFFFFF;">&minus;0.071</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Lag4</td>
<td class="gt_row gt_right" style="background-color: #05587C; color: #FFFFFF;">&minus;0.031</td>
<td class="gt_row gt_right" style="background-color: #024F75; color: #FFFFFF;">&minus;0.071</td>
<td class="gt_row gt_right" style="background-color: #0A6D8E; color: #FFFFFF;">0.058</td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.075</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.076</td>
<td class="gt_row gt_right" style="background-color: #035177; color: #FFFFFF;">&minus;0.061</td>
<td class="gt_row gt_right" style="background-color: #065D81; color: #FFFFFF;">&minus;0.008</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Lag5</td>
<td class="gt_row gt_right" style="background-color: #05587D; color: #FFFFFF;">&minus;0.031</td>
<td class="gt_row gt_right" style="background-color: #065D81; color: #FFFFFF;">&minus;0.008</td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.072</td>
<td class="gt_row gt_right" style="background-color: #0B6E8F; color: #FFFFFF;">0.061</td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.076</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #035277; color: #FFFFFF;">&minus;0.059</td>
<td class="gt_row gt_right" style="background-color: #076285; color: #FFFFFF;">0.011</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Volume</td>
<td class="gt_row gt_right" style="background-color: #E15521; color: #FFFFFF;">0.842</td>
<td class="gt_row gt_right" style="background-color: #025076; color: #FFFFFF;">&minus;0.065</td>
<td class="gt_row gt_right" style="background-color: #014B72; color: #FFFFFF;">&minus;0.086</td>
<td class="gt_row gt_right" style="background-color: #024F75; color: #FFFFFF;">&minus;0.069</td>
<td class="gt_row gt_right" style="background-color: #035177; color: #FFFFFF;">&minus;0.061</td>
<td class="gt_row gt_right" style="background-color: #035277; color: #FFFFFF;">&minus;0.059</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #04577C; color: #FFFFFF;">&minus;0.033</td></tr>
    <tr><td class="gt_row gt_right gt_stub">Today</td>
<td class="gt_row gt_right" style="background-color: #04587C; color: #FFFFFF;">&minus;0.032</td>
<td class="gt_row gt_right" style="background-color: #024E74; color: #FFFFFF;">&minus;0.075</td>
<td class="gt_row gt_right" style="background-color: #0A6E8F; color: #FFFFFF;">0.059</td>
<td class="gt_row gt_right" style="background-color: #024F75; color: #FFFFFF;">&minus;0.071</td>
<td class="gt_row gt_right" style="background-color: #065D81; color: #FFFFFF;">&minus;0.008</td>
<td class="gt_row gt_right" style="background-color: #076285; color: #FFFFFF;">0.011</td>
<td class="gt_row gt_right" style="background-color: #04577C; color: #FFFFFF;">&minus;0.033</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td></tr>
  </tbody>
  
  
</table>
</div>
<p>As before with the <code>smarket</code> data set, there is increasing <code>Volume</code> with <code>Year</code>:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="classification.html#cb314-1" aria-hidden="true" tabindex="-1"></a>weekly <span class="sc">%&gt;%</span></span>
<span id="cb314-2"><a href="classification.html#cb314-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Year), <span class="at">y =</span> Volume)) <span class="sc">+</span></span>
<span id="cb314-3"><a href="classification.html#cb314-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>day9_yellow) <span class="sc">+</span></span>
<span id="cb314-4"><a href="classification.html#cb314-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">width =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-168-1.png" width="576" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Logistic regression.</li>
</ol>
<p>Before fitting, I will reverse the order of the <code>Direction</code> factor so that the first level is “Up” because <code>tidymodels</code> treats the first level as “positive.”</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="classification.html#cb315-1" aria-hidden="true" tabindex="-1"></a>weekly <span class="ot">&lt;-</span> weekly <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Direction =</span> <span class="fu">fct_rev</span>(Direction))</span></code></pre></div>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="classification.html#cb316-1" aria-hidden="true" tabindex="-1"></a>lr_weekly_fit <span class="ot">&lt;-</span></span>
<span id="cb316-2"><a href="classification.html#cb316-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb316-3"><a href="classification.html#cb316-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Direction <span class="sc">~</span> Year <span class="sc">+</span> Lag1 <span class="sc">+</span> Lag2 <span class="sc">+</span> Lag3 <span class="sc">+</span> Lag4 <span class="sc">+</span> Lag5 <span class="sc">+</span> Volume,</span>
<span id="cb316-4"><a href="classification.html#cb316-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> weekly)</span>
<span id="cb316-5"><a href="classification.html#cb316-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_custom</span>(lr_weekly_fit) <span class="sc">%&gt;%</span></span>
<span id="cb316-6"><a href="classification.html#cb316-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code></pre></div>
<div id="nsssnibcqw" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#nsssnibcqw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nsssnibcqw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nsssnibcqw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nsssnibcqw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nsssnibcqw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nsssnibcqw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nsssnibcqw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nsssnibcqw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nsssnibcqw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nsssnibcqw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nsssnibcqw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nsssnibcqw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#nsssnibcqw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nsssnibcqw .gt_from_md > :first-child {
  margin-top: 0;
}

#nsssnibcqw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nsssnibcqw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nsssnibcqw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nsssnibcqw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nsssnibcqw .gt_row_group_first td {
  border-top-width: 2px;
}

#nsssnibcqw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nsssnibcqw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nsssnibcqw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nsssnibcqw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nsssnibcqw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nsssnibcqw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nsssnibcqw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nsssnibcqw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nsssnibcqw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nsssnibcqw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nsssnibcqw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nsssnibcqw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nsssnibcqw .gt_left {
  text-align: left;
}

#nsssnibcqw .gt_center {
  text-align: center;
}

#nsssnibcqw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nsssnibcqw .gt_font_normal {
  font-weight: normal;
}

#nsssnibcqw .gt_font_bold {
  font-weight: bold;
}

#nsssnibcqw .gt_font_italic {
  font-style: italic;
}

#nsssnibcqw .gt_super {
  font-size: 65%;
}

#nsssnibcqw .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#nsssnibcqw .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#nsssnibcqw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nsssnibcqw .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#nsssnibcqw .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#nsssnibcqw .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">coefficient</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">std.error</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">z-statistic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">p-value</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">(Intercept)</td>
<td class="gt_row gt_right">-17.2258</td>
<td class="gt_row gt_right">37.8905</td>
<td class="gt_row gt_right">-0.45</td>
<td class="gt_row gt_left">0.649</td></tr>
    <tr><td class="gt_row gt_left">Year</td>
<td class="gt_row gt_right">0.0085</td>
<td class="gt_row gt_right">0.0190</td>
<td class="gt_row gt_right">0.45</td>
<td class="gt_row gt_left">0.654</td></tr>
    <tr><td class="gt_row gt_left">Lag1</td>
<td class="gt_row gt_right">0.0407</td>
<td class="gt_row gt_right">0.0264</td>
<td class="gt_row gt_right">1.54</td>
<td class="gt_row gt_left">0.124</td></tr>
    <tr><td class="gt_row gt_left">Lag2</td>
<td class="gt_row gt_right">-0.0594</td>
<td class="gt_row gt_right">0.0270</td>
<td class="gt_row gt_right">-2.20</td>
<td class="gt_row gt_left">0.028</td></tr>
    <tr><td class="gt_row gt_left">Lag3</td>
<td class="gt_row gt_right">0.0155</td>
<td class="gt_row gt_right">0.0267</td>
<td class="gt_row gt_right">0.58</td>
<td class="gt_row gt_left">0.562</td></tr>
    <tr><td class="gt_row gt_left">Lag4</td>
<td class="gt_row gt_right">0.0273</td>
<td class="gt_row gt_right">0.0265</td>
<td class="gt_row gt_right">1.03</td>
<td class="gt_row gt_left">0.302</td></tr>
    <tr><td class="gt_row gt_left">Lag5</td>
<td class="gt_row gt_right">0.0140</td>
<td class="gt_row gt_right">0.0264</td>
<td class="gt_row gt_right">0.53</td>
<td class="gt_row gt_left">0.595</td></tr>
    <tr><td class="gt_row gt_left">Volume</td>
<td class="gt_row gt_right">-0.0033</td>
<td class="gt_row gt_right">0.0688</td>
<td class="gt_row gt_right">-0.05</td>
<td class="gt_row gt_left">0.962</td></tr>
  </tbody>
  
  
</table>
</div>
<p>Only <code>Lag2</code> was a significant predictor.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Confusion matrix.</li>
</ol>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="classification.html#cb317-1" aria-hidden="true" tabindex="-1"></a>lr_weekly_fit_conf_mat <span class="ot">&lt;-</span> <span class="fu">augment</span>(lr_weekly_fit, weekly) <span class="sc">%&gt;%</span></span>
<span id="cb317-2"><a href="classification.html#cb317-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb317-3"><a href="classification.html#cb317-3" aria-hidden="true" tabindex="-1"></a>lr_weekly_fit_conf_mat</span></code></pre></div>
<pre><code>##           Truth
## Prediction  Up Down
##       Up   558  428
##       Down  47   56</code></pre>
<ul>
<li>The model predicts many more <code>Direction</code> = “Up” than “Down”.</li>
<li>The overall accuracy was slightly better than guessing:
56%.</li>
<li>The sensitivity, TP / (TP + FP) was very good:
92%.</li>
<li>The specificity, TN / (TN + FN) was very poor:
12%.</li>
</ul>
<ol start="4" style="list-style-type: lower-alpha">
<li>Logistic regression with <code>Lag2</code> as the sole predictor.</li>
</ol>
<p>Split into training and testing:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="classification.html#cb319-1" aria-hidden="true" tabindex="-1"></a>weekly_train <span class="ot">&lt;-</span> weekly <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&lt;=</span> <span class="dv">2008</span>)</span>
<span id="cb319-2"><a href="classification.html#cb319-2" aria-hidden="true" tabindex="-1"></a>weekly_test <span class="ot">&lt;-</span> weekly <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">2008</span>)</span></code></pre></div>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="classification.html#cb320-1" aria-hidden="true" tabindex="-1"></a>lr_weekly_fit_lag2 <span class="ot">&lt;-</span></span>
<span id="cb320-2"><a href="classification.html#cb320-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb320-3"><a href="classification.html#cb320-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag2, <span class="at">data =</span> weekly_train)</span>
<span id="cb320-4"><a href="classification.html#cb320-4" aria-hidden="true" tabindex="-1"></a>lr_weekly_fit_lag2_conf_mat <span class="ot">&lt;-</span></span>
<span id="cb320-5"><a href="classification.html#cb320-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(lr_weekly_fit_lag2, weekly_test) <span class="sc">%&gt;%</span></span>
<span id="cb320-6"><a href="classification.html#cb320-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb320-7"><a href="classification.html#cb320-7" aria-hidden="true" tabindex="-1"></a>lr_weekly_fit_lag2_conf_mat</span></code></pre></div>
<pre><code>##           Truth
## Prediction Up Down
##       Up   56   34
##       Down  5    9</code></pre>
<ul>
<li>The model still predicts many more <code>Direction</code> = “Up” than “Down”.</li>
<li>The overall accuracy:
62%.</li>
<li>The sensitivity:
92%.</li>
<li>The specificity:
21%.</li>
</ul>
<p>(e-h) Repeat using LDA, QDA, KNN, naive Bayes.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="classification.html#cb322-1" aria-hidden="true" tabindex="-1"></a>model_fits <span class="ot">&lt;-</span></span>
<span id="cb322-2"><a href="classification.html#cb322-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb322-3"><a href="classification.html#cb322-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;logistic&quot;</span> <span class="ot">=</span> lr_weekly_fit_lag2,</span>
<span id="cb322-4"><a href="classification.html#cb322-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;LDA&quot;</span> <span class="ot">=</span> <span class="fu">discrim_linear</span>() <span class="sc">%&gt;%</span> <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag2, <span class="at">data =</span> weekly_train),</span>
<span id="cb322-5"><a href="classification.html#cb322-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;QDA&quot;</span> <span class="ot">=</span> <span class="fu">discrim_quad</span>() <span class="sc">%&gt;%</span> <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag2, <span class="at">data =</span> weekly_train),</span>
<span id="cb322-6"><a href="classification.html#cb322-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;KNN1&quot;</span> <span class="ot">=</span> <span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">neighbors =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb322-7"><a href="classification.html#cb322-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag2, <span class="at">data =</span> weekly_train),</span>
<span id="cb322-8"><a href="classification.html#cb322-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;NB&quot;</span> <span class="ot">=</span> <span class="fu">naive_Bayes</span>() <span class="sc">%&gt;%</span> <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag2, <span class="at">data =</span> weekly_train)</span>
<span id="cb322-9"><a href="classification.html#cb322-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb322-10"><a href="classification.html#cb322-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-11"><a href="classification.html#cb322-11" aria-hidden="true" tabindex="-1"></a>weekly_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(accuracy, sens, spec, ppv)</span>
<span id="cb322-12"><a href="classification.html#cb322-12" aria-hidden="true" tabindex="-1"></a><span class="fu">imap_dfr</span>(</span>
<span id="cb322-13"><a href="classification.html#cb322-13" aria-hidden="true" tabindex="-1"></a>  model_fits,</span>
<span id="cb322-14"><a href="classification.html#cb322-14" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span><span class="fu">augment</span>(.x, <span class="at">new_data =</span> weekly_test) <span class="sc">%&gt;%</span></span>
<span id="cb322-15"><a href="classification.html#cb322-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">weekly_metrics</span>(<span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class),</span>
<span id="cb322-16"><a href="classification.html#cb322-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">.id =</span> <span class="st">&quot;model&quot;</span></span>
<span id="cb322-17"><a href="classification.html#cb322-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb322-18"><a href="classification.html#cb322-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, .metric, .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb322-19"><a href="classification.html#cb322-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .metric, <span class="at">values_from =</span> .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb322-20"><a href="classification.html#cb322-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">&quot;model&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb322-21"><a href="classification.html#cb322-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> <span class="sc">-</span>model)</span></code></pre></div>
<div id="ypmkakvxat" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ypmkakvxat .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ypmkakvxat .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ypmkakvxat .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ypmkakvxat .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ypmkakvxat .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ypmkakvxat .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ypmkakvxat .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ypmkakvxat .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ypmkakvxat .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ypmkakvxat .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ypmkakvxat .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ypmkakvxat .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ypmkakvxat .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ypmkakvxat .gt_from_md > :first-child {
  margin-top: 0;
}

#ypmkakvxat .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ypmkakvxat .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ypmkakvxat .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ypmkakvxat .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ypmkakvxat .gt_row_group_first td {
  border-top-width: 2px;
}

#ypmkakvxat .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ypmkakvxat .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ypmkakvxat .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ypmkakvxat .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ypmkakvxat .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ypmkakvxat .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ypmkakvxat .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ypmkakvxat .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ypmkakvxat .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ypmkakvxat .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ypmkakvxat .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ypmkakvxat .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ypmkakvxat .gt_left {
  text-align: left;
}

#ypmkakvxat .gt_center {
  text-align: center;
}

#ypmkakvxat .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ypmkakvxat .gt_font_normal {
  font-weight: normal;
}

#ypmkakvxat .gt_font_bold {
  font-weight: bold;
}

#ypmkakvxat .gt_font_italic {
  font-style: italic;
}

#ypmkakvxat .gt_super {
  font-size: 65%;
}

#ypmkakvxat .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#ypmkakvxat .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ypmkakvxat .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ypmkakvxat .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#ypmkakvxat .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#ypmkakvxat .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">accuracy</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">sens</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">spec</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">ppv</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right gt_stub">logistic</td>
<td class="gt_row gt_right">62.50%</td>
<td class="gt_row gt_right">91.80%</td>
<td class="gt_row gt_right">20.93%</td>
<td class="gt_row gt_right">62.22%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">LDA</td>
<td class="gt_row gt_right">62.50%</td>
<td class="gt_row gt_right">91.80%</td>
<td class="gt_row gt_right">20.93%</td>
<td class="gt_row gt_right">62.22%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">QDA</td>
<td class="gt_row gt_right">58.65%</td>
<td class="gt_row gt_right">100.00%</td>
<td class="gt_row gt_right">0.00%</td>
<td class="gt_row gt_right">58.65%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN1</td>
<td class="gt_row gt_right">50.00%</td>
<td class="gt_row gt_right">49.18%</td>
<td class="gt_row gt_right">51.16%</td>
<td class="gt_row gt_right">58.82%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">NB</td>
<td class="gt_row gt_right">60.58%</td>
<td class="gt_row gt_right">91.80%</td>
<td class="gt_row gt_right">16.28%</td>
<td class="gt_row gt_right">60.87%</td></tr>
  </tbody>
  
  
</table>
</div>
<ol style="list-style-type: lower-roman">
<li>Which method was best?</li>
</ol>
<ul>
<li>LDA and logistic regression performed exactly the same, and did the best.</li>
<li>QDA predicted everything as “Up”.</li>
<li>KNN with 1 neighbor was a coin flip simulator.</li>
<li>Naive Bayes did slightly worse than logistic and LDA.</li>
</ul>
</div>
<div id="predict-gas-mileage-with-auto" class="section level4 unnumbered hasAnchor">
<h4>14. Predict gas mileage with <code>Auto</code><a href="classification.html#predict-gas-mileage-with-auto" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: lower-alpha">
<li>Create a binary outcome <code>mpg01</code>.</li>
</ol>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="classification.html#cb323-1" aria-hidden="true" tabindex="-1"></a>auto <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Auto <span class="sc">%&gt;%</span></span>
<span id="cb323-2"><a href="classification.html#cb323-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mpg01 =</span> <span class="fu">ifelse</span>(mpg <span class="sc">&gt;</span> <span class="fu">median</span>(mpg), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb323-3"><a href="classification.html#cb323-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">mpg01 =</span> <span class="fu">factor</span>(mpg01))</span>
<span id="cb323-4"><a href="classification.html#cb323-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(auto)</span></code></pre></div>
<pre><code>## Rows: 392
## Columns: 10
## $ mpg          &lt;dbl&gt; 18, 15, 18, 16, 17, 15, 14, 14, 14, 15, 15, 14, 15, 14, 2…
## $ cylinders    &lt;int&gt; 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 4, 6, 6, 6, 4, …
## $ displacement &lt;dbl&gt; 307, 350, 318, 304, 302, 429, 454, 440, 455, 390, 383, 34…
## $ horsepower   &lt;int&gt; 130, 165, 150, 150, 140, 198, 220, 215, 225, 190, 170, 16…
## $ weight       &lt;int&gt; 3504, 3693, 3436, 3433, 3449, 4341, 4354, 4312, 4425, 385…
## $ acceleration &lt;dbl&gt; 12.0, 11.5, 11.0, 12.0, 10.5, 10.0, 9.0, 8.5, 10.0, 8.5, …
## $ year         &lt;int&gt; 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 7…
## $ origin       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 1, 1, 3, …
## $ name         &lt;fct&gt; chevrolet chevelle malibu, buick skylark 320, plymouth sa…
## $ mpg01        &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, …</code></pre>
<p>Note that <code>origin</code> is a numeric coding for 1. American, 2. European, and 3. Japanese, and so should be a factor:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="classification.html#cb325-1" aria-hidden="true" tabindex="-1"></a>auto <span class="ot">&lt;-</span> auto <span class="sc">%&gt;%</span></span>
<span id="cb325-2"><a href="classification.html#cb325-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origin =</span> <span class="fu">factor</span>(origin, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb325-3"><a href="classification.html#cb325-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;American&quot;</span>, <span class="st">&quot;European&quot;</span>, <span class="st">&quot;Japanese&quot;</span>)))</span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Explore the data.</li>
</ol>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="classification.html#cb326-1" aria-hidden="true" tabindex="-1"></a>auto <span class="sc">%&gt;%</span></span>
<span id="cb326-2"><a href="classification.html#cb326-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name, <span class="sc">-</span>origin, <span class="sc">-</span>mpg) <span class="sc">%&gt;%</span></span>
<span id="cb326-3"><a href="classification.html#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>mpg01, <span class="at">names_to =</span> <span class="st">&quot;var&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;val&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb326-4"><a href="classification.html#cb326-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> mpg01, <span class="at">x =</span> val)) <span class="sc">+</span></span>
<span id="cb326-5"><a href="classification.html#cb326-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(mpg01))) <span class="sc">+</span></span>
<span id="cb326-6"><a href="classification.html#cb326-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>var, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb326-7"><a href="classification.html#cb326-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb326-8"><a href="classification.html#cb326-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_facet_borders</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-179-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="classification.html#cb327-1" aria-hidden="true" tabindex="-1"></a>auto <span class="sc">%&gt;%</span></span>
<span id="cb327-2"><a href="classification.html#cb327-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(origin, mpg01) <span class="sc">%&gt;%</span></span>
<span id="cb327-3"><a href="classification.html#cb327-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> origin, <span class="at">x =</span> mpg01)) <span class="sc">+</span></span>
<span id="cb327-4"><a href="classification.html#cb327-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> n)) <span class="sc">+</span></span>
<span id="cb327-5"><a href="classification.html#cb327-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb327-6"><a href="classification.html#cb327-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb327-7"><a href="classification.html#cb327-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb327-8"><a href="classification.html#cb327-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-180-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>All of the variables here look useful for predicting <code>mpg01</code>, but <code>cylinders</code>, <code>displacement</code>, <code>origin</code>, and <code>weight</code> in particular.</p>
<p>Look at the correlation between variables:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="classification.html#cb328-1" aria-hidden="true" tabindex="-1"></a>auto <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>name, <span class="sc">-</span>mpg01, <span class="sc">-</span>origin) <span class="sc">%&gt;%</span></span>
<span id="cb328-2"><a href="classification.html#cb328-2" aria-hidden="true" tabindex="-1"></a>  corrr<span class="sc">::</span><span class="fu">correlate</span>(<span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb328-3"><a href="classification.html#cb328-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">&quot;term&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb328-4"><a href="classification.html#cb328-4" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">fmt_missing</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">missing_text =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb328-5"><a href="classification.html#cb328-5" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">data_color</span>(</span>
<span id="cb328-6"><a href="classification.html#cb328-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">everything</span>(),</span>
<span id="cb328-7"><a href="classification.html#cb328-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> scales<span class="sc">::</span><span class="fu">col_numeric</span>(</span>
<span id="cb328-8"><a href="classification.html#cb328-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">palette =</span> <span class="fu">td_pal</span>(<span class="st">&quot;div5&quot;</span>)(<span class="dv">5</span>),</span>
<span id="cb328-9"><a href="classification.html#cb328-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">domain =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb328-10"><a href="classification.html#cb328-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb328-11"><a href="classification.html#cb328-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb328-12"><a href="classification.html#cb328-12" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">decimals =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Warning: The `fmt_missing()` function is deprecated and will soon be removed
## * Use the `sub_missing()` function instead</code></pre>
<div id="gqyndzjxvq" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#gqyndzjxvq .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gqyndzjxvq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gqyndzjxvq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gqyndzjxvq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gqyndzjxvq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gqyndzjxvq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gqyndzjxvq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gqyndzjxvq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gqyndzjxvq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gqyndzjxvq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gqyndzjxvq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gqyndzjxvq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#gqyndzjxvq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gqyndzjxvq .gt_from_md > :first-child {
  margin-top: 0;
}

#gqyndzjxvq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gqyndzjxvq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gqyndzjxvq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gqyndzjxvq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gqyndzjxvq .gt_row_group_first td {
  border-top-width: 2px;
}

#gqyndzjxvq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gqyndzjxvq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gqyndzjxvq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gqyndzjxvq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gqyndzjxvq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gqyndzjxvq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gqyndzjxvq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gqyndzjxvq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gqyndzjxvq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gqyndzjxvq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gqyndzjxvq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gqyndzjxvq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gqyndzjxvq .gt_left {
  text-align: left;
}

#gqyndzjxvq .gt_center {
  text-align: center;
}

#gqyndzjxvq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gqyndzjxvq .gt_font_normal {
  font-weight: normal;
}

#gqyndzjxvq .gt_font_bold {
  font-weight: bold;
}

#gqyndzjxvq .gt_font_italic {
  font-style: italic;
}

#gqyndzjxvq .gt_super {
  font-size: 65%;
}

#gqyndzjxvq .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#gqyndzjxvq .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#gqyndzjxvq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gqyndzjxvq .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#gqyndzjxvq .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#gqyndzjxvq .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mpg</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">cylinders</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">displacement</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">horsepower</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">weight</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">acceleration</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">year</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right gt_stub">mpg</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #076285; color: #FFFFFF;">&minus;0.78</td>
<td class="gt_row gt_right" style="background-color: #065F82; color: #FFFFFF;">&minus;0.81</td>
<td class="gt_row gt_right" style="background-color: #076285; color: #FFFFFF;">&minus;0.78</td>
<td class="gt_row gt_right" style="background-color: #065B7F; color: #FFFFFF;">&minus;0.83</td>
<td class="gt_row gt_right" style="background-color: #EE9610; color: #000000;">0.42</td>
<td class="gt_row gt_right" style="background-color: #EB800C; color: #000000;">0.58</td></tr>
    <tr><td class="gt_row gt_right gt_stub">cylinders</td>
<td class="gt_row gt_right" style="background-color: #076285; color: #FFFFFF;">&minus;0.78</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #DF4A23; color: #FFFFFF;">0.95</td>
<td class="gt_row gt_right" style="background-color: #E35B1F; color: #FFFFFF;">0.84</td>
<td class="gt_row gt_right" style="background-color: #E15322; color: #FFFFFF;">0.90</td>
<td class="gt_row gt_right" style="background-color: #0F83A1; color: #FFFFFF;">&minus;0.50</td>
<td class="gt_row gt_right" style="background-color: #7A9C8B; color: #000000;">&minus;0.35</td></tr>
    <tr><td class="gt_row gt_right gt_stub">displacement</td>
<td class="gt_row gt_right" style="background-color: #065F82; color: #FFFFFF;">&minus;0.81</td>
<td class="gt_row gt_right" style="background-color: #DF4A23; color: #FFFFFF;">0.95</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #E15322; color: #FFFFFF;">0.90</td>
<td class="gt_row gt_right" style="background-color: #DF4D23; color: #FFFFFF;">0.93</td>
<td class="gt_row gt_right" style="background-color: #0E7F9D; color: #FFFFFF;">&minus;0.54</td>
<td class="gt_row gt_right" style="background-color: #70988E; color: #000000;">&minus;0.37</td></tr>
    <tr><td class="gt_row gt_right gt_stub">horsepower</td>
<td class="gt_row gt_right" style="background-color: #076285; color: #FFFFFF;">&minus;0.78</td>
<td class="gt_row gt_right" style="background-color: #E35B1F; color: #FFFFFF;">0.84</td>
<td class="gt_row gt_right" style="background-color: #E15322; color: #FFFFFF;">0.90</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #E25820; color: #FFFFFF;">0.86</td>
<td class="gt_row gt_right" style="background-color: #0A6D8E; color: #FFFFFF;">&minus;0.69</td>
<td class="gt_row gt_right" style="background-color: #5A9195; color: #000000;">&minus;0.42</td></tr>
    <tr><td class="gt_row gt_right gt_stub">weight</td>
<td class="gt_row gt_right" style="background-color: #065B7F; color: #FFFFFF;">&minus;0.83</td>
<td class="gt_row gt_right" style="background-color: #E15322; color: #FFFFFF;">0.90</td>
<td class="gt_row gt_right" style="background-color: #DF4D23; color: #FFFFFF;">0.93</td>
<td class="gt_row gt_right" style="background-color: #E25820; color: #FFFFFF;">0.86</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #5A9195; color: #000000;">&minus;0.42</td>
<td class="gt_row gt_right" style="background-color: #89A285; color: #000000;">&minus;0.31</td></tr>
    <tr><td class="gt_row gt_right gt_stub">acceleration</td>
<td class="gt_row gt_right" style="background-color: #EE9610; color: #000000;">0.42</td>
<td class="gt_row gt_right" style="background-color: #0F83A1; color: #FFFFFF;">&minus;0.50</td>
<td class="gt_row gt_right" style="background-color: #0E7F9D; color: #FFFFFF;">&minus;0.54</td>
<td class="gt_row gt_right" style="background-color: #0A6D8E; color: #FFFFFF;">&minus;0.69</td>
<td class="gt_row gt_right" style="background-color: #5A9195; color: #000000;">&minus;0.42</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td>
<td class="gt_row gt_right" style="background-color: #EFAB24; color: #000000;">0.29</td></tr>
    <tr><td class="gt_row gt_right gt_stub">year</td>
<td class="gt_row gt_right" style="background-color: #EB800C; color: #000000;">0.58</td>
<td class="gt_row gt_right" style="background-color: #7A9C8B; color: #000000;">&minus;0.35</td>
<td class="gt_row gt_right" style="background-color: #70988E; color: #000000;">&minus;0.37</td>
<td class="gt_row gt_right" style="background-color: #5A9195; color: #000000;">&minus;0.42</td>
<td class="gt_row gt_right" style="background-color: #89A285; color: #000000;">&minus;0.31</td>
<td class="gt_row gt_right" style="background-color: #EFAB24; color: #000000;">0.29</td>
<td class="gt_row gt_right" style="background-color: #808080; color: #000000;"></td></tr>
  </tbody>
  
  
</table>
</div>
<p>Lots of inter-correlation.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Split the data into a training set and test set.</li>
</ol>
<p>Use a 3:1 split:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="classification.html#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">49</span>)</span>
<span id="cb330-2"><a href="classification.html#cb330-2" aria-hidden="true" tabindex="-1"></a>auto_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(auto, <span class="at">prop =</span> <span class="dv">3</span> <span class="sc">/</span> <span class="dv">4</span>)</span>
<span id="cb330-3"><a href="classification.html#cb330-3" aria-hidden="true" tabindex="-1"></a>auto_train <span class="ot">&lt;-</span> <span class="fu">training</span>(auto_split)</span>
<span id="cb330-4"><a href="classification.html#cb330-4" aria-hidden="true" tabindex="-1"></a>auto_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(auto_split)</span></code></pre></div>
<p>Normally, I would set the <code>strata</code> argument to the output variable <code>mpg01</code>, but by construction (separated by the median) the data is split in half.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="classification.html#cb331-1" aria-hidden="true" tabindex="-1"></a>auto_train <span class="sc">%&gt;%</span> <span class="fu">count</span>(mpg01)</span></code></pre></div>
<pre><code>##   mpg01   n
## 1     0 148
## 2     1 146</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="classification.html#cb333-1" aria-hidden="true" tabindex="-1"></a>auto_test <span class="sc">%&gt;%</span> <span class="fu">count</span>(mpg01)</span></code></pre></div>
<pre><code>##   mpg01  n
## 1     0 48
## 2     1 50</code></pre>
<p>(d-h) Perform LDA, QDA, logistic regression, naive Bayes, and KNN.</p>
<p>Define the <code>recipe</code>, and add it to a generic <code>workflow</code>:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="classification.html#cb335-1" aria-hidden="true" tabindex="-1"></a>auto_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb335-2"><a href="classification.html#cb335-2" aria-hidden="true" tabindex="-1"></a>  mpg01 <span class="sc">~</span> cylinders <span class="sc">+</span> displacement <span class="sc">+</span> horsepower <span class="sc">+</span> weight <span class="sc">+</span> acceleration <span class="sc">+</span></span>
<span id="cb335-3"><a href="classification.html#cb335-3" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">+</span> origin,</span>
<span id="cb335-4"><a href="classification.html#cb335-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> auto_train</span>
<span id="cb335-5"><a href="classification.html#cb335-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb335-6"><a href="classification.html#cb335-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize numerical predictors to work with KNN</span></span>
<span id="cb335-7"><a href="classification.html#cb335-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb335-8"><a href="classification.html#cb335-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(origin)</span>
<span id="cb335-9"><a href="classification.html#cb335-9" aria-hidden="true" tabindex="-1"></a>auto_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb335-10"><a href="classification.html#cb335-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(auto_recipe)</span></code></pre></div>
<p>Fit and summarize metrics:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="classification.html#cb336-1" aria-hidden="true" tabindex="-1"></a>model_fits <span class="ot">&lt;-</span></span>
<span id="cb336-2"><a href="classification.html#cb336-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb336-3"><a href="classification.html#cb336-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;LDA&quot;</span> <span class="ot">=</span> auto_workflow <span class="sc">%&gt;%</span></span>
<span id="cb336-4"><a href="classification.html#cb336-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_model</span>(<span class="fu">discrim_linear</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb336-5"><a href="classification.html#cb336-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fit</span>(<span class="at">data =</span> auto_train),</span>
<span id="cb336-6"><a href="classification.html#cb336-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;QDA&quot;</span> <span class="ot">=</span> auto_workflow <span class="sc">%&gt;%</span></span>
<span id="cb336-7"><a href="classification.html#cb336-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_model</span>(<span class="fu">discrim_quad</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb336-8"><a href="classification.html#cb336-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fit</span>(<span class="at">data =</span> auto_train),</span>
<span id="cb336-9"><a href="classification.html#cb336-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;logistic&quot;</span> <span class="ot">=</span> auto_workflow <span class="sc">%&gt;%</span></span>
<span id="cb336-10"><a href="classification.html#cb336-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_model</span>(<span class="fu">logistic_reg</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb336-11"><a href="classification.html#cb336-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fit</span>(<span class="at">data =</span> auto_train),</span>
<span id="cb336-12"><a href="classification.html#cb336-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;NB&quot;</span> <span class="ot">=</span> auto_workflow <span class="sc">%&gt;%</span></span>
<span id="cb336-13"><a href="classification.html#cb336-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_model</span>(<span class="fu">naive_Bayes</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb336-14"><a href="classification.html#cb336-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fit</span>(<span class="at">data =</span> auto_train),</span>
<span id="cb336-15"><a href="classification.html#cb336-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;KNN1&quot;</span> <span class="ot">=</span> auto_workflow <span class="sc">%&gt;%</span></span>
<span id="cb336-16"><a href="classification.html#cb336-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_model</span>(<span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">neighbors =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb336-17"><a href="classification.html#cb336-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fit</span>(<span class="at">data =</span> auto_train),</span>
<span id="cb336-18"><a href="classification.html#cb336-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;KNN3&quot;</span> <span class="ot">=</span> auto_workflow <span class="sc">%&gt;%</span></span>
<span id="cb336-19"><a href="classification.html#cb336-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_model</span>(<span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">neighbors =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb336-20"><a href="classification.html#cb336-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fit</span>(<span class="at">data =</span> auto_train),</span>
<span id="cb336-21"><a href="classification.html#cb336-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;KNN5&quot;</span> <span class="ot">=</span> auto_workflow <span class="sc">%&gt;%</span></span>
<span id="cb336-22"><a href="classification.html#cb336-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_model</span>(<span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">neighbors =</span> <span class="dv">5</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb336-23"><a href="classification.html#cb336-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fit</span>(<span class="at">data =</span> auto_train),</span>
<span id="cb336-24"><a href="classification.html#cb336-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;KNN7&quot;</span> <span class="ot">=</span> auto_workflow <span class="sc">%&gt;%</span></span>
<span id="cb336-25"><a href="classification.html#cb336-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_model</span>(<span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">neighbors =</span> <span class="dv">7</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb336-26"><a href="classification.html#cb336-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fit</span>(<span class="at">data =</span> auto_train)</span>
<span id="cb336-27"><a href="classification.html#cb336-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb336-28"><a href="classification.html#cb336-28" aria-hidden="true" tabindex="-1"></a>auto_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(accuracy, sens, spec, ppv)</span>
<span id="cb336-29"><a href="classification.html#cb336-29" aria-hidden="true" tabindex="-1"></a><span class="fu">imap_dfr</span>(</span>
<span id="cb336-30"><a href="classification.html#cb336-30" aria-hidden="true" tabindex="-1"></a>  model_fits,</span>
<span id="cb336-31"><a href="classification.html#cb336-31" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span><span class="fu">augment</span>(.x, <span class="at">new_data =</span> auto_test) <span class="sc">%&gt;%</span></span>
<span id="cb336-32"><a href="classification.html#cb336-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">auto_metrics</span>(<span class="at">truth =</span> mpg01, <span class="at">estimate =</span> .pred_class),</span>
<span id="cb336-33"><a href="classification.html#cb336-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">.id =</span> <span class="st">&quot;model&quot;</span></span>
<span id="cb336-34"><a href="classification.html#cb336-34" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb336-35"><a href="classification.html#cb336-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, .metric, .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb336-36"><a href="classification.html#cb336-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .metric, <span class="at">values_from =</span> .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb336-37"><a href="classification.html#cb336-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(accuracy)) <span class="sc">%&gt;%</span></span>
<span id="cb336-38"><a href="classification.html#cb336-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">&quot;model&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb336-39"><a href="classification.html#cb336-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> <span class="sc">-</span>model, <span class="at">decimals =</span> <span class="dv">1</span>)</span></code></pre></div>
<div id="bljlvhvupr" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#bljlvhvupr .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bljlvhvupr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bljlvhvupr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bljlvhvupr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bljlvhvupr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bljlvhvupr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bljlvhvupr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bljlvhvupr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bljlvhvupr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bljlvhvupr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bljlvhvupr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bljlvhvupr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#bljlvhvupr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bljlvhvupr .gt_from_md > :first-child {
  margin-top: 0;
}

#bljlvhvupr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bljlvhvupr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bljlvhvupr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#bljlvhvupr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#bljlvhvupr .gt_row_group_first td {
  border-top-width: 2px;
}

#bljlvhvupr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bljlvhvupr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#bljlvhvupr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#bljlvhvupr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bljlvhvupr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bljlvhvupr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bljlvhvupr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bljlvhvupr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bljlvhvupr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bljlvhvupr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bljlvhvupr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bljlvhvupr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bljlvhvupr .gt_left {
  text-align: left;
}

#bljlvhvupr .gt_center {
  text-align: center;
}

#bljlvhvupr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bljlvhvupr .gt_font_normal {
  font-weight: normal;
}

#bljlvhvupr .gt_font_bold {
  font-weight: bold;
}

#bljlvhvupr .gt_font_italic {
  font-style: italic;
}

#bljlvhvupr .gt_super {
  font-size: 65%;
}

#bljlvhvupr .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#bljlvhvupr .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#bljlvhvupr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#bljlvhvupr .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#bljlvhvupr .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#bljlvhvupr .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">accuracy</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">sens</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">spec</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">ppv</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right gt_stub">LDA</td>
<td class="gt_row gt_right">90.8%</td>
<td class="gt_row gt_right">87.5%</td>
<td class="gt_row gt_right">94.0%</td>
<td class="gt_row gt_right">93.3%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">logistic</td>
<td class="gt_row gt_right">90.8%</td>
<td class="gt_row gt_right">91.7%</td>
<td class="gt_row gt_right">90.0%</td>
<td class="gt_row gt_right">89.8%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">QDA</td>
<td class="gt_row gt_right">89.8%</td>
<td class="gt_row gt_right">85.4%</td>
<td class="gt_row gt_right">94.0%</td>
<td class="gt_row gt_right">93.2%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">NB</td>
<td class="gt_row gt_right">89.8%</td>
<td class="gt_row gt_right">87.5%</td>
<td class="gt_row gt_right">92.0%</td>
<td class="gt_row gt_right">91.3%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN1</td>
<td class="gt_row gt_right">89.8%</td>
<td class="gt_row gt_right">93.8%</td>
<td class="gt_row gt_right">86.0%</td>
<td class="gt_row gt_right">86.5%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN3</td>
<td class="gt_row gt_right">89.8%</td>
<td class="gt_row gt_right">93.8%</td>
<td class="gt_row gt_right">86.0%</td>
<td class="gt_row gt_right">86.5%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN5</td>
<td class="gt_row gt_right">89.8%</td>
<td class="gt_row gt_right">91.7%</td>
<td class="gt_row gt_right">88.0%</td>
<td class="gt_row gt_right">88.0%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN7</td>
<td class="gt_row gt_right">89.8%</td>
<td class="gt_row gt_right">91.7%</td>
<td class="gt_row gt_right">88.0%</td>
<td class="gt_row gt_right">88.0%</td></tr>
  </tbody>
  
  
</table>
</div>
<p>All models did well, but LDA and logistic regression were the best.
There wasn’t any difference in KNN accuracy for <span class="math inline">\(K\)</span> = 1, 3, 5, and 7.</p>
</div>
<div id="predict-crime-rate-with-boston" class="section level4 unnumbered hasAnchor">
<h4>16. Predict crime rate with <code>Boston</code><a href="classification.html#predict-crime-rate-with-boston" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="classification.html#cb337-1" aria-hidden="true" tabindex="-1"></a>boston <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Boston <span class="sc">%&gt;%</span></span>
<span id="cb337-2"><a href="classification.html#cb337-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb337-3"><a href="classification.html#cb337-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">crim01 =</span> <span class="fu">ifelse</span>(crim <span class="sc">&gt;</span> <span class="fu">median</span>(crim), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb337-4"><a href="classification.html#cb337-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">crim01 =</span> <span class="fu">factor</span>(crim01),</span>
<span id="cb337-5"><a href="classification.html#cb337-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the binary chas variable to TRUE/FALSE</span></span>
<span id="cb337-6"><a href="classification.html#cb337-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">chas =</span> chas <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb337-7"><a href="classification.html#cb337-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb337-8"><a href="classification.html#cb337-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(boston)</span></code></pre></div>
<pre><code>## Rows: 506
## Columns: 14
## $ crim    &lt;dbl&gt; 0.00632, 0.02731, 0.02729, 0.03237, 0.06905, 0.02985, 0.08829,…
## $ zn      &lt;dbl&gt; 18.0, 0.0, 0.0, 0.0, 0.0, 0.0, 12.5, 12.5, 12.5, 12.5, 12.5, 1…
## $ indus   &lt;dbl&gt; 2.31, 7.07, 7.07, 2.18, 2.18, 2.18, 7.87, 7.87, 7.87, 7.87, 7.…
## $ chas    &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE,…
## $ nox     &lt;dbl&gt; 0.538, 0.469, 0.469, 0.458, 0.458, 0.458, 0.524, 0.524, 0.524,…
## $ rm      &lt;dbl&gt; 6.575, 6.421, 7.185, 6.998, 7.147, 6.430, 6.012, 6.172, 5.631,…
## $ age     &lt;dbl&gt; 65.2, 78.9, 61.1, 45.8, 54.2, 58.7, 66.6, 96.1, 100.0, 85.9, 9…
## $ dis     &lt;dbl&gt; 4.0900, 4.9671, 4.9671, 6.0622, 6.0622, 6.0622, 5.5605, 5.9505…
## $ rad     &lt;int&gt; 1, 2, 2, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 4,…
## $ tax     &lt;dbl&gt; 296, 242, 242, 222, 222, 222, 311, 311, 311, 311, 311, 311, 31…
## $ ptratio &lt;dbl&gt; 15.3, 17.8, 17.8, 18.7, 18.7, 18.7, 15.2, 15.2, 15.2, 15.2, 15…
## $ lstat   &lt;dbl&gt; 4.98, 9.14, 4.03, 2.94, 5.33, 5.21, 12.43, 19.15, 29.93, 17.10…
## $ medv    &lt;dbl&gt; 24.0, 21.6, 34.7, 33.4, 36.2, 28.7, 22.9, 27.1, 16.5, 18.9, 15…
## $ crim01  &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1,…</code></pre>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="classification.html#cb339-1" aria-hidden="true" tabindex="-1"></a>boston <span class="sc">%&gt;%</span></span>
<span id="cb339-2"><a href="classification.html#cb339-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>chas) <span class="sc">%&gt;%</span></span>
<span id="cb339-3"><a href="classification.html#cb339-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>crim01, <span class="at">names_to =</span> <span class="st">&quot;var&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;val&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb339-4"><a href="classification.html#cb339-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> crim01, <span class="at">x =</span> val)) <span class="sc">+</span></span>
<span id="cb339-5"><a href="classification.html#cb339-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(crim01))) <span class="sc">+</span></span>
<span id="cb339-6"><a href="classification.html#cb339-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>var, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb339-7"><a href="classification.html#cb339-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb339-8"><a href="classification.html#cb339-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_facet_borders</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-187-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="classification.html#cb340-1" aria-hidden="true" tabindex="-1"></a>boston <span class="sc">%&gt;%</span></span>
<span id="cb340-2"><a href="classification.html#cb340-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(chas, crim01) <span class="sc">%&gt;%</span></span>
<span id="cb340-3"><a href="classification.html#cb340-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> chas, <span class="at">x =</span> crim01)) <span class="sc">+</span></span>
<span id="cb340-4"><a href="classification.html#cb340-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> n)) <span class="sc">+</span></span>
<span id="cb340-5"><a href="classification.html#cb340-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb340-6"><a href="classification.html#cb340-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb340-7"><a href="classification.html#cb340-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb340-8"><a href="classification.html#cb340-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-188-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>The <code>chas</code> and <code>rm</code> (average number of rooms per dwelling) variables look the least useful of these predictors.
Split the data:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="classification.html#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">98</span>)</span>
<span id="cb341-2"><a href="classification.html#cb341-2" aria-hidden="true" tabindex="-1"></a><span class="co"># By default, splits 3:1</span></span>
<span id="cb341-3"><a href="classification.html#cb341-3" aria-hidden="true" tabindex="-1"></a>boston_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(boston)</span>
<span id="cb341-4"><a href="classification.html#cb341-4" aria-hidden="true" tabindex="-1"></a>boston_train <span class="ot">&lt;-</span> <span class="fu">training</span>(boston_split)</span>
<span id="cb341-5"><a href="classification.html#cb341-5" aria-hidden="true" tabindex="-1"></a>boston_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(boston_split)</span></code></pre></div>
<p>Fit and summarize metrics for all the models and a few different predictor sets:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="classification.html#cb342-1" aria-hidden="true" tabindex="-1"></a>boston_models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb342-2"><a href="classification.html#cb342-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;LDA&quot;</span> <span class="ot">=</span> <span class="fu">discrim_linear</span>(),</span>
<span id="cb342-3"><a href="classification.html#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;QDA&quot;</span> <span class="ot">=</span> <span class="fu">discrim_quad</span>(),</span>
<span id="cb342-4"><a href="classification.html#cb342-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;logistic&quot;</span> <span class="ot">=</span> <span class="fu">logistic_reg</span>(),</span>
<span id="cb342-5"><a href="classification.html#cb342-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;NB&quot;</span> <span class="ot">=</span> <span class="fu">naive_Bayes</span>(),</span>
<span id="cb342-6"><a href="classification.html#cb342-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;KNN1&quot;</span> <span class="ot">=</span> <span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">neighbors =</span> <span class="dv">1</span>),</span>
<span id="cb342-7"><a href="classification.html#cb342-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;KNN3&quot;</span> <span class="ot">=</span> <span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">neighbors =</span> <span class="dv">3</span>),</span>
<span id="cb342-8"><a href="classification.html#cb342-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;KNN5&quot;</span> <span class="ot">=</span> <span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">neighbors =</span> <span class="dv">5</span>),</span>
<span id="cb342-9"><a href="classification.html#cb342-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;KNN7&quot;</span> <span class="ot">=</span> <span class="fu">nearest_neighbor</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">neighbors =</span> <span class="dv">7</span>)</span>
<span id="cb342-10"><a href="classification.html#cb342-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb342-11"><a href="classification.html#cb342-11" aria-hidden="true" tabindex="-1"></a>boston_recs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb342-12"><a href="classification.html#cb342-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;rec1&quot;</span> <span class="ot">=</span> <span class="fu">recipe</span>(</span>
<span id="cb342-13"><a href="classification.html#cb342-13" aria-hidden="true" tabindex="-1"></a>    crim01 <span class="sc">~</span> age <span class="sc">+</span> dis <span class="sc">+</span> indus <span class="sc">+</span> lstat <span class="sc">+</span> medv <span class="sc">+</span> nox <span class="sc">+</span> ptratio <span class="sc">+</span> rad <span class="sc">+</span> tax <span class="sc">+</span> zn,</span>
<span id="cb342-14"><a href="classification.html#cb342-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> boston_train</span>
<span id="cb342-15"><a href="classification.html#cb342-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb342-16"><a href="classification.html#cb342-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()),</span>
<span id="cb342-17"><a href="classification.html#cb342-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop medv and lstat</span></span>
<span id="cb342-18"><a href="classification.html#cb342-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;rec2&quot;</span> <span class="ot">=</span> <span class="fu">recipe</span>(</span>
<span id="cb342-19"><a href="classification.html#cb342-19" aria-hidden="true" tabindex="-1"></a>    crim01 <span class="sc">~</span> age <span class="sc">+</span> dis <span class="sc">+</span> indus <span class="sc">+</span> nox <span class="sc">+</span> ptratio <span class="sc">+</span> rad <span class="sc">+</span> tax <span class="sc">+</span> zn,</span>
<span id="cb342-20"><a href="classification.html#cb342-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> boston_train</span>
<span id="cb342-21"><a href="classification.html#cb342-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb342-22"><a href="classification.html#cb342-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()),</span>
<span id="cb342-23"><a href="classification.html#cb342-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop ptratio and tax</span></span>
<span id="cb342-24"><a href="classification.html#cb342-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;rec3&quot;</span> <span class="ot">=</span> <span class="fu">recipe</span>(</span>
<span id="cb342-25"><a href="classification.html#cb342-25" aria-hidden="true" tabindex="-1"></a>    crim01 <span class="sc">~</span> age <span class="sc">+</span> dis <span class="sc">+</span> indus <span class="sc">+</span> nox  <span class="sc">+</span> rad <span class="sc">+</span> zn,</span>
<span id="cb342-26"><a href="classification.html#cb342-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> boston_train</span>
<span id="cb342-27"><a href="classification.html#cb342-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb342-28"><a href="classification.html#cb342-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb342-29"><a href="classification.html#cb342-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb342-30"><a href="classification.html#cb342-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-31"><a href="classification.html#cb342-31" aria-hidden="true" tabindex="-1"></a>boston_fits <span class="ot">&lt;-</span></span>
<span id="cb342-32"><a href="classification.html#cb342-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(</span>
<span id="cb342-33"><a href="classification.html#cb342-33" aria-hidden="true" tabindex="-1"></a>    boston_models,</span>
<span id="cb342-34"><a href="classification.html#cb342-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(model) {</span>
<span id="cb342-35"><a href="classification.html#cb342-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map</span>(</span>
<span id="cb342-36"><a href="classification.html#cb342-36" aria-hidden="true" tabindex="-1"></a>        boston_recs,</span>
<span id="cb342-37"><a href="classification.html#cb342-37" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb342-38"><a href="classification.html#cb342-38" aria-hidden="true" tabindex="-1"></a>          <span class="fu">add_model</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb342-39"><a href="classification.html#cb342-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">add_recipe</span>(.x) <span class="sc">%&gt;%</span></span>
<span id="cb342-40"><a href="classification.html#cb342-40" aria-hidden="true" tabindex="-1"></a>          <span class="fu">fit</span>(<span class="at">data =</span> boston_train)</span>
<span id="cb342-41"><a href="classification.html#cb342-41" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb342-42"><a href="classification.html#cb342-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb342-43"><a href="classification.html#cb342-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb342-44"><a href="classification.html#cb342-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-45"><a href="classification.html#cb342-45" aria-hidden="true" tabindex="-1"></a>boston_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(accuracy, sens, spec, ppv)</span>
<span id="cb342-46"><a href="classification.html#cb342-46" aria-hidden="true" tabindex="-1"></a><span class="fu">imap_dfr</span>(</span>
<span id="cb342-47"><a href="classification.html#cb342-47" aria-hidden="true" tabindex="-1"></a>  boston_fits,</span>
<span id="cb342-48"><a href="classification.html#cb342-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(fit, y) {</span>
<span id="cb342-49"><a href="classification.html#cb342-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">imap_dfr</span>(</span>
<span id="cb342-50"><a href="classification.html#cb342-50" aria-hidden="true" tabindex="-1"></a>      fit,</span>
<span id="cb342-51"><a href="classification.html#cb342-51" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">augment</span>(.x, <span class="at">new_data =</span> boston_test) <span class="sc">%&gt;%</span></span>
<span id="cb342-52"><a href="classification.html#cb342-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">boston_metrics</span>(<span class="at">truth =</span> crim01, <span class="at">estimate =</span> .pred_class),</span>
<span id="cb342-53"><a href="classification.html#cb342-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">.id =</span> <span class="st">&quot;recipe&quot;</span></span>
<span id="cb342-54"><a href="classification.html#cb342-54" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb342-55"><a href="classification.html#cb342-55" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb342-56"><a href="classification.html#cb342-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">.id =</span> <span class="st">&quot;model&quot;</span></span>
<span id="cb342-57"><a href="classification.html#cb342-57" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb342-58"><a href="classification.html#cb342-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, recipe, .metric, .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb342-59"><a href="classification.html#cb342-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .metric, <span class="at">values_from =</span> .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb342-60"><a href="classification.html#cb342-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(recipe, <span class="fu">desc</span>(accuracy)) <span class="sc">%&gt;%</span></span>
<span id="cb342-61"><a href="classification.html#cb342-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(recipe) <span class="sc">%&gt;%</span></span>
<span id="cb342-62"><a href="classification.html#cb342-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">&quot;model&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb342-63"><a href="classification.html#cb342-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> <span class="sc">-</span>model, <span class="at">decimals =</span> <span class="dv">1</span>)</span></code></pre></div>
<div id="wbsyrjdeoz" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wbsyrjdeoz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wbsyrjdeoz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wbsyrjdeoz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wbsyrjdeoz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wbsyrjdeoz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbsyrjdeoz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wbsyrjdeoz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wbsyrjdeoz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wbsyrjdeoz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wbsyrjdeoz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wbsyrjdeoz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wbsyrjdeoz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wbsyrjdeoz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wbsyrjdeoz .gt_from_md > :first-child {
  margin-top: 0;
}

#wbsyrjdeoz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wbsyrjdeoz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wbsyrjdeoz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wbsyrjdeoz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wbsyrjdeoz .gt_row_group_first td {
  border-top-width: 2px;
}

#wbsyrjdeoz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbsyrjdeoz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wbsyrjdeoz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wbsyrjdeoz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbsyrjdeoz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbsyrjdeoz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wbsyrjdeoz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wbsyrjdeoz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbsyrjdeoz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wbsyrjdeoz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbsyrjdeoz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wbsyrjdeoz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbsyrjdeoz .gt_left {
  text-align: left;
}

#wbsyrjdeoz .gt_center {
  text-align: center;
}

#wbsyrjdeoz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wbsyrjdeoz .gt_font_normal {
  font-weight: normal;
}

#wbsyrjdeoz .gt_font_bold {
  font-weight: bold;
}

#wbsyrjdeoz .gt_font_italic {
  font-style: italic;
}

#wbsyrjdeoz .gt_super {
  font-size: 65%;
}

#wbsyrjdeoz .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#wbsyrjdeoz .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#wbsyrjdeoz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wbsyrjdeoz .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#wbsyrjdeoz .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#wbsyrjdeoz .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">accuracy</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">sens</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">spec</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">ppv</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <td colspan="5" class="gt_group_heading">rec1</td>
    </tr>
    <tr class="gt_row_group_first"><td class="gt_row gt_right gt_stub">QDA</td>
<td class="gt_row gt_right">95.3%</td>
<td class="gt_row gt_right">94.6%</td>
<td class="gt_row gt_right">95.8%</td>
<td class="gt_row gt_right">94.6%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN1</td>
<td class="gt_row gt_right">94.5%</td>
<td class="gt_row gt_right">98.2%</td>
<td class="gt_row gt_right">91.5%</td>
<td class="gt_row gt_right">90.2%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN3</td>
<td class="gt_row gt_right">94.5%</td>
<td class="gt_row gt_right">98.2%</td>
<td class="gt_row gt_right">91.5%</td>
<td class="gt_row gt_right">90.2%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN5</td>
<td class="gt_row gt_right">94.5%</td>
<td class="gt_row gt_right">98.2%</td>
<td class="gt_row gt_right">91.5%</td>
<td class="gt_row gt_right">90.2%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN7</td>
<td class="gt_row gt_right">94.5%</td>
<td class="gt_row gt_right">98.2%</td>
<td class="gt_row gt_right">91.5%</td>
<td class="gt_row gt_right">90.2%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">logistic</td>
<td class="gt_row gt_right">92.1%</td>
<td class="gt_row gt_right">98.2%</td>
<td class="gt_row gt_right">87.3%</td>
<td class="gt_row gt_right">85.9%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">NB</td>
<td class="gt_row gt_right">85.0%</td>
<td class="gt_row gt_right">80.4%</td>
<td class="gt_row gt_right">88.7%</td>
<td class="gt_row gt_right">84.9%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">LDA</td>
<td class="gt_row gt_right">83.5%</td>
<td class="gt_row gt_right">91.1%</td>
<td class="gt_row gt_right">77.5%</td>
<td class="gt_row gt_right">76.1%</td></tr>
    <tr class="gt_group_heading_row">
      <td colspan="5" class="gt_group_heading">rec2</td>
    </tr>
    <tr class="gt_row_group_first"><td class="gt_row gt_right gt_stub">KNN5</td>
<td class="gt_row gt_right">96.1%</td>
<td class="gt_row gt_right">100.0%</td>
<td class="gt_row gt_right">93.0%</td>
<td class="gt_row gt_right">91.8%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN1</td>
<td class="gt_row gt_right">95.3%</td>
<td class="gt_row gt_right">98.2%</td>
<td class="gt_row gt_right">93.0%</td>
<td class="gt_row gt_right">91.7%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN3</td>
<td class="gt_row gt_right">95.3%</td>
<td class="gt_row gt_right">98.2%</td>
<td class="gt_row gt_right">93.0%</td>
<td class="gt_row gt_right">91.7%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN7</td>
<td class="gt_row gt_right">95.3%</td>
<td class="gt_row gt_right">98.2%</td>
<td class="gt_row gt_right">93.0%</td>
<td class="gt_row gt_right">91.7%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">QDA</td>
<td class="gt_row gt_right">94.5%</td>
<td class="gt_row gt_right">94.6%</td>
<td class="gt_row gt_right">94.4%</td>
<td class="gt_row gt_right">93.0%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">logistic</td>
<td class="gt_row gt_right">89.0%</td>
<td class="gt_row gt_right">87.5%</td>
<td class="gt_row gt_right">90.1%</td>
<td class="gt_row gt_right">87.5%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">LDA</td>
<td class="gt_row gt_right">86.6%</td>
<td class="gt_row gt_right">96.4%</td>
<td class="gt_row gt_right">78.9%</td>
<td class="gt_row gt_right">78.3%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">NB</td>
<td class="gt_row gt_right">84.3%</td>
<td class="gt_row gt_right">80.4%</td>
<td class="gt_row gt_right">87.3%</td>
<td class="gt_row gt_right">83.3%</td></tr>
    <tr class="gt_group_heading_row">
      <td colspan="5" class="gt_group_heading">rec3</td>
    </tr>
    <tr class="gt_row_group_first"><td class="gt_row gt_right gt_stub">KNN5</td>
<td class="gt_row gt_right">95.3%</td>
<td class="gt_row gt_right">98.2%</td>
<td class="gt_row gt_right">93.0%</td>
<td class="gt_row gt_right">91.7%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN1</td>
<td class="gt_row gt_right">94.5%</td>
<td class="gt_row gt_right">98.2%</td>
<td class="gt_row gt_right">91.5%</td>
<td class="gt_row gt_right">90.2%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN3</td>
<td class="gt_row gt_right">94.5%</td>
<td class="gt_row gt_right">98.2%</td>
<td class="gt_row gt_right">91.5%</td>
<td class="gt_row gt_right">90.2%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">KNN7</td>
<td class="gt_row gt_right">94.5%</td>
<td class="gt_row gt_right">96.4%</td>
<td class="gt_row gt_right">93.0%</td>
<td class="gt_row gt_right">91.5%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">logistic</td>
<td class="gt_row gt_right">89.0%</td>
<td class="gt_row gt_right">87.5%</td>
<td class="gt_row gt_right">90.1%</td>
<td class="gt_row gt_right">87.5%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">QDA</td>
<td class="gt_row gt_right">86.6%</td>
<td class="gt_row gt_right">91.1%</td>
<td class="gt_row gt_right">83.1%</td>
<td class="gt_row gt_right">81.0%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">NB</td>
<td class="gt_row gt_right">86.6%</td>
<td class="gt_row gt_right">76.8%</td>
<td class="gt_row gt_right">94.4%</td>
<td class="gt_row gt_right">91.5%</td></tr>
    <tr><td class="gt_row gt_right gt_stub">LDA</td>
<td class="gt_row gt_right">84.3%</td>
<td class="gt_row gt_right">91.1%</td>
<td class="gt_row gt_right">78.9%</td>
<td class="gt_row gt_right">77.3%</td></tr>
  </tbody>
  
  
</table>
</div>
<p>In general, performance was best for <code>rec2</code> with these variables:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="classification.html#cb343-1" aria-hidden="true" tabindex="-1"></a>boston_recs<span class="sc">$</span>rec2<span class="sc">$</span>term_info</span></code></pre></div>
<pre><code>## # A tibble: 9 × 4
##   variable type    role      source  
##   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
## 1 age      numeric predictor original
## 2 dis      numeric predictor original
## 3 indus    numeric predictor original
## 4 nox      numeric predictor original
## 5 ptratio  numeric predictor original
## 6 rad      numeric predictor original
## 7 tax      numeric predictor original
## 8 zn       numeric predictor original
## 9 crim01   nominal outcome   original</code></pre>
<p>And the models that performed best were KNN and QDA.</p>
</div>
</div>
</div>
<div id="reproducibility-1" class="section level2 unnumbered hasAnchor">
<h2>Reproducibility<a href="classification.html#reproducibility-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<details>
<summary>
Reproducibility receipt
</summary>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="classification.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2022-09-18 23:29:25 AST&quot;</code></pre>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="classification.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">&quot;git2r&quot;</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()) {</span>
<span id="cb347-2"><a href="classification.html#cb347-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (git2r<span class="sc">::</span><span class="fu">in_repository</span>()) {</span>
<span id="cb347-3"><a href="classification.html#cb347-3" aria-hidden="true" tabindex="-1"></a>    git2r<span class="sc">::</span><span class="fu">repository</span>()</span>
<span id="cb347-4"><a href="classification.html#cb347-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb347-5"><a href="classification.html#cb347-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Local:    main C:/Users/tdunn/Documents/learning/islr-tidy
## Remote:   main @ origin (https://github.com/taylordunn/islr-tidy)
## Head:     [20e7bfa] 2022-09-18: Trying out some simulation</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="classification.html#cb349-1" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>()</span></code></pre></div>
<pre><code>## ─ Session info ───────────────────────────────────────────────────────────────
##  setting  value
##  version  R version 4.2.1 (2022-06-23 ucrt)
##  os       Windows 10 x64 (build 19044)
##  system   x86_64, mingw32
##  ui       RTerm
##  language (EN)
##  collate  English_Canada.utf8
##  ctype    English_Canada.utf8
##  tz       America/Curacao
##  date     2022-09-18
##  pandoc   2.18 @ C:/Program Files/RStudio/bin/quarto/bin/tools/ (via rmarkdown)
## 
## ─ Packages ───────────────────────────────────────────────────────────────────
##  package        * version    date (UTC) lib source
##  abind            1.4-5      2016-07-21 [1] CRAN (R 4.2.0)
##  assertthat       0.2.1      2019-03-21 [1] CRAN (R 4.2.1)
##  backports        1.4.1      2021-12-13 [1] CRAN (R 4.2.0)
##  base64enc        0.1-3      2015-07-28 [1] CRAN (R 4.2.0)
##  bayestestR       0.12.1     2022-05-02 [1] CRAN (R 4.2.1)
##  bit              4.0.4      2020-08-04 [1] CRAN (R 4.2.1)
##  bit64            4.0.5      2020-08-30 [1] CRAN (R 4.2.1)
##  bookdown         0.27       2022-06-14 [1] CRAN (R 4.2.1)
##  broom          * 1.0.0      2022-07-01 [1] CRAN (R 4.2.1)
##  bslib            0.4.0      2022-07-16 [1] CRAN (R 4.2.1)
##  cachem           1.0.6      2021-08-19 [1] CRAN (R 4.2.1)
##  car              3.1-0      2022-06-15 [1] CRAN (R 4.2.1)
##  carData          3.0-5      2022-01-06 [1] CRAN (R 4.2.1)
##  cellranger       1.1.0      2016-07-27 [1] CRAN (R 4.2.1)
##  checkmate        2.1.0      2022-04-21 [1] CRAN (R 4.2.1)
##  class            7.3-20     2022-01-16 [2] CRAN (R 4.2.1)
##  cli              3.3.0      2022-04-25 [1] CRAN (R 4.2.1)
##  codetools        0.2-18     2020-11-04 [2] CRAN (R 4.2.1)
##  colorspace       2.0-3      2022-02-21 [1] CRAN (R 4.2.1)
##  combinat         0.0-8      2012-10-29 [1] CRAN (R 4.2.0)
##  corrr          * 0.4.4      2022-08-16 [1] CRAN (R 4.2.1)
##  crayon           1.5.1      2022-03-26 [1] CRAN (R 4.2.1)
##  datawizard       0.4.1      2022-05-16 [1] CRAN (R 4.2.1)
##  DBI              1.1.3      2022-06-18 [1] CRAN (R 4.2.1)
##  dbplyr           2.2.1      2022-06-27 [1] CRAN (R 4.2.1)
##  dials          * 1.0.0      2022-06-14 [1] CRAN (R 4.2.1)
##  DiceDesign       1.9        2021-02-13 [1] CRAN (R 4.2.1)
##  digest           0.6.29     2021-12-01 [1] CRAN (R 4.2.1)
##  discrim        * 1.0.0      2022-06-23 [1] CRAN (R 4.2.1)
##  distill          1.4        2022-05-12 [1] CRAN (R 4.2.1)
##  distributional   0.3.0      2022-01-05 [1] CRAN (R 4.2.1)
##  downlit          0.4.2      2022-07-05 [1] CRAN (R 4.2.1)
##  dplyr          * 1.0.9      2022-04-28 [1] CRAN (R 4.2.1)
##  dunnr          * 0.2.6      2022-08-07 [1] Github (taylordunn/dunnr@e2a8213)
##  ellipsis         0.3.2      2021-04-29 [1] CRAN (R 4.2.1)
##  equatiomatic     0.3.1      2022-01-30 [1] CRAN (R 4.2.1)
##  evaluate         0.15       2022-02-18 [1] CRAN (R 4.2.1)
##  extrafont        0.18       2022-04-12 [1] CRAN (R 4.2.0)
##  extrafontdb      1.0        2012-06-11 [1] CRAN (R 4.2.0)
##  fansi            1.0.3      2022-03-24 [1] CRAN (R 4.2.1)
##  farver           2.1.1      2022-07-06 [1] CRAN (R 4.2.1)
##  fastmap          1.1.0      2021-01-25 [1] CRAN (R 4.2.1)
##  forcats        * 0.5.1      2021-01-27 [1] CRAN (R 4.2.1)
##  foreach          1.5.2      2022-02-02 [1] CRAN (R 4.2.1)
##  fs               1.5.2      2021-12-08 [1] CRAN (R 4.2.1)
##  furrr            0.3.0      2022-05-04 [1] CRAN (R 4.2.1)
##  future           1.27.0     2022-07-22 [1] CRAN (R 4.2.1)
##  future.apply     1.9.0      2022-04-25 [1] CRAN (R 4.2.1)
##  gargle           1.2.0      2021-07-02 [1] CRAN (R 4.2.1)
##  generics         0.1.3      2022-07-05 [1] CRAN (R 4.2.1)
##  GGally           2.1.2      2021-06-21 [1] CRAN (R 4.2.1)
##  ggdist         * 3.2.0      2022-07-19 [1] CRAN (R 4.2.1)
##  ggplot2        * 3.3.6      2022-05-03 [1] CRAN (R 4.2.1)
##  ggrepel          0.9.1      2021-01-15 [1] CRAN (R 4.2.1)
##  git2r            0.30.1     2022-03-16 [1] CRAN (R 4.2.1)
##  globals          0.15.1     2022-06-24 [1] CRAN (R 4.2.1)
##  glue             1.6.2      2022-02-24 [1] CRAN (R 4.2.1)
##  googledrive      2.0.0      2021-07-08 [1] CRAN (R 4.2.1)
##  googlesheets4    1.0.0      2021-07-21 [1] CRAN (R 4.2.1)
##  gower            1.0.0      2022-02-03 [1] CRAN (R 4.2.0)
##  GPfit            1.0-8      2019-02-08 [1] CRAN (R 4.2.1)
##  gt             * 0.6.0      2022-05-24 [1] CRAN (R 4.2.1)
##  gtable           0.3.0      2019-03-25 [1] CRAN (R 4.2.1)
##  hardhat          1.2.0      2022-06-30 [1] CRAN (R 4.2.1)
##  haven            2.5.0      2022-04-15 [1] CRAN (R 4.2.1)
##  here           * 1.0.1      2020-12-13 [1] CRAN (R 4.2.1)
##  highr            0.9        2021-04-16 [1] CRAN (R 4.2.1)
##  hms              1.1.1      2021-09-26 [1] CRAN (R 4.2.1)
##  htmltools        0.5.2      2021-08-25 [1] CRAN (R 4.2.1)
##  httpuv           1.6.5      2022-01-05 [1] CRAN (R 4.2.1)
##  httr             1.4.3      2022-05-04 [1] CRAN (R 4.2.1)
##  igraph           1.3.4      2022-07-19 [1] CRAN (R 4.2.1)
##  infer          * 1.0.2      2022-06-10 [1] CRAN (R 4.2.1)
##  insight          0.18.0     2022-07-05 [1] CRAN (R 4.2.1)
##  ipred            0.9-13     2022-06-02 [1] CRAN (R 4.2.1)
##  ISLR2          * 1.3-1      2022-01-10 [1] CRAN (R 4.2.1)
##  iterators        1.0.14     2022-02-05 [1] CRAN (R 4.2.1)
##  jquerylib        0.1.4      2021-04-26 [1] CRAN (R 4.2.1)
##  jsonlite         1.8.0      2022-02-22 [1] CRAN (R 4.2.1)
##  kknn             1.3.1      2016-03-26 [1] CRAN (R 4.2.1)
##  klaR             1.7-1      2022-06-27 [1] CRAN (R 4.2.1)
##  knitr            1.39       2022-04-26 [1] CRAN (R 4.2.1)
##  labeling         0.4.2      2020-10-20 [1] CRAN (R 4.2.0)
##  labelled         2.9.1      2022-05-05 [1] CRAN (R 4.2.1)
##  later            1.3.0      2021-08-18 [1] CRAN (R 4.2.1)
##  lattice          0.20-45    2021-09-22 [2] CRAN (R 4.2.1)
##  lava             1.6.10     2021-09-02 [1] CRAN (R 4.2.1)
##  lhs              1.1.5      2022-03-22 [1] CRAN (R 4.2.1)
##  lifecycle        1.0.1      2021-09-24 [1] CRAN (R 4.2.1)
##  listenv          0.8.0      2019-12-05 [1] CRAN (R 4.2.1)
##  lubridate        1.8.0      2021-10-07 [1] CRAN (R 4.2.1)
##  magrittr         2.0.3      2022-03-30 [1] CRAN (R 4.2.1)
##  MASS             7.3-57     2022-04-22 [2] CRAN (R 4.2.1)
##  Matrix           1.4-1      2022-03-23 [2] CRAN (R 4.2.1)
##  memoise          2.0.1      2021-11-26 [1] CRAN (R 4.2.1)
##  mgcv             1.8-40     2022-03-29 [2] CRAN (R 4.2.1)
##  mime             0.12       2021-09-28 [1] CRAN (R 4.2.0)
##  miniUI           0.1.1.1    2018-05-18 [1] CRAN (R 4.2.1)
##  modeldata      * 1.0.0      2022-07-01 [1] CRAN (R 4.2.1)
##  modelr           0.1.8      2020-05-19 [1] CRAN (R 4.2.1)
##  munsell          0.5.0      2018-06-12 [1] CRAN (R 4.2.1)
##  mvtnorm          1.1-3      2021-10-08 [1] CRAN (R 4.2.0)
##  nlme             3.1-157    2022-03-25 [2] CRAN (R 4.2.1)
##  nnet             7.3-17     2022-01-16 [2] CRAN (R 4.2.1)
##  parallelly       1.32.1     2022-07-21 [1] CRAN (R 4.2.1)
##  parsnip        * 1.0.0      2022-06-16 [1] CRAN (R 4.2.1)
##  patchwork      * 1.1.1      2020-12-17 [1] CRAN (R 4.2.1)
##  performance      0.9.1      2022-06-20 [1] CRAN (R 4.2.1)
##  pillar           1.8.0      2022-07-18 [1] CRAN (R 4.2.1)
##  pkgconfig        2.0.3      2019-09-22 [1] CRAN (R 4.2.1)
##  plyr             1.8.7      2022-03-24 [1] CRAN (R 4.2.1)
##  poissonreg     * 1.0.0      2022-06-15 [1] CRAN (R 4.2.1)
##  prodlim          2019.11.13 2019-11-17 [1] CRAN (R 4.2.1)
##  promises         1.2.0.1    2021-02-11 [1] CRAN (R 4.2.1)
##  purrr          * 0.3.4      2020-04-17 [1] CRAN (R 4.2.1)
##  questionr        0.7.7      2022-01-31 [1] CRAN (R 4.2.1)
##  R6               2.5.1      2021-08-19 [1] CRAN (R 4.2.1)
##  RColorBrewer     1.1-3      2022-04-03 [1] CRAN (R 4.2.0)
##  Rcpp             1.0.9      2022-07-08 [1] CRAN (R 4.2.1)
##  readr          * 2.1.2      2022-01-30 [1] CRAN (R 4.2.1)
##  readxl           1.4.0      2022-03-28 [1] CRAN (R 4.2.1)
##  recipes        * 1.0.1      2022-07-07 [1] CRAN (R 4.2.1)
##  repr             1.1.4      2022-01-04 [1] CRAN (R 4.2.1)
##  reprex           2.0.1      2021-08-05 [1] CRAN (R 4.2.1)
##  reshape          0.8.9      2022-04-12 [1] CRAN (R 4.2.1)
##  rlang            1.0.4      2022-07-12 [1] CRAN (R 4.2.1)
##  rmarkdown        2.14       2022-04-25 [1] CRAN (R 4.2.1)
##  rpart            4.1.16     2022-01-24 [2] CRAN (R 4.2.1)
##  rprojroot        2.0.3      2022-04-02 [1] CRAN (R 4.2.1)
##  rsample        * 1.1.0      2022-08-08 [1] CRAN (R 4.2.1)
##  rstudioapi       0.13       2020-11-12 [1] CRAN (R 4.2.1)
##  Rttf2pt1         1.3.8      2020-01-10 [1] CRAN (R 4.2.1)
##  rvest            1.0.2      2021-10-16 [1] CRAN (R 4.2.1)
##  sass             0.4.2      2022-07-16 [1] CRAN (R 4.2.1)
##  scales         * 1.2.0      2022-04-13 [1] CRAN (R 4.2.1)
##  see              0.7.1      2022-06-20 [1] CRAN (R 4.2.1)
##  sessioninfo      1.2.2      2021-12-06 [1] CRAN (R 4.2.1)
##  shiny            1.7.2      2022-07-19 [1] CRAN (R 4.2.1)
##  skimr            2.1.4      2022-04-15 [1] CRAN (R 4.2.1)
##  stringi          1.7.8      2022-07-11 [1] CRAN (R 4.2.1)
##  stringr        * 1.4.0      2019-02-10 [1] CRAN (R 4.2.1)
##  survival         3.3-1      2022-03-03 [2] CRAN (R 4.2.1)
##  tibble         * 3.1.8      2022-07-22 [1] CRAN (R 4.2.1)
##  tictoc         * 1.0.1      2021-04-19 [1] CRAN (R 4.2.0)
##  tidymodels     * 1.0.0      2022-07-13 [1] CRAN (R 4.2.1)
##  tidyr          * 1.2.0      2022-02-01 [1] CRAN (R 4.2.1)
##  tidyselect       1.1.2      2022-02-21 [1] CRAN (R 4.2.1)
##  tidyverse      * 1.3.2      2022-07-18 [1] CRAN (R 4.2.1)
##  timeDate         4021.104   2022-07-19 [1] CRAN (R 4.2.1)
##  tune           * 1.0.0      2022-07-07 [1] CRAN (R 4.2.1)
##  tzdb             0.3.0      2022-03-28 [1] CRAN (R 4.2.1)
##  usethis          2.1.6      2022-05-25 [1] CRAN (R 4.2.1)
##  utf8             1.2.2      2021-07-24 [1] CRAN (R 4.2.1)
##  vctrs            0.4.1      2022-04-13 [1] CRAN (R 4.2.1)
##  vroom            1.5.7      2021-11-30 [1] CRAN (R 4.2.1)
##  withr            2.5.0      2022-03-03 [1] CRAN (R 4.2.1)
##  workflows      * 1.0.0      2022-07-05 [1] CRAN (R 4.2.1)
##  workflowsets   * 1.0.0      2022-07-12 [1] CRAN (R 4.2.1)
##  xfun             0.31       2022-05-10 [1] CRAN (R 4.2.1)
##  xml2             1.3.3      2021-11-30 [1] CRAN (R 4.2.1)
##  xtable           1.8-4      2019-04-21 [1] CRAN (R 4.2.1)
##  yaml             2.3.5      2022-02-21 [1] CRAN (R 4.2.0)
##  yardstick      * 1.0.0      2022-06-06 [1] CRAN (R 4.2.1)
## 
##  [1] C:/Users/tdunn/AppData/Local/R/win-library/4.2
##  [2] C:/Program Files/R/R-4.2.1/library
## 
## ──────────────────────────────────────────────────────────────────────────────</code></pre>
</details>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="linear-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="resampling-methods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
