<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Moving Beyond Linearity | An Introduction to Statistical Learning with the tidyverse and tidymodels</title>
  <meta name="description" content="Working through ISLR with the tidyverse and tidymodels" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Moving Beyond Linearity | An Introduction to Statistical Learning with the tidyverse and tidymodels" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Working through ISLR with the tidyverse and tidymodels" />
  <meta name="github-repo" content="taylordunn/islr-tidy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Moving Beyond Linearity | An Introduction to Statistical Learning with the tidyverse and tidymodels" />
  
  <meta name="twitter:description" content="Working through ISLR with the tidyverse and tidymodels" />
  

<meta name="author" content="Taylor Dunn" />


<meta name="date" content="2022-04-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="linear-model-selection-and-regularization.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Who, what, and why?</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#an-overview-of-statistical-learning"><i class="fa fa-check"></i>An Overview of Statistical Learning</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#wage-data"><i class="fa fa-check"></i>Wage Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#a-brief-history-of-statistical-learning"><i class="fa fa-check"></i>A Brief History of Statistical Learning</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#this-book"><i class="fa fa-check"></i>This Book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="statistical-learning.html"><a href="statistical-learning.html"><i class="fa fa-check"></i><b>2</b> Statistical Learning</a>
<ul>
<li class="chapter" data-level="2.1" data-path="statistical-learning.html"><a href="statistical-learning.html#what-is-statistical-learning"><i class="fa fa-check"></i><b>2.1</b> What Is Statistical Learning?</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="statistical-learning.html"><a href="statistical-learning.html#why-estimate-f"><i class="fa fa-check"></i><b>2.1.1</b> Why Estimate <span class="math inline">\(f\)</span>?</a></li>
<li class="chapter" data-level="2.1.2" data-path="statistical-learning.html"><a href="statistical-learning.html#how-do-we-estimate-f"><i class="fa fa-check"></i><b>2.1.2</b> How Do We Estimate f?</a></li>
<li class="chapter" data-level="2.1.3" data-path="statistical-learning.html"><a href="statistical-learning.html#the-trade-off-between-prediction-accuracy-and-model-interpretability"><i class="fa fa-check"></i><b>2.1.3</b> The Trade-Off Between Prediction Accuracy and Model Interpretability</a></li>
<li class="chapter" data-level="2.1.4" data-path="statistical-learning.html"><a href="statistical-learning.html#supervised-versus-unsupervised-learning"><i class="fa fa-check"></i><b>2.1.4</b> Supervised Versus Unsupervised Learning</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="statistical-learning.html"><a href="statistical-learning.html#assessing-model-accuracy"><i class="fa fa-check"></i><b>2.2</b> Assessing Model Accuracy</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="statistical-learning.html"><a href="statistical-learning.html#measuring-the-quality-of-fit"><i class="fa fa-check"></i><b>2.2.1</b> Measuring the Quality of Fit</a></li>
<li class="chapter" data-level="2.2.2" data-path="statistical-learning.html"><a href="statistical-learning.html#the-bias-variance-trade-off"><i class="fa fa-check"></i><b>2.2.2</b> The Bias-Variance Trade-Off</a></li>
<li class="chapter" data-level="2.2.3" data-path="statistical-learning.html"><a href="statistical-learning.html#the-classification-setting"><i class="fa fa-check"></i><b>2.2.3</b> The Classification Setting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="statistical-learning.html"><a href="statistical-learning.html#lab-introduction-to-r"><i class="fa fa-check"></i><b>2.3</b> Lab: Introduction to R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>3</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="linear-regression.html"><a href="linear-regression.html#simple-linear-regression"><i class="fa fa-check"></i><b>3.1</b> Simple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="linear-regression.html"><a href="linear-regression.html#estimating-the-coefficients"><i class="fa fa-check"></i><b>3.1.1</b> Estimating the Coefficients</a></li>
<li class="chapter" data-level="3.1.2" data-path="linear-regression.html"><a href="linear-regression.html#assessing-the-accuracy-of-the-coefficient-estimates"><i class="fa fa-check"></i><b>3.1.2</b> Assessing the Accuracy of the Coefficient Estimates</a></li>
<li class="chapter" data-level="3.1.3" data-path="linear-regression.html"><a href="linear-regression.html#assessing-the-accuracy-of-the-model"><i class="fa fa-check"></i><b>3.1.3</b> Assessing the Accuracy of the Model</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="linear-regression.html"><a href="linear-regression.html#multiple-linear-regression"><i class="fa fa-check"></i><b>3.2</b> Multiple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="linear-regression.html"><a href="linear-regression.html#estimating-the-regression-coefficients"><i class="fa fa-check"></i><b>3.2.1</b> Estimating the Regression Coefficients</a></li>
<li class="chapter" data-level="3.2.2" data-path="linear-regression.html"><a href="linear-regression.html#some-important-questions"><i class="fa fa-check"></i><b>3.2.2</b> Some Important Questions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="linear-regression.html"><a href="linear-regression.html#other-considerations-in-the-regression-model"><i class="fa fa-check"></i><b>3.3</b> Other Considerations in the Regression Model</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="linear-regression.html"><a href="linear-regression.html#qualitative-predictors"><i class="fa fa-check"></i><b>3.3.1</b> Qualitative Predictors</a></li>
<li class="chapter" data-level="3.3.2" data-path="linear-regression.html"><a href="linear-regression.html#extensions-of-the-linear-model"><i class="fa fa-check"></i><b>3.3.2</b> Extensions of the Linear Model</a></li>
<li class="chapter" data-level="3.3.3" data-path="linear-regression.html"><a href="linear-regression.html#potential-problems"><i class="fa fa-check"></i><b>3.3.3</b> Potential Problems</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="linear-regression.html"><a href="linear-regression.html#the-marketing-plan"><i class="fa fa-check"></i><b>3.4</b> The Marketing Plan</a></li>
<li class="chapter" data-level="3.5" data-path="linear-regression.html"><a href="linear-regression.html#comparison-of-linear-regression-with-k-nearest-neighbors"><i class="fa fa-check"></i><b>3.5</b> Comparison of Linear Regression with <span class="math inline">\(K\)</span>-Nearest Neighbors</a></li>
<li class="chapter" data-level="3.6" data-path="linear-regression.html"><a href="linear-regression.html#lab-linear-regression"><i class="fa fa-check"></i><b>3.6</b> Lab: Linear Regression</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="linear-regression.html"><a href="linear-regression.html#libraries"><i class="fa fa-check"></i><b>3.6.1</b> Libraries</a></li>
<li class="chapter" data-level="3.6.2" data-path="linear-regression.html"><a href="linear-regression.html#simple-linear-regression-1"><i class="fa fa-check"></i><b>3.6.2</b> Simple Linear Regression</a></li>
<li class="chapter" data-level="3.6.3" data-path="linear-regression.html"><a href="linear-regression.html#multiple-linear-regression-1"><i class="fa fa-check"></i><b>3.6.3</b> Multiple Linear Regression</a></li>
<li class="chapter" data-level="3.6.4" data-path="linear-regression.html"><a href="linear-regression.html#interaction-terms"><i class="fa fa-check"></i><b>3.6.4</b> Interaction Terms</a></li>
<li class="chapter" data-level="3.6.5" data-path="linear-regression.html"><a href="linear-regression.html#non-linear-transformations-of-the-predictors"><i class="fa fa-check"></i><b>3.6.5</b> Non-linear Transformations of the Predictors</a></li>
<li class="chapter" data-level="3.6.6" data-path="linear-regression.html"><a href="linear-regression.html#qualitative-predictors-1"><i class="fa fa-check"></i><b>3.6.6</b> Qualitative Predictors</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="linear-regression.html"><a href="linear-regression.html#exercises"><i class="fa fa-check"></i><b>3.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#applied"><i class="fa fa-check"></i>Applied</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#reproducibility"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>4</b> Classification</a>
<ul>
<li class="chapter" data-level="4.1" data-path="classification.html"><a href="classification.html#an-overview-of-classification"><i class="fa fa-check"></i><b>4.1</b> An Overview of Classification</a></li>
<li class="chapter" data-level="4.2" data-path="classification.html"><a href="classification.html#why-not-linear-regression"><i class="fa fa-check"></i><b>4.2</b> Why Not Linear Regression?</a></li>
<li class="chapter" data-level="4.3" data-path="classification.html"><a href="classification.html#logistic-regression"><i class="fa fa-check"></i><b>4.3</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="classification.html"><a href="classification.html#the-logistic-model"><i class="fa fa-check"></i><b>4.3.1</b> The Logistic Model</a></li>
<li class="chapter" data-level="4.3.2" data-path="classification.html"><a href="classification.html#estimating-the-regression-coefficients-1"><i class="fa fa-check"></i><b>4.3.2</b> Estimating the Regression Coefficients</a></li>
<li class="chapter" data-level="4.3.3" data-path="classification.html"><a href="classification.html#making-predictions"><i class="fa fa-check"></i><b>4.3.3</b> Making Predictions</a></li>
<li class="chapter" data-level="4.3.4" data-path="classification.html"><a href="classification.html#multiple-logistic-regression"><i class="fa fa-check"></i><b>4.3.4</b> Multiple Logistic Regression</a></li>
<li class="chapter" data-level="4.3.5" data-path="classification.html"><a href="classification.html#multinomial-logistic-regression"><i class="fa fa-check"></i><b>4.3.5</b> Multinomial Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="classification.html"><a href="classification.html#generative-models-for-classification"><i class="fa fa-check"></i><b>4.4</b> Generative Models for Classification</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="classification.html"><a href="classification.html#linear-discriminant-analysis-for-p-1"><i class="fa fa-check"></i><b>4.4.1</b> Linear Discriminant Analysis for <span class="math inline">\(p = 1\)</span></a></li>
<li class="chapter" data-level="4.4.2" data-path="classification.html"><a href="classification.html#linear-discriminant-analysis-for-p-1-1"><i class="fa fa-check"></i><b>4.4.2</b> Linear Discriminant Analysis for <span class="math inline">\(p &gt; 1\)</span></a></li>
<li class="chapter" data-level="4.4.3" data-path="classification.html"><a href="classification.html#quadratic-discriminant-analysis"><i class="fa fa-check"></i><b>4.4.3</b> Quadratic Discriminant Analysis</a></li>
<li class="chapter" data-level="4.4.4" data-path="classification.html"><a href="classification.html#naive-bayes"><i class="fa fa-check"></i><b>4.4.4</b> Naive Bayes</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="classification.html"><a href="classification.html#a-comparison-of-classification-methods"><i class="fa fa-check"></i><b>4.5</b> A Comparison of Classification Methods</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="classification.html"><a href="classification.html#an-analytical-comparison"><i class="fa fa-check"></i><b>4.5.1</b> An Analytical Comparison</a></li>
<li class="chapter" data-level="4.5.2" data-path="classification.html"><a href="classification.html#an-empirical-comparison"><i class="fa fa-check"></i><b>4.5.2</b> An Empirical Comparison</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="classification.html"><a href="classification.html#generalized-linear-models"><i class="fa fa-check"></i><b>4.6</b> Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="classification.html"><a href="classification.html#linear-regression-on-the-bikeshare-data"><i class="fa fa-check"></i><b>4.6.1</b> Linear Regression on the Bikeshare Data</a></li>
<li class="chapter" data-level="4.6.2" data-path="classification.html"><a href="classification.html#poisson-regression-on-bikeshare-data"><i class="fa fa-check"></i><b>4.6.2</b> Poisson Regression on Bikeshare Data</a></li>
<li class="chapter" data-level="4.6.3" data-path="classification.html"><a href="classification.html#generalized-linear-models-in-greater-generality"><i class="fa fa-check"></i><b>4.6.3</b> Generalized Linear Models in Greater Generality</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="classification.html"><a href="classification.html#lab-classification-methods"><i class="fa fa-check"></i><b>4.7</b> Lab: Classification Methods</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="classification.html"><a href="classification.html#the-stock-market-data"><i class="fa fa-check"></i><b>4.7.1</b> The Stock Market Data</a></li>
<li class="chapter" data-level="4.7.2" data-path="classification.html"><a href="classification.html#logistic-regression-1"><i class="fa fa-check"></i><b>4.7.2</b> Logistic Regression</a></li>
<li class="chapter" data-level="4.7.3" data-path="classification.html"><a href="classification.html#linear-discriminant-analysis"><i class="fa fa-check"></i><b>4.7.3</b> Linear Discriminant Analysis</a></li>
<li class="chapter" data-level="4.7.4" data-path="classification.html"><a href="classification.html#quadratic-discriminant-analysis-1"><i class="fa fa-check"></i><b>4.7.4</b> Quadratic Discriminant Analysis</a></li>
<li class="chapter" data-level="4.7.5" data-path="classification.html"><a href="classification.html#naive-bayes-1"><i class="fa fa-check"></i><b>4.7.5</b> Naive Bayes</a></li>
<li class="chapter" data-level="4.7.6" data-path="classification.html"><a href="classification.html#k-nearest-neighbors-1"><i class="fa fa-check"></i><b>4.7.6</b> <span class="math inline">\(K\)</span>-Nearest Neighbors</a></li>
<li class="chapter" data-level="4.7.7" data-path="classification.html"><a href="classification.html#poisson-regression"><i class="fa fa-check"></i><b>4.7.7</b> Poisson Regression</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="classification.html"><a href="classification.html#exercises-1"><i class="fa fa-check"></i><b>4.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="classification.html"><a href="classification.html#applied-1"><i class="fa fa-check"></i>Applied</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="classification.html"><a href="classification.html#reproducibility-1"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="resampling-methods.html"><a href="resampling-methods.html"><i class="fa fa-check"></i><b>5</b> Resampling Methods</a>
<ul>
<li class="chapter" data-level="5.1" data-path="resampling-methods.html"><a href="resampling-methods.html#cross-validation"><i class="fa fa-check"></i><b>5.1</b> Cross Validation</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="resampling-methods.html"><a href="resampling-methods.html#validation-set"><i class="fa fa-check"></i><b>5.1.1</b> The Validation Set Approach</a></li>
<li class="chapter" data-level="5.1.2" data-path="resampling-methods.html"><a href="resampling-methods.html#loocv"><i class="fa fa-check"></i><b>5.1.2</b> Leave-One-Out Cross Validation</a></li>
<li class="chapter" data-level="5.1.3" data-path="resampling-methods.html"><a href="resampling-methods.html#kfoldcv"><i class="fa fa-check"></i><b>5.1.3</b> <span class="math inline">\(k\)</span>-fold Cross-Validation</a></li>
<li class="chapter" data-level="5.1.4" data-path="resampling-methods.html"><a href="resampling-methods.html#bias-variance-trade-off-for-k-fold-cross-validation"><i class="fa fa-check"></i><b>5.1.4</b> Bias-Variance Trade-Off for <span class="math inline">\(k\)</span>-Fold Cross-Validation</a></li>
<li class="chapter" data-level="5.1.5" data-path="resampling-methods.html"><a href="resampling-methods.html#cross-validation-on-classification-problems"><i class="fa fa-check"></i><b>5.1.5</b> Cross-Validation on Classification Problems</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="resampling-methods.html"><a href="resampling-methods.html#bootstrap-lab"><i class="fa fa-check"></i><b>5.2</b> The Bootstrap</a></li>
<li class="chapter" data-level="5.3" data-path="resampling-methods.html"><a href="resampling-methods.html#lab-cross-validation-and-the-bootstrap"><i class="fa fa-check"></i><b>5.3</b> Lab: Cross-Validation and the Bootstrap</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="resampling-methods.html"><a href="resampling-methods.html#the-validation-set-approach"><i class="fa fa-check"></i><b>5.3.1</b> The Validation Set Approach</a></li>
<li class="chapter" data-level="5.3.2" data-path="resampling-methods.html"><a href="resampling-methods.html#leave-one-out-cross-validation"><i class="fa fa-check"></i><b>5.3.2</b> Leave-One-Out Cross-Validation</a></li>
<li class="chapter" data-level="5.3.3" data-path="resampling-methods.html"><a href="resampling-methods.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>5.3.3</b> <span class="math inline">\(k\)</span>-fold Cross-Validation</a></li>
<li class="chapter" data-level="5.3.4" data-path="resampling-methods.html"><a href="resampling-methods.html#bootstrap"><i class="fa fa-check"></i><b>5.3.4</b> The Bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="resampling-methods.html"><a href="resampling-methods.html#exercises-2"><i class="fa fa-check"></i><b>5.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="resampling-methods.html"><a href="resampling-methods.html#applied-2"><i class="fa fa-check"></i>Applied</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="resampling-methods.html"><a href="resampling-methods.html#reproducibility-2"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html"><i class="fa fa-check"></i><b>6</b> Linear Model Selection and Regularization</a>
<ul>
<li class="chapter" data-level="6.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#subset-selection"><i class="fa fa-check"></i><b>6.1</b> Subset Selection</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#best-subset-selection"><i class="fa fa-check"></i><b>6.1.1</b> Best Subset Selection</a></li>
<li class="chapter" data-level="6.1.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#stepwise-selection"><i class="fa fa-check"></i><b>6.1.2</b> Stepwise Selection</a></li>
<li class="chapter" data-level="6.1.3" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#choosing-the-optimal-model"><i class="fa fa-check"></i><b>6.1.3</b> Choosing the Optimal Model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#shrinkage-methods"><i class="fa fa-check"></i><b>6.2</b> Shrinkage Methods</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#ridge-regression"><i class="fa fa-check"></i><b>6.2.1</b> Ridge Regression</a></li>
<li class="chapter" data-level="6.2.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#the-lasso"><i class="fa fa-check"></i><b>6.2.2</b> The Lasso</a></li>
<li class="chapter" data-level="6.2.3" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#selecting-the-tuning-parameter"><i class="fa fa-check"></i><b>6.2.3</b> Selecting the Tuning Parameter</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#dimension-reduction-methods"><i class="fa fa-check"></i><b>6.3</b> Dimension Reduction Methods</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#principal-components-regression"><i class="fa fa-check"></i><b>6.3.1</b> Principal Components Regression</a></li>
<li class="chapter" data-level="6.3.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#partial-least-squares"><i class="fa fa-check"></i><b>6.3.2</b> Partial Least Squares</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#considerations-in-high-dimensions"><i class="fa fa-check"></i><b>6.4</b> Considerations in High Dimensions</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#high-dimensional-data"><i class="fa fa-check"></i><b>6.4.1</b> High-Dimensional Data</a></li>
<li class="chapter" data-level="6.4.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#what-goes-wrong-in-high-dimensions"><i class="fa fa-check"></i><b>6.4.2</b> What Goes Wrong in High Dimensions?</a></li>
<li class="chapter" data-level="6.4.3" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#regression-in-high-dimensions"><i class="fa fa-check"></i><b>6.4.3</b> Regression in High Dimensions</a></li>
<li class="chapter" data-level="6.4.4" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#interpreting-results-in-high-dimensions"><i class="fa fa-check"></i><b>6.4.4</b> Interpreting Results in High Dimensions</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#lab-linear-models-and-regularization-methods"><i class="fa fa-check"></i><b>6.5</b> Lab: Linear Models and Regularization Methods</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#subset-selection-methods"><i class="fa fa-check"></i><b>6.5.1</b> Subset Selection Methods</a></li>
<li class="chapter" data-level="6.5.2" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#ridge-regression-and-the-lasso"><i class="fa fa-check"></i><b>6.5.2</b> Ridge Regression and the Lasso</a></li>
<li class="chapter" data-level="6.5.3" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#pcr-and-pls-regression"><i class="fa fa-check"></i><b>6.5.3</b> PCR and PLS Regression</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#exercises-3"><i class="fa fa-check"></i><b>6.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#applied-3"><i class="fa fa-check"></i>Applied</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="linear-model-selection-and-regularization.html"><a href="linear-model-selection-and-regularization.html#reproducibility-3"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html"><i class="fa fa-check"></i><b>7</b> Moving Beyond Linearity</a>
<ul>
<li class="chapter" data-level="7.1" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#polynomial-regression"><i class="fa fa-check"></i><b>7.1</b> Polynomial Regression</a></li>
<li class="chapter" data-level="7.2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#step-functions"><i class="fa fa-check"></i><b>7.2</b> Step Functions</a></li>
<li class="chapter" data-level="7.3" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#basis-functions"><i class="fa fa-check"></i><b>7.3</b> Basis Functions</a></li>
<li class="chapter" data-level="7.4" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#regression-splines"><i class="fa fa-check"></i><b>7.4</b> Regression Splines</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#piecewise-polynomials"><i class="fa fa-check"></i><b>7.4.1</b> Piecewise Polynomials</a></li>
<li class="chapter" data-level="7.4.2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#constraints-and-splines"><i class="fa fa-check"></i><b>7.4.2</b> Constraints and Splines</a></li>
<li class="chapter" data-level="7.4.3" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#spline-basis"><i class="fa fa-check"></i><b>7.4.3</b> The Spline Basis Representation</a></li>
<li class="chapter" data-level="7.4.4" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#choosing-knots"><i class="fa fa-check"></i><b>7.4.4</b> Choosing the Number and Locations of the Knots</a></li>
<li class="chapter" data-level="7.4.5" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#comparison-polynomial"><i class="fa fa-check"></i><b>7.4.5</b> Comparison to Polynomial Regression</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#smoothing-splines"><i class="fa fa-check"></i><b>7.5</b> Smoothing Splines</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#an-overview-of-smoothing-splines"><i class="fa fa-check"></i><b>7.5.1</b> An Overview of Smoothing Splines</a></li>
<li class="chapter" data-level="7.5.2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#smoothing-parameter"><i class="fa fa-check"></i><b>7.5.2</b> Choosing the Smoothing Parameter <span class="math inline">\(\lambda\)</span></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#local-regression"><i class="fa fa-check"></i><b>7.6</b> Local Regression</a></li>
<li class="chapter" data-level="7.7" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#generalized-additive-models"><i class="fa fa-check"></i><b>7.7</b> Generalized Additive Models</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#gam-regression"><i class="fa fa-check"></i><b>7.7.1</b> GAMs for Regression Problems</a></li>
<li class="chapter" data-level="7.7.2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#gam-classification"><i class="fa fa-check"></i><b>7.7.2</b> GAMs for Classification Problems</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#lab-non-linear-modeling"><i class="fa fa-check"></i><b>7.8</b> Lab: Non-linear Modeling</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#polynomial-regression-and-step-functions"><i class="fa fa-check"></i><b>7.8.1</b> Polynomial Regression and Step Functions</a></li>
<li class="chapter" data-level="7.8.2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#splines"><i class="fa fa-check"></i><b>7.8.2</b> Splines</a></li>
<li class="chapter" data-level="7.8.3" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#gams-lab"><i class="fa fa-check"></i><b>7.8.3</b> GAMs</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#exercises-4"><i class="fa fa-check"></i><b>7.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#applied-4"><i class="fa fa-check"></i>Applied</a></li>
<li class="chapter" data-level="7.9.1" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#delete"><i class="fa fa-check"></i><b>7.9.1</b> delete</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html#reproducibility-4"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An Introduction to Statistical Learning with the tidyverse and tidymodels</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="moving-beyond-linearity" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Moving Beyond Linearity</h1>
<p>Load the packages used in this chapter:</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="moving-beyond-linearity.html#cb697-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb697-2"><a href="moving-beyond-linearity.html#cb697-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb697-3"><a href="moving-beyond-linearity.html#cb697-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb697-4"><a href="moving-beyond-linearity.html#cb697-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb697-5"><a href="moving-beyond-linearity.html#cb697-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb697-6"><a href="moving-beyond-linearity.html#cb697-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tictoc)</span>
<span id="cb697-7"><a href="moving-beyond-linearity.html#cb697-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb697-8"><a href="moving-beyond-linearity.html#cb697-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load my R package and set the ggplot theme</span></span>
<span id="cb697-9"><a href="moving-beyond-linearity.html#cb697-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dunnr)</span>
<span id="cb697-10"><a href="moving-beyond-linearity.html#cb697-10" aria-hidden="true" tabindex="-1"></a>extrafont<span class="sc">::</span><span class="fu">loadfonts</span>(<span class="at">device =</span> <span class="st">&quot;win&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb697-11"><a href="moving-beyond-linearity.html#cb697-11" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_td</span>())</span>
<span id="cb697-12"><a href="moving-beyond-linearity.html#cb697-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set_geom_fonts</span>()</span>
<span id="cb697-13"><a href="moving-beyond-linearity.html#cb697-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set_palette</span>()</span></code></pre></div>
<p>In the previous chapter, we saw how to improve upon standard least squares linear regression using ridge regression, the lasso, PCA, and other techniques.
In that setting, the complexity of the linear model is reduced to reduce the variance of the estimates.
In this chapter, we relax the linearity assumption while still trying to maintain some interpretability, with these methods:</p>
<ul>
<li><em>Polynomial regression</em> extends the linear model by adding extra predictors by raising original predictors to a power.</li>
<li><em>Step functions</em> cut the range of a variable into <span class="math inline">\(K\)</span> distinct regions to produce a qualitative variable.</li>
<li><em>Regression splines</em> are a flexible combination of polynomials and step functions that involve polynomial functions fit to data in <span class="math inline">\(K\)</span> distinct regions.</li>
<li><em>Smoothing splines</em> are similar to regression splines but involve a smoothness penalty.</li>
<li><em>Local regression</em> is similar to splines but allows smooth overlaps across regions.</li>
<li><em>Generalized additive models</em> allows us to extend the above methods to deal with multiple predictors.</li>
</ul>
<div id="polynomial-regression" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Polynomial Regression</h2>
<p>Polynomial regression involves raising one or more predictors to a degree <span class="math inline">\(d\)</span>, each with its own coefficient:</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3 + \dots + \beta_d x_i^d + \epsilon_i.
\]</span></p>
<p>For a large enough degree <span class="math inline">\(d\)</span>, polynomial regression can produce an extremely non-linear curve, though it is unusual to use <span class="math inline">\(d\)</span> greater than 3 or 4 because the curve can become overly flexible and produce some strange shapes.</p>
<p>Re-create Figure 7.1 with the <code>wage</code> data:</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="moving-beyond-linearity.html#cb698-1" aria-hidden="true" tabindex="-1"></a>wage <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Wage</span>
<span id="cb698-2"><a href="moving-beyond-linearity.html#cb698-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb698-3"><a href="moving-beyond-linearity.html#cb698-3" aria-hidden="true" tabindex="-1"></a>wage_poly_4_linear_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">4</span>), <span class="at">data =</span> wage)</span>
<span id="cb698-4"><a href="moving-beyond-linearity.html#cb698-4" aria-hidden="true" tabindex="-1"></a>wage_poly_4_logistic_fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">4</span>),</span>
<span id="cb698-5"><a href="moving-beyond-linearity.html#cb698-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> wage, <span class="at">family =</span> binomial)</span>
<span id="cb698-6"><a href="moving-beyond-linearity.html#cb698-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb698-7"><a href="moving-beyond-linearity.html#cb698-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid of age values for predictions</span></span>
<span id="cb698-8"><a href="moving-beyond-linearity.html#cb698-8" aria-hidden="true" tabindex="-1"></a>age_grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">18</span>, <span class="dv">80</span>, <span class="at">length.out =</span> <span class="dv">63</span>)</span>
<span id="cb698-9"><a href="moving-beyond-linearity.html#cb698-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb698-10"><a href="moving-beyond-linearity.html#cb698-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> wage_poly_4_linear_fit <span class="sc">%&gt;%</span></span>
<span id="cb698-11"><a href="moving-beyond-linearity.html#cb698-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid), <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb698-12"><a href="moving-beyond-linearity.html#cb698-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb698-13"><a href="moving-beyond-linearity.html#cb698-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wage, <span class="fu">aes</span>(<span class="at">y =</span> wage),</span>
<span id="cb698-14"><a href="moving-beyond-linearity.html#cb698-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb698-15"><a href="moving-beyond-linearity.html#cb698-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb698-16"><a href="moving-beyond-linearity.html#cb698-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .lower),</span>
<span id="cb698-17"><a href="moving-beyond-linearity.html#cb698-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb698-18"><a href="moving-beyond-linearity.html#cb698-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .upper),</span>
<span id="cb698-19"><a href="moving-beyond-linearity.html#cb698-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb698-20"><a href="moving-beyond-linearity.html#cb698-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;wage&quot;</span>)</span>
<span id="cb698-21"><a href="moving-beyond-linearity.html#cb698-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb698-22"><a href="moving-beyond-linearity.html#cb698-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> wage_poly_4_logistic_fit <span class="sc">%&gt;%</span></span>
<span id="cb698-23"><a href="moving-beyond-linearity.html#cb698-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid),</span>
<span id="cb698-24"><a href="moving-beyond-linearity.html#cb698-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">type.predict =</span> <span class="st">&quot;link&quot;</span>, <span class="at">se_fit =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb698-25"><a href="moving-beyond-linearity.html#cb698-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb698-26"><a href="moving-beyond-linearity.html#cb698-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Have to compute CIs manually for logistic regression</span></span>
<span id="cb698-27"><a href="moving-beyond-linearity.html#cb698-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">.lower =</span> .fitted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> .se.fit,</span>
<span id="cb698-28"><a href="moving-beyond-linearity.html#cb698-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">.upper =</span> .fitted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> .se.fit,</span>
<span id="cb698-29"><a href="moving-beyond-linearity.html#cb698-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert from log-odds to probability scales</span></span>
<span id="cb698-30"><a href="moving-beyond-linearity.html#cb698-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(.fitted, .lower, .upper), <span class="sc">~</span> <span class="fu">exp</span>(.x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(.x)))</span>
<span id="cb698-31"><a href="moving-beyond-linearity.html#cb698-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb698-32"><a href="moving-beyond-linearity.html#cb698-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb698-33"><a href="moving-beyond-linearity.html#cb698-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="at">data =</span> wage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>),</span>
<span id="cb698-34"><a href="moving-beyond-linearity.html#cb698-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">sides =</span> <span class="st">&quot;t&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb698-35"><a href="moving-beyond-linearity.html#cb698-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="at">data =</span> wage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(wage <span class="sc">&lt;=</span> <span class="dv">250</span>),</span>
<span id="cb698-36"><a href="moving-beyond-linearity.html#cb698-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">sides =</span> <span class="st">&quot;b&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb698-37"><a href="moving-beyond-linearity.html#cb698-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb698-38"><a href="moving-beyond-linearity.html#cb698-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .lower), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb698-39"><a href="moving-beyond-linearity.html#cb698-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .upper), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb698-40"><a href="moving-beyond-linearity.html#cb698-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb698-41"><a href="moving-beyond-linearity.html#cb698-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Pr(wage &gt; 250 | age)&quot;</span>)</span>
<span id="cb698-42"><a href="moving-beyond-linearity.html#cb698-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb698-43"><a href="moving-beyond-linearity.html#cb698-43" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-1-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="step-functions" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Step Functions</h2>
<blockquote>
<p>Using polynomial functions of the features as predictors in a linear model
imposes a global structure on the non-linear function of <span class="math inline">\(X\)</span>. We can instead
use step functions in order to avoid imposing such a global structure. Here
we break the range of <span class="math inline">\(X\)</span> into <em>bins</em>, and fit a different constant in each bin.
This amounts to converting a continuous variable into an <em>ordered categorical variable</em>.</p>
</blockquote>
<p>This involves using a set of <span class="math inline">\(K\)</span> cutpoints <span class="math inline">\(c_k\)</span> which corresponds to dummy variables <span class="math inline">\(C_k(X)\)</span>:</p>
<p><span class="math display">\[
\begin{align}
C_0(X) &amp;= I(X &lt; c_1), \\
C_1(X) &amp;= I(c_1 \leq X &lt; c_2), \\
C_2(X) &amp;= I(c_2 \leq X &lt; c_3), \\
&amp;\vdots \\
C_{K-1}(X) &amp;= I(c_{K-1} \leq X &lt; c_K), \\
C_K(X) &amp;= I(c_K \leq X),
\end{align}
\]</span></p>
<p>where <span class="math inline">\(I()\)</span> is an <em>indicator</em> function that returns a 1 or 0 if the condition is true or false.
The least squares linear model is then:</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 C_1(x_i) + \beta_2 C_2 (x_i) + \dots + \beta_K C_K (x_i) + \epsilon_i.
\]</span></p>
<p>To re-create Figure 7.2, I’ll use <code>cut</code> with 4 breaks to separate the <code>age</code> predictor:</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="moving-beyond-linearity.html#cb699-1" aria-hidden="true" tabindex="-1"></a>wage_step_linear_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">cut</span>(age, <span class="at">breaks =</span> <span class="dv">4</span>), <span class="at">data =</span> wage)</span>
<span id="cb699-2"><a href="moving-beyond-linearity.html#cb699-2" aria-hidden="true" tabindex="-1"></a>wage_step_logistic_fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> <span class="fu">cut</span>(age, <span class="at">breaks =</span> <span class="dv">4</span>),</span>
<span id="cb699-3"><a href="moving-beyond-linearity.html#cb699-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> wage, <span class="at">family =</span> binomial)</span>
<span id="cb699-4"><a href="moving-beyond-linearity.html#cb699-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> wage_step_linear_fit <span class="sc">%&gt;%</span></span>
<span id="cb699-5"><a href="moving-beyond-linearity.html#cb699-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid),</span>
<span id="cb699-6"><a href="moving-beyond-linearity.html#cb699-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>, <span class="at">level =</span> <span class="fl">0.50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb699-7"><a href="moving-beyond-linearity.html#cb699-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb699-8"><a href="moving-beyond-linearity.html#cb699-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wage, <span class="fu">aes</span>(<span class="at">y =</span> wage),</span>
<span id="cb699-9"><a href="moving-beyond-linearity.html#cb699-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb699-10"><a href="moving-beyond-linearity.html#cb699-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb699-11"><a href="moving-beyond-linearity.html#cb699-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .lower),</span>
<span id="cb699-12"><a href="moving-beyond-linearity.html#cb699-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb699-13"><a href="moving-beyond-linearity.html#cb699-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .upper),</span>
<span id="cb699-14"><a href="moving-beyond-linearity.html#cb699-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb699-15"><a href="moving-beyond-linearity.html#cb699-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;wage&quot;</span>)</span>
<span id="cb699-16"><a href="moving-beyond-linearity.html#cb699-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb699-17"><a href="moving-beyond-linearity.html#cb699-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> wage_step_logistic_fit <span class="sc">%&gt;%</span></span>
<span id="cb699-18"><a href="moving-beyond-linearity.html#cb699-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid),</span>
<span id="cb699-19"><a href="moving-beyond-linearity.html#cb699-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">type.predict =</span> <span class="st">&quot;link&quot;</span>, <span class="at">se_fit =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb699-20"><a href="moving-beyond-linearity.html#cb699-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb699-21"><a href="moving-beyond-linearity.html#cb699-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.lower =</span> .fitted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> .se.fit,</span>
<span id="cb699-22"><a href="moving-beyond-linearity.html#cb699-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">.upper =</span> .fitted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> .se.fit,</span>
<span id="cb699-23"><a href="moving-beyond-linearity.html#cb699-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(.fitted, .lower, .upper), <span class="sc">~</span> <span class="fu">exp</span>(.x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(.x)))</span>
<span id="cb699-24"><a href="moving-beyond-linearity.html#cb699-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb699-25"><a href="moving-beyond-linearity.html#cb699-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb699-26"><a href="moving-beyond-linearity.html#cb699-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="at">data =</span> wage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>),</span>
<span id="cb699-27"><a href="moving-beyond-linearity.html#cb699-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">sides =</span> <span class="st">&quot;t&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb699-28"><a href="moving-beyond-linearity.html#cb699-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="at">data =</span> wage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(wage <span class="sc">&lt;=</span> <span class="dv">250</span>),</span>
<span id="cb699-29"><a href="moving-beyond-linearity.html#cb699-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">sides =</span> <span class="st">&quot;b&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb699-30"><a href="moving-beyond-linearity.html#cb699-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb699-31"><a href="moving-beyond-linearity.html#cb699-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .lower), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb699-32"><a href="moving-beyond-linearity.html#cb699-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .upper), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb699-33"><a href="moving-beyond-linearity.html#cb699-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb699-34"><a href="moving-beyond-linearity.html#cb699-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Pr(wage &gt; 250 | age)&quot;</span>)</span>
<span id="cb699-35"><a href="moving-beyond-linearity.html#cb699-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb699-36"><a href="moving-beyond-linearity.html#cb699-36" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-2-1.png" width="576" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Unfortunately, unless there are natural breakpoints in the predictors,
piecewise-constant functions can miss the action. For example, in the left- hand
panel of Figure 7.2, the first bin clearly misses the increasing trend
of <code>wage</code> with <code>age</code>. Nevertheless, step function approaches are very popular
in biostatistics and epidemiology, among other disciplines. For example,
5-year age groups are often used to define the bins.</p>
</blockquote>
</div>
<div id="basis-functions" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Basis Functions</h2>
<blockquote>
<p>Polynomial and piecewise-constant regression models are in fact special
cases of a basis function approach. The idea is to have at hand a fam ily of
functions or transformations that can be applied to a variable <span class="math inline">\(X\)</span>:
<span class="math inline">\(b_1(X), b_2(X), \dots, b_K(X)\)</span>. Instead of fitting a linear model in <span class="math inline">\(X\)</span>, we fit the
model</p>
</blockquote>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 b_1(x_i) + \beta_2 b_2 (x_i) + \dots + \beta_K b_K (x_i) + \epsilon_i.
\]</span></p>
<p>In polynomial regression, these basis functions were <span class="math inline">\(b_j(x_i) = x_i^j\)</span>.
In piecewise-constant regression, they were <span class="math inline">\(b_j(x_i) = I(c_j \leq x_i &lt; c_{j+1})\)</span>.
Despite the increased complexity, this still amounts to estimating the unknown regression coefficients <span class="math inline">\(\beta\)</span>, for which all the least squares tools and models apply.</p>
</div>
<div id="regression-splines" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Regression Splines</h2>
<div id="piecewise-polynomials" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Piecewise Polynomials</h3>
<blockquote>
<p>Instead of fitting a high-degree polynomial over the entire range of <span class="math inline">\(X\)</span>, piecewise
polynomial regression involves fitting separate low-degree polynomials
over different regions of <span class="math inline">\(X\)</span>. For example, a piecewise cubic polynomial works
by fitting a cubic regression model of the form</p>
</blockquote>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3 + \epsilon_i.
\]</span></p>
<blockquote>
<p>where the coefficients <span class="math inline">\(\beta_0, \beta_1, \beta_2,\)</span> and <span class="math inline">\(\beta_3\)</span> differ in parts of the range of <span class="math inline">\(X\)</span>.
The points where the coefficients change are called <em>knots</em>.</p>
</blockquote>
<p>With 0 knots, we have the standard cubic polynomial with <span class="math inline">\(d = 3\)</span> as described in section 7.1.
With a single knot at point <span class="math inline">\(c\)</span>, this takes the form:</p>
<p><span class="math display">\[
\begin{align}
y_i &amp;= \beta_{01} + \beta_{11} x_i + \beta_{21} x_i^2 + \beta_{31} x_i^3 + \epsilon_i \ \ \ \text{if} \ \  x_i &lt; c \\
&amp;= \beta_{02} + \beta_{22} x_i + \beta_{22} x_i^2 + \beta_{32} x_i^3 + \epsilon_i \ \ \ \text{if} \ \  x_i \geq c.
\end{align}
\]</span></p>
<p>Functionally, this is essentially fitting two separate regression equations on subsets of <span class="math inline">\(X\)</span>, with 8 degrees of freedom for the eight regression coefficients.</p>
</div>
<div id="constraints-and-splines" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Constraints and Splines</h3>
<p>The problem with piecewise polynomials is that the resulting fit can be discontinuous, like in the top left panel of Figure 7.3.
To remedy this, we can fit a piecewise polynomial under the <em>constraint</em> that the fitted curve must be continuous, like in the top right panel.
The bottom left panel shows the result of two additional constraints: that the first and second derivative are continuous at <code>age = 50</code> – this is called a <em>cubic spline</em>, which generally has <span class="math inline">\(K + 4\)</span> degrees of freedom (=5 in this example).
The lower right panel shows a <em>linear spline</em>.</p>
</div>
<div id="spline-basis" class="section level3" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> The Spline Basis Representation</h3>
<p>In order to implement the continuity constraints for regression splines, we can use the basis model.
A cubic spline with <span class="math inline">\(K\)</span> knots can be modeled as</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 b_1(x_i) + \beta_2 b_2 (x_i) + \dots + \beta_{K+3} b_{K+3} (x_i) + \epsilon_i,
\]</span></p>
<p>for an appropriate choice of basis functions <span class="math inline">\(b_1, b_2, \dots, b_{K+3}\)</span>.
The model can then be fit with least squares.</p>
<p>There are many equivalent representations of cubic splines using different basis functions.
The most direct is to start with the cubic polynomial and then add one <em>truncated power basis function</em> per knot:</p>
<p><span class="math display">\[
\begin{align}
h(x, \xi) = (x - \xi)^2_+ &amp;= (x - \xi)^3 \ \ \ \text{if} \ \ \ x &gt; \xi \\ 
&amp;= 0 \ \ \ \ \ \ \ \ \ \ \ \ \ \ \text{otherwise},
\end{align}
\]</span></p>
<p>where <span class="math inline">\(\xi\)</span> is the knot.
One can show that adding the term <span class="math inline">\(\beta_4 h(x, \xi)\)</span> to the cubic spline model above will lead to a discontinuity in only the third derivative at <span class="math inline">\(\xi\)</span>, but remain continuous in the first and second derivatives.</p>
<p>Unfortunately, these splines have high variance at boundaries of the predictors.
This can be reduced with <em>natural splines</em> which have additional constraints at the boundaries to produce more stable estimates.
We can show this with confidence intervals of the models fit with cubic and natural cubic splines, as in Figure 7.4:</p>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="moving-beyond-linearity.html#cb700-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb700-2"><a href="moving-beyond-linearity.html#cb700-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb700-3"><a href="moving-beyond-linearity.html#cb700-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use just a subset of the data to mimic the figure</span></span>
<span id="cb700-4"><a href="moving-beyond-linearity.html#cb700-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20</span>)</span>
<span id="cb700-5"><a href="moving-beyond-linearity.html#cb700-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> wage <span class="sc">%&gt;%</span></span>
<span id="cb700-6"><a href="moving-beyond-linearity.html#cb700-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(wage <span class="sc">&lt;</span> <span class="dv">300</span>) <span class="sc">%&gt;%</span></span>
<span id="cb700-7"><a href="moving-beyond-linearity.html#cb700-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">500</span>)</span>
<span id="cb700-8"><a href="moving-beyond-linearity.html#cb700-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb700-9"><a href="moving-beyond-linearity.html#cb700-9" aria-hidden="true" tabindex="-1"></a>wage_bs_linear_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>)), <span class="at">data =</span> d)</span>
<span id="cb700-10"><a href="moving-beyond-linearity.html#cb700-10" aria-hidden="true" tabindex="-1"></a>wage_ns_linear_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">ns</span>(age, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>)), <span class="at">data =</span> d)</span>
<span id="cb700-11"><a href="moving-beyond-linearity.html#cb700-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb700-12"><a href="moving-beyond-linearity.html#cb700-12" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb700-13"><a href="moving-beyond-linearity.html#cb700-13" aria-hidden="true" tabindex="-1"></a>  wage_bs_linear_fit <span class="sc">%&gt;%</span></span>
<span id="cb700-14"><a href="moving-beyond-linearity.html#cb700-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid), <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb700-15"><a href="moving-beyond-linearity.html#cb700-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Cubic spline&quot;</span>),</span>
<span id="cb700-16"><a href="moving-beyond-linearity.html#cb700-16" aria-hidden="true" tabindex="-1"></a>  wage_ns_linear_fit <span class="sc">%&gt;%</span></span>
<span id="cb700-17"><a href="moving-beyond-linearity.html#cb700-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid), <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb700-18"><a href="moving-beyond-linearity.html#cb700-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Natural cubic spline&quot;</span>)</span>
<span id="cb700-19"><a href="moving-beyond-linearity.html#cb700-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb700-20"><a href="moving-beyond-linearity.html#cb700-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">fct_rev</span>(model)) <span class="sc">%&gt;%</span></span>
<span id="cb700-21"><a href="moving-beyond-linearity.html#cb700-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb700-22"><a href="moving-beyond-linearity.html#cb700-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">y =</span> wage),</span>
<span id="cb700-23"><a href="moving-beyond-linearity.html#cb700-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb700-24"><a href="moving-beyond-linearity.html#cb700-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted, <span class="at">color =</span> model), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb700-25"><a href="moving-beyond-linearity.html#cb700-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .lower, <span class="at">color =</span> model), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb700-26"><a href="moving-beyond-linearity.html#cb700-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .upper, <span class="at">color =</span> model), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb700-27"><a href="moving-beyond-linearity.html#cb700-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb700-28"><a href="moving-beyond-linearity.html#cb700-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">300</span>)) <span class="sc">+</span></span>
<span id="cb700-29"><a href="moving-beyond-linearity.html#cb700-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb700-30"><a href="moving-beyond-linearity.html#cb700-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-4-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="choosing-knots" class="section level3" number="7.4.4">
<h3><span class="header-section-number">7.4.4</span> Choosing the Number and Locations of the Knots</h3>
<blockquote>
<p>When we fit a spline, where should we place the knots? The regression
spline is most flexible in regions that contain a lot of knots, because in
those regions the polynomial coefficients can change rapidly. Hence, one
option is to place more knots in places where we feel the function might
vary most rapidly, and to place fewer knots where it seems more stable.
While this option can work well, in practice it is common to place knots in
a uniform fashion. One way to do this is to specify the desired degrees of
freedom, and then have the software automatically place the corresponding
number of knots at uniform quantiles of the data.</p>
</blockquote>
<p>The <code>splines::ns()</code> function, when provided the <code>df</code> argument, computes knot locations based on percentiles.
For the <code>age</code> data and <code>df = 4</code> (3 knots):</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="moving-beyond-linearity.html#cb701-1" aria-hidden="true" tabindex="-1"></a>age_ns <span class="ot">&lt;-</span> <span class="fu">ns</span>(wage<span class="sc">$</span>age, <span class="at">df =</span> <span class="dv">4</span>)</span>
<span id="cb701-2"><a href="moving-beyond-linearity.html#cb701-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(age_ns, <span class="st">&quot;knots&quot;</span>)</span></code></pre></div>
<pre><code>##   25%   50%   75% 
## 33.75 42.00 51.00</code></pre>
<p>Fit the model and re-create Figure 7.5:</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="moving-beyond-linearity.html#cb703-1" aria-hidden="true" tabindex="-1"></a>wage_ns_linear_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">ns</span>(age, <span class="at">df =</span> <span class="dv">4</span>), <span class="at">data =</span> wage)</span>
<span id="cb703-2"><a href="moving-beyond-linearity.html#cb703-2" aria-hidden="true" tabindex="-1"></a>wage_ns_logistic_fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> <span class="fu">ns</span>(age, <span class="at">df =</span> <span class="dv">4</span>),</span>
<span id="cb703-3"><a href="moving-beyond-linearity.html#cb703-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> wage, <span class="at">family =</span> binomial)</span>
<span id="cb703-4"><a href="moving-beyond-linearity.html#cb703-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-5"><a href="moving-beyond-linearity.html#cb703-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> wage_ns_linear_fit <span class="sc">%&gt;%</span></span>
<span id="cb703-6"><a href="moving-beyond-linearity.html#cb703-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid), <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb703-7"><a href="moving-beyond-linearity.html#cb703-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb703-8"><a href="moving-beyond-linearity.html#cb703-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wage, <span class="fu">aes</span>(<span class="at">y =</span> wage),</span>
<span id="cb703-9"><a href="moving-beyond-linearity.html#cb703-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb703-10"><a href="moving-beyond-linearity.html#cb703-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb703-11"><a href="moving-beyond-linearity.html#cb703-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .lower), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb703-12"><a href="moving-beyond-linearity.html#cb703-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .upper), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb703-13"><a href="moving-beyond-linearity.html#cb703-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">attr</span>(age_ns, <span class="st">&quot;knots&quot;</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb703-14"><a href="moving-beyond-linearity.html#cb703-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> wage_ns_logistic_fit <span class="sc">%&gt;%</span></span>
<span id="cb703-15"><a href="moving-beyond-linearity.html#cb703-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid),</span>
<span id="cb703-16"><a href="moving-beyond-linearity.html#cb703-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">type.predict =</span> <span class="st">&quot;link&quot;</span>, <span class="at">se_fit =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb703-17"><a href="moving-beyond-linearity.html#cb703-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb703-18"><a href="moving-beyond-linearity.html#cb703-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">.lower =</span> .fitted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> .se.fit,</span>
<span id="cb703-19"><a href="moving-beyond-linearity.html#cb703-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">.upper =</span> .fitted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> .se.fit,</span>
<span id="cb703-20"><a href="moving-beyond-linearity.html#cb703-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(.fitted, .lower, .upper), <span class="sc">~</span> <span class="fu">exp</span>(.x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(.x)))</span>
<span id="cb703-21"><a href="moving-beyond-linearity.html#cb703-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb703-22"><a href="moving-beyond-linearity.html#cb703-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb703-23"><a href="moving-beyond-linearity.html#cb703-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="at">data =</span> wage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>),</span>
<span id="cb703-24"><a href="moving-beyond-linearity.html#cb703-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">sides =</span> <span class="st">&quot;t&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb703-25"><a href="moving-beyond-linearity.html#cb703-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="at">data =</span> wage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(wage <span class="sc">&lt;=</span> <span class="dv">250</span>),</span>
<span id="cb703-26"><a href="moving-beyond-linearity.html#cb703-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">sides =</span> <span class="st">&quot;b&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb703-27"><a href="moving-beyond-linearity.html#cb703-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb703-28"><a href="moving-beyond-linearity.html#cb703-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .lower), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb703-29"><a href="moving-beyond-linearity.html#cb703-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .upper), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb703-30"><a href="moving-beyond-linearity.html#cb703-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">attr</span>(age_ns, <span class="st">&quot;knots&quot;</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb703-31"><a href="moving-beyond-linearity.html#cb703-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb703-32"><a href="moving-beyond-linearity.html#cb703-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Pr(wage &gt; 250 | age)&quot;</span>)</span>
<span id="cb703-33"><a href="moving-beyond-linearity.html#cb703-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-34"><a href="moving-beyond-linearity.html#cb703-34" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-5-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The automatic choice of knot location is usually sufficient, but how do we decide on the number of knots <span class="math inline">\(K\)</span>?
The same way we usually choose model hyperparameters: resampling.
For this, we turn to <code>tidymodels</code>, which has <code>step_bs()</code> and <code>step_ns()</code> functions for specifying basis splines and natural basis splines.</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="moving-beyond-linearity.html#cb704-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">93</span>)</span>
<span id="cb704-2"><a href="moving-beyond-linearity.html#cb704-2" aria-hidden="true" tabindex="-1"></a>wage_resamples <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(wage, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb704-3"><a href="moving-beyond-linearity.html#cb704-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-4"><a href="moving-beyond-linearity.html#cb704-4" aria-hidden="true" tabindex="-1"></a>wage_lm_bs_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(wage <span class="sc">~</span> age, <span class="at">data =</span> wage) <span class="sc">%&gt;%</span></span>
<span id="cb704-5"><a href="moving-beyond-linearity.html#cb704-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_bs</span>(age, <span class="at">deg_free =</span> <span class="fu">tune</span>(), <span class="at">degree =</span> <span class="fu">tune</span>())</span>
<span id="cb704-6"><a href="moving-beyond-linearity.html#cb704-6" aria-hidden="true" tabindex="-1"></a>wage_lm_ns_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(wage <span class="sc">~</span> age, <span class="at">data =</span> wage) <span class="sc">%&gt;%</span></span>
<span id="cb704-7"><a href="moving-beyond-linearity.html#cb704-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_ns</span>(age, <span class="at">deg_free =</span> <span class="fu">tune</span>())</span>
<span id="cb704-8"><a href="moving-beyond-linearity.html#cb704-8" aria-hidden="true" tabindex="-1"></a>lm_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>()</span>
<span id="cb704-9"><a href="moving-beyond-linearity.html#cb704-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-10"><a href="moving-beyond-linearity.html#cb704-10" aria-hidden="true" tabindex="-1"></a>wage_lm_bs_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb704-11"><a href="moving-beyond-linearity.html#cb704-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb704-12"><a href="moving-beyond-linearity.html#cb704-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(wage_lm_bs_rec)</span>
<span id="cb704-13"><a href="moving-beyond-linearity.html#cb704-13" aria-hidden="true" tabindex="-1"></a>wage_lm_ns_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb704-14"><a href="moving-beyond-linearity.html#cb704-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb704-15"><a href="moving-beyond-linearity.html#cb704-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(wage_lm_ns_rec)</span></code></pre></div>
<p>If I understand Figure 7.6 correctly, the results being displayed in the right panel aren’t all cubic splines because those models can’t have &lt;3 degrees of freedom.
For example, if I set degrees of freedom to <code>df = 2</code> and the polynomial degree of freedom to <code>degree = 3</code>, then <code>bs()</code> will calculate a negative number of knots.
It will automatically adjust <code>df</code> so the number of knots equals 0 and return a warning:</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="moving-beyond-linearity.html#cb705-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">2</span>, <span class="at">degree =</span> <span class="dv">3</span>), <span class="at">data =</span> wage)</span></code></pre></div>
<pre><code>## Warning in bs(age, df = 2, degree = 3): &#39;df&#39; was too small; have used 3</code></pre>
<pre><code>## 
## Call:
## lm(formula = wage ~ bs(age, df = 2, degree = 3), data = wage)
## 
## Coefficients:
##                  (Intercept)  bs(age, df = 2, degree = 3)1  
##                        58.69                        102.64  
## bs(age, df = 2, degree = 3)2  bs(age, df = 2, degree = 3)3  
##                        48.76                         40.80</code></pre>
<p>So in choosing the hyperparameters for these models, I will vary both <code>deg_free</code> and <code>degree</code> so that it fits a linear spline, quadratic spline, and 7 cubic splines (with varying numbers of knots) as follows:</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb708-1"><a href="moving-beyond-linearity.html#cb708-1" aria-hidden="true" tabindex="-1"></a>bs_df_grid <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb708-2"><a href="moving-beyond-linearity.html#cb708-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">deg_free =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">degree =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb708-3"><a href="moving-beyond-linearity.html#cb708-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">deg_free =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">degree =</span> <span class="dv">3</span>)</span>
<span id="cb708-4"><a href="moving-beyond-linearity.html#cb708-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb708-5"><a href="moving-beyond-linearity.html#cb708-5" aria-hidden="true" tabindex="-1"></a>bs_df_grid</span></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    deg_free degree
##       &lt;int&gt;  &lt;dbl&gt;
##  1        1      1
##  2        2      2
##  3        3      3
##  4        4      3
##  5        5      3
##  6        6      3
##  7        7      3
##  8        8      3
##  9        9      3
## 10       10      3</code></pre>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb710-1"><a href="moving-beyond-linearity.html#cb710-1" aria-hidden="true" tabindex="-1"></a>wage_lm_bs_tune <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(</span>
<span id="cb710-2"><a href="moving-beyond-linearity.html#cb710-2" aria-hidden="true" tabindex="-1"></a>  wage_lm_bs_workflow, <span class="at">resamples =</span> wage_resamples,</span>
<span id="cb710-3"><a href="moving-beyond-linearity.html#cb710-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> bs_df_grid</span>
<span id="cb710-4"><a href="moving-beyond-linearity.html#cb710-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The way degrees of freedom work in natural splines doesn’t require this adjustment, I can just provide <code>deg_free = 1:10</code>:</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="moving-beyond-linearity.html#cb711-1" aria-hidden="true" tabindex="-1"></a>wage_lm_ns_tune <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(</span>
<span id="cb711-2"><a href="moving-beyond-linearity.html#cb711-2" aria-hidden="true" tabindex="-1"></a>  wage_lm_ns_workflow, <span class="at">resamples =</span> wage_resamples,</span>
<span id="cb711-3"><a href="moving-beyond-linearity.html#cb711-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> bs_df_grid <span class="sc">%&gt;%</span> <span class="fu">select</span>(deg_free)</span>
<span id="cb711-4"><a href="moving-beyond-linearity.html#cb711-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Finally, re-create Figure 7.6:</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb712-1"><a href="moving-beyond-linearity.html#cb712-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(wage_lm_ns_tune) <span class="sc">%&gt;%</span></span>
<span id="cb712-2"><a href="moving-beyond-linearity.html#cb712-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb712-3"><a href="moving-beyond-linearity.html#cb712-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mse =</span> mean<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb712-4"><a href="moving-beyond-linearity.html#cb712-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> deg_free, <span class="at">y =</span> mse)) <span class="sc">+</span></span>
<span id="cb712-5"><a href="moving-beyond-linearity.html#cb712-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb712-6"><a href="moving-beyond-linearity.html#cb712-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb712-7"><a href="moving-beyond-linearity.html#cb712-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Degrees of freedom of natural spline&quot;</span>,</span>
<span id="cb712-8"><a href="moving-beyond-linearity.html#cb712-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>))  <span class="sc">+</span></span>
<span id="cb712-9"><a href="moving-beyond-linearity.html#cb712-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Mean squared error&quot;</span>)</span>
<span id="cb712-10"><a href="moving-beyond-linearity.html#cb712-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(wage_lm_bs_tune) <span class="sc">%&gt;%</span></span>
<span id="cb712-11"><a href="moving-beyond-linearity.html#cb712-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb712-12"><a href="moving-beyond-linearity.html#cb712-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mse =</span> mean<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb712-13"><a href="moving-beyond-linearity.html#cb712-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> deg_free, <span class="at">y =</span> mse)) <span class="sc">+</span></span>
<span id="cb712-14"><a href="moving-beyond-linearity.html#cb712-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb712-15"><a href="moving-beyond-linearity.html#cb712-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb712-16"><a href="moving-beyond-linearity.html#cb712-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Degrees of freedom of cubic spline&quot;</span>,</span>
<span id="cb712-17"><a href="moving-beyond-linearity.html#cb712-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>))  <span class="sc">+</span></span>
<span id="cb712-18"><a href="moving-beyond-linearity.html#cb712-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb712-19"><a href="moving-beyond-linearity.html#cb712-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-6-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="comparison-polynomial" class="section level3" number="7.4.5">
<h3><span class="header-section-number">7.4.5</span> Comparison to Polynomial Regression</h3>
<p>Figure 7.7 compares a natural cubic spline with 15 degrees of freedom to a 15-degree polynomial regression on the <code>wage</code> data:</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="moving-beyond-linearity.html#cb713-1" aria-hidden="true" tabindex="-1"></a>wage_ns_15_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">ns</span>(age, <span class="at">df =</span> <span class="dv">15</span>), <span class="at">data =</span> wage)</span>
<span id="cb713-2"><a href="moving-beyond-linearity.html#cb713-2" aria-hidden="true" tabindex="-1"></a>wage_poly_15_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="at">degree =</span> <span class="dv">15</span>), <span class="at">data =</span> wage)</span>
<span id="cb713-3"><a href="moving-beyond-linearity.html#cb713-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb713-4"><a href="moving-beyond-linearity.html#cb713-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb713-5"><a href="moving-beyond-linearity.html#cb713-5" aria-hidden="true" tabindex="-1"></a>  wage_ns_15_fit <span class="sc">%&gt;%</span></span>
<span id="cb713-6"><a href="moving-beyond-linearity.html#cb713-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid)) <span class="sc">%&gt;%</span></span>
<span id="cb713-7"><a href="moving-beyond-linearity.html#cb713-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Natural cubic spline&quot;</span>),</span>
<span id="cb713-8"><a href="moving-beyond-linearity.html#cb713-8" aria-hidden="true" tabindex="-1"></a>  wage_poly_15_fit <span class="sc">%&gt;%</span></span>
<span id="cb713-9"><a href="moving-beyond-linearity.html#cb713-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extend the age range a bit to see more of the fit</span></span>
<span id="cb713-10"><a href="moving-beyond-linearity.html#cb713-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">c</span>(age_grid, <span class="fl">80.5</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb713-11"><a href="moving-beyond-linearity.html#cb713-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Polynomial&quot;</span>)</span>
<span id="cb713-12"><a href="moving-beyond-linearity.html#cb713-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb713-13"><a href="moving-beyond-linearity.html#cb713-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb713-14"><a href="moving-beyond-linearity.html#cb713-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wage, <span class="fu">aes</span>(<span class="at">y =</span> wage),</span>
<span id="cb713-15"><a href="moving-beyond-linearity.html#cb713-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb713-16"><a href="moving-beyond-linearity.html#cb713-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted, <span class="at">color =</span> model), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb713-17"><a href="moving-beyond-linearity.html#cb713-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb713-18"><a href="moving-beyond-linearity.html#cb713-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-7-1.png" width="576" style="display: block; margin: auto;" /></p>
<blockquote>
<p>The extra flexibility in the polynomial produces undesirable results at the boundaries, while the natural
cubic spline still provides a reasonable fit to the data. Regression splines
often give superior results to polynomial regression. This is because unlike
polynomials, which must use a high degree (exponent in the highest monomial term,
e.g. <span class="math inline">\(X^{15}\)</span>) to produce flexible fits, splines introduce flexibility
by increasing the number of knots but keeping the degree fixed. Generally,
this approach produces more stable estimates. Splines also allow us to place
more knots, and hence flexibility, over regions where the function <span class="math inline">\(f\)</span> seems
to be changing rapidly, and fewer knots where <span class="math inline">\(f\)</span> appears more stable.</p>
</blockquote>
</div>
</div>
<div id="smoothing-splines" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Smoothing Splines</h2>
<div id="an-overview-of-smoothing-splines" class="section level3" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> An Overview of Smoothing Splines</h3>
<p>To fit a curve <span class="math inline">\(g(x)\)</span> to a set of data, we want <span class="math inline">\(\text{RSS} = \sum_{i=1}^n (y_i - g(x_i))^2\)</span> to be small.
If there are no constraints on <span class="math inline">\(g(x)\)</span>, however, then it will simply overfit the data completely for <span class="math inline">\(\text{RSS} = 0\)</span>.</p>
<p>There are a number of ways to ensure that <span class="math inline">\(g\)</span> is smooth.
One way is to find <span class="math inline">\(g\)</span> that minimizes</p>
<p><span class="math display">\[
\text{RSS} + \lambda \int g&#39;&#39; (t)^2 dt
\]</span></p>
<p>where <span class="math inline">\(\lambda\)</span> is a non-negative penalty parameter (that will control the bias-variance trade-off as we’ve seen before).
The function <span class="math inline">\(g\)</span> that minimizes the above is known as a <em>smoothing spline</em>.
By placing the constraint on the second derivative <span class="math inline">\(g&#39;&#39;\)</span>, we encourage <span class="math inline">\(g\)</span> to be smooth.</p>
<p>It turns out that the optimal <span class="math inline">\(g(x)\)</span> is a natural cubic polynomial with knots at unique values of <span class="math inline">\(x\)</span> (and continuous first and second derivatives at each knot).
However, it is not the same one we would get with the basis function approach in Section 7.4.3 with knots at each value of <span class="math inline">\(x\)</span> – rather, it is a <em>shrunken</em> version of that spline, where <span class="math inline">\(\lambda\)</span> controls the level of shrinkage</p>
</div>
<div id="smoothing-parameter" class="section level3" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Choosing the Smoothing Parameter <span class="math inline">\(\lambda\)</span></h3>
<p>It may seem like a smoothing spline, with knots at every unique value of <span class="math inline">\(x_i\)</span>, will have far too many degrees of freedom, but the tuning parameter <span class="math inline">\(\lambda\)</span> controls the <em>effective degrees of freedom</em> <span class="math inline">\(df_{\lambda}\)</span>.
The higher <span class="math inline">\(df_{\lambda}\)</span>, the more flexible (lower bias, higher variance) the smoothing spline.</p>
<p>Unlike the other spline methods, we do not need to select the number or location of the knots.
We instead have to choose the value of <span class="math inline">\(\lambda\)</span>, usually via cross-validation.
It turns out that the LOOCV error can be computed very efficiently for smoothing splines, with essentially the same cost as computing a single fit, with this formula:</p>
<p><span class="math display">\[
\text{RSS}_{cv} (\lambda) = \sum_{i=1}^n (y_i - \hat{g}_{\lambda}^{(-i)} (x_i))^2
= \sum_{i=1}^n \left[\frac{y_i - \hat{g}_{\lambda}(x_i)}{1 - \{\textbf{S}_{\lambda}\}_{ii}}\right].
\]</span></p>
<p>where <span class="math inline">\(\hat{g}_{\lambda}^{(-i)}\)</span> is the fitted value for this smoothing spline evaluated at <span class="math inline">\(x_i\)</span>, with the fit using all training observations except for <span class="math inline">\((x_i, y_i)\)</span>.</p>
<blockquote>
<p>In contrast, <span class="math inline">\(\hat{g}_{\lambda}(x_i)\)</span> indicates the smoothing
spline function fit to all of the training observations and evaluated at <span class="math inline">\(x_i\)</span>.
This remarkable formula says that we can compute each of these leave- one-out
fits using only <span class="math inline">\(\hat{g}_{\lambda}\)</span>, the original fit to all of the data!
We have
a very similar formula (5.2) on page 202 in Chapter 5 for least squares
linear regression. Using (5.2), we can very quickly perform LOOCV for
the regression splines discussed earlier in this chapter, as well as for least
squares regression using arbitrary basis functions.</p>
</blockquote>
<p>The <code>smooth.spline()</code> function fits a smoothing spline to data as follows:</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="moving-beyond-linearity.html#cb714-1" aria-hidden="true" tabindex="-1"></a>wage_smooth_df_16 <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="at">x =</span> wage<span class="sc">$</span>age, <span class="at">y =</span> wage<span class="sc">$</span>wage, <span class="at">df =</span> <span class="dv">16</span>)</span>
<span id="cb714-2"><a href="moving-beyond-linearity.html#cb714-2" aria-hidden="true" tabindex="-1"></a>wage_smooth_df_16</span></code></pre></div>
<pre><code>## Call:
## smooth.spline(x = wage$age, y = wage$wage, df = 16)
## 
## Smoothing Parameter  spar= 0.4732071  lambda= 0.0006537868 (13 iterations)
## Equivalent Degrees of Freedom (Df): 16.00237
## Penalized Criterion (RSS): 61597.01
## GCV: 1599.69</code></pre>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb716-1"><a href="moving-beyond-linearity.html#cb716-1" aria-hidden="true" tabindex="-1"></a>wage_smooth_cv <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="at">x =</span> wage<span class="sc">$</span>age, <span class="at">y =</span> wage<span class="sc">$</span>wage, <span class="at">cv =</span> <span class="cn">TRUE</span>)</span>
<span id="cb716-2"><a href="moving-beyond-linearity.html#cb716-2" aria-hidden="true" tabindex="-1"></a>wage_smooth_cv</span></code></pre></div>
<pre><code>## Call:
## smooth.spline(x = wage$age, y = wage$wage, cv = TRUE)
## 
## Smoothing Parameter  spar= 0.6988943  lambda= 0.02792303 (12 iterations)
## Equivalent Degrees of Freedom (Df): 6.794596
## Penalized Criterion (RSS): 75215.9
## PRESS(l.o.o. CV): 1593.383</code></pre>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="moving-beyond-linearity.html#cb718-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb718-2"><a href="moving-beyond-linearity.html#cb718-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="fu">predict</span>(wage_smooth_df_16, age_grid)) <span class="sc">%&gt;%</span></span>
<span id="cb718-3"><a href="moving-beyond-linearity.html#cb718-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;16 degrees of freedom&quot;</span>),</span>
<span id="cb718-4"><a href="moving-beyond-linearity.html#cb718-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="fu">predict</span>(wage_smooth_cv, age_grid)) <span class="sc">%&gt;%</span></span>
<span id="cb718-5"><a href="moving-beyond-linearity.html#cb718-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;6.8 degrees of freedom (LOOCV)&quot;</span>)</span>
<span id="cb718-6"><a href="moving-beyond-linearity.html#cb718-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb718-7"><a href="moving-beyond-linearity.html#cb718-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb718-8"><a href="moving-beyond-linearity.html#cb718-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wage, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wage),</span>
<span id="cb718-9"><a href="moving-beyond-linearity.html#cb718-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb718-10"><a href="moving-beyond-linearity.html#cb718-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> model), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb718-11"><a href="moving-beyond-linearity.html#cb718-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb718-12"><a href="moving-beyond-linearity.html#cb718-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-8-1.png" width="576" style="display: block; margin: auto;" /></p>
<blockquote>
<p>The red curve indicates the fit obtained from pre-specifying that we
would like a smoothing spline with 16 effective degrees of freedom. The blue
curve is the smoothing spline obtained when <span class="math inline">\(\lambda\)</span> is chosen using LOOCV; in
this case, the value of <span class="math inline">\(\lambda\)</span> chosen results in 6.8 effective degrees of freedom
(computed using (7.13)). For this data, there is little discernible difference
between the two smoothing splines, beyond the fact that the one with 16
degrees of freedom seems slightly wigglier. Since there is little difference
between the two fits, the smoothing spline fit with 6.8 degrees of freedom
is preferable, since in general simpler models are better unless the data
provides evidence in support of a more complex model.</p>
</blockquote>
</div>
</div>
<div id="local-regression" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Local Regression</h2>
<p><em>Local regression</em> involves computing the fit at a target point <span class="math inline">\(x_0\)</span> using just the nearby (local) training observations.
It involves a number of choices, such the weighting function <span class="math inline">\(K\)</span>, and whether to fit a linear, constant or quadratic regression.
The most important choice is the span <span class="math inline">\(s\)</span> which is the proportion of points used to compute the local regression at <span class="math inline">\(x_0\)</span>.
It is analogous to <span class="math inline">\(\lambda\)</span> in smoothing splines: the smaller the value <span class="math inline">\(s\)</span>, the more <em>local</em> and flexible the fit; the larger the value, the less flexible.</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="moving-beyond-linearity.html#cb719-1" aria-hidden="true" tabindex="-1"></a>wage_local_s_0<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">loess</span>(wage <span class="sc">~</span> age, <span class="at">data =</span> wage, <span class="at">span =</span> <span class="fl">0.2</span>)</span>
<span id="cb719-2"><a href="moving-beyond-linearity.html#cb719-2" aria-hidden="true" tabindex="-1"></a>wage_local_s_0<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">loess</span>(wage <span class="sc">~</span> age, <span class="at">data =</span> wage, <span class="at">span =</span> <span class="fl">0.7</span>)</span>
<span id="cb719-3"><a href="moving-beyond-linearity.html#cb719-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-4"><a href="moving-beyond-linearity.html#cb719-4" aria-hidden="true" tabindex="-1"></a>wage_local_s_0<span class="fl">.2</span>; wage_local_s_0<span class="fl">.7</span></span></code></pre></div>
<pre><code>## Call:
## loess(formula = wage ~ age, data = wage, span = 0.2)
## 
## Number of Observations: 3000 
## Equivalent Number of Parameters: 16.42 
## Residual Standard Error: 39.92</code></pre>
<pre><code>## Call:
## loess(formula = wage ~ age, data = wage, span = 0.7)
## 
## Number of Observations: 3000 
## Equivalent Number of Parameters: 5.3 
## Residual Standard Error: 39.9</code></pre>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="moving-beyond-linearity.html#cb722-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb722-2"><a href="moving-beyond-linearity.html#cb722-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(wage_local_s_0<span class="fl">.2</span>, <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid)) <span class="sc">%&gt;%</span></span>
<span id="cb722-3"><a href="moving-beyond-linearity.html#cb722-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Span is 0.2 (16.4 degres of freedom)&quot;</span>),</span>
<span id="cb722-4"><a href="moving-beyond-linearity.html#cb722-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(wage_local_s_0<span class="fl">.7</span>, <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid)) <span class="sc">%&gt;%</span></span>
<span id="cb722-5"><a href="moving-beyond-linearity.html#cb722-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Span is 0.7 (5.3 degres of freedom)&quot;</span>)</span>
<span id="cb722-6"><a href="moving-beyond-linearity.html#cb722-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb722-7"><a href="moving-beyond-linearity.html#cb722-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb722-8"><a href="moving-beyond-linearity.html#cb722-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wage, <span class="fu">aes</span>(<span class="at">y =</span> wage),</span>
<span id="cb722-9"><a href="moving-beyond-linearity.html#cb722-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb722-10"><a href="moving-beyond-linearity.html#cb722-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted, <span class="at">color =</span> model), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb722-11"><a href="moving-beyond-linearity.html#cb722-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb722-12"><a href="moving-beyond-linearity.html#cb722-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-10-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="generalized-additive-models" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Generalized Additive Models</h2>
<p>In previous sections, we have presented approaches for flexibly predicting a response <span class="math inline">\(Y\)</span> with a single predictor <span class="math inline">\(X\)</span>.
<em>Generalized additive models</em> (GAMs) provide a general framework for extending a standard linear model by allowing non-linear functions of each of the variables, while maintaining <em>additivity</em>.</p>
<div id="gam-regression" class="section level3" number="7.7.1">
<h3><span class="header-section-number">7.7.1</span> GAMs for Regression Problems</h3>
<p>To extend the multiple linear regression model, we replace the coefficient components <span class="math inline">\(\beta_j x_{ij}\)</span> with smooth non-linear functions <span class="math inline">\(f_j (x_{ij})\)</span>:</p>
<p><span class="math display">\[
y_i = \beta_0 + f_1 (x_{i1}) + f_2 (x_{i2}) + \dots + f_p (x_{ip}) + \epsilon_i.
\]</span></p>
<p>Consider the task of fitting the model:</p>
<p><span class="math display">\[
\texttt{wage} = \beta_0 + f_1(\texttt{year}) + f_2 (\texttt{age}) + f_3 (\texttt{education}) + \epsilon.
\]</span></p>
<p>In the example in Figure 7.11, the quantitative variables <code>year</code> and <code>age</code> are fit using natural splines, and the qualitative variable (with 5 levels) <code>education</code> is fit via the usual dummy variable approach.</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb723-1"><a href="moving-beyond-linearity.html#cb723-1" aria-hidden="true" tabindex="-1"></a>wage_gam_ns_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">ns</span>(year, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">ns</span>(age, <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> wage)</span>
<span id="cb723-2"><a href="moving-beyond-linearity.html#cb723-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Though the model wasn&#39;t fit with `gam::gam()`, we can still use the</span></span>
<span id="cb723-3"><a href="moving-beyond-linearity.html#cb723-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  `gam::plot.Gam()` function on the `lm` object to retrieve the smooth functions</span></span>
<span id="cb723-4"><a href="moving-beyond-linearity.html#cb723-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab the data from the plot object so I can use it in `ggplot2`</span></span>
<span id="cb723-5"><a href="moving-beyond-linearity.html#cb723-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">invisible</span>(gam<span class="sc">::</span><span class="fu">plot.Gam</span>(wage_gam_ns_fit))</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-11-1.png" width="576" style="display: block; margin: auto;" /><img src="_main_files/figure-html/figure7-11-2.png" width="576" style="display: block; margin: auto;" /><img src="_main_files/figure-html/figure7-11-3.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb724-1"><a href="moving-beyond-linearity.html#cb724-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb724-2"><a href="moving-beyond-linearity.html#cb724-2" aria-hidden="true" tabindex="-1"></a>  d<span class="sc">$</span>preplot,</span>
<span id="cb724-3"><a href="moving-beyond-linearity.html#cb724-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">tibble</span>(<span class="at">x =</span> .<span class="sc">$</span>x, <span class="at">y =</span> .<span class="sc">$</span>y, <span class="at">y_se =</span> .<span class="sc">$</span>se.y, <span class="at">xlab =</span> .<span class="sc">$</span>xlab, <span class="at">ylab =</span> .<span class="sc">$</span>ylab) <span class="sc">%&gt;%</span></span>
<span id="cb724-4"><a href="moving-beyond-linearity.html#cb724-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y_lower =</span> y <span class="sc">-</span> y_se, <span class="at">y_upper =</span> y <span class="sc">+</span> y_se)</span>
<span id="cb724-5"><a href="moving-beyond-linearity.html#cb724-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb724-6"><a href="moving-beyond-linearity.html#cb724-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb724-7"><a href="moving-beyond-linearity.html#cb724-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d<span class="sc">$</span><span class="st">`</span><span class="at">ns(year, 4)</span><span class="st">`</span> <span class="sc">%&gt;%</span></span>
<span id="cb724-8"><a href="moving-beyond-linearity.html#cb724-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb724-9"><a href="moving-beyond-linearity.html#cb724-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb724-10"><a href="moving-beyond-linearity.html#cb724-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_lower), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb724-11"><a href="moving-beyond-linearity.html#cb724-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_upper), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb724-12"><a href="moving-beyond-linearity.html#cb724-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span><span class="st">`</span><span class="at">ns(year, 4)</span><span class="st">`</span><span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb724-13"><a href="moving-beyond-linearity.html#cb724-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb724-14"><a href="moving-beyond-linearity.html#cb724-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d<span class="sc">$</span><span class="st">`</span><span class="at">ns(age, 5)</span><span class="st">`</span> <span class="sc">%&gt;%</span></span>
<span id="cb724-15"><a href="moving-beyond-linearity.html#cb724-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb724-16"><a href="moving-beyond-linearity.html#cb724-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb724-17"><a href="moving-beyond-linearity.html#cb724-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_lower), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb724-18"><a href="moving-beyond-linearity.html#cb724-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_upper), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb724-19"><a href="moving-beyond-linearity.html#cb724-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span><span class="st">`</span><span class="at">ns(age, 5)</span><span class="st">`</span><span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb724-20"><a href="moving-beyond-linearity.html#cb724-20" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> d<span class="sc">$</span>education <span class="sc">%&gt;%</span></span>
<span id="cb724-21"><a href="moving-beyond-linearity.html#cb724-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb724-22"><a href="moving-beyond-linearity.html#cb724-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">ymin =</span> y_lower, <span class="at">ymax =</span> y_upper)) <span class="sc">+</span></span>
<span id="cb724-23"><a href="moving-beyond-linearity.html#cb724-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span>education<span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb724-24"><a href="moving-beyond-linearity.html#cb724-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">vjust =</span> <span class="fl">0.7</span>))</span>
<span id="cb724-25"><a href="moving-beyond-linearity.html#cb724-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-11-4.png" width="576" style="display: block; margin: auto;" /></p>
<p>For Figure 7.12, we use the <code>gam</code> package and specify smoothing splines:</p>
<div class="sourceCode" id="cb725"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb725-1"><a href="moving-beyond-linearity.html#cb725-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gam)</span></code></pre></div>
<pre><code>## Loaded gam 1.20.1</code></pre>
<div class="sourceCode" id="cb727"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb727-1"><a href="moving-beyond-linearity.html#cb727-1" aria-hidden="true" tabindex="-1"></a>wage_gam_smooth_fit <span class="ot">&lt;-</span></span>
<span id="cb727-2"><a href="moving-beyond-linearity.html#cb727-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(year, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">s</span>(age, <span class="dv">5</span>) <span class="sc">+</span> education,</span>
<span id="cb727-3"><a href="moving-beyond-linearity.html#cb727-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> wage)</span>
<span id="cb727-4"><a href="moving-beyond-linearity.html#cb727-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb727-5"><a href="moving-beyond-linearity.html#cb727-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">plot</span>(wage_gam_smooth_fit, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-393-1.png" width="576" style="display: block; margin: auto;" /><img src="_main_files/figure-html/unnamed-chunk-393-2.png" width="576" style="display: block; margin: auto;" /><img src="_main_files/figure-html/unnamed-chunk-393-3.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb728"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb728-1"><a href="moving-beyond-linearity.html#cb728-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb728-2"><a href="moving-beyond-linearity.html#cb728-2" aria-hidden="true" tabindex="-1"></a>  d<span class="sc">$</span>preplot,</span>
<span id="cb728-3"><a href="moving-beyond-linearity.html#cb728-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">tibble</span>(<span class="at">x =</span> .<span class="sc">$</span>x, <span class="at">y =</span> .<span class="sc">$</span>y, <span class="at">y_se =</span> .<span class="sc">$</span>se.y, <span class="at">xlab =</span> .<span class="sc">$</span>xlab, <span class="at">ylab =</span> .<span class="sc">$</span>ylab) <span class="sc">%&gt;%</span></span>
<span id="cb728-4"><a href="moving-beyond-linearity.html#cb728-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y_lower =</span> y <span class="sc">-</span> y_se, <span class="at">y_upper =</span> y <span class="sc">+</span> y_se)</span>
<span id="cb728-5"><a href="moving-beyond-linearity.html#cb728-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb728-6"><a href="moving-beyond-linearity.html#cb728-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb728-7"><a href="moving-beyond-linearity.html#cb728-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d<span class="sc">$</span><span class="st">`</span><span class="at">s(year, 4)</span><span class="st">`</span> <span class="sc">%&gt;%</span></span>
<span id="cb728-8"><a href="moving-beyond-linearity.html#cb728-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb728-9"><a href="moving-beyond-linearity.html#cb728-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb728-10"><a href="moving-beyond-linearity.html#cb728-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_lower), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb728-11"><a href="moving-beyond-linearity.html#cb728-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_upper), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb728-12"><a href="moving-beyond-linearity.html#cb728-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span><span class="st">`</span><span class="at">s(year, 4)</span><span class="st">`</span><span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb728-13"><a href="moving-beyond-linearity.html#cb728-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb728-14"><a href="moving-beyond-linearity.html#cb728-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d<span class="sc">$</span><span class="st">`</span><span class="at">s(age, 5)</span><span class="st">`</span> <span class="sc">%&gt;%</span></span>
<span id="cb728-15"><a href="moving-beyond-linearity.html#cb728-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb728-16"><a href="moving-beyond-linearity.html#cb728-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb728-17"><a href="moving-beyond-linearity.html#cb728-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_lower), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb728-18"><a href="moving-beyond-linearity.html#cb728-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_upper), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb728-19"><a href="moving-beyond-linearity.html#cb728-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span><span class="st">`</span><span class="at">s(age, 5)</span><span class="st">`</span><span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb728-20"><a href="moving-beyond-linearity.html#cb728-20" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> d<span class="sc">$</span>education <span class="sc">%&gt;%</span></span>
<span id="cb728-21"><a href="moving-beyond-linearity.html#cb728-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb728-22"><a href="moving-beyond-linearity.html#cb728-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">ymin =</span> y_lower, <span class="at">ymax =</span> y_upper)) <span class="sc">+</span></span>
<span id="cb728-23"><a href="moving-beyond-linearity.html#cb728-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span>education<span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb728-24"><a href="moving-beyond-linearity.html#cb728-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">vjust =</span> <span class="fl">0.7</span>))</span>
<span id="cb728-25"><a href="moving-beyond-linearity.html#cb728-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-12-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The fitted functions are essentially equivalent between the natural and smoothing splines.</p>
<blockquote>
<p>Fitting a GAM with a smoothing spline is not quite as simple as fitting a GAM
with a natural spline, since in the case of smoothing splines, least squares
cannot be used. However, standard software such as the <code>gam()</code> function in R
can be used to fit GAMs using smoothing splines, via an approach known
as backfitting. This method fits a model involving multiple predictors by backfitting repeatedly updating the fit for each predictor in turn, holding the others
fixed. The beauty of this approach is that each time we update a function,
we simply apply the fitting method for that variable to a partial residual.</p>
</blockquote>
<blockquote>
<p>We do not have to use splines as the building blocks for GAMs: we can
just as well use local regression, polynomial regression, or any combination
of the approaches seen earlier in this chapter in order to create a GAM.</p>
</blockquote>
<div id="pros-and-cons-of-gams" class="section level4 unnumbered">
<h4>Pros and Cons of GAMs</h4>
<p>Pros:</p>
<ul>
<li>GAMs allow <span class="math inline">\(f_j\)</span> fits to each <span class="math inline">\(X_j\)</span>, which is a way to flexibly and (nearly) automatically capture non-linearity.</li>
<li>Non-linear fits can improve prediction accuracy.</li>
<li>Because the models are additive, we can examine the effect of each <span class="math inline">\(X_j\)</span> on <span class="math inline">\(Y\)</span> separately, while holding others fixed.</li>
<li>Smoothness of each <span class="math inline">\(f_j\)</span> can be summarized via degrees of freedom.</li>
</ul>
<p>Cons:</p>
<ul>
<li>The main limitation is the additive restriction. We cannot add interaction terms like <span class="math inline">\(X_j \times X_k\)</span> to GAMs.</li>
</ul>
<p>GAMs provide as useful compromise between linear and fully non-parametric models.</p>
</div>
</div>
<div id="gam-classification" class="section level3" number="7.7.2">
<h3><span class="header-section-number">7.7.2</span> GAMs for Classification Problems</h3>
<p>GAMs are easily extended to other response distributions via the <code>family</code> argument, such as <code>binomial</code> for logistic regression classification.</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb729-1"><a href="moving-beyond-linearity.html#cb729-1" aria-hidden="true" tabindex="-1"></a>wage_gam_fit_binom <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb729-2"><a href="moving-beyond-linearity.html#cb729-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">s</span>(age, <span class="dv">5</span>) <span class="sc">+</span> education,</span>
<span id="cb729-3"><a href="moving-beyond-linearity.html#cb729-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial, <span class="at">data =</span> wage</span>
<span id="cb729-4"><a href="moving-beyond-linearity.html#cb729-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb729-5"><a href="moving-beyond-linearity.html#cb729-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">plot</span>(wage_gam_fit_binom)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-395-1.png" width="576" style="display: block; margin: auto;" /><img src="_main_files/figure-html/unnamed-chunk-395-2.png" width="576" style="display: block; margin: auto;" /><img src="_main_files/figure-html/unnamed-chunk-395-3.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb730"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb730-1"><a href="moving-beyond-linearity.html#cb730-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb730-2"><a href="moving-beyond-linearity.html#cb730-2" aria-hidden="true" tabindex="-1"></a>  d<span class="sc">$</span>preplot,</span>
<span id="cb730-3"><a href="moving-beyond-linearity.html#cb730-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">tibble</span>(<span class="at">x =</span> .<span class="sc">$</span>x, <span class="at">y =</span> .<span class="sc">$</span>y, <span class="at">y_se =</span> .<span class="sc">$</span>se.y, <span class="at">xlab =</span> .<span class="sc">$</span>xlab, <span class="at">ylab =</span> .<span class="sc">$</span>ylab) <span class="sc">%&gt;%</span></span>
<span id="cb730-4"><a href="moving-beyond-linearity.html#cb730-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y_lower =</span> y <span class="sc">-</span> y_se, <span class="at">y_upper =</span> y <span class="sc">+</span> y_se)</span>
<span id="cb730-5"><a href="moving-beyond-linearity.html#cb730-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb730-6"><a href="moving-beyond-linearity.html#cb730-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb730-7"><a href="moving-beyond-linearity.html#cb730-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d<span class="sc">$</span>year <span class="sc">%&gt;%</span></span>
<span id="cb730-8"><a href="moving-beyond-linearity.html#cb730-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb730-9"><a href="moving-beyond-linearity.html#cb730-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb730-10"><a href="moving-beyond-linearity.html#cb730-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_lower), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb730-11"><a href="moving-beyond-linearity.html#cb730-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_upper), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb730-12"><a href="moving-beyond-linearity.html#cb730-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span><span class="st">`</span><span class="at">s(year, 4)</span><span class="st">`</span><span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb730-13"><a href="moving-beyond-linearity.html#cb730-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb730-14"><a href="moving-beyond-linearity.html#cb730-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d<span class="sc">$</span><span class="st">`</span><span class="at">s(age, 5)</span><span class="st">`</span> <span class="sc">%&gt;%</span></span>
<span id="cb730-15"><a href="moving-beyond-linearity.html#cb730-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb730-16"><a href="moving-beyond-linearity.html#cb730-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb730-17"><a href="moving-beyond-linearity.html#cb730-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_lower), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb730-18"><a href="moving-beyond-linearity.html#cb730-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_upper), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb730-19"><a href="moving-beyond-linearity.html#cb730-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span><span class="st">`</span><span class="at">s(age, 5)</span><span class="st">`</span><span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb730-20"><a href="moving-beyond-linearity.html#cb730-20" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> d<span class="sc">$</span>education <span class="sc">%&gt;%</span></span>
<span id="cb730-21"><a href="moving-beyond-linearity.html#cb730-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb730-22"><a href="moving-beyond-linearity.html#cb730-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">ymin =</span> y_lower, <span class="at">ymax =</span> y_upper)) <span class="sc">+</span></span>
<span id="cb730-23"><a href="moving-beyond-linearity.html#cb730-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span>education<span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb730-24"><a href="moving-beyond-linearity.html#cb730-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">vjust =</span> <span class="fl">0.7</span>))</span>
<span id="cb730-25"><a href="moving-beyond-linearity.html#cb730-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-13-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>There are 0 occurrences of <code>wage &gt; 250</code> for <code>education = "1. &lt; HS Grad"</code>, which is causing very wide SE range.
Re-fit the model excluding that value of <code>education</code>:</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb731-1"><a href="moving-beyond-linearity.html#cb731-1" aria-hidden="true" tabindex="-1"></a>wage_gam_fit_binom <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb731-2"><a href="moving-beyond-linearity.html#cb731-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">s</span>(age, <span class="dv">5</span>) <span class="sc">+</span> education,</span>
<span id="cb731-3"><a href="moving-beyond-linearity.html#cb731-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial, <span class="at">data =</span> <span class="fu">filter</span>(wage, education <span class="sc">!=</span> <span class="st">&quot;1. &lt; HS Grad&quot;</span>)</span>
<span id="cb731-4"><a href="moving-beyond-linearity.html#cb731-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb731-5"><a href="moving-beyond-linearity.html#cb731-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">plot</span>(wage_gam_fit_binom)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-396-1.png" width="576" style="display: block; margin: auto;" /><img src="_main_files/figure-html/unnamed-chunk-396-2.png" width="576" style="display: block; margin: auto;" /><img src="_main_files/figure-html/unnamed-chunk-396-3.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb732"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb732-1"><a href="moving-beyond-linearity.html#cb732-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb732-2"><a href="moving-beyond-linearity.html#cb732-2" aria-hidden="true" tabindex="-1"></a>  d<span class="sc">$</span>preplot,</span>
<span id="cb732-3"><a href="moving-beyond-linearity.html#cb732-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">tibble</span>(<span class="at">x =</span> .<span class="sc">$</span>x, <span class="at">y =</span> .<span class="sc">$</span>y, <span class="at">y_se =</span> .<span class="sc">$</span>se.y, <span class="at">xlab =</span> .<span class="sc">$</span>xlab, <span class="at">ylab =</span> .<span class="sc">$</span>ylab) <span class="sc">%&gt;%</span></span>
<span id="cb732-4"><a href="moving-beyond-linearity.html#cb732-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y_lower =</span> y <span class="sc">-</span> y_se, <span class="at">y_upper =</span> y <span class="sc">+</span> y_se)</span>
<span id="cb732-5"><a href="moving-beyond-linearity.html#cb732-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb732-6"><a href="moving-beyond-linearity.html#cb732-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb732-7"><a href="moving-beyond-linearity.html#cb732-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d<span class="sc">$</span>year <span class="sc">%&gt;%</span></span>
<span id="cb732-8"><a href="moving-beyond-linearity.html#cb732-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb732-9"><a href="moving-beyond-linearity.html#cb732-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb732-10"><a href="moving-beyond-linearity.html#cb732-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_lower), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb732-11"><a href="moving-beyond-linearity.html#cb732-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_upper), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb732-12"><a href="moving-beyond-linearity.html#cb732-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span>year<span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb732-13"><a href="moving-beyond-linearity.html#cb732-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb732-14"><a href="moving-beyond-linearity.html#cb732-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d<span class="sc">$</span><span class="st">`</span><span class="at">s(age, 5)</span><span class="st">`</span> <span class="sc">%&gt;%</span></span>
<span id="cb732-15"><a href="moving-beyond-linearity.html#cb732-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb732-16"><a href="moving-beyond-linearity.html#cb732-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb732-17"><a href="moving-beyond-linearity.html#cb732-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_lower), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb732-18"><a href="moving-beyond-linearity.html#cb732-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_upper), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb732-19"><a href="moving-beyond-linearity.html#cb732-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span><span class="st">`</span><span class="at">s(age, 5)</span><span class="st">`</span><span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb732-20"><a href="moving-beyond-linearity.html#cb732-20" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> d<span class="sc">$</span>education <span class="sc">%&gt;%</span></span>
<span id="cb732-21"><a href="moving-beyond-linearity.html#cb732-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb732-22"><a href="moving-beyond-linearity.html#cb732-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">ymin =</span> y_lower, <span class="at">ymax =</span> y_upper)) <span class="sc">+</span></span>
<span id="cb732-23"><a href="moving-beyond-linearity.html#cb732-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> d<span class="sc">$</span>education<span class="sc">$</span>ylab, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb732-24"><a href="moving-beyond-linearity.html#cb732-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">vjust =</span> <span class="fl">0.7</span>))</span>
<span id="cb732-25"><a href="moving-beyond-linearity.html#cb732-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<p><img src="_main_files/figure-html/figure7-14-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="lab-non-linear-modeling" class="section level2" number="7.8">
<h2><span class="header-section-number">7.8</span> Lab: Non-linear Modeling</h2>
<div id="polynomial-regression-and-step-functions" class="section level3" number="7.8.1">
<h3><span class="header-section-number">7.8.1</span> Polynomial Regression and Step Functions</h3>
<p>The figure was re-produced in section <a href="moving-beyond-linearity.html#polynomial-regression">7.1</a>.</p>
<p>To determine the simplest sufficient polynomial model, we can perform <span class="math inline">\(F\)</span>-tests with <code>anova()</code>.</p>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="moving-beyond-linearity.html#cb733-1" aria-hidden="true" tabindex="-1"></a>wage_poly_1_linear_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> age, <span class="at">data =</span> wage)</span>
<span id="cb733-2"><a href="moving-beyond-linearity.html#cb733-2" aria-hidden="true" tabindex="-1"></a>wage_poly_2_linear_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">2</span>), <span class="at">data =</span> wage)</span>
<span id="cb733-3"><a href="moving-beyond-linearity.html#cb733-3" aria-hidden="true" tabindex="-1"></a>wage_poly_3_linear_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">3</span>), <span class="at">data =</span> wage)</span>
<span id="cb733-4"><a href="moving-beyond-linearity.html#cb733-4" aria-hidden="true" tabindex="-1"></a>wage_poly_5_linear_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">5</span>), <span class="at">data =</span> wage)</span>
<span id="cb733-5"><a href="moving-beyond-linearity.html#cb733-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb733-6"><a href="moving-beyond-linearity.html#cb733-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(wage_poly_1_linear_fit, wage_poly_2_linear_fit, wage_poly_3_linear_fit,</span>
<span id="cb733-7"><a href="moving-beyond-linearity.html#cb733-7" aria-hidden="true" tabindex="-1"></a>      wage_poly_4_linear_fit, wage_poly_5_linear_fit)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: wage ~ age
## Model 2: wage ~ poly(age, 2)
## Model 3: wage ~ poly(age, 3)
## Model 4: wage ~ poly(age, 4)
## Model 5: wage ~ poly(age, 5)
##   Res.Df     RSS Df Sum of Sq        F    Pr(&gt;F)    
## 1   2998 5022216                                    
## 2   2997 4793430  1    228786 143.5931 &lt; 2.2e-16 ***
## 3   2996 4777674  1     15756   9.8888  0.001679 ** 
## 4   2995 4771604  1      6070   3.8098  0.051046 .  
## 5   2994 4770322  1      1283   0.8050  0.369682    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The cubic fit is probably the best choice here.</p>
<p>Equivalently, because of the way <code>poly()</code> created orthogonalized polynomials, we can get the same <span class="math inline">\(p\)</span>-values and <span class="math inline">\(F\)</span>-statistics (= square of the <span class="math inline">\(t\)</span>-statistics) like this:</p>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="moving-beyond-linearity.html#cb735-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(wage_poly_5_linear_fit) <span class="sc">%&gt;%</span></span>
<span id="cb735-2"><a href="moving-beyond-linearity.html#cb735-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(term, <span class="at">t =</span> statistic, <span class="st">`</span><span class="at">F</span><span class="st">`</span> <span class="ot">=</span> t<span class="sc">^</span><span class="dv">2</span>, <span class="at">p =</span> scales<span class="sc">::</span><span class="fu">pvalue</span>(p.value)) <span class="sc">%&gt;%</span></span>
<span id="cb735-3"><a href="moving-beyond-linearity.html#cb735-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb735-4"><a href="moving-beyond-linearity.html#cb735-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(t, <span class="st">`</span><span class="at">F</span><span class="st">`</span>), <span class="at">n_sigfig =</span> <span class="dv">4</span>)</span></code></pre></div>
<div id="gqlyoulqnc" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#gqlyoulqnc .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gqlyoulqnc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gqlyoulqnc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gqlyoulqnc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gqlyoulqnc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gqlyoulqnc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gqlyoulqnc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gqlyoulqnc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gqlyoulqnc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gqlyoulqnc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gqlyoulqnc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gqlyoulqnc .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#gqlyoulqnc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gqlyoulqnc .gt_from_md > :first-child {
  margin-top: 0;
}

#gqlyoulqnc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gqlyoulqnc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gqlyoulqnc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#gqlyoulqnc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gqlyoulqnc .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#gqlyoulqnc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gqlyoulqnc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gqlyoulqnc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gqlyoulqnc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gqlyoulqnc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gqlyoulqnc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#gqlyoulqnc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gqlyoulqnc .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#gqlyoulqnc .gt_left {
  text-align: left;
}

#gqlyoulqnc .gt_center {
  text-align: center;
}

#gqlyoulqnc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gqlyoulqnc .gt_font_normal {
  font-weight: normal;
}

#gqlyoulqnc .gt_font_bold {
  font-weight: bold;
}

#gqlyoulqnc .gt_font_italic {
  font-style: italic;
}

#gqlyoulqnc .gt_super {
  font-size: 65%;
}

#gqlyoulqnc .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">t</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">F</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">p</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">(Intercept)</td>
<td class="gt_row gt_right">153.3</td>
<td class="gt_row gt_right">23,490</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">poly(age, 5)1</td>
<td class="gt_row gt_right">11.20</td>
<td class="gt_row gt_right">125.4</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">poly(age, 5)2</td>
<td class="gt_row gt_right">&minus;11.98</td>
<td class="gt_row gt_right">143.6</td>
<td class="gt_row gt_left">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">poly(age, 5)3</td>
<td class="gt_row gt_right">3.145</td>
<td class="gt_row gt_right">9.889</td>
<td class="gt_row gt_left">0.002</td></tr>
    <tr><td class="gt_row gt_left">poly(age, 5)4</td>
<td class="gt_row gt_right">&minus;1.952</td>
<td class="gt_row gt_right">3.810</td>
<td class="gt_row gt_left">0.051</td></tr>
    <tr><td class="gt_row gt_left">poly(age, 5)5</td>
<td class="gt_row gt_right">&minus;0.8972</td>
<td class="gt_row gt_right">0.8050</td>
<td class="gt_row gt_left">0.370</td></tr>
  </tbody>
  
  
</table>
</div>
<p>However, this only works because the polynomials are orthogonal and there is just the one predictor.
Otherwise, <code>anova()</code> must be used for these model comparisons.</p>
<p>The step function was fit and visualized in section <a href="moving-beyond-linearity.html#step-functions">7.2</a>.</p>
</div>
<div id="splines" class="section level3" number="7.8.2">
<h3><span class="header-section-number">7.8.2</span> Splines</h3>
<p>The cubic spline and natural spline fits are shown in sections <a href="moving-beyond-linearity.html#spline-basis">7.4.3</a> and <a href="moving-beyond-linearity.html#choosing-knots">7.4.4</a>.
The smoothing spline fits are shown in section <a href="moving-beyond-linearity.html#smoothing-parameter">7.5.2</a>, and the local regression fits in section <a href="moving-beyond-linearity.html#local-regression">7.6</a>.</p>
</div>
<div id="gams-lab" class="section level3" number="7.8.3">
<h3><span class="header-section-number">7.8.3</span> GAMs</h3>
<p>Figure 7.11 and 7.12 are re-produced in section <a href="moving-beyond-linearity.html#gam-regression">7.7.1</a>.</p>
<p>Use <code>anova()</code> with different variations of the <code>year</code> variable:</p>
<div class="sourceCode" id="cb736"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb736-1"><a href="moving-beyond-linearity.html#cb736-1" aria-hidden="true" tabindex="-1"></a>wage_gam_no_year <span class="ot">&lt;-</span> </span>
<span id="cb736-2"><a href="moving-beyond-linearity.html#cb736-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(age, <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> wage)</span>
<span id="cb736-3"><a href="moving-beyond-linearity.html#cb736-3" aria-hidden="true" tabindex="-1"></a>wage_gam_linear_year <span class="ot">&lt;-</span> </span>
<span id="cb736-4"><a href="moving-beyond-linearity.html#cb736-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gam</span>(wage <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">s</span>(age, <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> wage)</span>
<span id="cb736-5"><a href="moving-beyond-linearity.html#cb736-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb736-6"><a href="moving-beyond-linearity.html#cb736-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(wage_gam_no_year, wage_gam_linear_year, wage_gam_smooth_fit, <span class="at">test =</span> <span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: wage ~ s(age, 5) + education
## Model 2: wage ~ year + s(age, 5) + education
## Model 3: wage ~ s(year, 4) + s(age, 5) + education
##   Resid. Df Resid. Dev Df Deviance       F    Pr(&gt;F)    
## 1      2990    3711731                                  
## 2      2989    3693842  1  17889.2 14.4771 0.0001447 ***
## 3      2986    3689770  3   4071.1  1.0982 0.3485661    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We find evidence that the linear function of <code>year</code> is preferred, which can also be seen in the model <code>summary()</code>:</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb738-1"><a href="moving-beyond-linearity.html#cb738-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wage_gam_smooth_fit)</span></code></pre></div>
<pre><code>## 
## Call: gam(formula = wage ~ s(year, 4) + s(age, 5) + education, data = wage)
## Deviance Residuals:
##     Min      1Q  Median      3Q     Max 
## -119.43  -19.70   -3.33   14.17  213.48 
## 
## (Dispersion Parameter for gaussian family taken to be 1235.69)
## 
##     Null Deviance: 5222086 on 2999 degrees of freedom
## Residual Deviance: 3689770 on 2986 degrees of freedom
## AIC: 29887.75 
## 
## Number of Local Scoring Iterations: NA 
## 
## Anova for Parametric Effects
##              Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## s(year, 4)    1   27162   27162  21.981 2.877e-06 ***
## s(age, 5)     1  195338  195338 158.081 &lt; 2.2e-16 ***
## education     4 1069726  267432 216.423 &lt; 2.2e-16 ***
## Residuals  2986 3689770    1236                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Anova for Nonparametric Effects
##             Npar Df Npar F  Pr(F)    
## (Intercept)                          
## s(year, 4)        3  1.086 0.3537    
## s(age, 5)         4 32.380 &lt;2e-16 ***
## education                            
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We see under <code>Anova for Parametric Effects</code> that all of the terms are statistically significant, for even a linear relationship.
Under <code>Anova for Nonparametric Effects</code>, we see that only the <code>age</code> term has a statistically significant improvement over the linear.</p>
<p>The logistic regression example is in section <a href="moving-beyond-linearity.html#gam-classification">7.7.2</a>.</p>
</div>
</div>
<div id="exercises-4" class="section level2" number="7.9">
<h2><span class="header-section-number">7.9</span> Exercises</h2>
<div id="applied-4" class="section level3 unnumbered">
<h3>Applied</h3>
<div id="polynomial-and-step-function-regression-on-wage" class="section level4 unnumbered">
<h4>6. Polynomial and step function regression on <code>wage</code></h4>
<ol style="list-style-type: lower-alpha">
<li>Find the optimal degree <span class="math inline">\(d\)</span> for polynomial regression.</li>
</ol>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb740-1"><a href="moving-beyond-linearity.html#cb740-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">201</span>)</span>
<span id="cb740-2"><a href="moving-beyond-linearity.html#cb740-2" aria-hidden="true" tabindex="-1"></a>wage_resamples <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(wage, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb740-3"><a href="moving-beyond-linearity.html#cb740-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb740-4"><a href="moving-beyond-linearity.html#cb740-4" aria-hidden="true" tabindex="-1"></a>lm_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>()</span>
<span id="cb740-5"><a href="moving-beyond-linearity.html#cb740-5" aria-hidden="true" tabindex="-1"></a>wage_poly_spec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(wage <span class="sc">~</span> age, <span class="at">data =</span> wage) <span class="sc">%&gt;%</span></span>
<span id="cb740-6"><a href="moving-beyond-linearity.html#cb740-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(age, <span class="at">degree =</span> <span class="fu">tune</span>())</span>
<span id="cb740-7"><a href="moving-beyond-linearity.html#cb740-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb740-8"><a href="moving-beyond-linearity.html#cb740-8" aria-hidden="true" tabindex="-1"></a>wage_poly_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb740-9"><a href="moving-beyond-linearity.html#cb740-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb740-10"><a href="moving-beyond-linearity.html#cb740-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(wage_poly_spec)</span>
<span id="cb740-11"><a href="moving-beyond-linearity.html#cb740-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb740-12"><a href="moving-beyond-linearity.html#cb740-12" aria-hidden="true" tabindex="-1"></a>degree_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">degree =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb740-13"><a href="moving-beyond-linearity.html#cb740-13" aria-hidden="true" tabindex="-1"></a>wage_poly_tune <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(wage_poly_workflow, <span class="at">resamples =</span> wage_resamples,</span>
<span id="cb740-14"><a href="moving-beyond-linearity.html#cb740-14" aria-hidden="true" tabindex="-1"></a>                            <span class="at">grid =</span> degree_grid)</span>
<span id="cb740-15"><a href="moving-beyond-linearity.html#cb740-15" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(wage_poly_tune) <span class="sc">+</span></span>
<span id="cb740-16"><a href="moving-beyond-linearity.html#cb740-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/exercise-6-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The best <code>degree</code> values:</p>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="moving-beyond-linearity.html#cb741-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(wage_poly_tune, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   degree .metric .estimator  mean     n std_err .config              
##    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1      9 rmse    standard    39.8    10   0.868 Preprocessor09_Model1
## 2      7 rmse    standard    39.8    10   0.878 Preprocessor07_Model1
## 3      6 rmse    standard    39.8    10   0.874 Preprocessor06_Model1
## 4     10 rmse    standard    39.8    10   0.870 Preprocessor10_Model1
## 5      5 rmse    standard    39.8    10   0.872 Preprocessor05_Model1</code></pre>
<p>But it is clear from the above figure that there is little difference past <code>degree</code> 2 or 3.
We can find the least complex model within one standard error of the best model with this function:</p>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb743-1"><a href="moving-beyond-linearity.html#cb743-1" aria-hidden="true" tabindex="-1"></a>(best_degree <span class="ot">&lt;-</span> <span class="fu">select_by_one_std_err</span>(wage_poly_tune, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>, degree))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##   degree .metric .estimator  mean     n std_err .config             .best .bound
##    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt;  &lt;dbl&gt;
## 1      2 rmse    standard    39.9    10   0.882 Preprocessor02_Mod~  39.8   40.7</code></pre>
<p>And here is how the fit looks overlaid on the data:</p>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb745-1"><a href="moving-beyond-linearity.html#cb745-1" aria-hidden="true" tabindex="-1"></a>age_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">age =</span> <span class="dv">18</span><span class="sc">:</span><span class="dv">80</span>)</span>
<span id="cb745-2"><a href="moving-beyond-linearity.html#cb745-2" aria-hidden="true" tabindex="-1"></a><span class="fu">finalize_workflow</span>(wage_poly_workflow, best_degree) <span class="sc">%&gt;%</span></span>
<span id="cb745-3"><a href="moving-beyond-linearity.html#cb745-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> wage) <span class="sc">%&gt;%</span></span>
<span id="cb745-4"><a href="moving-beyond-linearity.html#cb745-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> age_grid) <span class="sc">%&gt;%</span></span>
<span id="cb745-5"><a href="moving-beyond-linearity.html#cb745-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb745-6"><a href="moving-beyond-linearity.html#cb745-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wage, <span class="fu">aes</span>(<span class="at">y =</span> wage),</span>
<span id="cb745-7"><a href="moving-beyond-linearity.html#cb745-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb745-8"><a href="moving-beyond-linearity.html#cb745-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .pred), <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>soft_orange, <span class="at">size =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-403-1.png" width="576" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Find the optimal number of cuts <span class="math inline">\(K\)</span> for step function regression.</li>
</ol>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="moving-beyond-linearity.html#cb746-1" aria-hidden="true" tabindex="-1"></a>wage_step_spec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(wage <span class="sc">~</span> age, <span class="at">data =</span> wage) <span class="sc">%&gt;%</span></span>
<span id="cb746-2"><a href="moving-beyond-linearity.html#cb746-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#step_cut(age, breaks = tune())</span></span>
<span id="cb746-3"><a href="moving-beyond-linearity.html#cb746-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_discretize</span>(age, <span class="at">num_breaks =</span> <span class="fu">tune</span>(),</span>
<span id="cb746-4"><a href="moving-beyond-linearity.html#cb746-4" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># Need to adjust this from the default (=10)</span></span>
<span id="cb746-5"><a href="moving-beyond-linearity.html#cb746-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">min_unique =</span> <span class="dv">2</span>)</span>
<span id="cb746-6"><a href="moving-beyond-linearity.html#cb746-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb746-7"><a href="moving-beyond-linearity.html#cb746-7" aria-hidden="true" tabindex="-1"></a>wage_step_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb746-8"><a href="moving-beyond-linearity.html#cb746-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb746-9"><a href="moving-beyond-linearity.html#cb746-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(wage_step_spec)</span>
<span id="cb746-10"><a href="moving-beyond-linearity.html#cb746-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb746-11"><a href="moving-beyond-linearity.html#cb746-11" aria-hidden="true" tabindex="-1"></a>breaks_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">num_breaks =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb746-12"><a href="moving-beyond-linearity.html#cb746-12" aria-hidden="true" tabindex="-1"></a>wage_step_tune <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(wage_step_workflow, <span class="at">resamples =</span> wage_resamples,</span>
<span id="cb746-13"><a href="moving-beyond-linearity.html#cb746-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">grid =</span> breaks_grid)</span>
<span id="cb746-14"><a href="moving-beyond-linearity.html#cb746-14" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(wage_step_tune)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-404-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb747-1"><a href="moving-beyond-linearity.html#cb747-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(wage_step_tune, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   num_breaks .metric .estimator  mean     n std_err .config              
##        &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1         20 rmse    standard    40.0    10   0.874 Preprocessor19_Model1
## 2         15 rmse    standard    40.0    10   0.853 Preprocessor14_Model1
## 3         14 rmse    standard    40.0    10   0.871 Preprocessor13_Model1
## 4         19 rmse    standard    40.0    10   0.874 Preprocessor18_Model1
## 5         17 rmse    standard    40.0    10   0.872 Preprocessor16_Model1</code></pre>
<p>The best model by RMSE has the most <code>num_breaks</code>, but within one <code>std_error</code> gives:</p>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb749-1"><a href="moving-beyond-linearity.html#cb749-1" aria-hidden="true" tabindex="-1"></a>(best_num_breaks <span class="ot">&lt;-</span></span>
<span id="cb749-2"><a href="moving-beyond-linearity.html#cb749-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_by_one_std_err</span>(wage_step_tune, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>, num_breaks))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##   num_breaks .metric .estimator  mean     n std_err .config         .best .bound
##        &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
## 1          3 rmse    standard    40.7    10   0.831 Preprocessor02~  40.0   40.9</code></pre>
<p>For posterity, here is the best model by RMSE, and best model within one standard error:</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="moving-beyond-linearity.html#cb751-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb751-2"><a href="moving-beyond-linearity.html#cb751-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(wage_step_workflow,</span>
<span id="cb751-3"><a href="moving-beyond-linearity.html#cb751-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select_best</span>(wage_step_tune, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb751-4"><a href="moving-beyond-linearity.html#cb751-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(<span class="at">data =</span> wage) <span class="sc">%&gt;%</span></span>
<span id="cb751-5"><a href="moving-beyond-linearity.html#cb751-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">new_data =</span> age_grid) <span class="sc">%&gt;%</span></span>
<span id="cb751-6"><a href="moving-beyond-linearity.html#cb751-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;best by RMSE&quot;</span>),</span>
<span id="cb751-7"><a href="moving-beyond-linearity.html#cb751-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(wage_step_workflow, best_num_breaks) <span class="sc">%&gt;%</span></span>
<span id="cb751-8"><a href="moving-beyond-linearity.html#cb751-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(<span class="at">data =</span> wage) <span class="sc">%&gt;%</span></span>
<span id="cb751-9"><a href="moving-beyond-linearity.html#cb751-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">new_data =</span> age_grid) <span class="sc">%&gt;%</span></span>
<span id="cb751-10"><a href="moving-beyond-linearity.html#cb751-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;best within 1 SE&quot;</span>)</span>
<span id="cb751-11"><a href="moving-beyond-linearity.html#cb751-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb751-12"><a href="moving-beyond-linearity.html#cb751-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb751-13"><a href="moving-beyond-linearity.html#cb751-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wage, <span class="fu">aes</span>(<span class="at">y =</span> wage),</span>
<span id="cb751-14"><a href="moving-beyond-linearity.html#cb751-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb751-15"><a href="moving-beyond-linearity.html#cb751-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .pred, <span class="at">color =</span> model), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb751-16"><a href="moving-beyond-linearity.html#cb751-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb751-17"><a href="moving-beyond-linearity.html#cb751-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-407-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="explore-other-predictors-in-wage" class="section level4" number="7.9.0.1">
<h4><span class="header-section-number">7.9.0.1</span> 7. Explore other predictors in <code>wage</code></h4>
<p>In <code>tidymodels</code>, the implementation of smooth splines and GAMs uses the <code>mgcv</code> package as the default (and currently only) engine, so I’ll use that for this example.</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="moving-beyond-linearity.html#cb752-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(<span class="st">&quot;package:gam&quot;</span>, <span class="at">unload =</span> <span class="cn">TRUE</span>)</span>
<span id="cb752-2"><a href="moving-beyond-linearity.html#cb752-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb752-3"><a href="moving-beyond-linearity.html#cb752-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wage)</span></code></pre></div>
<pre><code>## Rows: 3,000
## Columns: 11
## $ year       &lt;int&gt; 2006, 2004, 2003, 2003, 2005, 2008, 2009, 2008, 2006, 2004,~
## $ age        &lt;int&gt; 18, 24, 45, 43, 50, 54, 44, 30, 41, 52, 45, 34, 35, 39, 54,~
## $ maritl     &lt;fct&gt; 1. Never Married, 1. Never Married, 2. Married, 2. Married,~
## $ race       &lt;fct&gt; 1. White, 1. White, 1. White, 3. Asian, 1. White, 1. White,~
## $ education  &lt;fct&gt; 1. &lt; HS Grad, 4. College Grad, 3. Some College, 4. College ~
## $ region     &lt;fct&gt; 2. Middle Atlantic, 2. Middle Atlantic, 2. Middle Atlantic,~
## $ jobclass   &lt;fct&gt; 1. Industrial, 2. Information, 1. Industrial, 2. Informatio~
## $ health     &lt;fct&gt; 1. &lt;=Good, 2. &gt;=Very Good, 1. &lt;=Good, 2. &gt;=Very Good, 1. &lt;=~
## $ health_ins &lt;fct&gt; 2. No, 2. No, 1. Yes, 1. Yes, 1. Yes, 1. Yes, 1. Yes, 1. Ye~
## $ logwage    &lt;dbl&gt; 4.318063, 4.255273, 4.875061, 5.041393, 4.318063, 4.845098,~
## $ wage       &lt;dbl&gt; 75.04315, 70.47602, 130.98218, 154.68529, 75.04315, 127.115~</code></pre>
<p>Every other feature in this data set is data set is categorical.
Here is the <code>wage</code> distribution by the different categories:</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="moving-beyond-linearity.html#cb754-1" aria-hidden="true" tabindex="-1"></a>wage <span class="sc">%&gt;%</span></span>
<span id="cb754-2"><a href="moving-beyond-linearity.html#cb754-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(wage, <span class="fu">where</span>(is.factor), <span class="sc">-</span>education) <span class="sc">%&gt;%</span></span>
<span id="cb754-3"><a href="moving-beyond-linearity.html#cb754-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span></span>
<span id="cb754-4"><a href="moving-beyond-linearity.html#cb754-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(wage, rowname),</span>
<span id="cb754-5"><a href="moving-beyond-linearity.html#cb754-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;var&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;val&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb754-6"><a href="moving-beyond-linearity.html#cb754-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> val, <span class="at">x =</span> wage)) <span class="sc">+</span></span>
<span id="cb754-7"><a href="moving-beyond-linearity.html#cb754-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb754-8"><a href="moving-beyond-linearity.html#cb754-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> var, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-409-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Some general observations:</p>
<ul>
<li>People with better <code>health</code> have slightly higher wages.</li>
<li>People with <code>health_ins</code> have higher wages.</li>
<li>People with <code>jobclass = "Information"</code> have slightly higher wages.</li>
<li><code>maritl</code> status has no significant patterns.</li>
<li><code>race</code> has no significant patterns.</li>
<li>The <code>region</code> variable has a single value.</li>
</ul>
<p>Since these are all categorical, there aren’t any new smoothing/spline/polynomial/etc. functions to try out.
Instead I will add the variables and determine if they improve the fit:</p>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb755-1"><a href="moving-beyond-linearity.html#cb755-1" aria-hidden="true" tabindex="-1"></a>wage_gam_1 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(age, <span class="at">k =</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="fu">s</span>(year, <span class="at">k =</span> <span class="dv">4</span>) <span class="sc">+</span> education, <span class="at">data =</span> wage)</span>
<span id="cb755-2"><a href="moving-beyond-linearity.html#cb755-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wage_gam_1)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## wage ~ s(age, k = 5) + s(year, k = 4) + education
## 
## Parametric coefficients:
##                             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                   85.529      2.152  39.746  &lt; 2e-16 ***
## education2. HS Grad           10.896      2.429   4.487 7.51e-06 ***
## education3. Some College      23.415      2.556   9.159  &lt; 2e-16 ***
## education4. College Grad      38.058      2.541  14.980  &lt; 2e-16 ***
## education5. Advanced Degree   62.568      2.759  22.682  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df     F  p-value    
## s(age)  3.381  3.787 57.96  &lt; 2e-16 ***
## s(year) 1.073  1.142 11.44 0.000392 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.289   Deviance explained = 29.1%
## GCV = 1241.3  Scale est. = 1237.4    n = 3000</code></pre>
<p>Like we saw in the lab (section <a href="moving-beyond-linearity.html#gams-lab">7.8.3</a>), the <code>year</code> variable can be modeled as linear.</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="moving-beyond-linearity.html#cb757-1" aria-hidden="true" tabindex="-1"></a>wage_gam_2 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(age, <span class="at">k =</span> <span class="dv">5</span>) <span class="sc">+</span> year <span class="sc">+</span> education, <span class="at">data =</span> wage)</span>
<span id="cb757-2"><a href="moving-beyond-linearity.html#cb757-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wage_gam_2)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## wage ~ s(age, k = 5) + year + education
## 
## Parametric coefficients:
##                               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                 -2261.3683   637.2311  -3.549 0.000393 ***
## year                            1.1701     0.3177   3.683 0.000235 ***
## education2. HS Grad            10.9002     2.4285   4.488 7.45e-06 ***
## education3. Some College       23.4227     2.5564   9.163  &lt; 2e-16 ***
## education4. College Grad       38.0606     2.5406  14.981  &lt; 2e-16 ***
## education5. Advanced Degree    62.5714     2.7586  22.683  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##          edf Ref.df     F p-value    
## s(age) 3.381  3.787 57.97  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.289   Deviance explained = 29.1%
## GCV = 1241.3  Scale est. = 1237.4    n = 3000</code></pre>
<p>Now add the new categorical variables:</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="moving-beyond-linearity.html#cb759-1" aria-hidden="true" tabindex="-1"></a>wage_gam_3 <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb759-2"><a href="moving-beyond-linearity.html#cb759-2" aria-hidden="true" tabindex="-1"></a>  wage <span class="sc">~</span> <span class="fu">s</span>(age, <span class="at">k =</span> <span class="dv">5</span>) <span class="sc">+</span> year <span class="sc">+</span> education <span class="sc">+</span> health <span class="sc">+</span> health_ins <span class="sc">+</span> jobclass <span class="sc">+</span></span>
<span id="cb759-3"><a href="moving-beyond-linearity.html#cb759-3" aria-hidden="true" tabindex="-1"></a>    maritl <span class="sc">+</span> race,</span>
<span id="cb759-4"><a href="moving-beyond-linearity.html#cb759-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> wage</span>
<span id="cb759-5"><a href="moving-beyond-linearity.html#cb759-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb759-6"><a href="moving-beyond-linearity.html#cb759-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wage_gam_3)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## wage ~ s(age, k = 5) + year + education + health + health_ins + 
##     jobclass + maritl + race
## 
## Parametric coefficients:
##                               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                 -2485.6495   612.4533  -4.059 5.07e-05 ***
## year                            1.2794     0.3053   4.190 2.87e-05 ***
## education2. HS Grad             7.6142     2.3528   3.236  0.00122 ** 
## education3. Some College       18.1558     2.5025   7.255 5.10e-13 ***
## education4. College Grad       30.7018     2.5315  12.128  &lt; 2e-16 ***
## education5. Advanced Degree    53.2910     2.7935  19.077  &lt; 2e-16 ***
## health2. &gt;=Very Good            6.2775     1.4111   4.449 8.96e-06 ***
## health_ins2. No               -16.5462     1.4018 -11.803  &lt; 2e-16 ***
## jobclass2. Information          3.5045     1.3148   2.665  0.00773 ** 
## maritl2. Married               13.8176     1.7956   7.695 1.91e-14 ***
## maritl3. Widowed                0.7310     7.9577   0.092  0.92681    
## maritl4. Divorced               0.5206     2.9195   0.178  0.85849    
## maritl5. Separated              7.7757     4.8456   1.605  0.10867    
## race2. Black                   -4.7753     2.1317  -2.240  0.02516 *  
## race3. Asian                   -2.7584     2.5858  -1.067  0.28616    
## race4. Other                   -5.7192     5.6258  -1.017  0.30943    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##          edf Ref.df     F p-value    
## s(age) 2.779   3.31 18.21  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.346   Deviance explained =   35%
## GCV = 1146.5  Scale est. = 1139.3    n = 3000</code></pre>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="moving-beyond-linearity.html#cb761-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb761-2"><a href="moving-beyond-linearity.html#cb761-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wage_gam_3, <span class="at">pages =</span> <span class="dv">1</span>, <span class="at">all.terms =</span> <span class="cn">TRUE</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-412-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>It does provide a statistically singificant improvement:</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb762-1"><a href="moving-beyond-linearity.html#cb762-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(wage_gam_2, wage_gam_3, <span class="at">test =</span> <span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: wage ~ s(age, k = 5) + year + education
## Model 2: wage ~ s(age, k = 5) + year + education + health + health_ins + 
##     jobclass + maritl + race
##   Resid. Df Resid. Dev     Df Deviance      F    Pr(&gt;F)    
## 1    2990.2    3700651                                     
## 2    2980.7    3396564 9.5239   304087 28.024 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="non-linear-models-of-auto" class="section level4" number="7.9.0.2">
<h4><span class="header-section-number">7.9.0.2</span> 8. Non-linear models of <code>auto</code></h4>
<div class="sourceCode" id="cb764"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb764-1"><a href="moving-beyond-linearity.html#cb764-1" aria-hidden="true" tabindex="-1"></a>auto <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Auto <span class="sc">%&gt;%</span></span>
<span id="cb764-2"><a href="moving-beyond-linearity.html#cb764-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Origin is a factor coded as numeric</span></span>
<span id="cb764-3"><a href="moving-beyond-linearity.html#cb764-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb764-4"><a href="moving-beyond-linearity.html#cb764-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">origin =</span> <span class="fu">factor</span>(origin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb764-5"><a href="moving-beyond-linearity.html#cb764-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;American&quot;</span>, <span class="st">&quot;European&quot;</span>, <span class="st">&quot;Japanese&quot;</span>))</span>
<span id="cb764-6"><a href="moving-beyond-linearity.html#cb764-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb764-7"><a href="moving-beyond-linearity.html#cb764-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(auto)</span></code></pre></div>
<pre><code>## Rows: 392
## Columns: 9
## $ mpg          &lt;dbl&gt; 18, 15, 18, 16, 17, 15, 14, 14, 14, 15, 15, 14, 15, 14, 2~
## $ cylinders    &lt;int&gt; 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 4, 6, 6, 6, 4, ~
## $ displacement &lt;dbl&gt; 307, 350, 318, 304, 302, 429, 454, 440, 455, 390, 383, 34~
## $ horsepower   &lt;int&gt; 130, 165, 150, 150, 140, 198, 220, 215, 225, 190, 170, 16~
## $ weight       &lt;int&gt; 3504, 3693, 3436, 3433, 3449, 4341, 4354, 4312, 4425, 385~
## $ acceleration &lt;dbl&gt; 12.0, 11.5, 11.0, 12.0, 10.5, 10.0, 9.0, 8.5, 10.0, 8.5, ~
## $ year         &lt;int&gt; 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 7~
## $ origin       &lt;fct&gt; American, American, American, American, American, America~
## $ name         &lt;fct&gt; chevrolet chevelle malibu, buick skylark 320, plymouth sa~</code></pre>
<p>The variables (excluding <code>name</code>) vs <code>mpg</code>:</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb766-1"><a href="moving-beyond-linearity.html#cb766-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> auto <span class="sc">%&gt;%</span></span>
<span id="cb766-2"><a href="moving-beyond-linearity.html#cb766-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mpg, acceleration, displacement, year, horsepower) <span class="sc">%&gt;%</span></span>
<span id="cb766-3"><a href="moving-beyond-linearity.html#cb766-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span></span>
<span id="cb766-4"><a href="moving-beyond-linearity.html#cb766-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(rowname, mpg), <span class="at">names_to =</span> <span class="st">&quot;var&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb766-5"><a href="moving-beyond-linearity.html#cb766-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb766-6"><a href="moving-beyond-linearity.html#cb766-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb766-7"><a href="moving-beyond-linearity.html#cb766-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;gam&quot;</span>) <span class="sc">+</span></span>
<span id="cb766-8"><a href="moving-beyond-linearity.html#cb766-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> var, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)</span>
<span id="cb766-9"><a href="moving-beyond-linearity.html#cb766-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> auto <span class="sc">%&gt;%</span></span>
<span id="cb766-10"><a href="moving-beyond-linearity.html#cb766-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(mpg, <span class="at">cylinders =</span> <span class="fu">factor</span>(cylinders), origin) <span class="sc">%&gt;%</span></span>
<span id="cb766-11"><a href="moving-beyond-linearity.html#cb766-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span></span>
<span id="cb766-12"><a href="moving-beyond-linearity.html#cb766-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(rowname, mpg), <span class="at">names_to =</span> <span class="st">&quot;var&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb766-13"><a href="moving-beyond-linearity.html#cb766-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(value), <span class="at">x =</span> mpg)) <span class="sc">+</span></span>
<span id="cb766-14"><a href="moving-beyond-linearity.html#cb766-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb766-15"><a href="moving-beyond-linearity.html#cb766-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> var, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span>
<span id="cb766-16"><a href="moving-beyond-linearity.html#cb766-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2 <span class="sc">+</span></span>
<span id="cb766-17"><a href="moving-beyond-linearity.html#cb766-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-415-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Fit a GAM with all of the variables:</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="moving-beyond-linearity.html#cb767-1" aria-hidden="true" tabindex="-1"></a>auto_gam <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb767-2"><a href="moving-beyond-linearity.html#cb767-2" aria-hidden="true" tabindex="-1"></a>  mpg <span class="sc">~</span> <span class="fu">s</span>(acceleration, <span class="at">k =</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="fu">s</span>(displacement, <span class="at">k =</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="fu">s</span>(horsepower, <span class="at">k =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb767-3"><a href="moving-beyond-linearity.html#cb767-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(year, <span class="at">k =</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="fu">s</span>(cylinders, <span class="at">k =</span> <span class="dv">3</span>) <span class="sc">+</span> origin,</span>
<span id="cb767-4"><a href="moving-beyond-linearity.html#cb767-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> auto</span>
<span id="cb767-5"><a href="moving-beyond-linearity.html#cb767-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb767-6"><a href="moving-beyond-linearity.html#cb767-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(auto_gam)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## mpg ~ s(acceleration, k = 5) + s(displacement, k = 5) + s(horsepower, 
##     k = 5) + s(year, k = 5) + s(cylinders, k = 3) + origin
## 
## Parametric coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    23.25555    0.22312 104.227   &lt;2e-16 ***
## originEuropean  0.09133    0.52543   0.174   0.8621    
## originJapanese  0.86600    0.51939   1.667   0.0963 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                   edf Ref.df      F  p-value    
## s(acceleration) 2.364  2.942 10.931 1.64e-06 ***
## s(displacement) 3.305  3.735 11.353  &lt; 2e-16 ***
## s(horsepower)   2.635  3.185 31.694  &lt; 2e-16 ***
## s(year)         3.398  3.796 82.425  &lt; 2e-16 ***
## s(cylinders)    2.000  2.000  3.212   0.0414 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.873   Deviance explained = 87.8%
## GCV =  8.086  Scale est. = 7.7415    n = 392</code></pre>
<p>This suggests that there are non-linear relationships in <code>acceleration</code>, <code>displacement</code>, <code>horsepower</code>, and <code>year</code>.
Visualize the smooth functions:</p>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb769-1"><a href="moving-beyond-linearity.html#cb769-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(auto_gam, <span class="at">pages =</span> <span class="dv">1</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-417-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="predicting-nitrogen-oxide-concentration-in-boston" class="section level4" number="7.9.0.3">
<h4><span class="header-section-number">7.9.0.3</span> 9. Predicting nitrogen oxide concentration in <code>boston</code></h4>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb770-1"><a href="moving-beyond-linearity.html#cb770-1" aria-hidden="true" tabindex="-1"></a>boston <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Boston</span>
<span id="cb770-2"><a href="moving-beyond-linearity.html#cb770-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(boston)</span></code></pre></div>
<pre><code>## Rows: 506
## Columns: 13
## $ crim    &lt;dbl&gt; 0.00632, 0.02731, 0.02729, 0.03237, 0.06905, 0.02985, 0.08829,~
## $ zn      &lt;dbl&gt; 18.0, 0.0, 0.0, 0.0, 0.0, 0.0, 12.5, 12.5, 12.5, 12.5, 12.5, 1~
## $ indus   &lt;dbl&gt; 2.31, 7.07, 7.07, 2.18, 2.18, 2.18, 7.87, 7.87, 7.87, 7.87, 7.~
## $ chas    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,~
## $ nox     &lt;dbl&gt; 0.538, 0.469, 0.469, 0.458, 0.458, 0.458, 0.524, 0.524, 0.524,~
## $ rm      &lt;dbl&gt; 6.575, 6.421, 7.185, 6.998, 7.147, 6.430, 6.012, 6.172, 5.631,~
## $ age     &lt;dbl&gt; 65.2, 78.9, 61.1, 45.8, 54.2, 58.7, 66.6, 96.1, 100.0, 85.9, 9~
## $ dis     &lt;dbl&gt; 4.0900, 4.9671, 4.9671, 6.0622, 6.0622, 6.0622, 5.5605, 5.9505~
## $ rad     &lt;int&gt; 1, 2, 2, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 4,~
## $ tax     &lt;dbl&gt; 296, 242, 242, 222, 222, 222, 311, 311, 311, 311, 311, 311, 31~
## $ ptratio &lt;dbl&gt; 15.3, 17.8, 17.8, 18.7, 18.7, 18.7, 15.2, 15.2, 15.2, 15.2, 15~
## $ lstat   &lt;dbl&gt; 4.98, 9.14, 4.03, 2.94, 5.33, 5.21, 12.43, 19.15, 29.93, 17.10~
## $ medv    &lt;dbl&gt; 24.0, 21.6, 34.7, 33.4, 36.2, 28.7, 22.9, 27.1, 16.5, 18.9, 15~</code></pre>
<p>Visualize the <code>nox</code> and <code>dis</code> variables:</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb772-1"><a href="moving-beyond-linearity.html#cb772-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> boston <span class="sc">%&gt;%</span></span>
<span id="cb772-2"><a href="moving-beyond-linearity.html#cb772-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(nox, dis) <span class="sc">%&gt;%</span></span>
<span id="cb772-3"><a href="moving-beyond-linearity.html#cb772-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(nox, dis)) <span class="sc">%&gt;%</span></span>
<span id="cb772-4"><a href="moving-beyond-linearity.html#cb772-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb772-5"><a href="moving-beyond-linearity.html#cb772-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">0</span>, <span class="at">fill =</span> name), <span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb772-6"><a href="moving-beyond-linearity.html#cb772-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">1</span>, <span class="at">color =</span> name), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb772-7"><a href="moving-beyond-linearity.html#cb772-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb772-8"><a href="moving-beyond-linearity.html#cb772-8" aria-hidden="true" tabindex="-1"></a>  dunnr<span class="sc">::</span><span class="fu">remove_axis</span>(<span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb772-9"><a href="moving-beyond-linearity.html#cb772-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb772-10"><a href="moving-beyond-linearity.html#cb772-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> boston <span class="sc">%&gt;%</span></span>
<span id="cb772-11"><a href="moving-beyond-linearity.html#cb772-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dis, <span class="at">y =</span> nox)) <span class="sc">+</span></span>
<span id="cb772-12"><a href="moving-beyond-linearity.html#cb772-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb772-13"><a href="moving-beyond-linearity.html#cb772-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;gam&quot;</span>)</span>
<span id="cb772-14"><a href="moving-beyond-linearity.html#cb772-14" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-419-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Looks like higher values of <code>dis</code> (the distance from Boston employment centers) are associated with lower <code>nox</code> (nitrogen oxide concentration).</p>
<ol style="list-style-type: lower-alpha">
<li>Cubic polynomial regression.</li>
</ol>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="moving-beyond-linearity.html#cb773-1" aria-hidden="true" tabindex="-1"></a>lm_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>()</span>
<span id="cb773-2"><a href="moving-beyond-linearity.html#cb773-2" aria-hidden="true" tabindex="-1"></a>boston_poly_3_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(nox <span class="sc">~</span> dis, <span class="at">data =</span> boston) <span class="sc">%&gt;%</span></span>
<span id="cb773-3"><a href="moving-beyond-linearity.html#cb773-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(dis, <span class="at">degree =</span> <span class="dv">3</span>)</span>
<span id="cb773-4"><a href="moving-beyond-linearity.html#cb773-4" aria-hidden="true" tabindex="-1"></a>boston_poly_3_fit <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb773-5"><a href="moving-beyond-linearity.html#cb773-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(boston_poly_3_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb773-6"><a href="moving-beyond-linearity.html#cb773-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb773-7"><a href="moving-beyond-linearity.html#cb773-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> boston)</span>
<span id="cb773-8"><a href="moving-beyond-linearity.html#cb773-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(boston_poly_3_fit <span class="sc">%&gt;%</span> <span class="fu">extract_fit_engine</span>())</span></code></pre></div>
<pre><code>## 
## Call:
## stats::lm(formula = ..y ~ ., data = data)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.121130 -0.040619 -0.009738  0.023385  0.194904 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.554695   0.002759 201.021  &lt; 2e-16 ***
## dis_poly_1  -2.003096   0.062071 -32.271  &lt; 2e-16 ***
## dis_poly_2   0.856330   0.062071  13.796  &lt; 2e-16 ***
## dis_poly_3  -0.318049   0.062071  -5.124 4.27e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.06207 on 502 degrees of freedom
## Multiple R-squared:  0.7148, Adjusted R-squared:  0.7131 
## F-statistic: 419.3 on 3 and 502 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Visualize the cubic fit:</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="moving-beyond-linearity.html#cb775-1" aria-hidden="true" tabindex="-1"></a>dis_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">dis =</span> <span class="fu">seq</span>(<span class="fu">min</span>(boston<span class="sc">$</span>dis), <span class="fu">max</span>(boston<span class="sc">$</span>dis),</span>
<span id="cb775-2"><a href="moving-beyond-linearity.html#cb775-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb775-3"><a href="moving-beyond-linearity.html#cb775-3" aria-hidden="true" tabindex="-1"></a>boston_poly_3_pred <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb775-4"><a href="moving-beyond-linearity.html#cb775-4" aria-hidden="true" tabindex="-1"></a>  dis_grid,</span>
<span id="cb775-5"><a href="moving-beyond-linearity.html#cb775-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I&#39;ll use `predict` instead of `augment` because I don&#39;t think I can get</span></span>
<span id="cb775-6"><a href="moving-beyond-linearity.html#cb775-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  SEs/CIs easily with the latter</span></span>
<span id="cb775-7"><a href="moving-beyond-linearity.html#cb775-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(boston_poly_3_fit, <span class="at">new_data =</span> dis_grid),</span>
<span id="cb775-8"><a href="moving-beyond-linearity.html#cb775-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(boston_poly_3_fit, <span class="at">new_data =</span> dis_grid, <span class="at">type =</span> <span class="st">&quot;conf_int&quot;</span>)</span>
<span id="cb775-9"><a href="moving-beyond-linearity.html#cb775-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb775-10"><a href="moving-beyond-linearity.html#cb775-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb775-11"><a href="moving-beyond-linearity.html#cb775-11" aria-hidden="true" tabindex="-1"></a>p_base <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(boston, <span class="fu">aes</span>(<span class="at">x =</span> dis)) <span class="sc">+</span></span>
<span id="cb775-12"><a href="moving-beyond-linearity.html#cb775-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> nox), <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb775-13"><a href="moving-beyond-linearity.html#cb775-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">12</span>, <span class="dv">2</span>))</span>
<span id="cb775-14"><a href="moving-beyond-linearity.html#cb775-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb775-15"><a href="moving-beyond-linearity.html#cb775-15" aria-hidden="true" tabindex="-1"></a>p_base <span class="sc">+</span></span>
<span id="cb775-16"><a href="moving-beyond-linearity.html#cb775-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> boston_poly_3_pred, <span class="fu">aes</span>(<span class="at">y =</span> .pred),</span>
<span id="cb775-17"><a href="moving-beyond-linearity.html#cb775-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb775-18"><a href="moving-beyond-linearity.html#cb775-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> boston_poly_3_pred,</span>
<span id="cb775-19"><a href="moving-beyond-linearity.html#cb775-19" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> .pred_lower, <span class="at">ymax =</span> .pred_upper),</span>
<span id="cb775-20"><a href="moving-beyond-linearity.html#cb775-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-421-1.png" width="576" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Polynomial fits from 1 to 10 degrees.</li>
</ol>
<p>Since we’re not <code>tune()</code>ing the <code>degree</code> parameter on resamples here, just fitting a model for each <code>degree</code> to the full data set, so I can’t use the typical <code>tune_grid()/fit_resamples()</code> approach.</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb776-1"><a href="moving-beyond-linearity.html#cb776-1" aria-hidden="true" tabindex="-1"></a>boston_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(nox <span class="sc">~</span> dis, <span class="at">data =</span> boston)</span>
<span id="cb776-2"><a href="moving-beyond-linearity.html#cb776-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb776-3"><a href="moving-beyond-linearity.html#cb776-3" aria-hidden="true" tabindex="-1"></a>boston_poly_fits <span class="ot">&lt;-</span></span>
<span id="cb776-4"><a href="moving-beyond-linearity.html#cb776-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb776-5"><a href="moving-beyond-linearity.html#cb776-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">degree =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb776-6"><a href="moving-beyond-linearity.html#cb776-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">poly_fit =</span> <span class="fu">map</span>(</span>
<span id="cb776-7"><a href="moving-beyond-linearity.html#cb776-7" aria-hidden="true" tabindex="-1"></a>      degree,</span>
<span id="cb776-8"><a href="moving-beyond-linearity.html#cb776-8" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb776-9"><a href="moving-beyond-linearity.html#cb776-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_recipe</span>(boston_recipe <span class="sc">%&gt;%</span> <span class="fu">step_poly</span>(dis, <span class="at">degree =</span> .x)) <span class="sc">%&gt;%</span></span>
<span id="cb776-10"><a href="moving-beyond-linearity.html#cb776-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_model</span>(lm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb776-11"><a href="moving-beyond-linearity.html#cb776-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fit</span>(<span class="at">data =</span> boston)</span>
<span id="cb776-12"><a href="moving-beyond-linearity.html#cb776-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb776-13"><a href="moving-beyond-linearity.html#cb776-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb776-14"><a href="moving-beyond-linearity.html#cb776-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb776-15"><a href="moving-beyond-linearity.html#cb776-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">poly_pred =</span> <span class="fu">map</span>(</span>
<span id="cb776-16"><a href="moving-beyond-linearity.html#cb776-16" aria-hidden="true" tabindex="-1"></a>      poly_fit,</span>
<span id="cb776-17"><a href="moving-beyond-linearity.html#cb776-17" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">bind_cols</span>(</span>
<span id="cb776-18"><a href="moving-beyond-linearity.html#cb776-18" aria-hidden="true" tabindex="-1"></a>        dis_grid,</span>
<span id="cb776-19"><a href="moving-beyond-linearity.html#cb776-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">predict</span>(.x, <span class="at">new_data =</span> dis_grid),</span>
<span id="cb776-20"><a href="moving-beyond-linearity.html#cb776-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">predict</span>(.x, <span class="at">new_data =</span> dis_grid, <span class="at">type =</span> <span class="st">&quot;conf_int&quot;</span>)</span>
<span id="cb776-21"><a href="moving-beyond-linearity.html#cb776-21" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb776-22"><a href="moving-beyond-linearity.html#cb776-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb776-23"><a href="moving-beyond-linearity.html#cb776-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">mod_rss =</span> <span class="fu">map_dbl</span>(poly_fit, <span class="sc">~</span> <span class="fu">glance</span>(.x)<span class="sc">$</span>deviance)</span>
<span id="cb776-24"><a href="moving-beyond-linearity.html#cb776-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb776-25"><a href="moving-beyond-linearity.html#cb776-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb776-26"><a href="moving-beyond-linearity.html#cb776-26" aria-hidden="true" tabindex="-1"></a>p_base <span class="sc">+</span></span>
<span id="cb776-27"><a href="moving-beyond-linearity.html#cb776-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb776-28"><a href="moving-beyond-linearity.html#cb776-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> boston_poly_fits <span class="sc">%&gt;%</span></span>
<span id="cb776-29"><a href="moving-beyond-linearity.html#cb776-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb776-30"><a href="moving-beyond-linearity.html#cb776-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">degree_label =</span> <span class="fu">fct_inorder</span>(<span class="fu">paste0</span>(degree, <span class="st">&quot; (&quot;</span>, <span class="fu">round</span>(mod_rss, <span class="dv">3</span>), <span class="st">&quot;)&quot;</span>),</span>
<span id="cb776-31"><a href="moving-beyond-linearity.html#cb776-31" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb776-32"><a href="moving-beyond-linearity.html#cb776-32" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb776-33"><a href="moving-beyond-linearity.html#cb776-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unnest</span>(poly_pred),</span>
<span id="cb776-34"><a href="moving-beyond-linearity.html#cb776-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> .pred, <span class="at">color =</span> degree_label), <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb776-35"><a href="moving-beyond-linearity.html#cb776-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb776-36"><a href="moving-beyond-linearity.html#cb776-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">end =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb776-37"><a href="moving-beyond-linearity.html#cb776-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Degree (RSS)&quot;</span>) <span class="sc">+</span></span>
<span id="cb776-38"><a href="moving-beyond-linearity.html#cb776-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.35</span>, <span class="fl">0.9</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-422-1.png" width="576" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Choose the optimal degree by cross-validation.</li>
</ol>
<p>Now I can <code>tune()</code>:</p>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="moving-beyond-linearity.html#cb777-1" aria-hidden="true" tabindex="-1"></a>boston_poly_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(nox <span class="sc">~</span> dis, <span class="at">data =</span> boston) <span class="sc">%&gt;%</span></span>
<span id="cb777-2"><a href="moving-beyond-linearity.html#cb777-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(dis, <span class="at">degree =</span> <span class="fu">tune</span>())</span>
<span id="cb777-3"><a href="moving-beyond-linearity.html#cb777-3" aria-hidden="true" tabindex="-1"></a>boston_poly_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb777-4"><a href="moving-beyond-linearity.html#cb777-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(boston_poly_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb777-5"><a href="moving-beyond-linearity.html#cb777-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec)</span>
<span id="cb777-6"><a href="moving-beyond-linearity.html#cb777-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb777-7"><a href="moving-beyond-linearity.html#cb777-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb777-8"><a href="moving-beyond-linearity.html#cb777-8" aria-hidden="true" tabindex="-1"></a>degree_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">degree =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb777-9"><a href="moving-beyond-linearity.html#cb777-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb777-10"><a href="moving-beyond-linearity.html#cb777-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4928</span>)</span>
<span id="cb777-11"><a href="moving-beyond-linearity.html#cb777-11" aria-hidden="true" tabindex="-1"></a>boston_resamples <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(boston, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb777-12"><a href="moving-beyond-linearity.html#cb777-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb777-13"><a href="moving-beyond-linearity.html#cb777-13" aria-hidden="true" tabindex="-1"></a>boston_poly_tune <span class="ot">&lt;-</span></span>
<span id="cb777-14"><a href="moving-beyond-linearity.html#cb777-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(boston_poly_workflow, <span class="at">resamples =</span> boston_resamples,</span>
<span id="cb777-15"><a href="moving-beyond-linearity.html#cb777-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> degree_grid)</span>
<span id="cb777-16"><a href="moving-beyond-linearity.html#cb777-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb777-17"><a href="moving-beyond-linearity.html#cb777-17" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(boston_poly_tune) <span class="sc">+</span></span>
<span id="cb777-18"><a href="moving-beyond-linearity.html#cb777-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-423-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Both the 3-degree and 4-degree fits appear best.
I would choose the 3-degree since it is simpler.
You could also make a case for the quadratic fit by the one SE rule:</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="moving-beyond-linearity.html#cb778-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select_by_one_std_err</span>(boston_poly_tune, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>, degree)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##   degree .metric .estimator   mean     n std_err .config            .best .bound
##    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt;
## 1      2 rmse    standard   0.0636    10 0.00211 Preprocessor02_M~ 0.0618 0.0641</code></pre>
<ol start="4" style="list-style-type: lower-alpha">
<li>Regression splines.</li>
</ol>
<p>With 4 degrees of freedom, a cubic spline has a single knot.
By default, it will be placed at the median of <code>dis</code>:</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb780-1"><a href="moving-beyond-linearity.html#cb780-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">bs</span>(boston<span class="sc">$</span>dis, <span class="at">df =</span> <span class="dv">4</span>), <span class="st">&quot;knots&quot;</span>)</span></code></pre></div>
<pre><code>##     50% 
## 3.20745</code></pre>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="moving-beyond-linearity.html#cb782-1" aria-hidden="true" tabindex="-1"></a>boston_spline_4_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(nox <span class="sc">~</span> dis, <span class="at">data =</span> boston) <span class="sc">%&gt;%</span></span>
<span id="cb782-2"><a href="moving-beyond-linearity.html#cb782-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_bs</span>(dis, <span class="at">deg_free =</span> <span class="dv">4</span>)</span>
<span id="cb782-3"><a href="moving-beyond-linearity.html#cb782-3" aria-hidden="true" tabindex="-1"></a>boston_spline_4_fit <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb782-4"><a href="moving-beyond-linearity.html#cb782-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb782-5"><a href="moving-beyond-linearity.html#cb782-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(boston_spline_4_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb782-6"><a href="moving-beyond-linearity.html#cb782-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> boston)</span>
<span id="cb782-7"><a href="moving-beyond-linearity.html#cb782-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb782-8"><a href="moving-beyond-linearity.html#cb782-8" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_fit_engine</span>(boston_spline_4_fit) <span class="sc">%&gt;%</span></span>
<span id="cb782-9"><a href="moving-beyond-linearity.html#cb782-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## Call:
## stats::lm(formula = ..y ~ ., data = data)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.124622 -0.039259 -0.008514  0.020850  0.193891 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.73447    0.01460  50.306  &lt; 2e-16 ***
## dis_bs_1    -0.05810    0.02186  -2.658  0.00812 ** 
## dis_bs_2    -0.46356    0.02366 -19.596  &lt; 2e-16 ***
## dis_bs_3    -0.19979    0.04311  -4.634 4.58e-06 ***
## dis_bs_4    -0.38881    0.04551  -8.544  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.06195 on 501 degrees of freedom
## Multiple R-squared:  0.7164, Adjusted R-squared:  0.7142 
## F-statistic: 316.5 on 4 and 501 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb784-1"><a href="moving-beyond-linearity.html#cb784-1" aria-hidden="true" tabindex="-1"></a>boston_spline_4_pred <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb784-2"><a href="moving-beyond-linearity.html#cb784-2" aria-hidden="true" tabindex="-1"></a>  dis_grid,</span>
<span id="cb784-3"><a href="moving-beyond-linearity.html#cb784-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(boston_spline_4_fit, <span class="at">new_data =</span> dis_grid),</span>
<span id="cb784-4"><a href="moving-beyond-linearity.html#cb784-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(boston_spline_4_fit, <span class="at">new_data =</span> dis_grid, <span class="at">type =</span> <span class="st">&quot;conf_int&quot;</span>)</span>
<span id="cb784-5"><a href="moving-beyond-linearity.html#cb784-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb784-6"><a href="moving-beyond-linearity.html#cb784-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb784-7"><a href="moving-beyond-linearity.html#cb784-7" aria-hidden="true" tabindex="-1"></a>p_base <span class="sc">+</span></span>
<span id="cb784-8"><a href="moving-beyond-linearity.html#cb784-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> boston_spline_4_pred, <span class="fu">aes</span>(<span class="at">y =</span> .pred),</span>
<span id="cb784-9"><a href="moving-beyond-linearity.html#cb784-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>ruby_red, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb784-10"><a href="moving-beyond-linearity.html#cb784-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> boston_spline_4_pred,</span>
<span id="cb784-11"><a href="moving-beyond-linearity.html#cb784-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> .pred_lower, <span class="at">ymax =</span> .pred_upper),</span>
<span id="cb784-12"><a href="moving-beyond-linearity.html#cb784-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>ruby_red, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-427-1.png" width="576" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Regression splines for a range of degrees of freedom.</li>
</ol>
<p>I’ll range <code>deg_free</code> from 3 (no knots) to 10 (7 knots):</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="moving-beyond-linearity.html#cb785-1" aria-hidden="true" tabindex="-1"></a>boston_spline_fits <span class="ot">&lt;-</span></span>
<span id="cb785-2"><a href="moving-beyond-linearity.html#cb785-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb785-3"><a href="moving-beyond-linearity.html#cb785-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">deg_free =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb785-4"><a href="moving-beyond-linearity.html#cb785-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">spline_fit =</span> <span class="fu">map</span>(</span>
<span id="cb785-5"><a href="moving-beyond-linearity.html#cb785-5" aria-hidden="true" tabindex="-1"></a>      deg_free,</span>
<span id="cb785-6"><a href="moving-beyond-linearity.html#cb785-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb785-7"><a href="moving-beyond-linearity.html#cb785-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_recipe</span>(boston_recipe <span class="sc">%&gt;%</span> <span class="fu">step_bs</span>(dis, <span class="at">deg_free =</span> .x)) <span class="sc">%&gt;%</span></span>
<span id="cb785-8"><a href="moving-beyond-linearity.html#cb785-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_model</span>(lm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb785-9"><a href="moving-beyond-linearity.html#cb785-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fit</span>(<span class="at">data =</span> boston)</span>
<span id="cb785-10"><a href="moving-beyond-linearity.html#cb785-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb785-11"><a href="moving-beyond-linearity.html#cb785-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb785-12"><a href="moving-beyond-linearity.html#cb785-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb785-13"><a href="moving-beyond-linearity.html#cb785-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">spline_pred =</span> <span class="fu">map</span>(</span>
<span id="cb785-14"><a href="moving-beyond-linearity.html#cb785-14" aria-hidden="true" tabindex="-1"></a>      spline_fit,</span>
<span id="cb785-15"><a href="moving-beyond-linearity.html#cb785-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">bind_cols</span>(</span>
<span id="cb785-16"><a href="moving-beyond-linearity.html#cb785-16" aria-hidden="true" tabindex="-1"></a>        dis_grid,</span>
<span id="cb785-17"><a href="moving-beyond-linearity.html#cb785-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">predict</span>(.x, <span class="at">new_data =</span> dis_grid),</span>
<span id="cb785-18"><a href="moving-beyond-linearity.html#cb785-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">predict</span>(.x, <span class="at">new_data =</span> dis_grid, <span class="at">type =</span> <span class="st">&quot;conf_int&quot;</span>)</span>
<span id="cb785-19"><a href="moving-beyond-linearity.html#cb785-19" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb785-20"><a href="moving-beyond-linearity.html#cb785-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb785-21"><a href="moving-beyond-linearity.html#cb785-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">mod_rss =</span> <span class="fu">map_dbl</span>(spline_fit, <span class="sc">~</span> <span class="fu">glance</span>(.x)<span class="sc">$</span>deviance)</span>
<span id="cb785-22"><a href="moving-beyond-linearity.html#cb785-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb785-23"><a href="moving-beyond-linearity.html#cb785-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb785-24"><a href="moving-beyond-linearity.html#cb785-24" aria-hidden="true" tabindex="-1"></a>p_base <span class="sc">+</span></span>
<span id="cb785-25"><a href="moving-beyond-linearity.html#cb785-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb785-26"><a href="moving-beyond-linearity.html#cb785-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> boston_spline_fits <span class="sc">%&gt;%</span></span>
<span id="cb785-27"><a href="moving-beyond-linearity.html#cb785-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb785-28"><a href="moving-beyond-linearity.html#cb785-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">df_label =</span> <span class="fu">fct_inorder</span>(<span class="fu">paste0</span>(deg_free, <span class="st">&quot; (&quot;</span>, <span class="fu">round</span>(mod_rss, <span class="dv">3</span>), <span class="st">&quot;)&quot;</span>),</span>
<span id="cb785-29"><a href="moving-beyond-linearity.html#cb785-29" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb785-30"><a href="moving-beyond-linearity.html#cb785-30" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb785-31"><a href="moving-beyond-linearity.html#cb785-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unnest</span>(spline_pred),</span>
<span id="cb785-32"><a href="moving-beyond-linearity.html#cb785-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> .pred, <span class="at">color =</span> df_label), <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb785-33"><a href="moving-beyond-linearity.html#cb785-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb785-34"><a href="moving-beyond-linearity.html#cb785-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">end =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb785-35"><a href="moving-beyond-linearity.html#cb785-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;df (RSS)&quot;</span>) <span class="sc">+</span></span>
<span id="cb785-36"><a href="moving-beyond-linearity.html#cb785-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.35</span>, <span class="fl">0.9</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-428-1.png" width="576" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Choose the optimal degrees of freedom by cross-validation</li>
</ol>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="moving-beyond-linearity.html#cb786-1" aria-hidden="true" tabindex="-1"></a>boston_spline_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(nox <span class="sc">~</span> dis, <span class="at">data =</span> boston) <span class="sc">%&gt;%</span></span>
<span id="cb786-2"><a href="moving-beyond-linearity.html#cb786-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_bs</span>(dis, <span class="at">deg_free =</span> <span class="fu">tune</span>())</span>
<span id="cb786-3"><a href="moving-beyond-linearity.html#cb786-3" aria-hidden="true" tabindex="-1"></a>boston_spline_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb786-4"><a href="moving-beyond-linearity.html#cb786-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(boston_spline_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb786-5"><a href="moving-beyond-linearity.html#cb786-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec)</span>
<span id="cb786-6"><a href="moving-beyond-linearity.html#cb786-6" aria-hidden="true" tabindex="-1"></a>deg_free_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">deg_free =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">15</span>)</span></code></pre></div>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb787-1"><a href="moving-beyond-linearity.html#cb787-1" aria-hidden="true" tabindex="-1"></a>boston_spline_tune <span class="ot">&lt;-</span></span>
<span id="cb787-2"><a href="moving-beyond-linearity.html#cb787-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(boston_spline_workflow, <span class="at">resamples =</span> boston_resamples,</span>
<span id="cb787-3"><a href="moving-beyond-linearity.html#cb787-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> deg_free_grid)</span></code></pre></div>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="moving-beyond-linearity.html#cb788-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(boston_spline_tune) <span class="sc">+</span></span>
<span id="cb788-2"><a href="moving-beyond-linearity.html#cb788-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">15</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-430-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The RMSE estimates are a bit noisier than I would like.
The best model within one SE:</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="moving-beyond-linearity.html#cb789-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select_by_one_std_err</span>(boston_spline_tune, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>, deg_free)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##   deg_free .metric .estimator   mean     n std_err .config          .best .bound
##      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;
## 1        3 rmse    standard   0.0618    10 0.00235 Preprocessor01~ 0.0603 0.0626</code></pre>
<p>From the plot, it might be surprising that the best model has 0 knots (<code>deg_free = 3</code>), but relative to the standard errors, there isn’t a huge improvement for larger values.</p>
<p>An alternative way of choosing the model is by percent loss via <code>tune::select_by_pct_loss()</code>.
The best model here has an RMSE of
0.0603.
The <code>deg_free = 3</code> model has an RMSE of
0.0618.
This corresponds to a percentage loss of
(0.0618 - 0.0603) /
0.0603 * 100 =
2.5%.
We can choose an upper <code>limit</code> of acceptable percent loss in <code>tune::select_by_pct_loss()</code> – the default is <code>limit = 2</code> which eliminiates <code>deg_free = 3</code> as an option:</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="moving-beyond-linearity.html#cb791-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select_by_pct_loss</span>(boston_spline_tune, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>, deg_free)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##   deg_free .metric .estimator   mean     n std_err .config           .best .loss
##      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;
## 1        9 rmse    standard   0.0607    10 0.00245 Preprocessor07_~ 0.0603 0.712</code></pre>
<p>By percent loss, <code>deg_free = 9</code> is chosen.</p>
</div>
<div id="predicting-tuition-with-college" class="section level4" number="7.9.0.4">
<h4><span class="header-section-number">7.9.0.4</span> 10. Predicting tuition with <code>college</code></h4>
</div>
</div>
<div id="delete" class="section level3" number="7.9.1">
<h3><span class="header-section-number">7.9.1</span> delete</h3>
<p>The <code>tidymodels</code> implementation of smooth splines and GAMs uses the <code>mgcv</code> package as the default (and currently only) engine, so I’ll use that for this example:</p>
<p>See some examples in the <code>parsnip</code> documentation [here]
(<a href="https://parsnip.tidymodels.org/articles/Examples.html?q=additiv#gen_additive_mod-models" class="uri">https://parsnip.tidymodels.org/articles/Examples.html?q=additiv#gen_additive_mod-models</a>)
and [here]
(<a href="https://parsnip.tidymodels.org/reference/details_gen_additive_mod_mgcv.html?q=gen_additive#model-fitting" class="uri">https://parsnip.tidymodels.org/reference/details_gen_additive_mod_mgcv.html?q=gen_additive#model-fitting</a>).
An example of tuning degrees of freedom can be found <a href="https://community.rstudio.com/t/tune-grid-and-gam-model-incl-gam-formula/127206/2">here</a>.</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="moving-beyond-linearity.html#cb793-1" aria-hidden="true" tabindex="-1"></a>wage_smooth_fit_16 <span class="ot">&lt;-</span></span>
<span id="cb793-2"><a href="moving-beyond-linearity.html#cb793-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="fu">predict</span>(wage_smooth_df_16, age_grid)) <span class="sc">%&gt;%</span></span>
<span id="cb793-3"><a href="moving-beyond-linearity.html#cb793-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;smooth.spline()&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb793-4"><a href="moving-beyond-linearity.html#cb793-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">age =</span> x, <span class="at">.fitted =</span> y)</span>
<span id="cb793-5"><a href="moving-beyond-linearity.html#cb793-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb793-6"><a href="moving-beyond-linearity.html#cb793-6" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(<span class="st">&quot;package:mgcv&quot;</span>, <span class="at">unload =</span> <span class="cn">TRUE</span>)</span>
<span id="cb793-7"><a href="moving-beyond-linearity.html#cb793-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gam)</span>
<span id="cb793-8"><a href="moving-beyond-linearity.html#cb793-8" aria-hidden="true" tabindex="-1"></a>wage_gam_fit_16 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(age, <span class="at">df =</span> <span class="dv">16</span>), <span class="at">data =</span> wage)</span>
<span id="cb793-9"><a href="moving-beyond-linearity.html#cb793-9" aria-hidden="true" tabindex="-1"></a>wage_gam_fit_16_pred <span class="ot">&lt;-</span></span>
<span id="cb793-10"><a href="moving-beyond-linearity.html#cb793-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(wage_gam_fit_16, <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid)) <span class="sc">%&gt;%</span></span>
<span id="cb793-11"><a href="moving-beyond-linearity.html#cb793-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;gam()&quot;</span>)</span>
<span id="cb793-12"><a href="moving-beyond-linearity.html#cb793-12" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(<span class="st">&quot;package:gam&quot;</span>, <span class="at">unload =</span> <span class="cn">TRUE</span>)</span>
<span id="cb793-13"><a href="moving-beyond-linearity.html#cb793-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb793-14"><a href="moving-beyond-linearity.html#cb793-14" aria-hidden="true" tabindex="-1"></a>wage_mgcv_fit_16 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(age, <span class="at">k =</span> <span class="dv">16</span>, <span class="at">fx =</span> <span class="cn">TRUE</span>), <span class="at">data =</span> wage)</span>
<span id="cb793-15"><a href="moving-beyond-linearity.html#cb793-15" aria-hidden="true" tabindex="-1"></a>wage_mgcv_fit_16_pred <span class="ot">&lt;-</span></span>
<span id="cb793-16"><a href="moving-beyond-linearity.html#cb793-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(wage_mgcv_fit_16, <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid)) <span class="sc">%&gt;%</span></span>
<span id="cb793-17"><a href="moving-beyond-linearity.html#cb793-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;mgcv()&quot;</span>)</span>
<span id="cb793-18"><a href="moving-beyond-linearity.html#cb793-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb793-19"><a href="moving-beyond-linearity.html#cb793-19" aria-hidden="true" tabindex="-1"></a>wage_tidymodels_fit <span class="ot">&lt;-</span> <span class="fu">gen_additive_mod</span>(<span class="at">select_features =</span> <span class="cn">FALSE</span>, <span class="at">adjust_deg_free =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb793-20"><a href="moving-beyond-linearity.html#cb793-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;mgcv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb793-21"><a href="moving-beyond-linearity.html#cb793-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb793-22"><a href="moving-beyond-linearity.html#cb793-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(wage <span class="sc">~</span> <span class="fu">s</span>(age, <span class="at">k =</span> <span class="dv">16</span>, <span class="at">fx =</span> <span class="cn">TRUE</span>), <span class="at">data =</span> wage)</span>
<span id="cb793-23"><a href="moving-beyond-linearity.html#cb793-23" aria-hidden="true" tabindex="-1"></a>wage_tidymodels_fit_pred <span class="ot">&lt;-</span></span>
<span id="cb793-24"><a href="moving-beyond-linearity.html#cb793-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(wage_tidymodels_fit, <span class="at">new_data =</span> <span class="fu">tibble</span>(<span class="at">age =</span> age_grid)) <span class="sc">%&gt;%</span></span>
<span id="cb793-25"><a href="moving-beyond-linearity.html#cb793-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;tidymodels&quot;</span>)</span>
<span id="cb793-26"><a href="moving-beyond-linearity.html#cb793-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb793-27"><a href="moving-beyond-linearity.html#cb793-27" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb793-28"><a href="moving-beyond-linearity.html#cb793-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wage_smooth_fit_16,</span></span>
<span id="cb793-29"><a href="moving-beyond-linearity.html#cb793-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wage_gam_fit_16_pred,</span></span>
<span id="cb793-30"><a href="moving-beyond-linearity.html#cb793-30" aria-hidden="true" tabindex="-1"></a>  wage_mgcv_fit_16_pred,</span>
<span id="cb793-31"><a href="moving-beyond-linearity.html#cb793-31" aria-hidden="true" tabindex="-1"></a>  wage_tidymodels_fit_pred</span>
<span id="cb793-32"><a href="moving-beyond-linearity.html#cb793-32" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb793-33"><a href="moving-beyond-linearity.html#cb793-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb793-34"><a href="moving-beyond-linearity.html#cb793-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(data = wage, aes(x = age, y = wage),</span></span>
<span id="cb793-35"><a href="moving-beyond-linearity.html#cb793-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            shape = 21, color = &quot;grey50&quot;, alpha = 0.5) +</span></span>
<span id="cb793-36"><a href="moving-beyond-linearity.html#cb793-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted, <span class="at">color =</span> model), <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb793-37"><a href="moving-beyond-linearity.html#cb793-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.7</span>)) <span class="sc">+</span></span>
<span id="cb793-38"><a href="moving-beyond-linearity.html#cb793-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>)</span>
<span id="cb793-39"><a href="moving-beyond-linearity.html#cb793-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#facet_wrap(~ model)</span></span></code></pre></div>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb794-1"><a href="moving-beyond-linearity.html#cb794-1" aria-hidden="true" tabindex="-1"></a>gam_spec <span class="ot">&lt;-</span> <span class="fu">gen_additive_mod</span>(<span class="at">select_features =</span> <span class="cn">FALSE</span>, <span class="at">adjust_deg_free =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb794-2"><a href="moving-beyond-linearity.html#cb794-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&#39;mgcv&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb794-3"><a href="moving-beyond-linearity.html#cb794-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&#39;regression&#39;</span>)</span>
<span id="cb794-4"><a href="moving-beyond-linearity.html#cb794-4" aria-hidden="true" tabindex="-1"></a>wage_gam_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb794-5"><a href="moving-beyond-linearity.html#cb794-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(gam_spec) <span class="sc">%&gt;%</span></span>
<span id="cb794-6"><a href="moving-beyond-linearity.html#cb794-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>()</span>
<span id="cb794-7"><a href="moving-beyond-linearity.html#cb794-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-8"><a href="moving-beyond-linearity.html#cb794-8" aria-hidden="true" tabindex="-1"></a>wage_resamples</span>
<span id="cb794-9"><a href="moving-beyond-linearity.html#cb794-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_resamples</span>(<span class="at">object =</span> )</span>
<span id="cb794-10"><a href="moving-beyond-linearity.html#cb794-10" aria-hidden="true" tabindex="-1"></a>wage_tidymodels_fit <span class="ot">&lt;-</span> <span class="fu">gen_additive_mod</span>(<span class="at">select_features =</span> <span class="cn">FALSE</span>, <span class="at">adjust_deg_free =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb794-11"><a href="moving-beyond-linearity.html#cb794-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;mgcv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb794-12"><a href="moving-beyond-linearity.html#cb794-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb794-13"><a href="moving-beyond-linearity.html#cb794-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(wage <span class="sc">~</span> <span class="fu">s</span>(age, <span class="at">k =</span> <span class="dv">16</span>, <span class="at">fx =</span> <span class="cn">TRUE</span>), <span class="at">data =</span> wage)</span>
<span id="cb794-14"><a href="moving-beyond-linearity.html#cb794-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-15"><a href="moving-beyond-linearity.html#cb794-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-16"><a href="moving-beyond-linearity.html#cb794-16" aria-hidden="true" tabindex="-1"></a><span class="co"># fitting gam model</span></span>
<span id="cb794-17"><a href="moving-beyond-linearity.html#cb794-17" aria-hidden="true" tabindex="-1"></a>gam_mod <span class="ot">&lt;-</span> <span class="fu">fit</span>(gam_spec, interest_rate <span class="sc">~</span> <span class="fu">s</span>(annual_income) <span class="sc">+</span> <span class="fu">s</span>(debt_to_income) <span class="sc">+</span> <span class="fu">s</span>(delinq_2y), <span class="at">data =</span> loans)</span></code></pre></div>
</div>
</div>
<div id="reproducibility-4" class="section level2 unnumbered">
<h2>Reproducibility</h2>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="moving-beyond-linearity.html#cb795-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2022-04-16 22:17:57 AST&quot;</code></pre>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="moving-beyond-linearity.html#cb797-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">&quot;git2r&quot;</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()) {</span>
<span id="cb797-2"><a href="moving-beyond-linearity.html#cb797-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (git2r<span class="sc">::</span><span class="fu">in_repository</span>()) {</span>
<span id="cb797-3"><a href="moving-beyond-linearity.html#cb797-3" aria-hidden="true" tabindex="-1"></a>    git2r<span class="sc">::</span><span class="fu">repository</span>()</span>
<span id="cb797-4"><a href="moving-beyond-linearity.html#cb797-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb797-5"><a href="moving-beyond-linearity.html#cb797-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Local:    main C:/Users/tdunn/Documents/learning/islr-tidy
## Remote:   main @ origin (https://github.com/taylordunn/islr-tidy)
## Head:     [6db93f0] 2022-04-16: Started the exercises</code></pre>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="moving-beyond-linearity.html#cb799-1" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>()</span></code></pre></div>
<pre><code>## - Session info ---------------------------------------------------------------
##  setting  value                       
##  version  R version 4.1.3 (2022-03-10)
##  os       Windows 10 x64              
##  system   x86_64, mingw32             
##  ui       RTerm                       
##  language (EN)                        
##  collate  English_Canada.1252         
##  ctype    English_Canada.1252         
##  tz       America/Curacao             
##  date     2022-04-16                  
## 
## - Packages -------------------------------------------------------------------
##  package        * version    date       lib
##  abind            1.4-5      2016-07-21 [1]
##  assertthat       0.2.1      2019-03-21 [1]
##  backports        1.2.1      2020-12-09 [1]
##  base64enc        0.1-3      2015-07-28 [1]
##  bayestestR       0.10.5     2021-07-26 [1]
##  BiocParallel     1.28.3     2021-12-09 [1]
##  bit              4.0.4      2020-08-04 [1]
##  bit64            4.0.5      2020-08-30 [1]
##  bookdown         0.24       2021-09-02 [1]
##  boot             1.3-28     2021-05-03 [2]
##  broom          * 0.7.10     2021-10-31 [1]
##  bslib            0.2.5.1    2021-05-18 [1]
##  cachem           1.0.6      2021-08-19 [1]
##  car              3.0-12     2021-11-06 [1]
##  carData          3.0-4      2020-05-22 [1]
##  cellranger       1.1.0      2016-07-27 [1]
##  checkmate        2.0.0      2020-02-06 [1]
##  class            7.3-20     2022-01-16 [2]
##  cli              3.2.0      2022-02-14 [1]
##  coda             0.19-4     2020-09-30 [1]
##  codetools        0.2-18     2020-11-04 [2]
##  colorspace       2.0-3      2022-02-21 [1]
##  combinat         0.0-8      2012-10-29 [1]
##  conflicted       1.0.4      2019-06-21 [1]
##  corpcor          1.6.10     2021-09-16 [1]
##  corrr          * 0.4.3      2020-11-24 [1]
##  crayon           1.5.1      2022-03-26 [1]
##  datawizard       0.1.0      2021-06-18 [1]
##  DBI              1.1.2      2021-12-20 [1]
##  dbplyr           2.1.1      2021-04-06 [1]
##  DEoptimR         1.0-9      2021-05-24 [1]
##  dials          * 0.0.10     2021-09-10 [1]
##  DiceDesign       1.9        2021-02-13 [1]
##  digest           0.6.29     2021-12-01 [1]
##  discrim        * 0.1.3      2021-07-21 [1]
##  distill          1.3        2021-10-13 [1]
##  distributional   0.2.2      2021-02-02 [1]
##  doParallel     * 1.0.16     2020-10-16 [1]
##  downlit          0.4.0      2021-10-29 [1]
##  dplyr          * 1.0.8      2022-02-08 [1]
##  dunnr          * 0.2.5      2022-01-15 [1]
##  effectsize       0.4.5      2021-05-25 [1]
##  ellipse          0.4.2      2020-05-27 [1]
##  ellipsis         0.3.2      2021-04-29 [1]
##  emmeans          1.7.0      2021-09-29 [1]
##  equatiomatic     0.2.0      2021-01-30 [1]
##  estimability     1.3        2018-02-11 [1]
##  evaluate         0.14       2019-05-28 [1]
##  extrafont        0.17       2014-12-08 [1]
##  extrafontdb      1.0        2012-06-11 [1]
##  fansi            1.0.3      2022-03-24 [1]
##  farver           2.1.0      2021-02-28 [1]
##  fastmap          1.1.0      2021-01-25 [1]
##  forcats        * 0.5.1      2021-01-27 [1]
##  foreach        * 1.5.2      2022-02-02 [1]
##  fs               1.5.2      2021-12-08 [1]
##  furrr            0.2.3      2021-06-25 [1]
##  future         * 1.24.0     2022-02-19 [1]
##  future.apply     1.8.1      2021-08-10 [1]
##  generics         0.1.2      2022-01-31 [1]
##  GGally           2.1.2      2021-06-21 [1]
##  ggdist         * 3.0.0      2021-07-19 [1]
##  ggplot2        * 3.3.5      2021-06-25 [1]
##  ggrepel          0.9.1      2021-01-15 [1]
##  ggridges         0.5.3      2021-01-08 [1]
##  git2r            0.28.0     2021-01-10 [1]
##  glmnet         * 4.1-3      2021-11-02 [1]
##  globals          0.14.0     2020-11-22 [1]
##  glue             1.6.2      2022-02-24 [1]
##  gower            0.2.2      2020-06-23 [1]
##  GPfit            1.0-8      2019-02-08 [1]
##  gridExtra        2.3        2017-09-09 [1]
##  gt             * 0.3.1      2021-08-07 [1]
##  gtable           0.3.0      2019-03-25 [1]
##  hardhat          0.2.0      2022-01-24 [1]
##  haven            2.4.1      2021-04-23 [1]
##  here           * 1.0.1      2020-12-13 [1]
##  highr            0.9        2021-04-16 [1]
##  hms              1.1.1      2021-09-26 [1]
##  htmltools        0.5.2      2021-08-25 [1]
##  httpuv           1.6.5      2022-01-05 [1]
##  httr             1.4.2      2020-07-20 [1]
##  igraph           1.2.11     2022-01-04 [1]
##  infer          * 1.0.0      2021-08-13 [1]
##  insight          0.14.2     2021-06-22 [1]
##  ipred            0.9-12     2021-09-15 [1]
##  ISLR2          * 1.3-1      2022-01-10 [1]
##  iterators      * 1.0.14     2022-02-05 [1]
##  janitor          2.1.0      2021-01-05 [1]
##  jquerylib        0.1.4      2021-04-26 [1]
##  jsonlite         1.7.3      2022-01-17 [1]
##  kknn             1.3.1      2016-03-26 [1]
##  klaR             0.6-15     2020-02-19 [1]
##  knitr            1.37       2021-12-16 [1]
##  labeling         0.4.2      2020-10-20 [1]
##  labelled         2.8.0      2021-03-08 [1]
##  later            1.3.0      2021-08-18 [1]
##  lattice        * 0.20-45    2021-09-22 [2]
##  lava             1.6.10     2021-09-02 [1]
##  leaps          * 3.1        2020-01-16 [1]
##  lhs              1.1.1      2020-10-05 [1]
##  lifecycle        1.0.1      2021-09-24 [1]
##  listenv          0.8.0      2019-12-05 [1]
##  lubridate        1.8.0      2021-10-07 [1]
##  magrittr         2.0.2      2022-01-26 [1]
##  MASS           * 7.3-55     2022-01-16 [2]
##  Matrix         * 1.4-0      2021-12-08 [2]
##  matrixStats      0.61.0     2021-09-17 [1]
##  memoise          2.0.1      2021-11-26 [1]
##  MetBrewer        0.1.0      2022-01-05 [1]
##  mgcv           * 1.8-40     2022-03-29 [1]
##  mime             0.12       2021-09-28 [1]
##  miniUI           0.1.1.1    2018-05-18 [1]
##  mixOmics       * 6.19.3     2022-04-04 [1]
##  modeldata      * 0.1.1      2021-07-14 [1]
##  modelr           0.1.8      2020-05-19 [1]
##  munsell          0.5.0      2018-06-12 [1]
##  mvtnorm        * 1.1-3      2021-10-08 [1]
##  nlme           * 3.1-155    2022-01-16 [2]
##  nnet             7.3-17     2022-01-16 [2]
##  parallelly       1.30.0     2021-12-17 [1]
##  parameters       0.14.0     2021-05-29 [1]
##  parsnip        * 0.1.7      2021-07-21 [1]
##  patchwork      * 1.1.1      2020-12-17 [1]
##  performance      0.7.3      2021-07-21 [1]
##  pillar           1.7.0      2022-02-01 [1]
##  pkgconfig        2.0.3      2019-09-22 [1]
##  pls            * 2.8-0      2021-09-03 [1]
##  plyr             1.8.7      2022-03-24 [1]
##  poissonreg     * 0.1.1      2021-08-07 [1]
##  prettyunits      1.1.1      2020-01-24 [1]
##  pROC             1.17.0.1   2021-01-13 [1]
##  prodlim          2019.11.13 2019-11-17 [1]
##  promises         1.2.0.1    2021-02-11 [1]
##  purrr          * 0.3.4      2020-04-17 [1]
##  qqplotr          0.0.5      2021-04-23 [1]
##  questionr        0.7.5      2021-10-06 [1]
##  R6               2.5.1      2021-08-19 [1]
##  rARPACK          0.11-0     2016-03-10 [1]
##  RColorBrewer     1.1-3      2022-04-03 [1]
##  Rcpp             1.0.8.3    2022-03-17 [1]
##  readr          * 2.1.1      2021-11-30 [1]
##  readxl           1.3.1      2019-03-13 [1]
##  recipes        * 0.1.17     2021-09-27 [1]
##  repr             1.1.3      2021-01-21 [1]
##  reprex           2.0.0      2021-04-02 [1]
##  reshape          0.8.8      2018-10-23 [1]
##  reshape2         1.4.4      2020-04-09 [1]
##  rlang          * 1.0.2      2022-03-04 [1]
##  rmarkdown        2.11       2021-09-14 [1]
##  robustbase       0.93-8     2021-06-02 [1]
##  rpart            4.1.16     2022-01-24 [2]
##  rprojroot        2.0.2      2020-11-15 [1]
##  rsample        * 0.1.0      2021-05-08 [1]
##  RSpectra         0.16-0     2019-12-01 [1]
##  rstudioapi       0.13       2020-11-12 [1]
##  Rttf2pt1         1.3.8      2020-01-10 [1]
##  rvest            1.0.0      2021-03-09 [1]
##  sass             0.4.0      2021-05-12 [1]
##  scales         * 1.1.1      2020-05-11 [1]
##  see              0.6.4      2021-05-29 [1]
##  sessioninfo      1.1.1      2018-11-05 [1]
##  shape            1.4.6      2021-05-19 [1]
##  shiny            1.6.0      2021-01-25 [1]
##  skimr            2.1.3      2021-03-07 [1]
##  snakecase        0.11.0     2019-05-25 [1]
##  stringi          1.7.6      2021-11-29 [1]
##  stringr        * 1.4.0      2019-02-10 [1]
##  survival         3.2-13     2021-08-24 [2]
##  tibble         * 3.1.6      2021-11-07 [1]
##  tictoc         * 1.0.1      2021-04-19 [1]
##  tidymodels     * 0.1.4      2021-10-01 [1]
##  tidyr          * 1.2.0      2022-02-01 [1]
##  tidyselect       1.1.2      2022-02-21 [1]
##  tidyverse      * 1.3.1      2021-04-15 [1]
##  timeDate         3043.102   2018-02-21 [1]
##  tune           * 0.1.6      2021-07-21 [1]
##  tzdb             0.2.0      2021-10-27 [1]
##  usethis          2.1.5      2021-12-09 [1]
##  utf8             1.2.2      2021-07-24 [1]
##  vctrs          * 0.3.8      2021-04-29 [1]
##  viridisLite      0.4.0      2021-04-13 [1]
##  vroom            1.5.7      2021-11-30 [1]
##  withr            2.5.0      2022-03-03 [1]
##  workflows      * 0.2.3      2021-07-16 [1]
##  workflowsets   * 0.1.0      2021-07-22 [1]
##  xfun             0.29       2021-12-14 [1]
##  xml2             1.3.3      2021-11-30 [1]
##  xtable           1.8-4      2019-04-21 [1]
##  yaml             2.2.1      2020-02-01 [1]
##  yardstick      * 0.0.8      2021-03-28 [1]
##  source                                
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  Bioconductor                          
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.3)                        
##  Github (taylordunn/dunnr@c83b30e)     
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.1)                        
##  Github (mixOmicsTeam/mixOmics@974a8c9)
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.1)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.3)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.2)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
##  CRAN (R 4.1.0)                        
## 
## [1] C:/Users/tdunn/Documents/R/win-library/4.1
## [2] C:/Program Files/R/R-4.1.3/library</code></pre>

<div id="refs" class="references csl-bib-body hanging-indent">
<div class="csl-entry">
Hastie, Trevor, Robert Tibshirani, and Jerome Friedman. 2009. <em><span class="nocase">The Elements of Statistical Learning</span></em>. Springer Series in Statistics. New York, NY: Springer New York. <a href="https://doi.org/10.1007/978-0-387-84858-7">https://doi.org/10.1007/978-0-387-84858-7</a>.
</div>
<div class="csl-entry">
Smith, Gary. 2018. <span>“<span class="nocase">Step away from stepwise</span>.”</span> <em>Journal of Big Data</em> 5 (1): 32. <a href="https://doi.org/10.1186/s40537-018-0143-6">https://doi.org/10.1186/s40537-018-0143-6</a>.
</div>
</div>
</div>
</div>








            </section>

          </div>
        </div>
      </div>
<a href="linear-model-selection-and-regularization.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
